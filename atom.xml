<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>George&#39;s Blog</title>
  
  <subtitle>让我来给你讲讲他的传奇故事吧</subtitle>
  <link href="http://cyc0819.top/atom.xml" rel="self"/>
  
  <link href="http://cyc0819.top/"/>
  <updated>2022-06-18T13:25:37.813Z</updated>
  <id>http://cyc0819.top/</id>
  
  <author>
    <name>George Chan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Redis进阶学习</title>
    <link href="http://cyc0819.top/2022/06/18/2022-06-18-Redis%E8%BF%9B%E9%98%B6/"/>
    <id>http://cyc0819.top/2022/06/18/2022-06-18-Redis%E8%BF%9B%E9%98%B6/</id>
    <published>2022-06-18T13:25:15.000Z</published>
    <updated>2022-06-18T13:25:37.813Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Redis进阶学习"><a href="#Redis进阶学习" class="headerlink" title="Redis进阶学习"></a>Redis进阶学习</h1><h2 id="1、Redis事务"><a href="#1、Redis事务" class="headerlink" title="1、Redis事务"></a>1、Redis事务</h2><div class="story post-story"><h3 id="1-1、事务的概念"><a href="#1-1、事务的概念" class="headerlink" title="1.1、事务的概念"></a>1.1、事务的概念</h3><p>Redis 事务可以一次执行多个命令， 并且带有以下两个重要的保证：<br>事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断；但是队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行。也就是说 Redis 的事务具有<strong>隔离性</strong>，但是它没有<strong>隔离级别</strong>的概念。</p><p>其次，Redis 事务不保证原子性。在 Redis 中，单条命令是原子性执行的，但是事务不保证原子性，且没有回滚。如：事务在执行 EXEC 之前，入队的命令可能会出错。命令可能在 EXEC 调用后失败。</p><p>以下是 Redis 事务从开始到执行会经历的三个阶段：</p><ol><li>开始事务。</li><li>命令入队。</li><li>执行事务。</li></ol><h3 id="1-2、事务中的几个重要命令"><a href="#1-2、事务中的几个重要命令" class="headerlink" title="1.2、事务中的几个重要命令"></a>1.2、事务中的几个重要命令</h3><ol><li>开启事务：<code>multi</code></li><li>执行所有事务：<code>exec</code></li><li>取消事务，放弃执行所有事务：<code>discard</code></li><li>监视一个或多个 key ，如果在事务执行之前 key 被其他命令改动，则终止事务：<code>watch</code></li><li>取消对 key 的监视：<code>unwatch</code></li></ol><hr><p>如何执行？如下：<br>从执行 <code>Multi</code> 命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入完成<br>执行 <code>exec</code> 后，Redis 会将之前的命令队列中的命令依次执行。<br>组队的过程中可以通过 <code>discard</code> 来放弃组队。<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226170944.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226170944.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>从执行 <code>multi</code> 命令到执行 <code>exec</code> 这段过程中，如果某一个命令出现了错误，那么整个队列都会取消。而当执行了 <code>exec</code> 命令之后，如果有命令出现了错误，那么只有出现错误的命令不会被执行，其他的命令不会被影响。</p><p><strong>示例如下：</strong></p><p>执行事务：<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171736.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171736.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>放弃事务：<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171704.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171704.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>若在事务队列中存在命令性错误（类似于 java 编译性错误），则执行 EXEC 命令时，所有命令都不会执行:<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171748.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171748.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>若在事务队列中存在语法性错误（类似于 java 的 1/0 的运行时异常），则执行 EXEC 命令时，其他正确命令会被执行，错误命令抛出异常:<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171708.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226171708.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、锁"><a href="#2、锁" class="headerlink" title="2、锁"></a>2、锁</h2><div class="story post-story"><h3 id="2-1、悲观锁"><a href="#2-1、悲观锁" class="headerlink" title="2.1、悲观锁"></a>2.1、悲观锁</h3><p>悲观锁(Pessimistic Lock)，顾名思义，就是很悲观，认为这个世界是黑暗的，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会 block 直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226172953.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226172953.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-2、乐观锁"><a href="#2-2、乐观锁" class="headerlink" title="2.2、乐观锁"></a>2.2、乐观锁</h3><p>乐观锁(Optimistic Lock)，顾名思义，就是很乐观，认为这个世界是光明的，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量。Redis 就是利用这种 check-and-set 机制实现事务的。</p><p>而 Redis 中默认使用的就是乐观锁。<br>通过上一章中的命令 <code>watch</code>，我们可以实现乐观锁。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch key [key] ...</span><br></pre></td></tr></table></figure><p>例如：很多人同时对一个值进行操作，一旦这个值被修改，且被其他人监听，则其他人无法修改这个值。</p><p>通过 <code>unwatch</code>，可以取消乐观锁。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unwatch key [key] ...</span><br></pre></td></tr></table></figure><p>缺点：如果单纯使用 watch，可能导致 key 的值无法完全被修改。</p><p>场景：假设库存有 500 个商品，2000 个人进行秒杀购买(2000 个程序监听商品的 key)，假设 1999 人同时购买，其内部程序监听的商品数量为 500，最后一个人却已经购买成功，商品数量变为499，则前面的事务被打断(监听的 500 数量)，导致 1999 人会购买失败，库存还有 499 个商品。</p></div><h2 id="3、持久化"><a href="#3、持久化" class="headerlink" title="3、持久化"></a>3、持久化</h2><div class="story post-story"><p>Redis 提供了以下 2 个不同形式的持久化方式：</p><ol><li>RDB（Redis DataBase）</li><li>AOF（Append Of File）</li></ol><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/62012015313f478fa67559d0aa9105a9.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/62012015313f478fa67559d0aa9105a9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们分成两个部分进行学习。</p><h3 id="3-1、RDB持久化"><a href="#3-1、RDB持久化" class="headerlink" title="3.1、RDB持久化"></a>3.1、RDB持久化</h3><p>Redis 中默认使用的就是 RDB 的持久化方式。<br>该种方式在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是 Snapshot 快照，它恢复时是将快照文件直接读到内存里。</p><h4 id="3-1-1、备份的执行过程"><a href="#3-1-1、备份的执行过程" class="headerlink" title="3.1.1、备份的执行过程"></a>3.1.1、备份的执行过程</h4><p>Redis会单独创建fork一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化都结束了，再用这个临时文件替换上次持久化好的文件，整个过程中，主进程是不进行任何IO操作的。这就确保了级高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式就要比AOF方式更加的高效。<br><u>RDB 的缺点是最后一次持久化之后的数据可能丢失</u></p><p>我们在生产环境会将 <code>dump.rdb</code> 这个文件进行备份。</p><p>以下是 RDB 持久化的一个执行流程：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/b4caafff95b841debb86bc82157d5f8b.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/b4caafff95b841debb86bc82157d5f8b.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>RDB 所保存的文件就是 <code>dump.rdb</code> 文件。他的好处就是：效率高。</p><h4 id="3-1-4、RDB-的备份策略"><a href="#3-1-4、RDB-的备份策略" class="headerlink" title="3.1.4、RDB 的备份策略"></a>3.1.4、RDB 的备份策略</h4><p>对于 RDB 的备份策略，如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">save 3600 1     -- 如果 1 个 key 发生改变（增删改），则 1 个小时后备份一次</span><br><span class="line">save 300 100    -- 如果 100 个 key 发生改变（增删改），则 5 分钟后备份一次</span><br><span class="line">save 60 10000-- 如果 10000 个 key 发生改变（增删改），则 1 分钟后备份一次</span><br><span class="line"></span><br><span class="line"># save &lt;秒钟&gt; &lt;写操作次数&gt;</span><br></pre></td></tr></table></figure><p>除此之外，还可以手动执行命令生成 RDB 快照，进入 redis 客户端执行命令 <code>save</code> 或<code>bgsave</code>可以生成 <code>dump.rdb</code> 文件。<br>每次命令执行都会将所有 redis 内存快照到一个新的 <code>.rdb</code> 文件里，并覆盖原有 <code>.rdb</code> 快照文件。</p><p>其中：</p><table><thead><tr><th></th><th>save</th><th>bgsave</th></tr></thead><tbody><tr><td>IO类型</td><td>同步</td><td>异步</td></tr><tr><td>是否阻塞其他命令</td><td>是</td><td>否(fork的时候会短暂阻塞)</td></tr><tr><td>复杂度</td><td>O(n)</td><td>O(n)</td></tr><tr><td>优点</td><td>不会消耗额外内存</td><td>不阻塞操作</td></tr><tr><td>缺点</td><td>阻塞操作</td><td>会消耗额外内存</td></tr></tbody></table><ul><li>save：save 时只管保存，其它不管，全部阻塞。手动保存。<strong>不建议</strong></li><li>bgsave：Redis 会在后台异步进行快照操作，快照同时还可以响应客户端请求。<strong>推荐</strong></li></ul><p><strong>配置自动生成rdb文件后台使用的是bgsave方式。</strong></p><h4 id="3-1-4、RDB-持久化方式的优缺点"><a href="#3-1-4、RDB-持久化方式的优缺点" class="headerlink" title="3.1.4、RDB 持久化方式的优缺点"></a>3.1.4、RDB 持久化方式的优缺点</h4><p><strong>优点：</strong><br>    因为dump.rdb文件是二进制文件，所以当redis服务崩溃恢复的时候，能很快的将文件数据恢复到内存之中。<br>    适合大规模的数据恢复<br>    对数据完整性和一致性要求不高更适合使用<br>    节省磁盘空间<br><strong>缺点：</strong><br>    RDB每次持久化需要将所有内存数据写入文件，然后替换原有文件，当内存数据量很大的时候，频繁的生成快照会很耗性能。<br>    如果将生成快照的策略设置的时间间隔很大，会导致redis宕机的时候丢失过的的数据。<br>    Fork 的时候，内存中的数据被克隆了一份，大致 2 倍的膨胀性需要考虑</p><h3 id="3-2、AOF持久化"><a href="#3-2、AOF持久化" class="headerlink" title="3.2、AOF持久化"></a>3.2、AOF持久化</h3><p>为解决RDB方式丢失数据的问题，从1.1版本开始，redis 增加了一种更加可靠的方式：AOF 持久化方式。<br>在使用AOF方式时，redis 每执行一次修改数据命令，都会将该命令追加到 appendonly.aof 文件中（先写入 os cache，然后通过 sync 刷盘）。</p><h4 id="3-2-1、AOF-的持久化流程"><a href="#3-2-1、AOF-的持久化流程" class="headerlink" title="3.2.1、AOF 的持久化流程"></a>3.2.1、AOF 的持久化流程</h4><ol><li>客户端的请求写命令会被 append 追加到 AOF 缓冲区内；</li><li>AOF 缓冲区根据 AOF 持久化策略[always,everysec,no]将操作 sync 同步到磁盘的 AOF 文件中；</li><li>AOF 文件大小超过重写策略或手动重写时，会对 AOF 文件 rewrite 重写，压缩 AOF 文件容量；</li><li>Redis 服务重启时，会重新 load 加载 AOF 文件中的写操作达到数据恢复的目的；</li></ol><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226200544.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226200544.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h4 id="3-2-2、开启-AOF-持久化"><a href="#3-2-2、开启-AOF-持久化" class="headerlink" title="3.2.2、开启 AOF 持久化"></a>3.2.2、开启 AOF 持久化</h4><p>由于 Redis 默认使用的是 RDB 持久化方式，所以我们需要手动开启 AOF 持久化。<br>默认情况下，配置文件如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly no</span><br></pre></td></tr></table></figure><p>如果需要开启，所以通过将 <code>no</code> 修改成 <code>yes</code> 即可开启。<br>redis重启的时候，会重放 appendonly.aof 中的命令恢复数据。</p><p>如果两者同时开启，Redis 所使用的是 AOF 的持久化。</p><p>对于 AOF，有三种同步频率可供配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">appendfsync always：每次执行写命令都会刷盘，非常慢，也非常安全。</span><br><span class="line">appendfsync everysec：每秒刷盘一次，兼顾性能和安全。</span><br><span class="line">appendfsync no：将刷盘操作交给系统，很快，不安全。</span><br></pre></td></tr></table></figure><p>推荐使用 <code>everysec</code>，该策略下，最多会丢1秒的数据。</p><h4 id="3-2-3、AOF重写"><a href="#3-2-3、AOF重写" class="headerlink" title="3.2.3、AOF重写"></a>3.2.3、AOF重写</h4><p>因为 <code>appendonly.aof</code> 文件中存储的是执行命令，所以会产生很多没用的命令，因此，redis 会定期根据最新的内存数据生成新的 <code>.aof</code> 文件。</p><p><strong><u>如何使用重写？命令如下：</u></strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no-appendfsync-on-rewrite yes</span><br></pre></td></tr></table></figure><p>如果 <code>no-appendfsync-on-rewrite</code> 改为 <code>yes</code>，代表不写入 AOF 文件，只写入缓存，用户请求不会阻塞，但是在这段时间如果宕机会丢失这段时间的缓存数据。（降低数据安全性，提高 性能）<br>如果 <code>no-appendfsync-on-rewrite</code> 改为 <code>no</code>，还是会把数据往磁盘里刷，但是遇到重写操作，可能会发生阻塞。（数据安全，但是性能降低）</p><p><strong><u>那么怎么样才会触发重写呢？如下：</u></strong></p><p>Redis 会记录上次重写时的 AOF 大小，默认配置是当 AOF 文件大小是上次 rewrite 后大小的一倍且文件大于 64M 时触发。<br>重写虽然可以节约大量磁盘空间，减少恢复时间。但是每次重写还是有一定的负担的，因此设定 Redis 要满足一定条件才会进行重写。<br>下面两个配置可以控制<code>.aof</code> 文件重写的频率：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto‐aof‐rewrite‐min‐size 64mb：-- aof文件至少达到了64m才会触发重写</span><br><span class="line">auto‐aof‐rewrite‐percentage 100：-- 距离上次重写增长了100%才会再次触发重写</span><br></pre></td></tr></table></figure><p>AOF 重写的流程：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226203142.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226203142.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol><li>bgrewriteaof 触发重写，判断是否当前有 bgsave 或 bgrewriteaof 在运行，如果有，则等待该命令结束后再继续执行</li><li>主进程 fork 出子进程执行重写操作，保证主进程不会阻塞</li><li>子进程遍历 redis 内存中数据到临时文件，客户端的写请求同时写入 aof_buf 缓冲区和 aof_rewrite_buf 重写缓冲区保证原 AOF 文件完整以及新 AOF 文件生成期间的 新的数据修改动作不会丢失</li><li>子进程写完新的 AOF 文件后，向主进程发信号，父进程更新统计信息</li><li>主进程把 aof_rewrite_buf 中的数据写入到新的 AOF 文件。</li><li>使用新的 AOF 文件覆盖旧的 AOF 文件，完成 AOF 重写</li></ol><h4 id="3-2-4、AOF-的优缺点"><a href="#3-2-4、AOF-的优缺点" class="headerlink" title="3.2.4、AOF 的优缺点"></a>3.2.4、AOF 的优缺点</h4><p>优点：<br>    备份机制更稳健，丢失数据概率更低<br>    可读的日志文本，通过操作 AOF 稳健，可以处理误操作<br>缺点：<br>    比起 RDB 占用更多的磁盘空间<br>    恢复备份速度要慢<br>    每次读写都同步的话，有一定的性能压力<br>    存在个别 Bug，造成恢复不能</p><h3 id="3-3、RDB和AOF对比"><a href="#3-3、RDB和AOF对比" class="headerlink" title="3.3、RDB和AOF对比"></a>3.3、RDB和AOF对比</h3><table><thead><tr><th>命令</th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td>启动优先级</td><td>低</td><td>高</td></tr><tr><td>体积</td><td>小</td><td>大</td></tr><tr><td>恢复速度</td><td>快</td><td>慢</td></tr><tr><td>数据安全性</td><td>容易丢数据</td><td>根据策略而定，相对不容易</td></tr></tbody></table></div><h2 id="4、主从复制"><a href="#4、主从复制" class="headerlink" title="4、主从复制"></a>4、主从复制</h2><div class="story post-story"><h3 id="4-1、什么是主从复制"><a href="#4-1、什么是主从复制" class="headerlink" title="4.1、什么是主从复制"></a>4.1、什么是主从复制</h3><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205002.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205002.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>主从复制是指将一台 Redis 服务的数据，复制到其他 Redis 服务器上。前者称为主节点（master），后者称为从节点（slave）。数据的复制是单向的，只能从主节点到从节点。<br>其中 Master 以写为主，Slave 以读为主。<br>默认情况下，每一台 Redis 服务都是主节点，一个主节点可以有多个从节点（也可以没有），但一个从节点只能有一个主节点。</p><p><strong>为什么要有主从复制呢？</strong><br>假设只有一台 Redis 服务，这时候是单机模式。首先会出现第一个问题：如果 Redis 服务宕机了，就会造成数据的丢失，会造成很大的损失。<br>第二个问题：一台服务器的内存是有限的，尽管内存可以升级，但是终究是有限的，所以通过多台服务器可以减轻服务器的压力。</p><p>针对上述问题，我们需要准备多台服务器，配置主从复制。将数据保存在多台服务器上，并且保证每台服务器的数据是同步的。即使有一台服务器宕机，也不影响用户的使用。redis 可以继续实现高可用，同时实现数据的冗余备份。</p><p>所以就要有主从复制，那么<strong>主从复制的具体作用</strong>是什么呢？</p><ol><li>数据冗余，实现数据的热备份，这也是持久化实现的另一种方式。</li><li>针对单机故障问题，一个节点故障，其他节点可以提供服务，不影响用户使用。实现了快速恢复故障，这也是服务冗余。</li><li>读写分离，master 服务主要用来写，slave 服务主要用来读数据。可以提高服务器的负载能力，可以根据需求的变化，添加从节点的数量。</li><li>负载均衡，同时配合读写分离，由主节点提供写服务，从节点提供读服务，分担服务器的负载。在写少读多的情况下，通过多个从节点分担读负载，能够大大提高 Redis 服务的并发量和负载。</li><li>高可用的基石，主从复制是哨兵和集群模式能够实施的基础。</li></ol><h3 id="4-2、主从复制的实现原理"><a href="#4-2、主从复制的实现原理" class="headerlink" title="4.2、主从复制的实现原理"></a>4.2、主从复制的实现原理</h3><p>Redis 的主从复制分为以下两个阶段：<code>sync</code> 阶段和 <code>command propagate</code> 阶段。</p><h4 id="4-2-1、sync-同步-阶段"><a href="#4-2-1、sync-同步-阶段" class="headerlink" title="4.2.1、sync(同步)阶段"></a>4.2.1、sync(同步)阶段</h4><p>当从节点启动之后，会发送 <code>sync</code> 指令给主节点，要求全量同步数据，具体的步骤如下图所示：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/rZEJmRMT6Gpxgiz.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/rZEJmRMT6Gpxgiz.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol><li>Slave 节点向 Master 节点发送 sync 指令，以请求数据同步</li><li>Master 节点在接收到 sync 指令后，会执行一次 BGSAVE 指令，将当前 Master 节点中的数据保存到对应的 RDB 文件中。当 Master 节点完成 RDB 文件的导出后，再将导出的 RBD 文件发送给 Slave 节点。由于在这个过程中 Master 节点依旧有可能发生数据写入操作，在这种情况下 Master 节点会将执行的指令放入到对应的缓冲区</li><li>Slave 节点在接受到 Master 节点导出的 RDB 文件之后，会删除现有节点的所有数据，然后加载这个 RDB 文件的内容到 Slave 节点</li><li>当 Slave 节点数据加载完成之后，Master 会将缓冲区中暂存的指令发送到 Slave 节点</li><li>Slave 执行收到的指令，完成数据的同步</li></ol><h4 id="4-2-2、Command-Propagate-命令传播-阶段"><a href="#4-2-2、Command-Propagate-命令传播-阶段" class="headerlink" title="4.2.2、Command Propagate(命令传播)阶段"></a>4.2.2、Command Propagate(命令传播)阶段</h4><p>数据同步完成之后，如果后续 Master 节点继续收到了新的写入操作的指令，那么也需要将该命令传播到 Slave 节点以完成数据的同步。这个过程就被称为 “命令传播”。</p><p>主从服务器在完成第一次同步后，双方之间就会维护一个 TCP 连接。<br>后续主服务器可以通过这个连接继续将写操作命令传播给从服务器，然后从服务器执行该命令，使得与主服务器的数据库状态相同。<br>而且这个连接是长连接的，目的是避免频繁的 TCP 连接和断开带来的性能开销。<br>上面的这个过程被称为基于长连接的命令传播，通过这种方式来保证第一次同步后的主从服务器的数据一致性。</p><h3 id="4-3、配置主从复制"><a href="#4-3、配置主从复制" class="headerlink" title="4.3、配置主从复制"></a>4.3、配置主从复制</h3><p>首先在本地启动三个 Redis 服务，用来模拟不同服务器上面的 Redis 服务。</p><p><strong>一主二从</strong><br>主服务器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">include /etc/redis.conf    # 核心配置文件</span><br><span class="line">pidfile /var/run/redis_6379.pid   # 固定</span><br><span class="line">port 6379    #端口</span><br><span class="line">dbfilename dump6379.rdb   # 持久化备份文件</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">dir &quot;/myredis&quot;  # 备份文件路径，自定义</span><br></pre></td></tr></table></figure><p>从服务器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include /etc/redis.conf    # 核心配置文件</span><br><span class="line">pidfile /var/run/redis_6380.pid   # 固定</span><br><span class="line">port 6380    #端口</span><br><span class="line">dbfilename dump6380.rdb   # 持久化备份文件</span><br><span class="line">daemonize yes   </span><br><span class="line">protected-mode no</span><br><span class="line">dir &quot;/myredis&quot;  # 备份文件路径，自定义</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##################################################</span></span> </span><br><span class="line"></span><br><span class="line">include /etc/redis.conf    # 核心配置文件</span><br><span class="line">pidfile /var/run/redis_6381.pid   # 固定</span><br><span class="line">port 6381    #端口</span><br><span class="line">dbfilename dump6381.rdb   # 持久化备份文件</span><br><span class="line">daemonize yes</span><br><span class="line">protected-mode no</span><br><span class="line">dir &quot;/myredis&quot;  # 备份文件路径，自定义</span><br></pre></td></tr></table></figure><p>如果重新配置了文件内容，则需要重启 Redis 服务。<br>启动好 3 个不同端口服务后，我们再分别开启 Redis 连接:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379</span><br><span class="line">redis-cli -p 6380</span><br><span class="line">redis-cli -p 6381</span><br></pre></td></tr></table></figure><p>通过 <code>info replication</code> 指令查看信息:<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205444.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205444.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以发现，默认情况下，开启的每个 Redis 服务器都是主节点。</p><p>所以，现在我们要配置为一个 Master 和 两个 Slave（即一主二从）<br>6379 为主，6380、6381 为从，分别在 6380、6381 的 Redis 上执行如下指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 127.0.0.1 6379</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205520.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205520.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>然后，6080和6381就变成了从机，在主机设置值，在从机都可以取到，但是从机不能写值。</p><p>但是我们这里是使用命令搭建，是「暂时的」，如果重启三个 Redis 服务，则又恢复到三主的地位。<br>如果想配置「永久的」，则去配置里进行修改，找到 <code>slaveof &lt;ip&gt; &lt;port&gt;</code> 指令进行配置：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205703.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226205703.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当主机断电宕机后，默认情况下从机的角色不会发生变化，集群中只是失去了写操作，当主机恢复以后，又会连接上从机恢复原状。</p><p>当从机断电宕机后，若不是使用配置文件配置的从机，再次启动后作为主机是无法获取之前主机的数据的，若此时重新配置称为从机，又可以获取到主机的所有数据。这里就要提到一个同步原理。</p><p><strong>薪火相传</strong><br>上一个 Slave 可以是下一个 Slave 和 Master，Slave 同样可以接收其他 Slaves 的连接和同步请求，那么该 Slave 作为了链条中下一个的 Master，可以有效减轻 Master 的写压力，去中心化降低风险。<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226210451.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226210451.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>在一个从机用 <code>slaveof &lt;ip&gt; &lt;port&gt;</code> 指令连接另一个从机。<br><img src="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226210356.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/Kele-Bingtang/static/img/Redis/20211226210356.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226210314.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226210314.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>反客为主</strong><br>当一个 master 宕机后，后面的 slave 可以立刻升为 master，其后面的 slave 不用做任何修改。<br>有两种方式可以产生新的主机：</p><ol><li>从机手动执行命令 <code>slaveof no one</code>，这样执行以后从机会独立出来成为一个主机</li><li>使用哨兵模式（自动选举）</li></ol><h3 id="4-4、哨兵模式"><a href="#4-4、哨兵模式" class="headerlink" title="4.4、哨兵模式"></a>4.4、哨兵模式</h3><h4 id="4-4-1、什么是哨兵模式？"><a href="#4-4-1、什么是哨兵模式？" class="headerlink" title="4.4.1、什么是哨兵模式？"></a>4.4.1、什么是哨兵模式？</h4><p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。Redis 从 2.8 开始正式提供了 Sentinel（哨兵）架构来解决这个问题。</p><p>哨兵模式就是自动实现反客为主的一种形式，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</p><p>哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是 哨兵通过发送命令，等待 Redis 服务器响应，从而监控运行的多个 Redis 实例。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211059.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211059.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这里的哨兵有两个作用：</p><ol><li>通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器。</li><li>当哨兵监测到 Master 宕机，会自动将 Slave 切换成 Master，然后通过 发布订阅模式 通知其他的从服务器，修改配置文件，让它们切换主机。</li></ol><p>然而一个哨兵进程对 Redis 服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211245.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211245.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>假设主服务器宕机，哨兵 1 先检测到这个结果，系统并不会马上进行 failover 过程，仅仅是哨兵 1 主观的认为主服务器不可用，这个现象成为 主观下线。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行 failover [故障转移]操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为 客观下线。</p><h4 id="4-4-2、配置哨兵模式"><a href="#4-4-2、配置哨兵模式" class="headerlink" title="4.4.2、配置哨兵模式"></a>4.4.2、配置哨兵模式</h4><p>配置哨兵配置文件 <code>sentinel.conf</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">sentinel monitor 主机名称 host port 1</span></span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最后面的1，代表主机挂了，Slave投票看谁接替成为主机，票数最多的，就会成为主机</span></span><br></pre></td></tr></table></figure><p>启动哨兵：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel myredis/sentinel.conf</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211701.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211701.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>此时哨兵监视着我们的主机 6379，当我们断开主机后：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211710.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211226211710.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>哪个从机会被选举为主机呢？根据优先级别：<code>slave-priority</code>，这个指令需要去每个从机的配置文件进行配置，默认都是 100。</p><p>建议每个从机都配置不同的 <code>slave-priority</code>，这样可以避免复制延时。</p><p><strong>需要注意的是：值越小优先级越高。</strong></p><p>复制延时：由于所有的写操作都是先在 Master 上操作，然后同步更新到 Slave 上，所以从 Master 同步到 Slave 机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave 机器数量的增加也会使这个问题更加严重。</p><p><strong>哨兵模式的优缺点：</strong><br>优点：<br>    哨兵集群，基于主从复制模式，所有主从复制的优点，它都有<br>    主从可以切换，故障可以转移，系统的可用性更好<br>    哨兵模式是主从模式的升级，手动到自动，更加健壮<br>缺点：<br>    Redis不好在线扩容，集群容量一旦达到上限，在线扩容就十分麻烦<br>    实现哨兵模式的配置其实是很麻烦的，里面有很多配置项</p><p><strong>以下是哨兵模式的完整配置：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Example sentinel.conf</span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵 sentinel 实例运行的端口 默认 26379</span></span><br><span class="line">port 26379</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵 sentinel 的工作目录</span></span><br><span class="line">dir /tmp</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 哨兵 sentinel 监控的 redis 主节点的 ip port</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> master-name：可以自己命名的主节点名字 只能由字母 A-z、数字 0-9 、这三个字符 <span class="string">&quot;.-_&quot;</span> 组成。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> quorum：当这些 quorum 个数 sentinel 哨兵认为 Master 主节点失联 那么这时客观上认为主节点失联了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当在 Redis 实例中开启了 requirepass foobared 授权密码 这样所有连接 Redis 实例的客户端都要提供密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置哨兵 sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定多少毫秒之后 主节点没有应答哨兵 sentinel 此时 哨兵主观上认为主节点下线 默认 30 秒</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个配置项指定了在发生 failover 主备切换时最多可以有多少个 Slave 同时对新的 Master 进行同步，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个数字越小，完成 failover 所需的时间就越长，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 但是如果这个数字越大，就意味着越 多的 Slave 因为 replication 而不可用。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以通过将这个值设为 1 来保证每次只有一个 Slave 处于不能处理命令请求的状态。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">1. 同一个 sentinel 对同一个 Master 两次 failover 之间的间隔时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2. 当一个 Slave 从一个错误的 Master 那里同步数据开始计算时间。直到 Slave 被纠正为向正确的 Master 那里同步数据时。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">3. 当想要取消一个正在进行的 failover 所需要的时间。</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash">4. 当进行 failover 时，配置所有 Slaves 指向新的 Master 所需的最大时间。不过，即使过了这个超时，Slaves 依然会被正确配置为指向Master，但是就不按 parallel-syncs 所配置的规则来了</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认三分钟</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> SCRIPTS EXECUTION</span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 若脚本执行后返回 1，那么该脚本稍后将会被再次执行，重复次数目前默认为 10</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 若脚本执行后返回 2，或者比 2 更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为 1 时的行为相同。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个脚本的最大执行时间为 60s，如果超过这个时间，脚本将会被一个 SIGKILL 信号终止，之后重新执行。</span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通知型脚本:当 sentinel 有任何警告级别的事件发生时（比如说 Redis 实例的主观失效和客观失效等等），将会去调用这个脚本，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这时这个脚本应该通过邮件，SMS 等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个是事件的类型，</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一个是事件的描述。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果 sentinel.conf 配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则 sentinel 无法正常启动成功。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通知脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当一个 Master 由于 failover 而发生改变时，这个脚本将会被调用，通知相关的客户端关于 Master 地址已经发生改变的信息。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 目前 &lt;state&gt; 总是「failover」,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> &lt;role&gt; 是「leader」或者「observer」中的一个。</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 参数 from-ip, from-port, to-ip, to-port 是用来和旧的 Master 和新的 Master(即旧的 Slave)通信的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="数据库" scheme="http://cyc0819.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="redis" scheme="http://cyc0819.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/redis/"/>
    
    
    <category term="数据库" scheme="http://cyc0819.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="redis" scheme="http://cyc0819.top/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>算法学习—二分查找</title>
    <link href="http://cyc0819.top/2022/06/16/2022-06-16-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E2%80%94%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"/>
    <id>http://cyc0819.top/2022/06/16/2022-06-16-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E2%80%94%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/</id>
    <published>2022-06-16T05:08:35.000Z</published>
    <updated>2022-06-16T05:08:13.361Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="算法学习—二分查找"><a href="#算法学习—二分查找" class="headerlink" title="算法学习—二分查找"></a>算法学习—二分查找</h1><h2 id="1、二分查找的概念"><a href="#1、二分查找的概念" class="headerlink" title="1、二分查找的概念"></a>1、二分查找的概念</h2><div class="story post-story"><p>当我们碰到需要获取数列中的元素或者利用数列中的元素时，最快想到的方法就是通过顺序查找，一个一个找下去，这种查找方式基本上市从头开始到末尾，将所有的元素都找一遍，直到找到了想要的元素。<br>这种方法因为是需要查找所有的元素，所以当元素数量太多的时候，就会出现超时的情况出现，效率十分低下，所以一般实际的情况下我们不是用顺序查找。<br>取而代之的，是二分查找。二分查找顾名思义，就是将一个数列分成两个部分，分别查找元素。虽然说该种方法比较高效，但是这种方法是建立在数列有序的基础上的，所以对于一些不能排序的数列，可能不适用二分查找；除此之外，二分查找的结果只能是一个，不能是多个。</p></div><h2 id="2、基本思想"><a href="#2、基本思想" class="headerlink" title="2、基本思想"></a>2、基本思想</h2><div class="story post-story"><p>二分查找的基本思想是：我们首先定义两个首尾元素，一般一开始默认是在数列的第一位以及最后一位。然后我们找到两个首尾元素的中间点元素 mid ，将该元素与我们作为比较的元素相对比，然后决定我们下一步所取的数列的区间范围。而在所取范围之外的另一半的元素我们自然就不用再查找了，效率就大大地提高了。</p></div><h2 id="3、解题步骤"><a href="#3、解题步骤" class="headerlink" title="3、解题步骤"></a>3、解题步骤</h2><div class="story post-story"><p>1.将数列排序<br>2.通过首尾节点确定中间点元素 mid<br>3.将mid与比较的元素相对比，判断下一次所取的区间<br>4.最后只剩下一个结果时，结束</p></div><h2 id="4、二分查找的模板"><a href="#4、二分查找的模板" class="headerlink" title="4、二分查找的模板"></a>4、二分查找的模板</h2><div class="story post-story"><h3 id="4-1、第一类：数据无重复查找数据"><a href="#4-1、第一类：数据无重复查找数据" class="headerlink" title="4.1、第一类：数据无重复查找数据"></a>4.1、第一类：数据无重复查找数据</h3><p>所要查找的数据如下所示：</p><p>位置：0 1 2 3 4 5 6 7 8 9<br>数据：1 2 3 4 5 <u><strong>6</strong></u> 7 8 9 10</p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = numbers.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (numbers[middle] == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (numbers[middle] &gt; target) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2、第二类：数据有重复查找小于该数的最后一个数字的位置"><a href="#4-2、第二类：数据有重复查找小于该数的最后一个数字的位置" class="headerlink" title="4.2、第二类：数据有重复查找小于该数的最后一个数字的位置"></a>4.2、第二类：数据有重复查找小于该数的最后一个数字的位置</h3><p>位置：0 1 2 3 4 5 6 7 8 9<br>数据：1 1 2 <u><strong>2</strong></u> 3 3 3 3 4 4</p><p>在本类型中，我们查找小于3的最后一个数据的位置。</p><p>代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = numbers.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = left + (right - left + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (numbers[middle] == target) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (numbers[middle] &gt; target) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3、第三类：数据有重复查找该数字第一次出现的位置"><a href="#4-3、第三类：数据有重复查找该数字第一次出现的位置" class="headerlink" title="4.3、第三类：数据有重复查找该数字第一次出现的位置"></a>4.3、第三类：数据有重复查找该数字第一次出现的位置</h3><p>位置：0 1 2 3 4 5 6 7 8 9<br>数据：1 1 2 2 <u><strong>3</strong></u> 3 3 3 4 4</p><p>在本类中，我们查找数字3第一次出现的位置。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = numbers.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (numbers[middle] == target) &#123;</span><br><span class="line">            right = middle;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (numbers[middle] &gt; target) &#123;</span><br><span class="line">            right = middle;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4、第四类：数据有重复查找该数字最后一次出现的位置"><a href="#4-4、第四类：数据有重复查找该数字最后一次出现的位置" class="headerlink" title="4.4、第四类：数据有重复查找该数字最后一次出现的位置"></a>4.4、第四类：数据有重复查找该数字最后一次出现的位置</h3><p>位置：0 1 2 3 4 5 6 7 8 9<br>数据：1 1 2 2 3 3 3 <u><strong>3</strong></u> 4 4</p><p>在本类中，我们查找数字3最后一次出现的位置。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = numbers.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = left + (right - left + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (numbers[middle] == target) &#123;</span><br><span class="line">            left = middle;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (numbers[middle] &gt; target) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5、第五类：数据有重复查找第一个大于该数的数字的位置"><a href="#4-5、第五类：数据有重复查找第一个大于该数的数字的位置" class="headerlink" title="4.5、第五类：数据有重复查找第一个大于该数的数字的位置"></a>4.5、第五类：数据有重复查找第一个大于该数的数字的位置</h3><p>位置：0 1 2 3 4 5 6 7 8 9<br>数据：1 1 2 2 3 3 3 3 <u><strong>4</strong></u> 4</p><p>在本类中，我们查找第一个大于数字3的数字的位置。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] numbers, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = numbers.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = left + (right - left ) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (numbers[middle] == target) &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (numbers[middle] &gt; target) &#123;</span><br><span class="line">            right = middle;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、实际例子"><a href="#5、实际例子" class="headerlink" title="5、实际例子"></a>5、实际例子</h2><div class="story post-story"><h3 id="5-1、搜索插入位置"><a href="#5-1、搜索插入位置" class="headerlink" title="5.1、搜索插入位置"></a>5.1、搜索插入位置</h3><p><a href="https://leetcode.cn/problems/search-insert-position/">leetcode-35</a></p><p>给定一个排序数组和一个目标值，在数组中找到目标值，并返回其索引。如果目标值不存在于数组中，返回它将会被按顺序插入的位置。</p><p>示例1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: nums = [1,3,5,6], target = 5</span><br><span class="line">输出: 2</span><br></pre></td></tr></table></figure><p>示例2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: nums = [1,3,5,6], target = 2</span><br><span class="line">输出: 1</span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;= nums.length &lt;= 104</span><br><span class="line">-104 &lt;= nums[i] &lt;= 104</span><br><span class="line">nums 为 无重复元素 的 升序 排列数组</span><br><span class="line">-104 &lt;= target &lt;= 104</span><br></pre></td></tr></table></figure><p>解题思路：</p><p>该题目的意思是在数列中找到一个目标值，并返回其索引，所以该题符合 类型一 的情况。<br>我们假设该位置为 pos ，所以有成立的条件为：<br>$$<br>nums[pos−1]&lt;target≤nums[pos]<br>$$<br>其中 nums 代表排序数组。由于如果存在这个目标值，我们返回的索引也是 pos，因此我们可以将两个条件合并得出最后的目标：「在一个有序数组中找第一个大于等于 target 的下标」。</p><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">searchInsert</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>,right=nums.length;</span><br><span class="line">        <span class="keyword">while</span>(left&lt;right)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(nums[mid]&gt;=target)&#123;</span><br><span class="line">                right=mid;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                left=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2、x-的平方根"><a href="#5-2、x-的平方根" class="headerlink" title="5.2、x 的平方根"></a>5.2、x 的平方根</h3><p><a href="https://leetcode.cn/problems/sqrtx/">leetcode-69</a></p><p>给你一个非负整数 x ，计算并返回 x 的 算术平方根 。<br>由于返回类型是整数，结果只保留 整数部分 ，小数部分将被 舍去 。<br>注意：不允许使用任何内置指数函数和算符，例如 pow(x, 0.5) 或者 x ** 0.5 。</p><p>示例1：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 4</span><br><span class="line">输出：2</span><br></pre></td></tr></table></figure><p>示例2：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入：x = 8</span><br><span class="line">输出：2</span><br><span class="line">解释：8 的算术平方根是 2.82842..., 由于返回类型是整数，小数部分将被舍去。</span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 &lt;= x &lt;= 231 - 1</span><br></pre></td></tr></table></figure><p>解题思路：<br>由于 x 平方根的整数部分 ans 是满足<code>k的平方小于等于x</code>的最大 k 值，因此我们可以对 k 进行二分查找，从而得到答案。</p><p>二分查找的下界为 0，上界可以粗略地设定为 x。在二分查找的每一步中，我们只需要比较中间元素 mid 的平方与 xx 的大小关系，并通过比较的结果调整上下界的范围。由于我们所有的运算都是整数运算，不会存在误差，因此在得到最终的答案 ans 后，也就不需要再去尝试 ans+1 了。</p><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">mySqrt</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right=x;</span><br><span class="line">        <span class="keyword">int</span> num=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;=right)&#123;</span><br><span class="line">            <span class="keyword">int</span> mid=(left+right)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">long</span>)mid*mid&lt;=x)&#123;</span><br><span class="line">                num=mid;</span><br><span class="line">                left=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                right=mid-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="算法" scheme="http://cyc0819.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="算法" scheme="http://cyc0819.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>算法学习—回溯法</title>
    <link href="http://cyc0819.top/2022/06/15/2022-06-15-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E2%80%94%E5%9B%9E%E6%BA%AF%E6%B3%95/"/>
    <id>http://cyc0819.top/2022/06/15/2022-06-15-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0%E2%80%94%E5%9B%9E%E6%BA%AF%E6%B3%95/</id>
    <published>2022-06-15T15:36:35.000Z</published>
    <updated>2022-06-15T16:59:43.769Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="算法学习—回溯法"><a href="#算法学习—回溯法" class="headerlink" title="算法学习—回溯法"></a>算法学习—回溯法</h1><h2 id="1、回溯法的概念"><a href="#1、回溯法的概念" class="headerlink" title="1、回溯法的概念"></a>1、回溯法的概念</h2><div class="story post-story"><p>回溯法，顾名思义就是不断地重复枚举结果集，直到找到我们所要的结果。这种思想类似于暴力搜索，但是又与暴力搜索有着不同，回溯法使用了剪枝函数，除去了一些错误的解法。<br>回溯法在搜索的过程中，如果发现这一步的结果不符合结果的要求，则会放弃下面的查找，回溯到上一步，更换一种新的查找方式，它其实是一种选优搜索，根据选优条件逐步搜索，以达到目标。回溯法中满足回溯条件的点我们称为 “回溯点”。<br>在一些复杂问题，或者是比较大规模的问题中，我们都可以使用回溯法来解决，所以回溯法也有着“通用解题方法”的美称。</p></div><h2 id="2、基本思想"><a href="#2、基本思想" class="headerlink" title="2、基本思想"></a>2、基本思想</h2><div class="story post-story"><p>回溯法的基本思想是：从一条路往前走，能进则进，不能进则退回来，换一条新的路尝试。回溯法是一个既带有系统性又带有跳跃性的的搜索算法。它在包含问题的所有解的解空间树中，按照深度优先的策略，从根结点出发搜索解空间树。算法搜索至解空间树的任一结点时，总是先判断该结点是否肯定不包含问题的解。如果肯定不包含，则跳过对以该结点为根的子树的系统搜索，逐层向其祖先结点回溯。否则，进入该子树，继续按深度优先的策略进行搜索。回溯法在用来求问题的所有解时，要回溯到根，且根结点的所有子树都已被搜索遍才结束。而回溯法在用来求问题的任一解时，只要搜索到问题的一个解就可以结束。这种以深度优先的方式系统地搜索问题的解的算法称为回溯法，它适用于解一些组合数较大的问题。</p></div><h2 id="3、解题步骤"><a href="#3、解题步骤" class="headerlink" title="3、解题步骤"></a>3、解题步骤</h2><div class="story post-story"><p>1.定义一个解空间，它包含问题的解；<br>2.利用适于搜索的方法组织解空间；<br>3.利用深度优先法搜索解空间；<br>4.利用限界函数避免移动到不可能产生解的子空间。</p></div><h2 id="4、实际例子"><a href="#4、实际例子" class="headerlink" title="4、实际例子"></a>4、实际例子</h2><div class="story post-story"><h3 id="4-1、全排列问题"><a href="#4-1、全排列问题" class="headerlink" title="4.1、全排列问题"></a>4.1、全排列问题</h3><p><a href="https://leetcode.cn/problems/permutations/">leetcode-46</a></p><p>题目：给定一个不含重复数字的数组 nums ，返回其 所有可能的全排列 。你可以 <strong>按任意顺序</strong> 返回答案。</p><p>示例1：    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [1,2,3]</span><br><span class="line">输出：[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]]</span><br></pre></td></tr></table></figure><p>示例2：    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [0,1]</span><br><span class="line">输出：[[0,1],[1,0]]</span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;= nums.length &lt;= 6</span><br><span class="line">-10 &lt;= nums[i] &lt;= 10</span><br><span class="line">nums 中的所有整数 互不相同</span><br></pre></td></tr></table></figure><p>解题思路：</p><p>这个全排列问题是一个典型的回溯法问题。从左到右，我们不断尝试所有可能的结果，如果有出现重复的结果就除去，</p><p>我们定义递归函数 backtrack(first,output) 表示从左往右填到第 first 个位置，当前排列为  output。 那么整个递归函数分为两个情况：</p><ol><li>如果 first=n，说明我们已经填完了 n 个位置（注意下标从 0 开始），找到了一个可行的解，我们将 output 放入答案数组中，递归结束。</li><li>如果 first&lt;n，我们要考虑这第 first 个位置我们要填哪个数。根据题目要求我们肯定不能填已经填过的数，因此很容易想到的一个处理手段是我们定义一个标记数组 vis 来标记已经填过的数，那么在填第 first 个数的时候我们遍历题目给定的 n 个数，如果这个数没有被标记过，我们就尝试填入，并将其标记，继续尝试填下一个位置，即调用函数 backtrack(first+1,output)。回溯的时候要撤销这一个位置填的数以及标记，并继续尝试其他没被标记过的数。</li></ol><p>示例图：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220616005347.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220616005347.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; permute(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">    <span class="comment">// 首先建立一个返回的集合</span></span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; output = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        <span class="comment">// 将输入的数组变成集合</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num:nums)&#123;</span><br><span class="line">            output.add(num);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> n=nums.length;</span><br><span class="line">        <span class="comment">// 进入回溯</span></span><br><span class="line">        backtrack(n,output,list,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backtrack</span><span class="params">(<span class="keyword">int</span> n,List&lt;Integer&gt; output,List&lt;List&lt;Integer&gt;&gt; list,<span class="keyword">int</span> first)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 如果已经到了最后一个，就终止，将当前的数组结构加到集合中</span></span><br><span class="line">        <span class="keyword">if</span> (first==n)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> ArrayList&lt;Integer&gt;(output));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = first; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// 动态维护数组(交换两个集合中任意两个元素（first和i）的位置)</span></span><br><span class="line">            Collections.swap(output, first, i);</span><br><span class="line">            <span class="comment">// 继续递归填下一个数</span></span><br><span class="line">            backtrack(n, output, list, first + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 撤销操作（即撤销上一步中交换的操作）</span></span><br><span class="line">            Collections.swap(output, first, i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2、括号生成问题"><a href="#4-2、括号生成问题" class="headerlink" title="4.2、括号生成问题"></a>4.2、括号生成问题</h3><p><a href="https://leetcode.cn/problems/generate-parentheses/">leetcode-22</a></p><p>题目：数字 n 代表生成括号的对数，请你设计一个函数，用于能够生成所有可能的并且 有效的 括号组合。</p><p>示例1：    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：n = 3</span><br><span class="line">输出：[&quot;((()))&quot;,&quot;(()())&quot;,&quot;(())()&quot;,&quot;()(())&quot;,&quot;()()()&quot;]</span><br></pre></td></tr></table></figure><p>示例2：    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：n = 1</span><br><span class="line">输出：[&quot;()&quot;]</span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;= n &lt;= 8</span><br></pre></td></tr></table></figure><p>解题思路：<br>我们可以生成所有 2的2n次方个 ‘(’ 和 ‘)’ 字符构成的序列，然后我们检查每一个是否有效即可。<br>如果左括号数量不大于 n，我们可以放一个左括号。如果右括号数量小于左括号的数量，我们可以放一个右括号。</p><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">generateParenthesis</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        backtrack(list,<span class="keyword">new</span> StringBuilder(),<span class="number">0</span>,<span class="number">0</span>,n);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// open左括号 close右括号</span></span><br><span class="line">    <span class="comment">// max是n的长度</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backtrack</span><span class="params">(List&lt;String&gt; list,StringBuilder sb,<span class="keyword">int</span> open,<span class="keyword">int</span> close,<span class="keyword">int</span> max)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sb.length()==max*<span class="number">2</span>)&#123;</span><br><span class="line">            list.add(sb.toString());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 左括号</span></span><br><span class="line">        <span class="keyword">if</span> (open&lt;max)&#123;</span><br><span class="line">            sb.append(<span class="string">&#x27;(&#x27;</span>);</span><br><span class="line">            backtrack(list,sb,open+<span class="number">1</span>,close,max);</span><br><span class="line">            sb.deleteCharAt(sb.length()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 右括号</span></span><br><span class="line">        <span class="keyword">if</span> (close&lt;open)&#123;</span><br><span class="line">            sb.append(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            backtrack(list,sb,open,close+<span class="number">1</span>,max);</span><br><span class="line">            sb.deleteCharAt(sb.length()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3、子集问题"><a href="#4-3、子集问题" class="headerlink" title="4.3、子集问题"></a>4.3、子集问题</h3><p><a href="https://leetcode.cn/problems/subsets/">leetcode-78</a></p><p>题目：给你一个整数数组 nums ，数组中的元素 互不相同 。返回该数组所有可能的子集（幂集）。<br>解集 不能 包含重复的子集。你可以按 任意顺序 返回解集。</p><p>示例1：    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [1,2,3]</span><br><span class="line">输出：[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]]</span><br></pre></td></tr></table></figure><p>示例2：    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入：nums = [0]</span><br><span class="line">输出：[[],[0]]</span><br></pre></td></tr></table></figure><p>提示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;= nums.length &lt;= 10</span><br><span class="line">-10 &lt;= nums[i] &lt;= 10</span><br><span class="line">nums 中的所有元素 互不相同</span><br></pre></td></tr></table></figure><p>解题思路：<br>类似于全排列问题。</p><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; a=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; subsets(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">        backtrack(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backtrack</span><span class="params">(<span class="keyword">int</span>[] nums,<span class="keyword">int</span> cur)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (cur==nums.length)&#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> ArrayList&lt;Integer&gt;(a));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        a.add(nums[cur]);</span><br><span class="line">        backtrack(nums,cur+<span class="number">1</span>);</span><br><span class="line">        a.remove(a.size() - <span class="number">1</span>);</span><br><span class="line">        backtrack(nums,cur + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="算法" scheme="http://cyc0819.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="算法" scheme="http://cyc0819.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot通过SSH连接服务器数据库</title>
    <link href="http://cyc0819.top/2022/06/14/2022-06-14-SpringBoot%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <id>http://cyc0819.top/2022/06/14/2022-06-14-SpringBoot%E9%80%9A%E8%BF%87SSH%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E5%BA%93/</id>
    <published>2022-06-14T13:33:33.000Z</published>
    <updated>2022-06-14T14:35:10.384Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringBoot通过SSH连接服务器数据库"><a href="#SpringBoot通过SSH连接服务器数据库" class="headerlink" title="SpringBoot通过SSH连接服务器数据库"></a>SpringBoot通过SSH连接服务器数据库</h1><p>有一些情况下，数据库为了安全起见，往往只允许一些特定的 IP 进行连接，而此时我们其他的服务区想对其进行连接，一种方法是使得该数据库允许我们的服务器对其进行连接，一种是将数据库设置成所有人可连接，还有一种方法就是本文我们所讲的方法：通过 SSH 连接到被允许链接的服务器 IP ，将此服务器作为一个支点，然后再连接到数据库中。</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220614215252.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220614215252.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以 Mysql 数据库为例，我们通过以下的步骤以及对其进行连接。</p><h2 id="1、实现方法"><a href="#1、实现方法" class="headerlink" title="1、实现方法"></a>1、实现方法</h2><div class="story post-story"><h3 id="1-1、引入依赖"><a href="#1-1、引入依赖" class="headerlink" title="1.1、引入依赖"></a>1.1、引入依赖</h3><p>新建一个 SpringBoot 项目，引入以下的依赖：<br>该依赖是 Mysql 数据库进行 SSH 连接所必需的一个依赖，不能缺少。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.jcraft<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.55<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-2、创建连接"><a href="#1-2、创建连接" class="headerlink" title="1.2、创建连接"></a>1.2、创建连接</h3><p>然后新建一个工具类<code>SSHConnection</code>，里面编写的是SSH连接服务器的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSHConnection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * linux服务器登录名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String SSH_USER = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * linux登陆密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String SSH_PASSWORD = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *linux服务器公网IP</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String SSH_REMOTE_SERVER = <span class="string">&quot;xxx.xxx.xxx.xxx&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *跳板机ssh开放的接口,ssh通道端口   默认端口 22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> SSH_REMOTE_PORT = <span class="number">22</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *服务器上数据库端口号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> REMOTE_PORT = <span class="number">3306</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *这个是本地的端口，选取一个没有占用的port即可</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> LOCAL_PORT = <span class="number">3307</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *要访问的mysql所在的ip </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String MYSQL_REMOTE_SERVER = <span class="string">&quot;xxx.xxx.xxx.xxx&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Session session = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    建立SSH连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SSHConnection</span><span class="params">()</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">JSch jsch = <span class="keyword">new</span> JSch();</span><br><span class="line"></span><br><span class="line">session = jsch.getSession(SSH_USER, SSH_REMOTE_SERVER, SSH_REMOTE_PORT);</span><br><span class="line">session.setPassword(SSH_PASSWORD);</span><br><span class="line">Properties config = <span class="keyword">new</span> Properties();</span><br><span class="line">config.put(<span class="string">&quot;StrictHostKeyChecking&quot;</span>, <span class="string">&quot;no&quot;</span>);</span><br><span class="line">session.setConfig(config);</span><br><span class="line">session.connect();</span><br><span class="line">session.setPortForwardingL(LOCAL_PORT, MYSQL_REMOTE_SERVER, REMOTE_PORT);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    断开SSH连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeSSH</span> <span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.session.disconnect();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3、java监听类，监听SSH连接情况"><a href="#1-3、java监听类，监听SSH连接情况" class="headerlink" title="1.3、java监听类，监听SSH连接情况"></a>1.3、java监听类，监听SSH连接情况</h3><p>创建一个监听类<code>MyContextListener</code>，在 SSH 连接和断开时提供监听和反馈的作用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyContextListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SSHConnection conexionssh;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyContextListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent arg0)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 建立连接</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conexionssh = <span class="keyword">new</span> SSHConnection();</span><br><span class="line">            conexionssh.SSHConnection();</span><br><span class="line">            System.out.println(<span class="string">&quot;成功建立SSH连接！&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;SSH连接失败！&quot;</span>);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent arg0)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 断开连接</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Context destroyed ... !\n\n\n&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            conexionssh.closeSSH(); <span class="comment">// disconnect</span></span><br><span class="line">            System.out.println(<span class="string">&quot;成功断开SSH连接！&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;断开SSH连接出错！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4、编写配置文件"><a href="#1-4、编写配置文件" class="headerlink" title="1.4、编写配置文件"></a>1.4、编写配置文件</h3><p>在最后编写 SpringBoot的配置文件，即可运行使用</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">spring.datasource.url=jdbc:mysql://127.0.0.1:3307/数据库名称?useUnicode=true&amp;characterEncoding=UTF-8&amp;useJDBCCompliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="string">spring.datasource.username=数据库名</span></span><br><span class="line"><span class="string">spring.datasource.password=数据库密码</span></span><br><span class="line"><span class="string">spring.datasource.druid.test-on-borrow=true</span></span><br><span class="line"><span class="string">spring.datasource.druid.test-while-idle=true</span></span><br><span class="line"><span class="comment">#127.0.0.1:3307 本机的3307端口，不需改动，和ssh工具类的local_port对应起来</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="数据库" scheme="http://cyc0819.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/categories/java/SpringBoot/"/>
    
    <category term="SSH连接" scheme="http://cyc0819.top/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/SSH%E8%BF%9E%E6%8E%A5/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="数据库" scheme="http://cyc0819.top/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>通过gunicorn+docker部署flask项目</title>
    <link href="http://cyc0819.top/2022/05/09/2022-05-09-%E9%80%9A%E8%BF%87gunicorn+docker%E9%83%A8%E7%BD%B2flask%E9%A1%B9%E7%9B%AE/"/>
    <id>http://cyc0819.top/2022/05/09/2022-05-09-%E9%80%9A%E8%BF%87gunicorn+docker%E9%83%A8%E7%BD%B2flask%E9%A1%B9%E7%9B%AE/</id>
    <published>2022-05-08T16:24:33.000Z</published>
    <updated>2022-06-12T16:28:33.343Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="通过gunicorn-docker部署flask项目"><a href="#通过gunicorn-docker部署flask项目" class="headerlink" title="通过gunicorn+docker部署flask项目"></a>通过gunicorn+docker部署flask项目</h1><p>由于学习上的原因，有幸接触到了 Python 项目部署到服务器的知识点，经过查找资料了解到，通过 flask 框架编写 Python 项目，并通过 gunicorn 运行项目以及 docker容器化服务，即可实现将其部署到服务器。</p><h2 id="1、准备"><a href="#1、准备" class="headerlink" title="1、准备"></a>1、准备</h2><div class="story post-story"><p>首先我们需要准备一个完整的能在运行的 flask 项目，并且需要在服务器上安装好 docker 容器。<br>以下我使用一个基础的 flask Hello World 项目进行配置，项目的基本结构如下：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510141015.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510141015.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>其中<code>app.py</code>是程序的启动类文件，<code>Dockerfile</code>是docker的配置文件，可以用来创建docker的镜像文件，<code>requirements.txt</code>是所有依赖的名称，docker 会根据这些名称来下载你所需要的依赖，<code>gunicorn.conf.py</code>是 gunicorn 服务器的配置文件，其中有线程以及端口等内容。</p></div><h2 id="2、配置文件编辑"><a href="#2、配置文件编辑" class="headerlink" title="2、配置文件编辑"></a>2、配置文件编辑</h2><div class="story post-story"><ol><li>首先是启动类的内容</li></ol><p>启动类是 flask 框架的必备内容，其内容如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span>  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure><ol start="2"><li>requirements.txt文件内容</li></ol><p>里头写上所有我们所需要的依赖，如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br><span class="line">gunicorn</span><br><span class="line">gevent</span><br></pre></td></tr></table></figure><ol start="3"><li>gunicorn.conf.py</li></ol><p>里头写上 gunicorn 启动的时候的配置文件，如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">workers = <span class="number">4</span>        <span class="comment"># 定义同时开启的处理请求的进程数量，根据网站流量适当调整</span></span><br><span class="line">worker_class = <span class="string">&quot;gevent&quot;</span>  <span class="comment"># 采用gevent库，支持异步处理请求，提高吞吐量</span></span><br><span class="line">bind = <span class="string">&quot;0.0.0.0:8080&quot;</span>   <span class="comment"># 这里8080可以随便调整</span></span><br></pre></td></tr></table></figure><ol start="4"><li>Dockerfile</li></ol><p>该文件是 docker 创建镜像的时候比较重要的文件，通过读取其中的内容创建一个镜像，内容如下：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># FROM:所构建镜像基于什么镜像</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.7</span></span><br><span class="line"><span class="comment"># WORKDIR:之后的shell语句是运行在哪个目录下</span></span><br><span class="line"><span class="comment"># 写到你运行的文件的位置</span></span><br><span class="line"><span class="comment"># 写的是要部署到服务器上的路径，如果这个镜像没有这个文件就会自动创建这个文件</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /home/chen/ff</span></span><br><span class="line"><span class="comment"># COPY:将当前宿主机的文件拷贝到镜像里面去</span></span><br><span class="line"><span class="comment"># 这里我们是把python安装的依赖requirements.txt拷贝到镜像里面去</span></span><br><span class="line"><span class="comment"># requirements.txt是依赖包的名字，里面写上要下载的依赖</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> requirements.txt ./</span></span><br><span class="line"><span class="comment"># RUN 执行shell命令，在构建的时候就会运行</span></span><br><span class="line"><span class="comment"># 这里是安装python依赖 配置镜像源</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/</span></span><br><span class="line"><span class="comment"># 复制当前目录到项目中的WorkDir中</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="comment"># 第一个app是我们的flask的python文件名 第二个app为flask的应用名</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;gunicorn&quot;</span>, <span class="string">&quot;app:app&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;./gunicorn.conf.py&quot;</span>]</span></span><br></pre></td></tr></table></figure></div><h2 id="3、构建docker镜像并运行"><a href="#3、构建docker镜像并运行" class="headerlink" title="3、构建docker镜像并运行"></a>3、构建docker镜像并运行</h2><div class="story post-story"><p>将以上文件打包上传到服务器上，然后在该目录下即可创建 docker 的镜像文件。<br>通过以下的命令即可创建：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t &#x27;myflask_app2&#x27; .</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143219.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143219.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>注意：此处由于我之前已经创建过一次了，所以直接成功，首次创建回=会遍历你的配置文件然后下载。</p><p>完成之后就会显示出已经创建的镜像文件<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143558.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143558.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>随后运行该镜像文件，通过以下的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8087:8086 --name myflask2 myflask_app2</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143701.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143701.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>运行成功之后通过访问服务器的8087端口，即可访问我们的内容<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143851.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143851.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>随后通过<code>docker ps</code>可以查看现在正在运行的镜像<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143920.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220510143920.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>至此就算是部署成功了。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="http://cyc0819.top/categories/Linux/"/>
    
    <category term="部署" scheme="http://cyc0819.top/categories/Linux/%E9%83%A8%E7%BD%B2/"/>
    
    <category term="Python" scheme="http://cyc0819.top/categories/Python/"/>
    
    <category term="flask" scheme="http://cyc0819.top/categories/Python/flask/"/>
    
    
    <category term="docker" scheme="http://cyc0819.top/tags/docker/"/>
    
    <category term="Linux" scheme="http://cyc0819.top/tags/Linux/"/>
    
    <category term="flask" scheme="http://cyc0819.top/tags/flask/"/>
    
    <category term="gunicorn" scheme="http://cyc0819.top/tags/gunicorn/"/>
    
    <category term="Python" scheme="http://cyc0819.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>数据结构之树</title>
    <link href="http://cyc0819.top/2022/05/04/2022-05-04-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E6%A0%91/"/>
    <id>http://cyc0819.top/2022/05/04/2022-05-04-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B9%8B%E6%A0%91/</id>
    <published>2022-05-04T15:16:18.000Z</published>
    <updated>2022-06-12T16:28:08.648Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="数据结构之树"><a href="#数据结构之树" class="headerlink" title="数据结构之树"></a>数据结构之树</h1><h2 id="1、基本理论术语"><a href="#1、基本理论术语" class="headerlink" title="1、基本理论术语"></a>1、基本理论术语</h2><div class="story post-story"><p>节点深度：对任意节点x，x节点的深度表示为根节点到x节点的路径长度。所以根节点深度为0，第二层节点深度为1，以此类推<br>节点高度：对任意节点x，叶子节点到x节点的路径长度就是节点x的高度<br>树的深度：一棵树中节点的最大深度就是树的深度，也称为高度<br>父节点：若一个节点含有子节点，则这个节点称为其子节点的父节点<br>子节点：一个节点含有的子树的根节点称为该节点的子节点<br>节点的层次：从根节点开始，根节点为第一层，根的子节点为第二层，以此类推<br>兄弟节点：拥有共同父节点的节点互称为兄弟节点<br>度：节点的子树数目就是节点的度<br>叶子节点：度为零的节点就是叶子节点<br>祖先：对任意节点x，从根节点到节点x的所有节点都是x的祖先（节点x也是自己的祖先）<br>后代：对任意节点x，从节点x到叶子节点的所有节点都是x的后代（节点x也是自己的后代）<br>森林：m颗互不相交的树构成的集合就是森林</p></div><h2 id="2、树的种类"><a href="#2、树的种类" class="headerlink" title="2、树的种类"></a>2、树的种类</h2><div class="story post-story"><ol><li>无序树<br> 树的任意节点的子节点没有顺序关系。 </li><li>有序树<br> 树的任意节点的子节点有顺序关系。 </li><li>二叉树<br> 树的任意节点至多包含两棵子树。 </li><li>满二叉树<br> 叶子节点都在同一层并且除叶子节点外的所有节点都有两个子节点。 </li><li>完全二叉树<br> 对于一颗二叉树，假设其深度为d（d&gt;1）。除第d层外的所有节点构成满二叉树，且第d层所有节点从左向右连续地紧密排列，这样的二叉树被称为完全二叉树； </li><li>平衡二叉树<br> 它是一 棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树，同时，平衡二叉树必定是二叉搜索树。 </li><li>二叉查找树<br>又称为二叉搜索树<br>若任意节点的左子树不空，则左子树上所有节点的值均小于它的根节点的值；<br>若任意节点的右子树不空，则右子树上所有节点的值均大于它的根节点的值；<br>任意节点的左、右子树也分别为二叉查找树；<br>没有键值相等的节点。 </li><li>线索二叉树<br> 遍历二叉树是以一定的规则将二叉树中的结点排列成一个线性序列，从而得到几种遍历序列，使得该序列中的每个结点(第一个和最后一个结点除外)都有一个直接前驱和直接后继。</li><li>霍夫曼树<br> 带权路径最短的二叉树称为哈夫曼树或最优二叉树。</li><li>红黑树<br>红黑树是一颗特殊的二叉查找树，除了二叉查找树的要求外，它还具有以下特性：<ul><li>每个节点或者是黑色，或者是红色。</li><li>根节点是黑色。</li><li>每个叶子节点（NIL）是黑色。 [注意：这里叶子节点，是指为空(NIL或NULL)的叶子节点！]</li><li>如果一个节点是红色的，则它的子节点必须是黑色的。</li><li>从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑节点。<br>图示如下：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20180121021159244" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20180121021159244" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ul></li><li>B树<br>一颗m阶B树的特性：<ul><li>根结点至少有两个子女（如果B树只有一个根节点，这个根节点的key的数量可以为[1~m-1])</li><li>每个非根节点所包含的关键字个数 j 满足：⌈m/2⌉ - 1 &lt;= j &lt;= m - 1，节点的值按非降序方式存放，即从左到右依次增加</li><li>除根结点以及叶子节点以外的所有结点的度数正好是关键字总数加1，故内部节点的子树个数 k 满足：⌈m/2⌉ &lt;= k &lt;= m</li><li>所有的叶子结点都位于同一层</li></ul></li><li>B+树<br>m阶B+树是m阶B树的变体，它的定义大致跟B-tree一致，不过有以下几点不同：<ul><li>有n棵子树的结点中含有n个关键字，每个关键字不保存数据，只用来索引，所有数据都保存在叶子节点，其中⌈m/2⌉ &lt;= n &lt;= m</li><li>所有的叶子结点中包含了全部关键字的信息，及指向含这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接</li><li>所有的非终端结点可以看成是索引部分，结点中仅含其子树（根结点）中的最大（或最小）关键字</li><li>通常在B+树上有两个头指针，一个指向根结点，一个指向关键字最小的叶子结点</li></ul></li><li>B * 树<br>B * 树是B+树的变体，除了B+树的要求之外，还有以下特性：<ul><li>⌈m * 2/3⌉ &lt;= n &lt;=m 这里的n是除根节点之外的内部节点的键</li><li>增加内部节点中兄弟节点的指针，由左边指向右边</li></ul></li></ol></div><h2 id="3、二叉树"><a href="#3、二叉树" class="headerlink" title="3、二叉树"></a>3、二叉树</h2><div class="story post-story"><h3 id="3-1、二叉树的定义"><a href="#3-1、二叉树的定义" class="headerlink" title="3.1、二叉树的定义"></a>3.1、二叉树的定义</h3><p>二叉树，顾名思义是一种每个节点中至多有两棵子树的一种树结构，并且有左右的分别，其次序也不能颠倒。<br>二叉树的两棵子树分别称为左子树以及右子树，而对于两棵子树而言，同样是一个二叉树，同样存在两棵子树。<br>综上所述，如果交换二叉树的左右节点，就会变成另外一棵二叉树，即使只有一个子树，同样也要区分左右子树。<br>以下是二叉树的几个形态：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223141038540.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223141038540.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="3-2、特殊的二叉树"><a href="#3-2、特殊的二叉树" class="headerlink" title="3.2、特殊的二叉树"></a>3.2、特殊的二叉树</h3><ol><li>斜二叉树<br> 所有子节点在左边的叫左斜二叉树，所有节点在右边的叫做右斜二叉树。</li><li>满二叉树<br> 一颗高度为h的二叉树，且含有2h-1个节点的二叉树称为满二叉树，也就是说在每个节点上都存在数量最多的子节点。<br> <img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223141540595.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223141540595.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>完全二叉树<br> 一颗高度为h的二叉树，有n个节点，当且仅当每一个节点都与高度为h的满二叉树中编号为1~n的节点一一对应的时候，称为完全二叉树。<br> <img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223141920389.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223141920389.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><ul><li>若i ≤ n / 2 i≤n/2i≤n/2, 则结点i ii为分支结点，否则为叶子结点。</li><li>叶子结点只可能在层次最大的两层上出现。对于最大层次中的叶子结点，都依次排列在该层最左边的位置上。</li><li>若有度为1 11的结点，则只可能有一个，且该结点只有左孩子而无右孩子(重要特征)。</li><li>按层序编号后，一旦出现某结点(编号为i ii)为叶子结点或只有左孩子，则编号大于i ii的结点均为叶子结点。</li><li>若n nn为奇数，则每个分支结点都有左孩子和右孩子;若n nn为偶数，则编号最大的分支结点(编号为n / 2 n/2n/2)只有左孩子，没有右孩子，其余分支结点左、右孩子都有。</li></ul></li><li>平衡二叉树<br> 一棵二叉树的左右节点的深度差别不大于1，就是平衡二叉树。</li><li>二叉排序树<br> 一棵二叉树的左节点上的所有的节点的值都比根节点小，并且所有右节点上的所有的节点的值都比根节点大，且每一个子节点又分别是一颗二叉排序树，这就是二叉排序树。</li></ol><h3 id="3-3、二叉树的存储结构"><a href="#3-3、二叉树的存储结构" class="headerlink" title="3.3、二叉树的存储结构"></a>3.3、二叉树的存储结构</h3><p>二叉树有两种存储结构，分别是顺序存储结构以及链式存储结构。</p><ol><li>顺序存储结构</li></ol><p>二叉树的顺序存储结构是指用一组地址连续的存储单元自上到下，自左到右存储完全二叉树的节点元素，即将二叉树上编号为 i 的项存储在一维数组下标为 i-1 的位置上。</p><p>依据二叉树的性质，完全二叉树和满二叉树采用顺序存储比较合适，树中结点的序号可以唯一地反映结点之间的逻辑关系，这样既能最大可能地节省存储空间，又能利用数组元素的下标值确定结点在二叉树中的位置，以及结点之间的关系。</p><p>但对于一般的二叉树，为了让数组下标能反映二叉树中结点之间的逻辑关系，只能添加一些并不存在的空结点，让其每个结点与完全二叉树上的结点相对照，再存储到一维数组的相应分量中。然而，在最坏情况下，一个高度为 h 且只有 h 个结点的单支树却需要占据近 2h−1 个存储单元。二叉树的顺序存储结构如图所示，其中0表示并不存在的空结点。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223145918502.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223145918502.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="2"><li>链式存储结构</li></ol><p>由于顺序存储结构的实用性不强，所以有了链式存储结构。<br>二叉树有一个根节点，一个根节点又有两个子节点，所以我们设计一个链式存储结构的结构为一个数据域以及两个指针域。如下：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223150251730.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223150251730.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>其中data是数据域，lchild 和rchild都是指针域，分别存放指向左孩子和右孩子的指针。</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223150652536.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223150652536.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>容易验证，在含有 n 个结点的二叉链表中，含有 n + 1 个空链域。</p><h3 id="3-4、遍历二叉树"><a href="#3-4、遍历二叉树" class="headerlink" title="3.4、遍历二叉树"></a>3.4、遍历二叉树</h3><p>首先创建一个二叉树节点类，以便后面的遍历：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line"></span><br><span class="line">    TreeNode() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TreeNode(<span class="keyword">int</span> val) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    TreeNode(<span class="keyword">int</span> val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        <span class="keyword">this</span>.val = val;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>二叉树的遍历，是指从根节点出发，逐步查找访问每一个子节点，子节点的子节点的一个过程，其中每一个节点必须也只能被访问一次。</p><p>遍历二叉树有多种方式，以下是一些基本的遍历方式：<br>(1).先序遍历<br>(2).中序遍历<br>(3).后序遍历</p><ol><li>先序遍历</li></ol><p>先序遍历的顺序为：根节点-左子树-右子树<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223151636759.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223151636759.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>其算法实现为：<br><a href="https://leetcode-cn.com/problems/binary-tree-preorder-traversal/">leetcode-144</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">preorderTraversal</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        preorder(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(root.val);</span><br><span class="line">        preorder(root.left,list);</span><br><span class="line">        preorder(root.right,list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>中序遍历</li></ol><p>中序遍历的顺序为：左子树-根节点-右子树<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/2021022315230487.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/2021022315230487.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>其算法实现为：<br><a href="https://leetcode-cn.com/problems/binary-tree-inorder-traversal/">leetcode-94</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">inorderTraversal</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        inorder(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; res)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inorder(root.left,res);</span><br><span class="line">        res.add(root.val);</span><br><span class="line">        inorder(root.right,res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>后序遍历</li></ol><p>后序遍历的顺序为：左子树-右子树-根节点<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223152835126.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210223152835126.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>其算法实现为：<br><a href="https://leetcode-cn.com/problems/binary-tree-postorder-traversal/">leetcode-145</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">postorderTraversal</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        dfs(root,list);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TreeNode root,List&lt;Integer&gt; list)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        dfs(root.left,list);</span><br><span class="line">        dfs(root.right,list);</span><br><span class="line">        list.add(root.val);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="3-5、层序遍历二叉树"><a href="#3-5、层序遍历二叉树" class="headerlink" title="3.5、层序遍历二叉树"></a>3.5、层序遍历二叉树</h3><p>除了上一节中的三种常见的遍历二叉树的方式，还有一种层序遍历的方式，该遍历方式就是从根节点开始，依层遍历，先遍历完第二层，再遍历第二层，以此类推直到结束。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210225175155659.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210225175155659.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>要进行层次遍历，需要借助一个队列。先将二叉树根结点入队，然后出队，访问出队结点，若它有左子树，则将左子树根结点入队;若它有右子树，则将右子树根结点入队。然后出队，访问出队结…如此反复，直至队列为空。</p><p>其算法实现为：<br><a href="https://leetcode-cn.com/problems/binary-tree-level-order-traversal/">leetcode-102</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ret = <span class="keyword">new</span> ArrayList&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> LinkedList&lt;TreeNode&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            List&lt;Integer&gt; level = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">            <span class="keyword">int</span> currentLevelSize = queue.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= currentLevelSize; ++i) &#123;</span><br><span class="line">                TreeNode node = queue.poll();</span><br><span class="line">                level.add(node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    queue.offer(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    queue.offer(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ret.add(level);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、线索二叉树"><a href="#4、线索二叉树" class="headerlink" title="4、线索二叉树"></a>4、线索二叉树</h2><div class="story post-story"><h3 id="4-1、线索二叉树理论入门"><a href="#4-1、线索二叉树理论入门" class="headerlink" title="4.1、线索二叉树理论入门"></a>4.1、线索二叉树理论入门</h3><p>遍历二叉树是以一定的规则将二叉树中的结点排列成一个线性序列，从而得到几种遍历序列，使得该序列中的每个结点(第一个和最后一个结点除外)都有一个直接前驱和直接后继。<br>传统的二叉链表存储仅能体现一种父子关系，不能直接得到结点在遍历中的前驱或后继。</p><p>为了区分二叉树的左孩子指针和右孩子指针是否为空，或者是否指向前驱节点或后继节点，我们将节点的结构改成5个域，在原二叉树的基础上添加左标志域Ltag和右标志域Rtag，他们是两个int型的数据域。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220505140613.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220505140613.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ul><li>如果节点有左孩子，那么Lchild依然指向他的左孩子，否则指向遍历序列中他的前驱节点。</li><li>如果节点有右孩子，那么Rchild依然指向他的左孩子，否则指向遍历序列中他的后继节点。</li></ul><p>Ltag和Rtag的定义如下:</p><ul><li>Ltag : 等于0时，Lchild域指示节点的左孩子;等于1时，Lchild指示节点的遍历前驱。</li><li>Rtag : 等于0时，Rchild域指示节点的左孩子;等于1时，Rchild指示节点的遍历后继。</li></ul><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226110049774.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226110049774.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="4-2、二叉树的线索化"><a href="#4-2、二叉树的线索化" class="headerlink" title="4.2、二叉树的线索化"></a>4.2、二叉树的线索化</h3><p>二叉树的线索化是将二叉链表中的空指针改为指向前驱或后继的线索。而前驱或后继的信息只有在遍历时才能得到，因此线索化的实质就是遍历一次二叉树，线索化的过程就是在遍历的过程中修改空指针的过程。</p><ol><li>当遍历到左孩子指针域为空的时候，我们应该填入该节点的遍历前驱节点的指针，这时候我们可以提前声明一个全局变量pre来记录刚刚访问过的节点，在遍历过程中如果遇到左孩子为空的节点，就将pre赋给他的左孩子域，并且将Ltag设置为1。pre的初值应该为NULL，因为便利的首节点的前驱节点一定为空。</li><li>当遍历过程中右孩子的指针域为空的时候，要填的节点应该为当前节点遍历序列的后继节点，但是我们现在无法确定，因此当前节点的右孩子指针域只能遍历到下一个节点的时候在填，并且当前节点就是pre节点的后继节点，所以我们只需要在遍历的过程中加上判断，回填pre的语句，若pre的右孩子节点为空，那么将当前的节点赋值给pre的右节点，同时pre节点的Rtag应该置为1</li></ol><p>以下是中序线索二叉树的代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Inthread</span><span class="params">(BiTree root)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//pre为全局变量，在函数外已经声明过</span></span><br><span class="line"><span class="keyword">if</span>(root != <span class="keyword">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">Inthread(root.Lchild);<span class="comment">//递归线索化root的左孩子</span></span><br><span class="line"><span class="keyword">if</span>(root.Lchild == <span class="keyword">null</span>) <span class="comment">//置前置线索 </span></span><br><span class="line">&#123;</span><br><span class="line">root.Lchild = pre;</span><br><span class="line">root.Ltag = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">root.Ltag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pre != <span class="keyword">null</span> &amp;&amp; pre.Rchlid == <span class="keyword">null</span>)<span class="comment">//置后置线索</span></span><br><span class="line">&#123;</span><br><span class="line">pre.Rchlid = root;</span><br><span class="line">pre.Rtag = <span class="number">1</span>;</span><br><span class="line">&#125; </span><br><span class="line">pre = root;</span><br><span class="line">Inthread(root.Rchlid);<span class="comment">//递归线索化root的右孩子</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-3、遍历线索二叉树"><a href="#4-3、遍历线索二叉树" class="headerlink" title="4.3、遍历线索二叉树"></a>4.3、遍历线索二叉树</h3></div><h2 id="5、树、森林以及二叉树的转换"><a href="#5、树、森林以及二叉树的转换" class="headerlink" title="5、树、森林以及二叉树的转换"></a>5、树、森林以及二叉树的转换</h2><div class="story post-story"><p>在讲树的存储结构时，我们提到了树的孩子兄弟法可以将一棵树用二叉链表进行存储，所以借助二叉链表，树和二叉树可以相互进行转换。从物理结构来看，它们的二叉链表也是相同的，只是解释不太一样而已。 因此，只要我们设定一定的规则，用二叉树来表示树，甚至表示森林都是可以的，森林与二叉树也可以互相进行转换。</p><h3 id="5-1、树转换为二叉树"><a href="#5-1、树转换为二叉树" class="headerlink" title="5.1、树转换为二叉树"></a>5.1、树转换为二叉树</h3><p>树转换为二义树的规则:每个结点左指针指向它的第一个孩子，右指针指向它在树中的相邻右兄弟，这个规则又称“左孩子右兄弟”。由于根结点没有兄弟，所以对应的二叉树没有右子树。</p><p>以下是树转换为二叉树的画法：</p><ol><li>在兄弟节点中加一连线</li><li>对每个节点，只保留它与第一个子节点的连线，而其他子节点的连线全都删掉</li><li>以根节点为中心，旋转45°<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226145948307.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226145948307.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="5-2、森林转换为二叉树"><a href="#5-2、森林转换为二叉树" class="headerlink" title="5.2、森林转换为二叉树"></a>5.2、森林转换为二叉树</h3><p>森林是由若干棵树组成的，所以完全可以理解为,森林中的每一棵树都是兄弟，可以按照兄弟的处理办法来操作。</p><p>以下是森林转换为二叉树的画法：</p><ol><li>将森林中的每棵树都转换为单独的二叉树</li><li>每一颗单独的树的根节点都看作兄弟节点，在每棵树的下面加一条连线</li><li>以第一棵树为中心旋转45°<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226150421261.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226150421261.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>而二叉树转化为树或者森林即为将上述的过程倒推一遍即可。</p></div><h2 id="6、二叉排序树"><a href="#6、二叉排序树" class="headerlink" title="6、二叉排序树"></a>6、二叉排序树</h2><div class="story post-story"><p>二叉排序树又称为二叉查找树。其可能是一颗空树，也有可能是具有以下性质的二叉树：</p><ol><li>若左子树非空，那么左子树上的所有节点值均小于根节点的值</li><li>若右子树非空，那么右子树上的所有节点值均大于根节点的值</li><li>左右节点分别都是一颗二叉搜索树</li></ol><p>根据二叉排序树的定义，左子树结点值&lt;根结点值&lt;右子树结点值，所以对二叉排序树进行中序遍历，可以得到一个递增的有序序列。例如，下图所示二叉排序树的中序遍历序列为123468。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309095505317.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309095505317.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>首先创建一个二叉排序树：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTreeNode</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">int</span> data; <span class="comment">//数据域</span></span><br><span class="line"><span class="keyword">public</span> BinaryTreeNode left, right; <span class="comment">//指向左右子节点的指针</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BinaryTreeNode</span><span class="params">(<span class="keyword">int</span> data, BinaryTreeNode left, BinaryTreeNode right)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.data = data;</span><br><span class="line"><span class="keyword">this</span>.left = left;</span><br><span class="line"><span class="keyword">this</span>.right = right;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-1、-初始化二叉排序树"><a href="#6-1、-初始化二叉排序树" class="headerlink" title="6.1、 初始化二叉排序树"></a>6.1、 初始化二叉排序树</h3><p>首先是在初始化的类中定义二叉查找树的根节点：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BinaryTreeNode root;</span><br></pre></td></tr></table></figure><p>然后即可初始化二叉排序树：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertBinaryTree</span><span class="params">(<span class="keyword">int</span>[] datas)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(datas.length &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;the datas Array length small zero!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.root = <span class="keyword">new</span> BinaryTreeNode(datas[<span class="number">0</span>], <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; datas.length; i++) &#123;</span><br><span class="line">        <span class="keyword">this</span>.insert(<span class="keyword">this</span>.root, datas[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(BinaryTreeNode root, <span class="keyword">int</span> data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(data &gt; root.data) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root.right == <span class="keyword">null</span>) </span><br><span class="line">            root.right = <span class="keyword">new</span> BinaryTreeNode(data, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">this</span>.insert(root.right, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root.left == <span class="keyword">null</span>) </span><br><span class="line">            root.left = <span class="keyword">new</span> BinaryTreeNode(data, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">this</span>.insert(root.left, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过传递给insertBinaryTree()存储二叉查找树值的数组来完成初始化。通过insert()方法递归的来完成对结点的初始化操作。</p><h3 id="6-2、-二叉排序树的中序遍历"><a href="#6-2、-二叉排序树的中序遍历" class="headerlink" title="6.2、 二叉排序树的中序遍历"></a>6.2、 二叉排序树的中序遍历</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">(BinaryTreeNode root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.inOrder(root.left);</span><br><span class="line">        System.out.print(root.data + <span class="string">&quot;-&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.inOrder(root.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据二叉排序树的特性我们知道如果根节点非空，则根节点的左子树上所有结点的值均小于根节点，右子树上的所有结点值均大于根节点。同理对任意子树都满足上面。所以对于二叉排序树的遍历是对二叉排序树的由小到大的升序输出。在这里前序和后序遍历与中序逻辑相似，不做展示。</p><h3 id="6-3、二叉排序树的查找"><a href="#6-3、二叉排序树的查找" class="headerlink" title="6.3、二叉排序树的查找"></a>6.3、二叉排序树的查找</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">SearchBST</span><span class="params">(BinaryTreeNode root, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(key == root.data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(key &lt; root.data) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.SearchBST(root.left, key);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.SearchBST(root.right, key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询操作也基于递归，查询过程和节点结点值进行比较，若成功返回true。</p><h3 id="6-4、二叉排序树的插入"><a href="#6-4、二叉排序树的插入" class="headerlink" title="6.4、二叉排序树的插入"></a>6.4、二叉排序树的插入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">InsertBST</span><span class="params">(BinaryTreeNode root, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">this</span>.SearchBST(root, key)) &#123;</span><br><span class="line"><span class="keyword">this</span>.insert(root, key);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;the key existence in BinaryTree&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该操作的思路是查询带插入的key是否已经在二叉排序树中，如果不在，执行insert()方法递归的将key插入到指定的位置，如果存在，返回错误信息并结束。</p><h3 id="6-5、二叉排序树的删除"><a href="#6-5、二叉排序树的删除" class="headerlink" title="6.5、二叉排序树的删除"></a>6.5、二叉排序树的删除</h3><p>相对于其他的操作，二叉排序树的删除操作就显得不是特别容易，因为我们需要保证在删除了某一个元素之后，剩下的元素还保持二叉排序树的结构，所以在删除时就需要考虑多种情况。</p><ol><li>当删除的为叶子节点的时候：</li></ol><p>可以直接删除该叶子结点的值，并将其父节点指向该节点的域置为null<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311194315480.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311194315480.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>删除x<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311194520105.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311194520105.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="2"><li>当删除的节点只有左子树或者只有右子树</li></ol><p>相对来说也好解决，那就是结点删除后，将它的左子树或右子树整个移动到删除结点的位置即可，可以理解为独子继承父业。<br>比如要删除结点x，直接将父结点p指向待删除的结点x的指针直接指向x结点的唯一儿子结点(l或则是r)，然后删除x结点即可。</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311195012724.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311195012724.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>删除x<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311195343646.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20190311195343646.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="3"><li>当删除的节点存在左右子树时</li></ol><p>这也是最麻烦的一种情况，通常的解决方式是用删除结点x的前驱(或后继)结点填补它的位置。因为x有一个左子结点，因此它的前驱结点就是左子树中的最大结点，这样替换就能保证有序性，因为x.data和它的前驱之间不存在其他的键值。<br>操作如下：<br>3.1 寻找到待删除的结点的前驱结点，并用s指向其前驱结点<br>3.2 找到待删除结点的前驱结点的父结点，并用q来指向前驱结点的父节点。<br>3.3 将x的前驱结点的值赋给x，完成替换操作。<br>3.4 最后修改q的指向为s的子节点，并删除s。</p><p>通过递归寻找要删除的节点：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">DeleteBST</span><span class="params">(BinaryTreeNode root, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(root == <span class="keyword">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;the root node is null&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(key == root.data) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.delete(root);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(key &lt; root.data) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.DeleteBST(root.left, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.DeleteBST(root.right, key);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除找到的节点：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(BinaryTreeNode root)</span> </span>&#123;</span><br><span class="line">    BinaryTreeNode q, s;</span><br><span class="line">    <span class="keyword">if</span>(root.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">        root = root.left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(root.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">        root = root.right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        q = root;</span><br><span class="line">        s = root.left;</span><br><span class="line">        <span class="keyword">while</span>(s.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            q = s;</span><br><span class="line">            s = s.right;</span><br><span class="line">        &#125;</span><br><span class="line">        root.data = s.data;</span><br><span class="line">        <span class="keyword">if</span>(q != root) &#123;</span><br><span class="line">            q.right = s.left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            q.left = s.left;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="7、平衡二叉树"><a href="#7、平衡二叉树" class="headerlink" title="7、平衡二叉树"></a>7、平衡二叉树</h2><div class="story post-story"><p>平衡二叉树(Self-Balancing Binary Search Tree 或 Height-Balanced Binary Search Tree)是一种二叉排序树，其中每一个节点的左子树和右子树的高度差至多等于1。</p><p>它是一种高度平衡的二叉排序树。它要么是一棵空树， 要么它的左子树和右子树都是平衡二叉树，且左子树和右子树的深度之差的绝对值不超过1。我们将二叉树上结点的左子树深度减去右子树深度的值称为平衡因子BF (Balance Factor) ， 那么平衡二叉树上所有结点的平衡因子只可能是-1、0和1。只要二叉树上有一个结点的平衡因子的绝对值大于1，则该二叉树就是不平衡的。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309100347701.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309100347701.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="7-1、平衡二叉树的查找"><a href="#7-1、平衡二叉树的查找" class="headerlink" title="7.1、平衡二叉树的查找"></a>7.1、平衡二叉树的查找</h3><p>在平衡二叉树上进行查找的过程与二叉排序树的相同。</p><h3 id="7-2、平衡二叉树的插入"><a href="#7-2、平衡二叉树的插入" class="headerlink" title="7.2、平衡二叉树的插入"></a>7.2、平衡二叉树的插入</h3><p>二叉排序树保证平衡的基本思想如下：每当在二叉排序树中插入(或删除)一个结点时，首先检查其插入路径上的结点是否因为此次操作而导致了不平衡。若导致了不平衡，则先找到插入路径上离插入结点最近的平衡因子的绝对值大于1的结点A，再对以A为根的子树，在保持二叉排序树特性的前提下，调整各结点的位置关系，使之重新达到平衡。</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309101003723.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309101003723.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>平衡二叉树的插入过程的前半部分与二叉排序树相同，但在新结点插入后，若造成查找路径上的某个结点不再平衡，则需要做出相应的调整。</p><ol><li>LL平衡旋转(右单旋转)</li></ol><p>由于在结点A的左孩子(L)的左子树(L)上插入了新结点，A的平衡因子由1增至2，导致以A为根的子树失去平衡，需要一次向右的旋转操作。将A的左孩子B向右上旋转代替A成为根结点，将A结点向右下旋转成为B的右子树的根结点，而B的原右子树则作为A结点的左子树。<br>如下图所示，结点旁的数值代表结点的平衡因子，而用方块表示相应结点的子树，下方数值代表该子树的高度。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309101721760.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309101721760.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="2"><li>RR平衡旋转(左单旋转)</li></ol><p>由于在结点A的右孩子®的右子树®上插入了 新结点，A的平衡因子由-1减至-2，导致以A为根的子树失去平衡，需要一次向左的旋转操作。将A的右孩子B向左上旋转代替A成为根结点，将A结点向左下旋转成为B的左子树的根结点，而B的原左子树则作为A结点的右子树。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/2021030910190515.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/2021030910190515.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="3"><li>LR平衡旋转(先左后右双旋转)</li></ol><p>由于在A的左孩子(L)的右子树®上插入新结点，A的平衡因子由1增至2，导致以A为根的子树失去平衡，需要进行两次旋转操作，先左旋转后右旋转。先将A结点的左孩子B的右子树的根结点C向左上旋转提升到B结点的位置（即进行一次RR平衡旋转(左单旋转)），然后再把该C结点向右上旋转提升到A结点的位置（即进行一次LL平衡旋转(右单旋转)）。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309101948801.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309101948801.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol start="4"><li>RL平衡旋转(先右后左双旋转)</li></ol><p>由于在A的右孩子®的左子树(L)上插入新结点，A的平衡因子由-1减至-2，导致以A为根的子树失去平衡，需要进行两次旋转操作，先右旋转后左旋转。先将A结点的右孩子B的左子树的根结点C向右上旋转提升到B结点的位置（即进行一次LL平衡旋转(右单旋转)），然后再把该C结点向左上旋转提升到A结点的位置（即进行一次RR平衡旋转(左单旋转)）。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309102558548.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309102558548.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>注意: LR和RL旋转时，新结点究竟是插入C的左子树还是插入C的右子树不影响旋转过程，而上图中是以插入C的左子树中为例。</strong></p><h3 id="7-2、平衡二叉树的插入——举例"><a href="#7-2、平衡二叉树的插入——举例" class="headerlink" title="7.2、平衡二叉树的插入——举例"></a>7.2、平衡二叉树的插入——举例</h3><p>假设关键字序列为15 , 3 , 7 , 10 , 9 , 8通过该序列生成平衡二叉树的过程如下图所示。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309103024879.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210309103024879.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="8、哈夫曼树"><a href="#8、哈夫曼树" class="headerlink" title="8、哈夫曼树"></a>8、哈夫曼树</h2><div class="story post-story"><h3 id="8-1、哈夫曼树的定义"><a href="#8-1、哈夫曼树的定义" class="headerlink" title="8.1、哈夫曼树的定义"></a>8.1、哈夫曼树的定义</h3><p>在许多应用中，树中结点常常被赋予一个表示某种意义的数值，称为该结点的权。从树的根到任意结点的路径长度(经过的边数)与该结点上权值的乘积，称为该结点的带权路径长度。树中所有叶结点的带权路径长度之和称为该树的带权路径长度，记为<br>$$<br>WPL=\sum_{i=1}^nw_il_i<br>$$<br>式中，wi是第i个叶结点所带的权值， li是该叶结点到根结点的路径长度。<br>在含有n个带权叶结点的二叉树中，其中带权路径长度(WPL)最小的二叉树称为哈夫曼树，也称最优二叉树。例如，下图中的3棵二叉树都有4个叶子结点a, b,c,d,分别带权7,5,2,4，它们的带权路径长度分别为<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226154517971.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226154517971.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>a. WPL = 7x2 + 5x2 + 2x2 + 4x2 = 36。<br>b. WPL = 4x2 + 7x3 + 5x3 + 2x1 = 46。<br>c. WPL = 7x1 + 5x2 + 2x3 + 4x3 = 35。<br>其中，图c树的WPL最小。可以验证，它恰好为哈夫曼树。</p><h3 id="8-2、构造哈夫曼树"><a href="#8-2、构造哈夫曼树" class="headerlink" title="8.2、构造哈夫曼树"></a>8.2、构造哈夫曼树</h3><ol><li>先把有权值的叶子结点按照从大到小（从小到大也可以）的顺序排列成一个有序序列。</li><li>取最后两个最小权值的结点作为一个新节点的两个子结点，注意相对较小的是左孩子。</li><li>用第2步构造的新结点替掉它的两个子节点，插入有序序列中，保持从大到小排列。</li><li>重复步骤2到步骤3，直到根节点出现。</li></ol><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226155839813.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226155839813.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="8-3、哈夫曼编码"><a href="#8-3、哈夫曼编码" class="headerlink" title="8.3、哈夫曼编码"></a>8.3、哈夫曼编码</h3><p>哈夫曼编码的研究，本质上是一种最优化问题的研究，其目的主要是为了解决远距离通信的数据传输问题。而哈夫曼编码被公认为是一种有效的数据压缩编码。</p><p>比如我们有一段文字内容为“ BADCADFEED”要网络传输给别人，显然用二进制的数字(0和1)来表示是很自然的想法。我们现在这段文字只有六个字母ABCDEF，那么我们可以用相应的二进制数据表示，如下表所示：</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226160333919.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226160333919.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这样按照固定长度编码编码后就是“001000011010000011101100100011”，对方接收时可以按照3位一分来译码。如果一篇文章很长，这样的二进制串也将非常的可怕。而且事实上，不管是英文、中文或是其他语言，字母或汉字的出现频率是不相同的。</p><p>假设六个字母的频率为A 27,B 8,C 15,D 15,E 30,F 5,合起来正好是100%，那就意味着，我们完全可以重新按照赫夫曼树来规划它们。</p><p>图左图为构造赫夫曼树的过程的权值显示。右图为将权值左分支改为0，右分支改为1后的赫夫曼树。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226161046918.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226161046918.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>这棵哈夫曼树的WPL为:<br>$$<br>WPL=2*(15+17+30)+3<em>15+4</em>(5+8)=241<br>$$<br>此时，我们对这六个字母用其从树根到叶子所经过路径的0或1来编码，可以得到如下表所示这样的定义。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226161554834.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20210226161554834.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>若没有一个编码是另一个编码的前缀，则称这样的编码为前缀编码。<br>我们将文字内容为“ BADCADFEED”再次编码，对比可以看到结果串变小了。</p><ul><li>原编码二进制串: 000011000011101100100011 (共 30个字符)</li><li>新编码二进制串: 10100101010111100(共25个字符)</li></ul><p>也就是说，我们的数据被压缩了，节约了大约17%的存储或传输成本。</p><p>需要注意的一点是：<br>0和1究竟是表示左子树还是右子树没有明确规定。左、右孩子结点的顺序是任意的，所以构造出的哈夫曼树并不唯一，但各哈夫曼树的带权路径长度WPL相同且为最优。此外，如有若干权值相同的结点，则构造出的哈夫曼树更可能不同，但WPL必然相同且是最优的。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="数据结构" scheme="http://cyc0819.top/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="数据结构" scheme="http://cyc0819.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>docker基础</title>
    <link href="http://cyc0819.top/2022/03/20/2022-03-20-docker%E5%9F%BA%E7%A1%80/"/>
    <id>http://cyc0819.top/2022/03/20/2022-03-20-docker%E5%9F%BA%E7%A1%80/</id>
    <published>2022-03-20T02:17:43.000Z</published>
    <updated>2022-06-12T16:27:20.779Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="docker基础"><a href="#docker基础" class="headerlink" title="docker基础"></a>docker基础</h1><h2 id="1、安装以及配置"><a href="#1、安装以及配置" class="headerlink" title="1、安装以及配置"></a>1、安装以及配置</h2><div class="story post-story"><h3 id="1-1、docker的基本组成"><a href="#1-1、docker的基本组成" class="headerlink" title="1.1、docker的基本组成"></a>1.1、docker的基本组成</h3><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320151027.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320151027.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol><li>镜像</li></ol><p>镜像就是一个只读的模板，可以通过这个模板创建容器服务，一个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中）。</p><ol start="2"><li>容器</li></ol><ul><li>Docker利用容器技术，独立运行的一个或一组应用。容器是用镜像创建的运行实例。</li><li>它可以被启用，开始，停止，删除。每个容器都是相互隔离的，保证安全的平台。</li><li>可以把容器看作是一个简易版的Linux系统(包括root用户权限，进程空间，用户空间和网络空间等)和运行在其中的应用程序。</li><li>容器的定义和镜像几乎一摸一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的</li></ul><ol start="3"><li>仓库</li></ol><ul><li>仓库是集中存放镜像文件的场所。</li><li>仓库和仓库注册服务器(Registry)是有区别的，仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签</li><li>仓库分为公开仓库(public)和私有仓库(private)两种形式</li><li>最大的开放仓库是国外的 Docker Hub，存放了数量庞大的镜像供用户下载。</li><li>国内的公开仓库包括阿里云，网易云都有容器服务器（需要配置镜像加速）等</li></ul><h3 id="1-2、准备安装环境"><a href="#1-2、准备安装环境" class="headerlink" title="1.2、准备安装环境"></a>1.2、准备安装环境</h3><p>需要准备一台系统为<code>Cent OS 7&amp;8</code>的服务器，这里我所使用的是阿里云的服务器。</p><h3 id="1-3、安装"><a href="#1-3、安装" class="headerlink" title="1.3、安装"></a>1.3、安装</h3><ol><li>卸载旧版本</li></ol><p>直接通过<code>yum</code>来安装 docker 服务。<br>如果在系统之中有旧版本的 docker ，需要首先卸载旧的版本</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure><ol start="2"><li>安装新版本<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure></li><li>设置镜像地址<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 默认是国外的</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line"><span class="meta">#</span><span class="bash"> 换成阿里云镜像地址</span></span><br><span class="line">sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>安装最新版Docker Engine和容器<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker-ce社区版(docker-ee企业版)</span></span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure></li></ol><h3 id="1-4、安装完成后启动"><a href="#1-4、安装完成后启动" class="headerlink" title="1.4、安装完成后启动"></a>1.4、安装完成后启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><p>查看是否安装成功并启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320153252.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320153252.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="1-5、测试"><a href="#1-5、测试" class="headerlink" title="1.5、测试"></a>1.5、测试</h3><p>运行hello world测试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320153514.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320153514.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>查看刚才运行的镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320153657.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220320153657.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、docker常用命令"><a href="#2、docker常用命令" class="headerlink" title="2、docker常用命令"></a>2、docker常用命令</h2><div class="story post-story"><h2 id="3、实战部署"><a href="#3、实战部署" class="headerlink" title="3、实战部署"></a>3、实战部署</h2><h3 id="3-1、部署Nginx"><a href="#3-1、部署Nginx" class="headerlink" title="3.1、部署Nginx"></a>3.1、部署Nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 搜索镜像</span></span><br><span class="line">docker search nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 下载镜像</span></span><br><span class="line">docker pull nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 查看镜像是否下载成功</span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 启动容器(-d:后台运行 --name:容器名 -p:暴露端口 宿主机端口3344:容器端口80)</span></span><br><span class="line">docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 查看容器是否启动</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 本机测试</span></span><br><span class="line">curl localhost:3344</span><br></pre></td></tr></table></figure><h3 id="3-2、部署Tomcat"><a href="#3-2、部署Tomcat" class="headerlink" title="3.2、部署Tomcat"></a>3.2、部署Tomcat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 官方使用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 之前我们都是后台启动,停止容器后,仍可以通过docker ps -a命令查到容器的使用记录</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --rm表示用完就删除容器及历史记录,通过命令查不到;</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="3、容器数据卷"><a href="#3、容器数据卷" class="headerlink" title="3、容器数据卷"></a>3、容器数据卷</h2><div class="story post-story"><h3 id="3-1、什么是容器数据卷"><a href="#3-1、什么是容器数据卷" class="headerlink" title="3.1、什么是容器数据卷"></a>3.1、什么是容器数据卷</h3><p>docker的理念：将应用和环境打包成一个镜像！通过镜像启动容器运行。</p><p>而现在有这样一个问题：在容器中存储的程序数据是需要持久化的，不能容器删了数据也随之删除。比如，安装一个MySQL容器，在其中存储了大量数据，结果把容器删了数据也没了，就相当于删库跑路，这是不可能发生的</p><p>而为了解决这个问题，就有了 容器数据卷 的概念：Docker容器所产生的数据会自动同步到本地，这样子即使将容器删除了，数据依然还在；同时，同一份数据还可以在多个容器中进行共享。<br>类似于将容器的目录挂载到本地（本地指的是：服务器的本地）</p><h3 id="3-2、使用容器数据卷"><a href="#3-2、使用容器数据卷" class="headerlink" title="3.2、使用容器数据卷"></a>3.2、使用容器数据卷</h3><p>使用数据卷有两种方式，一种是通过命令行挂载的方式，一种是通过dockerfile的方式添加，首先进行第一种模式的介绍。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器内目录</span><br></pre></td></tr></table></figure><p>举例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /home/test:/home centos /bin/bash</span><br></pre></td></tr></table></figure><p>启动之后可以用docker inspect查看容器详细信息，可以看到挂载的信息。<br>其中<code>-v</code>表示在容器中创建一个数据卷，通过该命令，会在docker以及宿主中分别创建一个相同的目录，两个目录相互共享，里面的文件也是一样。</p><p>同时在创建容器数据卷的的时候还可以给它加上权限，如果我们想要给宿主机只能读取数据卷中的数据，但是不能修改，我们就可以通过以下的方式进行设置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v /主机目录 ： /容器内目录  ：ro 镜像名</span><br></pre></td></tr></table></figure><p>而一般情况下，只写很少使用，同样通过docker inspect可以查看权限。<br>下面我们介绍dockerfile的方式创建容器数据卷。</p><h3 id="3-3、初识Dockerfile"><a href="#3-3、初识Dockerfile" class="headerlink" title="3.3、初识Dockerfile"></a>3.3、初识Dockerfile</h3><p>DockerFile也就是用来创建docker镜像的构建文件，而dockerFile对于docker镜像而言就如同java中某个类的.class文件对应上该类的.java文件。</p><p>首先在linux服务器根目录上新建docker文件夹并建立DockerFile文件，使用volume命令（出于可移植可分享的的考虑，用以上 -v /宿主机绝对路径目录 ：<code> /容器内目录</code> 的这种方式不能够直接在dockerFile中直接实现，因为宿主机目录是依赖于特定的宿主机的，并不能保证所有的宿主机都存在这样特定的目录）</p><p>首先我们编写一个dockerfile文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM  镜像名</span><br><span class="line">VOLUME [&quot;/生成的目录路径&quot;]  -- privileged=true</span><br><span class="line">CMD echo &quot;success build&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p>以上的文件脚本相当于命令行：<code> docker run -it -v /主机目录 ： /容器内目录</code></p><p>然后通过<code>docker build</code>编译运行该脚本文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f  /docker/DockerFile -t  命名空间/镜像名</span><br></pre></td></tr></table></figure><p>执行后输入docker images就可以发现自己通过DockerFile所build的镜像，里面有挂载数据卷。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="docker" scheme="http://cyc0819.top/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>给个人网站加上天气插件</title>
    <link href="http://cyc0819.top/2022/03/09/2022-03-09-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E5%A4%A9%E6%B0%94%E6%8F%92%E4%BB%B6/"/>
    <id>http://cyc0819.top/2022/03/09/2022-03-09-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E5%A4%A9%E6%B0%94%E6%8F%92%E4%BB%B6/</id>
    <published>2022-03-09T01:09:43.000Z</published>
    <updated>2022-06-12T16:27:02.678Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="给个人网站加上天气插件"><a href="#给个人网站加上天气插件" class="headerlink" title="给个人网站加上天气插件"></a>给个人网站加上天气插件</h1><h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><div class="story post-story"><p>在修改个人网站的时候，想加上一个天气的插件，以用于打开我的个人网站的时候就可以看到当前地区的天气，这个功能既可以给网站增添光彩，也可以给游客打开网站增加了一个理由。</p><p>在看了多款天气插件之后，如：中国天气网、心知天气、彩云天气等等。<br>最终还是选了<a href="https://www.qweather.com/">和风天气</a>作为最终的插件</p></div><h2 id="2、API设置"><a href="#2、API设置" class="headerlink" title="2、API设置"></a>2、API设置</h2><div class="story post-story"><p>首先我们需要进入和风天气的<a href="https://dev.qweather.com/">开发平台</a><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308232438.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308232438.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>点开右上角的<code>控制台</code>登录进入<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308232654.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308232654.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>然后打开应用管理中的创建新应用，创建一个 <code>Web API</code>类幸应用</p><p>创建成功后，会得到这样的一个应用，重要的是这个KEY，后面再开发的时候会用到！<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308233225.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308233225.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="3、插件设置"><a href="#3、插件设置" class="headerlink" title="3、插件设置"></a>3、插件设置</h2><div class="story post-story"><p>除了上面的 API 的方式之外，可能更多使用的是插件，因为插件不用自己写样式，可以直接进行调用，而 API 仅仅是一堆数据，需要我们手写样式才能将其显示出来。<br>所以说如果不是特别强调要匹配网站原始风格的，直接使用插件，会更加方便。</p><h3 id="3-1、配置插件设置"><a href="#3-1、配置插件设置" class="headerlink" title="3.1、配置插件设置"></a>3.1、配置插件设置</h3><p>首先我们打开和风天气的插件管理界面,点击左侧的开发文档<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091452.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091452.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>然后选择插件开发文档，会显示以下的内容，根据自己的需要进行创建。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091611.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091611.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>这里以网页标准插件作为例子</p><p>此处在配置完成插件的内容之后，点击生成代码，即可完成制作<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091801.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091801.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>注意：此处的代码是不能直接在 vue 中进行使用的，所以我们需要对其进行一些处理</strong><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091924.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309091924.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>首先我们复制第二个 script 中的连接，在浏览器中打开<br>记录下这些内容，这个就是这个连接所对应的源码<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309092119.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309092119.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="3-2、vue代码编写"><a href="#3-2、vue代码编写" class="headerlink" title="3.2、vue代码编写"></a>3.2、vue代码编写</h3><p>首先我们需要创建一个 div 作为容器，并将其id设置为<code>he-plugin-standard</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;he-plugin-standard&quot; &gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><h3 id="3-3、js部分代码"><a href="#3-3、js部分代码" class="headerlink" title="3.3、js部分代码"></a>3.3、js部分代码</h3><p>接下来就是将刚刚我们在官网所配置的代码放到我们的 js 代码部分了</p><p>我们需要在页面创建的时候就创建天气插件，所以我们将代码放到一个<code>created</code>代码块中。<br>注意此处在<code>WIDGET</code>的前面要加上<code>window</code>才可以。<br>其他的就是直接法制黏贴即可</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.WIDGET = &#123;</span><br><span class="line">      <span class="string">&quot;CONFIG&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;layout&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;width&quot;</span>: <span class="string">&quot;500&quot;</span>,</span><br><span class="line">        <span class="string">&quot;height&quot;</span>: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">        <span class="string">&quot;background&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;dataColor&quot;</span>: <span class="string">&quot;FFFFFF&quot;</span>,</span><br><span class="line">        <span class="string">&quot;borderRadius&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: <span class="string">&quot;94096c96a79b4e3d9bf421612639f9e9&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> c = d.createElement(<span class="string">&#x27;link&#x27;</span>)</span><br><span class="line">      c.rel = <span class="string">&#x27;stylesheet&#x27;</span></span><br><span class="line">      c.href = <span class="string">&#x27;https://widget.heweather.net/standard/static/css/he-standard.css?v=1.4.0&#x27;</span></span><br><span class="line">      <span class="keyword">var</span> s = d.createElement(<span class="string">&#x27;script&#x27;</span>)</span><br><span class="line">      s.src = <span class="string">&#x27;https://widget.heweather.net/standard/static/js/he-standard.js?v=1.4.0&#x27;</span></span><br><span class="line">      <span class="keyword">var</span> sn = d.getElementsByTagName(<span class="string">&#x27;script&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">      sn.parentNode.insertBefore(c, sn)</span><br><span class="line">      sn.parentNode.insertBefore(s, sn)</span><br><span class="line">    &#125;)(<span class="built_in">document</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在官方这些代码的基础上，我们可以进行一些修改，达到自己想要的一些效果。<br>以下就是最终的结果<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309093544.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220309093544.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="博客" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="个人网站" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="记录" scheme="http://cyc0819.top/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>给个人网站加上高德地图插件</title>
    <link href="http://cyc0819.top/2022/03/08/2022-03-08-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E6%8F%92%E4%BB%B6/"/>
    <id>http://cyc0819.top/2022/03/08/2022-03-08-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E9%AB%98%E5%BE%B7%E5%9C%B0%E5%9B%BE%E6%8F%92%E4%BB%B6/</id>
    <published>2022-03-08T14:06:53.000Z</published>
    <updated>2022-06-12T16:26:41.973Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="给个人网站加上高德地图插件"><a href="#给个人网站加上高德地图插件" class="headerlink" title="给个人网站加上高德地图插件"></a>给个人网站加上高德地图插件</h1><h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><div class="story post-story"><p>在修改个人网站的关于界面的时候，突然想起之前有看过高德地图的插件，而关于界面刚好可以将个人地址设置为地图图层的形式，所以找到了<a href="https://lbs.amap.com/">高德地图</a>的插件，进行设置。</p></div><h2 id="2、API设置"><a href="#2、API设置" class="headerlink" title="2、API设置"></a>2、API设置</h2><div class="story post-story"><p>首先我们要进入<a href="https://lbs.amap.com/">高德开放平台</a>的地址<br>然后会显示以下的选项<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308222155.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308222155.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>选择左上角的<code>地图 JS API</code><br>即出现以下内容：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308223043.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308223043.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>这是官方文档所写的方式，大家可以根据官方的文档进行操作，基本都能很简单实现。</p><h3 id="2-1、安装Loader"><a href="#2-1、安装Loader" class="headerlink" title="2.1、安装Loader"></a>2.1、安装Loader</h3><p>官方的方式，首先我们要下载Loader<br><code>npm i @amap/amap-jsapi-loader --save</code></p><h3 id="2-2、编辑vue文件"><a href="#2-2、编辑vue文件" class="headerlink" title="2.2、编辑vue文件"></a>2.2、编辑vue文件</h3><p>首先我们可以创建一个vue文件，单独放置我们的地图插件。<br>然后创建一个<code>div</code>组件，并设置地图容器的 id 属性为 container。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后可以设置地图的css格式：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;style  scoped&gt;</span><br><span class="line">    <span class="selector-id">#container</span>&#123;</span><br><span class="line">        <span class="attribute">padding</span>:<span class="number">0px</span>;</span><br><span class="line">        <span class="attribute">margin</span>: <span class="number">0px</span>;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">800px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>最后我们在这个vue组件中引入 amap-jsapi-loader </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> AMapLoader <span class="keyword">from</span> <span class="string">&#x27;@amap/amap-jsapi-loader&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-3、初始化map对象"><a href="#2-3、初始化map对象" class="headerlink" title="2.3、初始化map对象"></a>2.3、初始化map对象</h3><p>本次我所使用的是 vue3，和 vue2 还是有语法上的一些差异的，这里我们先介绍 vue3 的用法。<br>首先需要引入 Vue3 的 shallowRef 方法（使用 shallowRef 进行非深度监听，因为在 Vue3 所使用的 Proxy 拦截操作会改变 JSAPI 原生对象，所以此处需要区别 Vue2 使用方式对地图对象行非深度监听，否则会出现问题，建议 JS API 相关对象采用非响应式的普通对象来存储）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowRef &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/reactivity&#x27;</span></span><br></pre></td></tr></table></figure><p>然后我们在 setup 中声明 map 对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> map = shallowRef(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">       map,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p><strong>vue2中初始化map对象</strong><br>仅需要以下这一句</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span>&#123;</span><br><span class="line">        <span class="attr">map</span>:<span class="literal">null</span>,</span><br><span class="line">     &#125; </span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure><h3 id="2-4、初始化函数-initMap"><a href="#2-4、初始化函数-initMap" class="headerlink" title="2.4、初始化函数 initMap"></a>2.4、初始化函数 initMap</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">methods:&#123;</span><br><span class="line">    <span class="function"><span class="title">initMap</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        AMapLoader.load(&#123;</span><br><span class="line">            <span class="attr">key</span>:<span class="string">&quot;&quot;</span>,             <span class="comment">// 申请好的Web端开发者Key，首次调用 load 时必填</span></span><br><span class="line">            <span class="attr">version</span>:<span class="string">&quot;2.0&quot;</span>,      <span class="comment">// 指定要加载的 JSAPI 的版本，缺省时默认为 1.4.15</span></span><br><span class="line">            <span class="attr">plugins</span>:[<span class="string">&#x27;&#x27;</span>],       <span class="comment">// 需要使用的的插件列表，如比例尺&#x27;AMap.Scale&#x27;等</span></span><br><span class="line">        &#125;).then(<span class="function">(<span class="params">AMap</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.map = <span class="keyword">new</span> AMap.Map(<span class="string">&quot;container&quot;</span>,&#123;  <span class="comment">//设置地图容器id</span></span><br><span class="line">                <span class="attr">viewMode</span>:<span class="string">&quot;3D&quot;</span>,    <span class="comment">//是否为3D地图模式</span></span><br><span class="line">                <span class="attr">zoom</span>:<span class="number">5</span>,           <span class="comment">//初始化地图级别</span></span><br><span class="line">                <span class="attr">center</span>:[<span class="number">105.602725</span>,<span class="number">37.076636</span>], <span class="comment">//初始化地图中心点位置</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(e);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>最后就是调用初始化函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//DOM初始化完成进行地图初始化</span></span><br><span class="line">    <span class="built_in">this</span>.initMap();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="3、我所使用的代码"><a href="#3、我所使用的代码" class="headerlink" title="3、我所使用的代码"></a>3、我所使用的代码</h2><div class="story post-story"><p>我所使用的与官方的不太相同，没有官方这么复杂</p><p>首先我还是定义一个 div 容器用来存放地图组件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;ismoblie==true?&#x27;map1&#x27;:&#x27;map2&#x27;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后在我们的页面加载完毕之后，立即异步加载我们的地图，这就要用到 vue3 的生命周期函数中的<code>onMounted</code>。</p><p>根据官方的方式进行改进，就有我以下代码的方式来实现，具体用途都写上了注释。<br>这样子与官方的同样，可以生成一个地图组件</p><p><strong>完整的代码如下</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">onMounted(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="comment">//页面加载完,开始异步引入高德地图</span></span><br><span class="line">      <span class="comment">//创建了一个回调函数,高德地图加载完毕会调用</span></span><br><span class="line">      <span class="built_in">window</span>.onLoad = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 所有关于地图的逻辑全部都要写在这个回调里面</span></span><br><span class="line">        <span class="comment">// 保证高德地图加载完毕</span></span><br><span class="line">        <span class="comment">// var map = new AMap.Map(&quot;container&quot;);</span></span><br><span class="line">        <span class="comment">// 地图中心点</span></span><br><span class="line">        <span class="keyword">var</span> map = <span class="keyword">new</span> AMap.Map(<span class="string">&quot;container&quot;</span>, &#123;</span><br><span class="line">          <span class="attr">zoom</span>: <span class="number">16</span>, <span class="comment">//级别</span></span><br><span class="line">          <span class="attr">center</span>: [<span class="number">110.417813</span>,<span class="number">25.31373</span>], <span class="comment">//中心点坐标</span></span><br><span class="line">          <span class="attr">viewMode</span>: <span class="string">&quot;3D&quot;</span>, <span class="comment">//使用3D视图</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// key是申请的值</span></span><br><span class="line">      <span class="keyword">var</span> url =</span><br><span class="line">          <span class="string">&quot;https://webapi.amap.com/maps?v=1.4.15&amp;key=d6c8f397b0da87524290b6622de498f5&amp;callback=onLoad&quot;</span>;</span><br><span class="line">      <span class="comment">//创建一个 script dom元素</span></span><br><span class="line">      <span class="comment">// doc需要补全document</span></span><br><span class="line">      <span class="keyword">var</span> jsapi = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">      <span class="comment">//设定script标签属性</span></span><br><span class="line">      jsapi.charset = <span class="string">&quot;utf-8&quot;</span>;</span><br><span class="line">      jsapi.src = url;</span><br><span class="line">      <span class="comment">//将API文件引入页面中,加载完毕以后会调用函数</span></span><br><span class="line">      <span class="built_in">document</span>.head.appendChild(jsapi);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p><strong>最后效果</strong><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308231640.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308231640.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="4、其他功能"><a href="#4、其他功能" class="headerlink" title="4、其他功能"></a>4、其他功能</h2><div class="story post-story"><p>我们本次所使用到的仅仅是很少的一部分功能，除此之外，高德地图的API还有很多的功能，官方也有很多的实例供我们所参考：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308230605.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220308230605.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们可以根据官方的文档去制作我们所需要的各种插件。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="博客" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="个人网站" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="记录" scheme="http://cyc0819.top/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>给个人网站加上邮箱通知</title>
    <link href="http://cyc0819.top/2022/03/06/2022-03-06-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E9%82%AE%E7%AE%B1%E9%80%9A%E7%9F%A5/"/>
    <id>http://cyc0819.top/2022/03/06/2022-03-06-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E9%82%AE%E7%AE%B1%E9%80%9A%E7%9F%A5/</id>
    <published>2022-03-06T10:53:20.000Z</published>
    <updated>2022-06-12T16:26:18.695Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="给个人网站加上邮箱通知"><a href="#给个人网站加上邮箱通知" class="headerlink" title="给个人网站加上邮箱通知"></a>给个人网站加上邮箱通知</h1><h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><div class="story post-story"><p>一般在网站上实现邮箱通知有多种方式，原先我所使用的是<code>mailto:chenyc2021@qq.com</code>的方式，这种方式可以直接调用设备上的邮箱发送邮件，但是这样子就容易被发件人不小心修改邮箱信息，而且如果发件人的设备上没有邮箱设备，可能就无法使用这个功能了，所以本次我更新了网站中的邮件发送功能，优化用户体验。</p><p>原先的发送邮件方式：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190513.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190513.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>现如今改成使用 <a href="https://commons.apache.org/proper/commons-email/">commons-email</a> 来发送邮箱，配合前端的表单，实现邮件发送。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190750.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190750.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、前端部分"><a href="#2、前端部分" class="headerlink" title="2、前端部分"></a>2、前端部分</h2><div class="story post-story"><p>首先编写前端表单界面，我这里所使用的是点击按钮弹出弹框的形式进行填写，然后使用 axios 将数据传送到后端。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;Formail&quot; v-if=&quot;isAd==0&quot;&gt;</span><br><span class="line">    &lt;!--&lt;a href=&quot;mailto:chenyc2021@qq.com?subject=广告招标&amp;body=广告商家：初步报价：其他联系方式：&quot;&gt;联系管理员&lt;/a&gt;--&gt;</span><br><span class="line">    &lt;el-button type=&quot;success&quot; @click=&quot;dialogVisible = true&quot;&gt;联系管理员&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">        v-model=&quot;dialogVisible&quot;</span><br><span class="line">        title=&quot;您的广告内容&quot;</span><br><span class="line">        width=&quot;30%&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;广告标题：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.title&quot; placeholder=&quot;广告标题&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;广告内容：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.text&quot; autosize type=&quot;textarea&quot; placeholder=&quot;广告内容&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;广告报价：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.money&quot; placeholder=&quot;广告报价&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;显示日期：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.times&quot; placeholder=&quot;显示日期&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;联系方式：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.phone&quot; placeholder=&quot;联系方式&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;您的邮箱：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.email&quot; placeholder=&quot;您的邮箱&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;template #footer&gt;</span><br><span class="line">      &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;buyEmail&quot;&gt;发送&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>所显示的效果如下图所示：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306202634.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306202634.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>随后是 axios 部分，将表单的数据传送给后端。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buyEmail = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      proxy.$axios.get(<span class="string">&#x27;ad/buy&#x27;</span>,&#123;<span class="attr">params</span>:&#123;<span class="string">&quot;title&quot;</span>:data.input.title,</span><br><span class="line">          <span class="string">&quot;text&quot;</span>:data.input.text,</span><br><span class="line">          <span class="string">&quot;money&quot;</span>:data.input.money,</span><br><span class="line">          <span class="string">&quot;time&quot;</span>:data.input.times,</span><br><span class="line">          <span class="string">&quot;phone&quot;</span>:data.input.phone,</span><br><span class="line">          <span class="string">&quot;buyemail&quot;</span>:data.input.email&#125;</span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        ElMessage(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;邮件发送成功，请等待工作人员回复.&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      data.dialogVisible = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>发送邮件之后，会反馈信息，提高用户体验。</p></div><h2 id="3、后端"><a href="#3、后端" class="headerlink" title="3、后端"></a>3、后端</h2><div class="story post-story"><p>现在就是重要的后端部分了。</p><h3 id="3-1、引入依赖"><a href="#3-1、引入依赖" class="headerlink" title="3.1、引入依赖"></a>3.1、引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-email<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2、控制器类"><a href="#3-2、控制器类" class="headerlink" title="3.2、控制器类"></a>3.2、控制器类</h3><p>编写一个控制器类，接收前端传来的数据，并在此处做邮件的发送工作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/buy&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">buyAd</span><span class="params">(String title,String text,String money,String time,String phone,String buyemail)</span> <span class="keyword">throws</span> EmailException, MalformedURLException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建邮件</span></span><br><span class="line">    HtmlEmail email = <span class="keyword">new</span> HtmlEmail();</span><br><span class="line">    <span class="comment">// 邮箱主机，可以是域名也可以是IP地址</span></span><br><span class="line">    email.setHostName(<span class="string">&quot;smtp.qq.com&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置使用安全链接</span></span><br><span class="line">    email.setSSLOnConnect(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// QQ邮箱默认的端口是465</span></span><br><span class="line">    email.setSslSmtpPort(<span class="string">&quot;465&quot;</span>);</span><br><span class="line">    <span class="comment">// 有中文的话需要设置编码，不然会乱码</span></span><br><span class="line">    email.setCharset(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置你的邮箱名与生成的授权码</span></span><br><span class="line">    email.setAuthentication(<span class="string">&quot;chenyc2021@qq.com&quot;</span>, <span class="string">&quot;cqyruivpditnebhc&quot;</span>);</span><br><span class="line">    <span class="comment">// 发件人信息，收件人收到邮件时看到的收件人姓名</span></span><br><span class="line">    email.setFrom(buyemail, title);</span><br><span class="line">    <span class="comment">// 标题</span></span><br><span class="line">    email.setSubject(title);</span><br><span class="line">    <span class="comment">// 内容</span></span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    sb.append(<span class="string">&quot;广告内容：&quot;</span>).append(text).append(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    .append(<span class="string">&quot;广告报价：&quot;</span>).append(money).append(<span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">    .append(<span class="string">&quot;联系方式：&quot;</span>).append(phone).append(<span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">    .append(<span class="string">&quot;上架时间&quot;</span>).append(time);</span><br><span class="line">    email.setHtmlMsg(sb.toString());</span><br><span class="line"></span><br><span class="line">    email.addTo(<span class="string">&quot;chenyc2021@qq.com&quot;</span>);</span><br><span class="line">    <span class="comment">//发送邮件</span></span><br><span class="line">    email.send();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码就是发送邮件所需要的最基础的代码了。除此之外还有很多方法可供我们使用，如果只是实现简单地发送，只要上面地简短代码即可。</p><p>这里有一个邮箱的授权码，我以QQ邮箱为例子。</p><ol><li>首先打开设置中的账户<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203509.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203509.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>然后打开 POP3/SMTP服务，然后会有一个生成授权码的按钮，点击认证即可生成，然后及时复制到本地。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203652.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203652.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="博客" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="个人网站" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="记录" scheme="http://cyc0819.top/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Java反射机制</title>
    <link href="http://cyc0819.top/2022/03/04/2022-03-04-Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"/>
    <id>http://cyc0819.top/2022/03/04/2022-03-04-Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/</id>
    <published>2022-03-04T12:19:20.000Z</published>
    <updated>2022-06-12T16:25:57.036Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Java反射机制"><a href="#Java反射机制" class="headerlink" title="Java反射机制"></a>Java反射机制</h1><h2 id="1、反射是什么"><a href="#1、反射是什么" class="headerlink" title="1、反射是什么?"></a>1、反射是什么?</h2><div class="story post-story"><p>Java反射机制（Java Reflection）是Java语言中一种动态（运行时）访问、检测以及修改它本身的能力。主要作用是动态获取类完整的结构信息和调用对象的方法。</p><p><strong>正射和反射的区别：</strong><br>一般情况下，我们使用某个类，都会知道这个类，以及要用它来做什么，可以直接通过 new 实例化创建对象，然后使用这个对象对类进行操作，这个就属于正射。<br>而反射则是不知道要初始化的是什么类，无法使用 new 来实例化创建对象，主要通过 JDK 提供的反射 API 来实现，在运行时才知道要操作的是什么类，并且可以获取到类的完整构造以及调用对应的方法，这就是反射。</p><p><strong>举例：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//一、正射调用过程</span></span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setId(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;正射调用过程Student id:&quot;</span> + student.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//二、反射调用过程</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">&quot;com.justin.java.lang.Student&quot;</span>);</span><br><span class="line">        Constructor studentConstructor = clazz.getConstructor();</span><br><span class="line">        Object studentObj = studentConstructor.newInstance();</span><br><span class="line">        </span><br><span class="line">        Method setIdMethod = clazz.getMethod(<span class="string">&quot;setId&quot;</span>, <span class="keyword">int</span>.class);</span><br><span class="line">        setIdMethod.invoke(studentObj, <span class="number">2</span>);</span><br><span class="line">        Method getIdMethod = clazz.getMethod(<span class="string">&quot;getId&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;正射调用过程Student id:&quot;</span> + getIdMethod.invoke(studentObj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220304122334.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220304122334.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、反射获取-Class-的三种方式"><a href="#2、反射获取-Class-的三种方式" class="headerlink" title="2、反射获取 Class 的三种方式"></a>2、反射获取 Class 的三种方式</h2><div class="story post-story"><p>在 Java 中，反射获取 Class 有三种方式，这三种方式各有各的优点。<br>以下是三种获取 Class 的方式：</p><ol><li>通过 <code>类名.class</code>来获取。</li><li>通过<code>Class.forName(&quot;类的全局路径&quot;)</code>来获取。</li><li>通过<code>new 类名().getClass()</code>来获取。</li></ol><p>使用第一种方式获取 Class，JVM 会使用 ClassLoader 类加载器将类加载到内存中，但并不会做任何类的初始化工作，返回 java.lang.Class 对象。<br>使用第二种方式获取 Class，类会被 JVM 加载到内存中，并且会进行类的静态初始化工作，返回 java.lang.Class 对象。<br>第三种获取 Class 的方式，它使用了 new 进行实例化操作，因此静态初始化和非静态初始化工作都会进行，getClass 方法属于顶级 Object 类中的方法，任何子类对象都可以调用，哪个子类调用，就返回那个子类的 java.lang.Class 对象。</p></div><h2 id="3、反射的优缺点"><a href="#3、反射的优缺点" class="headerlink" title="3、反射的优缺点"></a>3、反射的优缺点</h2><div class="story post-story"><p><strong>优点:</strong><br>在运行时获得类的各种内容，进行反编译，对于Java这种先编译再运行的语言，能够让我们很方便的创建灵活的代码，这些代码可以在运行时装配，无需在组件之间进行源代码的链接，更加容易实现面向对象。</p><p><strong>缺点:</strong><br>（1）反射会消耗一定的系统资源，因此，如果不需要动态地创建一个对象，那么就不需要用反射；<br>（2）反射调用方法时可以忽略权限检查，因此可能会破坏封装性而导致安全问题。</p></div><h2 id="4、方法的反射"><a href="#4、方法的反射" class="headerlink" title="4、方法的反射"></a>4、方法的反射</h2><div class="story post-story"><p><strong>步骤思路：</strong><br>1.获取该类的类类型<br>2.通过类类型获取类的方法（getMethods()）<br>3.循环遍历所获取到的方法<br>4.通过这些方法的getReturnType()得到返回值类型的类类型，又通过该类类型得到返回值类型的名字<br>5.getName()得到方法的名称，getParameterTypes()获取这个方法里面的参数类型的类类型。</p><p><strong>实例：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassMethodMessage</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        <span class="comment">//想要获取类的信息,首先我们要获取类的类类型</span></span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">        <span class="comment">//Object类是一切类的父类，所以我们传递的是哪个子类的对象，c就是该子类的类类型。</span></span><br><span class="line">        <span class="comment">//然后获取类的名称</span></span><br><span class="line">        System.out.println(<span class="string">&quot;类的名称是:&quot;</span>+c.getName());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *既然方法也是对象，那么是谁的对象呢？</span></span><br><span class="line"><span class="comment">        * 在java里面，方法是Method类的对象</span></span><br><span class="line"><span class="comment">        *一个成员方法就是一个Method的对象，那么Method就封装了对这个成员</span></span><br><span class="line"><span class="comment">        *方法的操作</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//如果我们要获得所有的方法，可以用getMethods()方法，这个方法获取的是所有的Public的函数，包括父类继承而来的。如果我们要获取所有该类自己声明的方法，就可以用getDeclaredMethods()方法，这个方法是不问访问权限的。</span></span><br><span class="line">        Method[] ms = c.getMethods();<span class="comment">//c.getDeclaredMethods()</span></span><br><span class="line">        <span class="comment">//接下来我们拿到这些方法之后干什么？我们就可以获取这些方法的信息，比如方法的名字。</span></span><br><span class="line">        <span class="comment">//首先我们要循环遍历这些方法</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ms.length;i++)&#123;</span><br><span class="line">            <span class="comment">//然后可以得到方法的返回值类型的类类型</span></span><br><span class="line">            Class returnType = ms[i].getReturnType();</span><br><span class="line">            <span class="comment">//得到方法的返回值类型的名字</span></span><br><span class="line">            System.out.print(returnType.getName()+<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="comment">//得到方法的名称</span></span><br><span class="line">            System.out.print(ms[i].getName()+<span class="string">&quot;(&quot;</span>);</span><br><span class="line">            <span class="comment">//获取参数类型---&gt;得到的是参数列表的类型的类类型</span></span><br><span class="line">            Class[] paramTypes = ms[i].getParameterTypes();</span><br><span class="line">            <span class="keyword">for</span> (Class class1 : paramTypes) &#123;</span><br><span class="line">            System.out.print(class1.getName()+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、成员变量的反射"><a href="#5、成员变量的反射" class="headerlink" title="5、成员变量的反射"></a>5、成员变量的反射</h2><div class="story post-story"><p>成员变量也是对象，是java.lang.reflect.Field类的对象，那么也就是说Field类封装了关于成员变量的操作。既然它封装了成员变量，我们又该如何获取这些成员变量呢？它有这么一个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFieldMessage</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">        Field[] fs = c.getFields();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的getFields()方法获取的所有的public的成员变量的信息。和方法的反射那里public的成员变量，也有一个获取所有自己声明的成员变量的信息：<code>Field[] fs = c.getDeclaredFields();</code><br>我们得到它之后，可以进行遍历（既然封装了Field的信息，那么我们就可以得到Field类型）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Field field : fs) &#123;</span><br><span class="line">    <span class="comment">//得到成员变量的类型的类类型</span></span><br><span class="line">    Class fieldType = field.getType();</span><br><span class="line">    String typeName = fieldType.getName();</span><br><span class="line">    <span class="comment">//得到成员变量的名称</span></span><br><span class="line">    String fieldName = field.getName();</span><br><span class="line">    System.out.println(typeName+<span class="string">&quot; &quot;</span>+fieldName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="6、Class类的动态加载类"><a href="#6、Class类的动态加载类" class="headerlink" title="6、Class类的动态加载类"></a>6、Class类的动态加载类</h2><div class="story post-story"><p>动态加载是啥意思？怎么样动态加载一个类呢？<br>首先我们需要明白的是，动态加载和静态加载的概念以及区别。<br>我们一般所理解的，在编译的时候所加载的类是静态加载类；而运行的时候加载的类是动态加载类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Class A&#123;</span><br><span class="line">    <span class="function">Public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;B&quot;</span>.equal(args[<span class="number">0</span>]))&#123;</span><br><span class="line">            B b=<span class="keyword">new</span> B();</span><br><span class="line">            b.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;C&quot;</span>.equal(args[<span class="number">0</span>]))&#123;</span><br><span class="line">            C c=<span class="keyword">new</span> C();</span><br><span class="line">            C.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这一段代码，如果我们仅仅是在 IDEA 之中运行，是可以正常运行不发生错误的，而如果我们在 CMD 控制台运行的话，就会抛出问题。如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">A.java：7：错误：找不到符号</span><br><span class="line">B b=new B();</span><br><span class="line">符号:  类B</span><br><span class="line">位置： 类A</span><br><span class="line">A.java：7：错误：找不到符号</span><br><span class="line">B b=new B();</span><br><span class="line">符号:  类B</span><br><span class="line">位置： 类A</span><br><span class="line">A.java：12：错误：找不到符号</span><br><span class="line">C c=new C();</span><br><span class="line">符号:  类C</span><br><span class="line">位置： 类A</span><br><span class="line">A.java：12：错误：找不到符号</span><br><span class="line">C c=new C();</span><br><span class="line">符号:  类C</span><br><span class="line">位置： 类A</span><br><span class="line">4个错误</span><br></pre></td></tr></table></figure><p>此时，因为B不存在，就应该是错误的。<br>但是，仔细想想，会发现B我们不一定使用，C我们也不一定使用。<br>现在我们来模拟一下B存在的情况。<br>也就是先编译B，然后再编译A。<br>但是此时还是有问题，C也是不存在的。<br>但是我们现在根本就不想用C，我们只想用B，那怎么办？<br>想要正常使用B，我们就不得不将C一起编译。而如果有ABCDEFGHIJKLMN个类，我们同样只想用B，那么我们是不是同样得全部编译他们呢？答案是肯定的。这样子肯定不是很好的。<br>以上这种说法就是所谓的静态加载类。<br>而解决这个问题的方法也很简单，就是改为动态加载类。即要使用的时候再创建。</p><p>我们新建一个类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class All&#123;</span><br><span class="line">    <span class="function">Public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">            Class cl= Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//通过类类型，创建该类的对象</span></span><br><span class="line">            cl.newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Class.forName(“类的全称”)，它不仅仅表示了类的类类型，还表示了动态加载类。当我们javac A.ava的时候，它不会报任何错误，也就是说在编译的时候是没有错误的。只有当我们具体用某个类的时候，那个类不存在，它才会报错。</p><p>如果我们要加载B，那么就需要：<code>B bt = (B) cl.newInstance();</code><br>加载C，就是：<code>C ct = (C) cl.newInstance();</code><br>DEFG等等都是这样。</p><p>但是如果有一百各类，我们不可能写一百句这个，太冗余了。<br>我们可以写一个统一处理的方法，统一一个标准，只要满足这个标准的都可以使用这个方法。<br><code>and s = (Stand) cl.newInstance();</code></p><p>例如B类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class B implements Stand&#123;</span><br><span class="line">    <span class="function">Public <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.print(<span class="string">&quot;B...satrt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即满足了前面的标准。就可以通过这个统一的标准来运行。</p><p>如果以后想用某一个类，不需要重新编译，只需要实现这个标准的接口即可。只需要动态的加载新的东西就行了。<br>这就是<strong>动态加载类</strong>。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="反射" scheme="http://cyc0819.top/categories/java/%E5%8F%8D%E5%B0%84/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>自定义注解</title>
    <link href="http://cyc0819.top/2022/02/09/2022-02-09-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/"/>
    <id>http://cyc0819.top/2022/02/09/2022-02-09-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/</id>
    <published>2022-02-09T13:38:33.000Z</published>
    <updated>2022-06-12T16:24:34.907Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h1><h2 id="1、注解"><a href="#1、注解" class="headerlink" title="1、注解"></a>1、注解</h2><div class="story post-story"><p>注解是 java 这一门编程语言中很重要的一个知识点，利用注解，我们可以很方便实现很多功能。<br>它可以用于创建文档，跟踪代码中的依赖性，甚至执行基本编译时检查。<br>注解不会影响代码的正常运行，他与我们的代码处于两个时空中，但是注解和我们的代码又在某些方面相互影响。<br>java 中，所有的注解都继承了 Annotation 接口。<br>java 中，已经预定义了很多注解，以方便我们的使用，我们可以在编程过程中直接对这些注解进行调用，实现我们所需要的功能。<br>以下列出了一些平时会用到的注解：</p><h3 id="1-1、基础注解"><a href="#1-1、基础注解" class="headerlink" title="1.1、基础注解"></a>1.1、基础注解</h3><p><code>@Override</code>:<br>表示该方法是重写的方法。<br><code>@Deprecated</code>:<br>表示该方法是过时的方法，我们在一些旧版本的 API 文档中警方会看到这个注解。</p><h3 id="1-2、元注解"><a href="#1-2、元注解" class="headerlink" title="1.2、元注解"></a>1.2、元注解</h3><p>在我们自定义注解的过程中，就会使用到这些元注解，它可以帮助我们构建自己的自定义注解，就是用在注解中的注解。</p><p><code>@Target</code>:<br>表示该注解可以被放在哪个位置。<br>它的参数类型如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ElementType.TYPE：能修饰类、接口或枚举类型</span><br><span class="line">ElementType.FIELD：能修饰成员变量</span><br><span class="line">ElementType.METHOD：能修饰方法</span><br><span class="line">ElementType.PARAMETER：能修饰参数</span><br><span class="line">ElementType.CONSTRUCTOR：能修饰构造器</span><br><span class="line">ElementType.LOCAL_VARIABLE：能修饰局部变量</span><br><span class="line">ElementType.ANNOTATION_TYPE：能修饰注解</span><br><span class="line">ElementType.PACKAGE：能修饰包</span><br></pre></td></tr></table></figure><p><code>@Retention</code>:<br>用于声明生命周期。<br>参数类型如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RetentionPolicy.SOURCE：源码阶段</span><br><span class="line">RetentionPolicy.CLASS： 编译阶段</span><br><span class="line">RetentionPolicy.RUNTIME：运行阶段</span><br></pre></td></tr></table></figure><p><code>@Inherited</code>:<br>表示注解可以被子类继承。即子类继承父类以后，也可以继承父类的注解。</p><p><code>@Documented</code>:<br>表示生成 API 。</p><p><code>@Repeatable</code>:<br>表示注解在同一个地方可以出现多次，如果不加这个注解的话，同一个地方注解只能出现一次。</p></div><h2 id="2、自定义注解"><a href="#2、自定义注解" class="headerlink" title="2、自定义注解"></a>2、自定义注解</h2><div class="story post-story"><p>对于自定义注解，说起来其实十分简单，用<code>@interface</code>修饰一个我们所创建的“类”，然后再加上我们需要的一些元注解，就可以实现一个自定义注解了。</p><p>对于创建的自定义注解，我们需要考虑以下几个问题：</p><ol><li>注解用在什么地方？</li><li>注解什么时候使用？</li><li>注解想要实现什么功能？</li></ol><p>在考虑好上面的这些问题之后，通过合理使用元注解，我们就能解决以上的一些问题。<br>可以说自定义注解和元注解之间的关系密不可分！就比如说盖楼时我们必须打地基一样。</p><p>自定义注解可以有很多种形式，以下是几个自定义注解的例子。</p><h3 id="2-1、自定义注解可以存放变量"><a href="#2-1、自定义注解可以存放变量" class="headerlink" title="2.1、自定义注解可以存放变量"></a>2.1、自定义注解可以存放变量</h3><p>首先我们创建一个以下的自定义注解：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209224224.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209224224.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>可以看出来，这个自定义注解中有三个变量，分别是<code>id</code>，<code>name</code>，<code>age</code>。<br>别处通过注解，可以很方便的使用它们。</p><p>当我们创建一个类，标上这个注解的时候，他会提示我们所需要的三个变量：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209225911.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209225911.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>此时我们输入所需元素：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230104.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230104.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果我们想拿到注解中我们设置好的结果，通过以下的方法即可拿到：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230840.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230840.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-2、自定义注解实现某个功能"><a href="#2-2、自定义注解实现某个功能" class="headerlink" title="2.2、自定义注解实现某个功能"></a>2.2、自定义注解实现某个功能</h3><p>上面的用法通常不太常见，我们更多所见到的，是通过注解来实现某个功能，所以下面就是一个这样的例子。</p><p>因为参数校验是位于业务逻辑执行执行，可以考虑将其拆分。<br>所以这个注解可以简单实现检验一个参数是否为空等检验功能。<br>由于并不是所有的方法，都需要校验(某些方法允许空参数)，所以考虑使用自定义注解，让开发者进行灵活控制。</p><p>首先创建以下的一个注解：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112425.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112425.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后是注解用于检验的类<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112726.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112726.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后在需要验证的字段上添加上这个注解<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112920.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112920.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>最后创建一个控制器类，来检验我们的代码<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113128.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113128.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当我们标注的 name 字段有值的时候，可以正常返回信息<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113421.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113421.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>而当值为空的时候，则会出现错误，后台会提示具体的错误信息<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113505.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113505.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210114008.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210114008.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以上就是一个验证字段是否为空的自定义注解的例子。</p></div><h2 id="3、附录"><a href="#3、附录" class="headerlink" title="3、附录"></a>3、附录</h2><div class="story post-story"><p><code>testInt1</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> test2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> demo1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/9 21:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> testInt1 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>l1</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> test2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> demo1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/9 22:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@testInt1(id = 1,name = &quot;chenyicai&quot;,age = 22)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">l1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        testInt1 testInt1=l1.class.getAnnotation(demo1.testInt1.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(testInt1.id());</span><br><span class="line">        System.out.println(testInt1.name());</span><br><span class="line">        System.out.println(testInt1.age());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        f1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isNotNull</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//仅仅用于请求字段的非空校验</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="comment">//需要jvm运行时使用</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//使用validator时必须添加，指定与NotNullValidator自定义校验器配合使用</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = isNotNullValidator.class)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">//@interface 代表此类是注解类</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> isNotNull &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认错误信息</span></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> &quot;不能为空&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isNotNullValidator</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">isNotNullValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">isNotNull</span>,<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Object o, ConstraintValidatorContext constraintValidatorContext)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//此时name是当前非空校验的字段名</span></span><br><span class="line">        String name = String.valueOf(((ConstraintValidatorContextImpl) constraintValidatorContext)</span><br><span class="line">                .getConstraintViolationCreationContexts().get(<span class="number">0</span>).getPath());</span><br><span class="line">        System.out.println(name + <span class="string">&quot; value is &quot;</span> + String.valueOf(o));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//o是字段的值，我们需要校验是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == o ||<span class="string">&quot;&quot;</span>==o)&#123;</span><br><span class="line">            <span class="comment">// 获取到注解中message的值</span></span><br><span class="line">            System.err.println(((ConstraintValidatorContextImpl) constraintValidatorContext)</span><br><span class="line">                    .getConstraintViolationCreationContexts().get(<span class="number">0</span>).getMessage());</span><br><span class="line">            <span class="comment">//返回false代表校验失败</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回true代表校验成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Users</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@isNotNull(message = &quot;姓名不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TestController</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">addUser</span><span class="params">(<span class="meta">@Valid</span> Users users)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;111&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="注解" scheme="http://cyc0819.top/categories/java/%E6%B3%A8%E8%A7%A3/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="注解" scheme="http://cyc0819.top/tags/%E6%B3%A8%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>位运算</title>
    <link href="http://cyc0819.top/2022/02/01/2022-02-01-%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    <id>http://cyc0819.top/2022/02/01/2022-02-01-%E4%BD%8D%E8%BF%90%E7%AE%97/</id>
    <published>2022-02-01T03:24:53.000Z</published>
    <updated>2022-02-01T06:55:00.818Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="1、位运算"><a href="#1、位运算" class="headerlink" title="1、位运算"></a>1、位运算</h1><p>程序中的所有数在计算机内存中都是以二进制的形式储存的。<br>位运算就是直接对整数在内存中的二进制位进行操作。<br>比如，and运算本来是一个逻辑运算符，但整数与整数之间也可以进行and运算。<br>举个例子，6的二进制是110，11的二进制是1011，那么6 and 11的结果就是2，它是二进制对应位进行逻辑运算的结果.<br>&amp;运算时，当且仅当两者都为 1 时，结果才为 1.<br>使用二进制来表示就是如下：<br>6  ：0 1 1 0<br>11：1 0 1 1<br>——————<br>2  ：0 0 1 0</p><p>相比于使用常规的运算符，在计算机语言中，合理使用位运算符能很好地帮助我们提高效率。</p><h2 id="2-1、位运算符"><a href="#2-1、位运算符" class="headerlink" title="2.1、位运算符"></a>2.1、位运算符</h2><div class="story post-story"><table><thead><tr><th>符号</th><th>描述</th><th>运算规则</th></tr></thead><tbody><tr><td>&amp;</td><td>与</td><td>两个位都为1时，结果才为1</td></tr><tr><td>|</td><td>或</td><td>两个位都为0时，结果才为0</td></tr><tr><td>^</td><td>异或</td><td>两个位相同为0，相异为1</td></tr><tr><td>~</td><td>非</td><td>0变1，1变0</td></tr><tr><td>&lt;&lt;</td><td>左移</td><td>各二进位全部左移若干位，高位丢弃，低位补0</td></tr><tr><td>&gt;&gt;</td><td>右移</td><td>各二进位全部右移若干位，对无符号数，高位补0，有符号数，各编译器处理方法不一样，有的补符号位（算术右移），有的补0（逻辑右移）</td></tr></tbody></table></div><h2 id="2-2、实例"><a href="#2-2、实例" class="headerlink" title="2.2、实例"></a>2.2、实例</h2><div class="story post-story"><h3 id="2-2-1、与"><a href="#2-2-1、与" class="headerlink" title="2.2.1、与"></a>2.2.1、与</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">11：1 0 1 1</span><br><span class="line">————————————</span><br><span class="line">2 ：0 0 1 0</span><br></pre></td></tr></table></figure><p>当且仅当两者都为 1 的时候，结果才为 1，所以在这里只有第三位两者都为 1 ，所以结果就是 0010。</p><h3 id="2-2-2、或"><a href="#2-2-2、或" class="headerlink" title="2.2.2、或"></a>2.2.2、或</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">11：1 0 1 1</span><br><span class="line">————————————</span><br><span class="line">15：1 1 1 1</span><br></pre></td></tr></table></figure><p>当且仅当两者都为 0 的时候，结果才为 0，所以在这里所有的结果都为 1  ，所以结果就是 1111。</p><h3 id="2-2-3、非"><a href="#2-2-3、非" class="headerlink" title="2.2.3、非"></a>2.2.3、非</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">————————————</span><br><span class="line">9 ：1 0 0 1</span><br></pre></td></tr></table></figure><p>非的规则是将 1 变成 0，0 变成 1，所以0110非操作之后就是1001，为9.</p><h3 id="2-2-4、异或"><a href="#2-2-4、异或" class="headerlink" title="2.2.4、异或"></a>2.2.4、异或</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">11：1 0 1 1</span><br><span class="line">————————————</span><br><span class="line">13：1 1 0 1</span><br></pre></td></tr></table></figure><p>异或的运算规则：0^0=0  0^1=1  1^0=1  1^1=0 相同为 0，相异为 1.</p><h3 id="2-2-5、左移和右移"><a href="#2-2-5、左移和右移" class="headerlink" title="2.2.5、左移和右移"></a>2.2.5、左移和右移</h3><p><strong>左移：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">————————————</span><br><span class="line">12：1 1 0 0</span><br></pre></td></tr></table></figure><p>左移就是将所有的 1 都左移一位，然后空位上补0，所以 6 左移一位的结果就是 12.相当于 6 乘 2 等于 12.<br><strong>右移：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">————————————</span><br><span class="line">3 ：0 0 1 1</span><br></pre></td></tr></table></figure><p>右移就是将所有的 1 都右移一位，然后空位上补0，所以 6 右移一位的结果就是 3.相当于 6 除 2 等于 3.</p><p>从上面可以看出，如果我们在平时需要用到乘法或者除法，就可以使用左移和右移来进行替代，可以更好地提高效率。</p></div><h2 id="2-3、使用技巧"><a href="#2-3、使用技巧" class="headerlink" title="2.3、使用技巧"></a>2.3、使用技巧</h2><div class="story post-story"><h3 id="2-3-1、实现乘除法"><a href="#2-3-1、实现乘除法" class="headerlink" title="2.3.1、实现乘除法"></a>2.3.1、实现乘除法</h3><p>数 a 向右移一位，相当于将 a 除以 2；数 a 向左移一位，相当于将 a 乘以 2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int a = 2;</span><br><span class="line">a &gt;&gt; 1; ---&gt; 1</span><br><span class="line">a &lt;&lt; 1; ---&gt; 4</span><br></pre></td></tr></table></figure><h3 id="2-3-2、交换两个数"><a href="#2-3-2、交换两个数" class="headerlink" title="2.3.2、交换两个数"></a>2.3.2、交换两个数</h3><p>使用位运算交换两个数的时候，可以不使用第三个变量，虽然这个操作普通的运算也能做到，但是效率远不如位运算。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">  a = a + b;</span><br><span class="line">  b = a - b;</span><br><span class="line">  a = a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//位与操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">  a ^= b;</span><br><span class="line">  b ^= a;</span><br><span class="line">  a ^= b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-3、判断奇偶数"><a href="#2-3-3、判断奇偶数" class="headerlink" title="2.3.3、判断奇偶数"></a>2.3.3、判断奇偶数</h3><p>只要根据数的最后一位是 0 还是 1 来决定即可，为 0 就是偶数，为 1 就是奇数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == (a &amp; <span class="number">1</span>)) &#123;</span><br><span class="line"> <span class="comment">//偶数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-4、交换符号"><a href="#2-3-4、交换符号" class="headerlink" title="2.3.4、交换符号"></a>2.3.4、交换符号</h3><p>交换符号将正数变成负数，负数变成正数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">reversal</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-5、求绝对值"><a href="#2-3-5、求绝对值" class="headerlink" title="2.3.5、求绝对值"></a>2.3.5、求绝对值</h3><p>整数的绝对值是其本身，负数的绝对值正好可以对其进行取反加一求得，即我们首先判断其符号位（整数右移 31 位得到 0，负数右移 31 位得到 -1,即 0xffffffff），然后根据符号进行相应的操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = a &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">return</span> i == <span class="number">0</span> ? a : (~a + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的操作可以进行优化，可以将 i == 0 的条件判断语句去掉。我们都知道符号位 i 只有两种情况，即 i = 0 为正，i = -1 为负。对于任何数与 0 异或都会保持不变，与 -1 即 0xffffffff 进行异或就相当于对此数进行取反,因此可以将上面三目元算符转换为((a^i)-i)，即整数时 a 与 0 异或得到本身，再减去 0，负数时与 0xffffffff 异或将 a 进行取反，然后在加上 1，即减去 i(i =-1)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs2</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = a &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">return</span> ((a^i) - i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除此之外，还有很多用途。</p></div><h2 id="2-4、写法"><a href="#2-4、写法" class="headerlink" title="2.4、写法"></a>2.4、写法</h2><div class="story post-story"><p>和普通的运算符一样，位运算符也可以组成复合运算符的形式。<br>如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp;=        例：a&amp;=b    相当于     a=a&amp;b</span><br><span class="line">|=        例：a|=b    相当于     a=a|b</span><br><span class="line">&gt;&gt;=      例：a&gt;&gt;=b   相当于     a=a&gt;&gt;b</span><br><span class="line">&lt;&lt;=      例：a&lt;&lt;=b     相当于      a=a&lt;&lt;b</span><br><span class="line">^=        例：a^=b    相当于   a= a^b</span><br></pre></td></tr></table></figure></div><h2 id="2-5、算法题应用"><a href="#2-5、算法题应用" class="headerlink" title="2.5、算法题应用"></a>2.5、算法题应用</h2><div class="story post-story"><h3 id="2-5-1、只出现一次的数字"><a href="#2-5-1、只出现一次的数字" class="headerlink" title="2.5.1、只出现一次的数字"></a>2.5.1、只出现一次的数字</h3><p><strong>问题描述</strong><br>给定一个非空整数数组，除了某个元素只出现一次以外，<strong>其余每个元素均出现两次</strong>。找出那个只出现了一次的元素。<br>说明：你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p><p><strong>分析</strong></p><ol><li>0和任意数字进行异或操作结果为数字本身.</li><li>两个相同的数字进行异或的结果为0.</li></ol><p><strong>解答</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> value=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            value^=nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-2、只出现一次的数字"><a href="#2-5-2、只出现一次的数字" class="headerlink" title="2.5.2、只出现一次的数字"></a>2.5.2、只出现一次的数字</h3><p><strong>问题描述</strong><br>给定一个非空整数数组，除了某个元素只出现一次以外，<strong>其余每个元素均出现了三次</strong>。找出那个只出现了一次的元素。<br>说明：你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p><p><strong>分析</strong><br>这题和上一题的思路略有不同，这题其他数字出现了3次，那么我们如果直接使用位运算异或操作的话无法直接找到结果，就需要巧妙的运用二进制的其他特性：判断整除求余操作。即判断所有数字二进制1的总个数和0的总个数一定有一个不是三的整数倍，如果0不是三的整数倍那么就说明结果的该位二进制数字为0，同理否则为1.<br>在具体的操作实现上，问题中给出数组中的数据在int范围之内，那么我们就可以在实现上可以对int的32个位每个位进行依次判断该位1的个数求余3后是否为1，如果为1说明结果该位二进制为1可以将结果加上去。最终得到的值即为答案。<br><strong>解答</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> value=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> num:nums)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(((num&gt;&gt;i)&amp;<span class="number">1</span>)==<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum%<span class="number">3</span>==<span class="number">1</span>)</span><br><span class="line">                value+=(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>2021年终总结</title>
    <link href="http://cyc0819.top/2022/01/10/2022-01-10-2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>http://cyc0819.top/2022/01/10/2022-01-10-2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2022-01-10T13:54:53.000Z</published>
    <updated>2022-01-10T15:25:03.363Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="1、2021"><a href="#1、2021" class="headerlink" title="1、2021"></a>1、2021</h1><p>2021是崭新的一年，是疫情的第二年，也是大学生涯的第三年。</p><h2 id="1-1、编程学习"><a href="#1-1、编程学习" class="headerlink" title="1.1、编程学习"></a>1.1、编程学习</h2><div class="story post-story"><p>今年一年，是冲刺学习 java 的一年，大部分的知识都是在今年学习到的。<br>在今年，当了四个项目的组长，虽然都是简单的单体项目，但是在学习中一步一步成长的感觉还是十分舒服的。四个项目分别是：点餐系统、桂电宿舍管理系统、国医堂小程序以及骏泰理发店管理系统。<br>2月，尽管是过年时间，线上学习还是不能停。<br>6月，其他同学都放假回家了，我们留在学校加班学习，第一次不回家过暑假，看着家里的朋友在家喝茶玩耍，真是恨不得当场买票回去。但是想到以后工作之后，这将成为常态，感觉自己还是得适应，同时也感叹自己即将步入社会，也会开始怀念大学生活了。<br>暑假的加班学习是为了今后更好的就业，所以我也一直在加油。<br>8月，开发了自己的第一个博客，用的是 hexo 的框架，主要是图方便，还好看，主题多。然后博客是用 GitHubPage 搭建的，所有内容都存在GitHub上。想着这个博客里分享一些自己学到的技术，还有写一些自己的感想什么的。<br>9月，开始面试了。在面试过程中，第一家公司，也就是现在签三方的公司，面试过程都比较轻松，感觉面试官也比较看重我。后面在面试一家工资较高的公司的时候，虽然笔试成绩还算不错，但是因为学的不够深入，很多问题没有回答上来，所以就被刷下来了。<br>总结一下今年的秋招面试：有遗憾，但是也很满足了。<br>11月，想着自己有一个闲置的服务器，就想着用来做点什么，就自己开发了一个书签项目，放在服务器里面，里面存了一些自己用过的书签网站，还可以快速跳转到我的博客，还可以快速搜索，自己还异想天开弄了一个广告框，想着有人能打广告，赚点零花钱。以后还会自己开发这个项目，增加更多功能。<br>12月和好兄弟一起开发了一个真实的项目：桂林医学院报修系统！这个项目虽然是学长留下的二手项目，但是在接手项目时，从阅读源码到本地运行，从本地开发到正式上线，我真实感觉到了自己从项目中学习到了很多新的思想。一开始接手项目时，基本上是从0开始阅读源码，到现在已经可以灵活使用以及修改项目中的每一处代码，从中看到了自己的进步，同时也看到了自己和其他人的差距所在。<br>印象比较深刻的是第一次上线自己写的程序的时候，刚刚一开始上线，系统就进不去了，折腾了一个晚上还是没有解决，最后还是靠学长帮忙才得以解决（虽然后面发现其实并不是我们的锅）。<br>知道前几天，一起开发的兄弟才发现，原来是服务器jar的加密问题，具体的我也不太懂。<br>其间还跟着老师去见了一次甲方，对项目的二期需求进行一个沟通，第一次真实经历这种场面，一开始还真有点紧张，但是到后面也逐渐放松了下来这样的经验是很珍贵的，对以后的职场应对有很大的帮助。在沟通过程中甲方有些不经过脑子的需求确实很难以理解，但是在积极的沟通之下还是进行的很顺利。<br>现在项目一期也已经验收通过了，老师也说二期不用太过着急，但是还是要提上日程，尽快完成需要的项目。<br>而另一个理发店项目基本处于放羊状态，也不着急，我们就慢慢做了。</p><p>目前也在学习算法，只要算法玩的好，大厂什么的根本不是梦。</p></div><h2 id="1-2、专业学习"><a href="#1-2、专业学习" class="headerlink" title="1.2、专业学习"></a>1.2、专业学习</h2><div class="story post-story"><p>今年是毕业年级了，要考虑的不只是学习，还有自己未来的发展方向。<br>3月，现在是大三的下学期，这个学期会接触到更多的编程方面的课程，比如说：Java语言程序设计、算法分析与设计、软件工程、ACM程序设计等等。这样的课程对我来说是比较感兴趣的，相对于数学，我觉得我更适合编程，果然自己是一个科研废物。<br>7月，成绩全都出了，今年终于迎来自己第一个大满贯，没有挂科科目，继续加油，争取更好成绩！今年暑假留校，加班学习。<br>9月，正式成为一个大四狗。今年除了面对学习的压力，更多的是来自就业方面的，由于疫情的影响，大学生就业形式不容乐观，提升自己专业能力，才是使自己更有优势的唯一途径。<br>12月，又是一个大满贯，终于把所有的课程都修完了，困扰了我多年的英语也终于都通过了。接下来就是毕业论文了，我做的内容是纯理论研究，对于我这样一个科研废物来说，这样的内容无疑是要我老命，但是没办法，终究自己还是数学专业的人，只能硬着头皮做了。<br>奖项方面，今年跟同学一起拿了几个小奖项，数学建模竞赛校内三等奖、市场调查大赛校内三等奖、金融证券大赛南部赛区团队一等奖。<br>感觉专业学习方面的年终总结确实写不出啥东西，毕竟科研方面自己还是不如其他同学。。。</p><h1 id="2、年度总结"><a href="#2、年度总结" class="headerlink" title="2、年度总结"></a>2、年度总结</h1><p>年度编程语言：java<br>年度框架：Spring Boot<br>年度IDE：IntelliJ IDEA<br>年度技术社区：CSDN<br>年度学科：数学<br>年度歌手：五月天<br>年度演员：沈腾<br>年度电影：《飞驰人生》<br>年度游戏：城市天际线<br>年度社交软件：微信<br>年度音乐软件：QQ音乐<br>年度视频平台：bilibili<br>年度UP主：徐大虾<br>年度综艺：下一个是谁<br>年度动漫：某科学的超电磁炮<br>年度运动：篮球<br>年度球队：洛杉矶湖人<br>年度球星：凯尔 库兹马</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="随笔" scheme="http://cyc0819.top/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="年终总结" scheme="http://cyc0819.top/categories/%E9%9A%8F%E7%AC%94/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="随笔" scheme="http://cyc0819.top/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot发送微信模板消息</title>
    <link href="http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/"/>
    <id>http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/</id>
    <published>2021-12-10T04:54:26.000Z</published>
    <updated>2022-06-12T16:23:29.870Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringBoot发送微信模板消息"><a href="#SpringBoot发送微信模板消息" class="headerlink" title="SpringBoot发送微信模板消息"></a>SpringBoot发送微信模板消息</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>MySQL 8.0</li></ul></div><h2 id="2、工作"><a href="#2、工作" class="headerlink" title="2、工作"></a>2、工作</h2><div class="story post-story"><p>这段时间在做项目的时候，甲方要求将之前的易班消息推送更换成微信公众号模板消息推送，所以本文就是记录一下使用模板消息的过程，</p><p>开发的时候我用的是微信的<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">测试公众账号</a>，但是实际的功能和企业的账号是一样的。</p></div><h2 id="3、准备工作"><a href="#3、准备工作" class="headerlink" title="3、准备工作"></a>3、准备工作</h2><div class="story post-story"><p>首先我们要知道，<wavy>模板消息</wavy>是什么？以下就是公众号模板消息，我们在生活中很多场景都会接触到它。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:15%;" /></p><p>在进入了测试号的管理后台之后，我们可以在这里设置我们的模板消息的<wavy>模板</wavy></p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>首先我们要在公众平台中设置好我们的模板，然后 java 中根据模板信息来添加相应的内容。</p></div><h2 id="4、java后端编写"><a href="#4、java后端编写" class="headerlink" title="4、java后端编写"></a>4、java后端编写</h2><div class="story post-story"><p>我们创建一个名为<code>WeChatNotify</code>的工具类，里面存放的是模板消息的设置内容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeChatNotify</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IDictService ds;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ParseUtil pu;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdrService js;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送模板信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">push</span><span class="params">(String openid,String map, Bxd bxd)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1，配置</span></span><br><span class="line">        WxMpInMemoryConfigStorage wxStorage = <span class="keyword">new</span> WxMpInMemoryConfigStorage();</span><br><span class="line">        wxStorage.setAppId(<span class="string">&quot;wxacc93d31c5dbd26f&quot;</span>);</span><br><span class="line">        wxStorage.setSecret(<span class="string">&quot;f8c9e82b590ac71eb12e96f77cf65740&quot;</span>);</span><br><span class="line">        WxMpService wxMpService = <span class="keyword">new</span> WxMpServiceImpl();</span><br><span class="line">        wxMpService.setWxMpConfigStorage(wxStorage);</span><br><span class="line">        <span class="comment">//2,推送消息</span></span><br><span class="line">        WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder()</span><br><span class="line">                .toUser(openid)<span class="comment">//要推送的用户openid</span></span><br><span class="line">                .templateId(<span class="string">&quot;-1pT4MrVw4asKamh0IQMF6c22Ih74dRjxqN8fwhjoQs&quot;</span>)<span class="comment">//模版id</span></span><br><span class="line">                .url(<span class="string">&quot;https://www.cyc0819.top&quot;</span>)<span class="comment">//点击模版消息要访问的网址</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取保修类别</span></span><br><span class="line">        String bxlb=pu.paraseBxlb(bxd.getBxlb());</span><br><span class="line">        <span class="comment">//3,正式版发送模版消息，这里需要配置你的信息，替换微信公众号上创建的模板内容</span></span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;map&quot;</span>, map, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;type&quot;</span>,bxlb, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;text&quot;</span>, bxd.getXxdd()+bxd.getBxnr(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;time&quot;</span>, bxd.getYysj(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;name&quot;</span>, bxd.getSbr(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;phone&quot;</span>, bxd.getSbrsj(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;推送成功&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;推送失败：&quot;</span> + e.getMessage());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;推送失败&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查openid是否已经绑定</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">selOpenid</span><span class="params">(String ybid)</span></span>&#123;</span><br><span class="line">        String openid=js.selOpenidForYbid(ybid);</span><br><span class="line">        <span class="keyword">if</span> (openid == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> openid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，我们需要公众号的<code>appid,appsecret</code>，以及接收人的<code>openid</code>。</p><div class="note warning"><p>如何获取用户的 openid 可以看以下这篇文章。</p></div><div class="tag link"><a class="link-card" title="SpringBoot+Vue微信授权获取用户openid" href="http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">SpringBoot+Vue微信授权获取用户openid</p><p class="url">http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/</p></div></a></div><p>给足所需要的消息，然后在要发送消息的地方调用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">zdpdWeChat</span><span class="params">(String eid, String bxlb,Bxd bxd)</span></span>&#123;</span><br><span class="line">    String ybid=zdpd(eid,bxlb);</span><br><span class="line">    String map=es.selxxwz(Integer.parseInt(eid));</span><br><span class="line">    <span class="comment">//调用发送模板信息</span></span><br><span class="line">    wcn.push(<span class="string">&quot;OPENID&quot;</span>,map,bxd);</span><br><span class="line">    <span class="keyword">return</span> ybid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/categories/java/SpringBoot/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot+Vue微信授权获取用户openid</title>
    <link href="http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/"/>
    <id>http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/</id>
    <published>2021-12-08T16:16:46.000Z</published>
    <updated>2022-06-12T16:17:58.477Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringBoot-Vue微信授权获取用户openid"><a href="#SpringBoot-Vue微信授权获取用户openid" class="headerlink" title="SpringBoot+Vue微信授权获取用户openid"></a>SpringBoot+Vue微信授权获取用户openid</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>MySQL 8.0</li><li>Vue 3.0</li></ul></div><h2 id="2、需求"><a href="#2、需求" class="headerlink" title="2、需求"></a>2、需求</h2><div class="story post-story"><p>这几天在做桂林医学院的项目的时候，甲方提出了需求说能不能将消息通知改成微信公众号通知，因为公众号的效率比较高，同时受众也是比较多（原本用的是易班的 api，文档及其不友好，bug 官方也不解决，按照上一届学长的说法，之前发送消息接收人得等两天之后才能收到）。</p><p>而如果用到微信的公众号，必须就得接收人主动绑定自己的微信号，我们才能获取他的 openid ，才能对其发送模板消息。</p></div><h2 id="3、微信公众号模板消息"><a href="#3、微信公众号模板消息" class="headerlink" title="3、微信公众号模板消息"></a>3、微信公众号模板消息</h2><div class="story post-story"><p>开发的时候我用的是微信的<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">测试公众账号</a>，但是实际的功能和企业的账号是一样的。</p><p>首先我们要知道，<wavy>模板消息</wavy>是什么？以下就是公众号模板消息，我们在生活中很多场景都会接触到它。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:15%;" /></p><p>在进入了测试号的管理后台之后，我们可以在这里设置我们的模板消息的<wavy>模板</wavy></p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当然，本文的主题并不是模板消息的发送，而是使用模板消息的时候引发的其他问题，具体的模板消息可以移步我的：</p><div class="tag link"><a class="link-card" title="SpringBoot发送微信模板消息" href="http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">SpringBoot发送微信模板消息</p><p class="url">http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/</p></div></a></div></div><h2 id="4、SpringBoot获取openid"><a href="#4、SpringBoot获取openid" class="headerlink" title="4、SpringBoot获取openid"></a>4、SpringBoot获取openid</h2><div class="story post-story"><p>openid 是微信用户的唯一标识，就跟人的身份证一样，每个微信号都有一个自己的 openid ，用于识别每个微信，一般情况下，我们无法看到，更无法修改我们的 openid，此时如果需要获取，就需要微信官方给我们提供的接口：</p><p>我们点开下图中的<span class='p blue'>蓝色</span>字体,<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以进入到<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">网页授权</a>的界面：</p><p>里面详细介绍了获取openid，甚至是用户信息的过程：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003923.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003923.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以下是我通过 java 实现的一些过程，可供参考。</p><h3 id="4-1、用户同意授权，获取code"><a href="#4-1、用户同意授权，获取code" class="headerlink" title="4.1、用户同意授权，获取code"></a>4.1、用户同意授权，获取code</h3><p>根据官方的说法，我们需要请求一个链接来获取到用户的 CODE<br>链接如下：<br><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</code></p><p>这里有几个参数，官方文档都有说明，这里重点是把要去上一步中：</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>最后面的修改那里，将域名改成与  REDIRECT_URI 一致</p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209004933.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209004933.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>而此时我们选择的<code>scope</code>是需要用户手动通过授权的<code>snsapi_userinfo</code></p><p>然后我们就有了我们的链接，此时就要去代码中对其进行请求了。</p><p>以下就是java代码<br>首先我们在 SpringBoot模块中建一个 <code>WechatOAuth</code> 控制器，用来接受前端发来的请求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;wechat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatOAuth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthUtil authUtil;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户同意授权，获取code</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oauth&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oauth</span><span class="params">(HttpServletResponse response, String id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// System.out.println(&quot;开始询问用户是否同统一授权&quot;);</span></span><br><span class="line">        String appid = <span class="string">&quot;wxac**********d26f&quot;</span>;</span><br><span class="line">        String path = <span class="string">&quot;http://10.33.73.62:8089/wechat/invoke&quot;</span>;</span><br><span class="line">        path = URLEncoder.encode(path, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String url = <span class="string">&quot;https://open.weixin.qq.com/connect/oauth2/authorize?appid=&quot;</span> + appid</span><br><span class="line">                + <span class="string">&quot;&amp;response_type=code&amp;scope=snsapi_userinfo&amp;redirect_uri=&quot;</span> + path</span><br><span class="line">                + <span class="string">&quot;&amp;state=&quot;</span> + id</span><br><span class="line">                + <span class="string">&quot;&amp;connect_redirect=1#wechat_redirect&quot;</span>;</span><br><span class="line">        <span class="comment">//请求转发链接</span></span><br><span class="line">        response.sendRedirect(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，我们请求链接获得 code ，然后返回我们设置好的<wavy>回调地址</wavy>，也就是上面的 path，（注意，此处的地址要和前面我们设置的一致，后面的端口可以改变）</p><h3 id="4-2、通过code换取网页授权openid"><a href="#4-2、通过code换取网页授权openid" class="headerlink" title="4.2、通过code换取网页授权openid"></a>4.2、通过code换取网页授权openid</h3><p>然后我们再写一个转发之后的控制器。<br>也就是上一步中<code>String path = &quot;http://10.33.73.62:8089/wechat/invoke&quot;;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户同意授权</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/invoke&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">oauthInvoke</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得code</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户同意授权，开始获取openid&quot;</span>);</span><br><span class="line">        String code = request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        String state = request.getParameter(<span class="string">&quot;state&quot;</span>);</span><br><span class="line">        System.out.println(code);</span><br><span class="line">        System.out.println(state);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否绑定过openid</span></span><br><span class="line">        String isOpenid=userService.selUser(state).getOpenid();</span><br><span class="line">        <span class="keyword">if</span> (isOpenid!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;您已经绑定过微信了,如需修改请联系管理员&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 通过token获取access_token</span></span><br><span class="line">        String appid = <span class="string">&quot;wxacc93d31c5dbd26f&quot;</span>;</span><br><span class="line">        String secret = <span class="string">&quot;f8c9e82b590ac71eb12e96f77cf65740&quot;</span>;</span><br><span class="line">        String url = <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&quot;</span> + appid</span><br><span class="line">                + <span class="string">&quot;&amp;secret=&quot;</span> + secret</span><br><span class="line">                + <span class="string">&quot;&amp;code=&quot;</span> + code</span><br><span class="line">                + <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JSONObject jsonObject = authUtil.doGetJson(url);</span><br><span class="line">            String openid= (String) jsonObject.get(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line">            System.out.println(openid);</span><br><span class="line">            <span class="comment">// 将openid插入到user表中</span></span><br><span class="line">            userService.addOpenid(state,openid);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;授权成功,绑定微信成功&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>此处同样是请求链接，就可以返回一个 json 数据，里面就有我们所需要的数据，如果还需要用户信息的数据，可以继续跟着官方的步骤继续往下做，但是我们这里只需要一个 openid，所以就到这一步。</p><p>在这一步中，我们请求该链接，然后用<code>authUtil</code>工具里来解析，将其返回的数据转换为 json 数据，以方便我们的提取使用，转换为 json 数据之后，只要从中通过 <code>key</code> 取出来即可。</p><p>此处首先会判断用户的 openid 是否存在，如果存在就弹出提示，不执行以下的操作，否则在查出用户的openid 之后，即可绑定到数据库，弹出提示信息。</p><p>以下是此处用到的 authUtil 工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPID = <span class="string">&quot;wx45c1428e5584fcdb&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPSECRET = <span class="string">&quot;98174450eb706ada330f37e646be85d5&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JSONObject <span class="title">doGetJson</span><span class="params">(String url)</span> <span class="keyword">throws</span> ClientProtocolException, IOException </span>&#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//首先初始化HttpClient对象</span></span><br><span class="line">        DefaultHttpClient client = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">        <span class="comment">//通过get方式进行提交</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">        <span class="comment">//通过HTTPclient的execute方法进行发送请求</span></span><br><span class="line">        HttpResponse response = client.execute(httpGet);</span><br><span class="line">        <span class="comment">//从response里面拿自己想要的结果</span></span><br><span class="line">        HttpEntity entity = response.getEntity();</span><br><span class="line">        <span class="keyword">if</span>(entity != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String result = EntityUtils.toString(entity,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="comment">// jsonObject = JSONObject.fromObject(result);</span></span><br><span class="line">            jsonObject= JSON.parseObject(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把链接释放掉</span></span><br><span class="line">        httpGet.releaseConnection();</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、前端请求后端接口"><a href="#5、前端请求后端接口" class="headerlink" title="5、前端请求后端接口"></a>5、前端请求后端接口</h2><div class="story post-story"><p>我们需要一个能看得过去，能让用户输入账号密码的前端界面，所以以下是我们 vue 的代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;form-login&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;form&quot; :model=&quot;data.form&quot; &gt;</span><br><span class="line">        &lt;el-form-item label=&quot;账户&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;data.form.name&quot; class=&quot;input-login&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;密码&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;data.form.pass&quot; type=&quot;password&quot; class=&quot;input-login&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot;  @click=&quot;Wechatlogin&quot;&gt;微信授权&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;getCurrentInstance, reactive&#125; from &quot;vue&quot;;</span><br><span class="line">import qs from &quot;qs&quot;;</span><br><span class="line">import router from &quot;../../router&quot;;</span><br><span class="line">import &#123; ElLoading &#125; from &#x27;element-plus&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Wechar&quot;,</span><br><span class="line">  setup()&#123;</span><br><span class="line">    const &#123;proxy&#125;=getCurrentInstance();</span><br><span class="line">    const qs=require(&#x27;qs&#x27;);</span><br><span class="line">    const data=reactive(&#123;</span><br><span class="line">      form: &#123;</span><br><span class="line">        name: &#x27;&#x27;,</span><br><span class="line">        pass: &#x27;&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    const Wechatlogin = () =&gt; &#123;</span><br><span class="line">      const loading = ElLoading.service(&#123;</span><br><span class="line">        lock: true,</span><br><span class="line">        text: &#x27;Loading&#x27;,</span><br><span class="line">        background: &#x27;rgba(0, 0, 0, 0.7)&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">      proxy.$axios.post(&#x27;user/login&#x27;,qs.stringify(&#123; &quot;userId&quot;:data.form.name,&quot;userPass&quot;:data.form.pass &#125;)).then(res=&gt;&#123;</span><br><span class="line">        if (&quot;允许登录&quot;==res.data)&#123;</span><br><span class="line">          window.location.href=&quot;http://10.33.73.62:8089/wechat/oauth?id=&quot;+data.form.name</span><br><span class="line">          loading.close()</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">          loading.close()</span><br><span class="line">          alert(res.data);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    return&#123;</span><br><span class="line">      data,Wechatlogin,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>这里点击授权的按钮之后，首先会判断用户是否存在以及密码是否正确，然后就去调用后端的接口。</p><div class="note warning"><p>注意此处有一个坑： 可以看到我这里<code>window.location.href=http://10.33.73.62:8089/wechat/oauth?id=+data.form.name</code>使用的是<code>window.location.href</code>请求后端接口。 这里是不能用<code>axios</code>进行请求的，会出现跨域异常（跨域到微信的服务器）。 算是一个逼坑指南。</p></div></div><h2 id="6、完整流程"><a href="#6、完整流程" class="headerlink" title="6、完整流程"></a>6、完整流程</h2><div class="story post-story"><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115733.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115733.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115941.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115941.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120057.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120057.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120115.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120115.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120147.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120147.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">        </p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/categories/java/SpringBoot/"/>
    
    <category term="前端" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Vue" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/Vue/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/tags/SpringBoot/"/>
    
    <category term="Vue" scheme="http://cyc0819.top/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>json—lib依赖无法下载问题</title>
    <link href="http://cyc0819.top/2021/12/08/2021-12-08-json%E2%80%94lib%E4%BE%9D%E8%B5%96%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%E9%97%AE%E9%A2%98/"/>
    <id>http://cyc0819.top/2021/12/08/2021-12-08-json%E2%80%94lib%E4%BE%9D%E8%B5%96%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%E9%97%AE%E9%A2%98/</id>
    <published>2021-12-08T05:53:12.000Z</published>
    <updated>2022-06-12T16:16:42.864Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="json-lib依赖无法下载问题"><a href="#json-lib依赖无法下载问题" class="headerlink" title="json-lib依赖无法下载问题"></a>json-lib依赖无法下载问题</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>Maven源：阿里云</li></ul></div><h2 id="2、问题"><a href="#2、问题" class="headerlink" title="2、问题"></a>2、问题</h2><div class="story post-story"><p>昨天在研究微信验证时，需要用到 <code>JSONObject.fromObject(result);</code> 这个方法，所以需要引入 <code>json-lib</code> 的依赖，引入依赖很简单，本以为复制黏贴就可以了，但是不知道为什么阿里云的 maven 仓库却死活无法找到这个依赖的包。后面通过手动引入的方式解决。</p></div><h2 id="3、解决"><a href="#3、解决" class="headerlink" title="3、解决"></a>3、解决</h2><div class="story post-story"><h3 id="3-1、引入的依赖"><a href="#3-1、引入的依赖" class="headerlink" title="3.1、引入的依赖"></a>3.1、引入的依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.sf.json-lib/json-lib --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.json-lib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-lib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2、报错"><a href="#3-2、报错" class="headerlink" title="3.2、报错"></a>3.2、报错</h3><p>此时直接进行下载会提示找不到依赖的相关内容</p><h3 id="3-3、解决方法一"><a href="#3-3、解决方法一" class="headerlink" title="3.3、解决方法一"></a>3.3、解决方法一</h3><p>翻阅了网上的说法，说是在依赖后面加上一句：<code>&lt;classifier&gt;jdk15&lt;/classifier&gt;</code> ，因为远程提供了两个包，我试了一下在我这里并不管用。<br>所以，此方法基本放弃。</p><h3 id="3-4、解决方法二"><a href="#3-4、解决方法二" class="headerlink" title="3.4、解决方法二"></a>3.4、解决方法二</h3><p>另一个方法，就是去<a href="https://mvnrepository.com/">MAVEN存储库</a>直接下载jar包，<br>但是在我打开网站的时候，点击 jar 包进行下载，却发现，这里的也无法下载了<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141505.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141505.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141543.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141543.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>所以基本上可以判断不是我们自己的问题了。</p><p>偶然之间，我发现这个依赖竟然有一个官网：<a href="http://json-lib.sourceforge.net/">JSON-lib</a></p><p>进去看看<img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142229.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142229.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>官网里应该有 jar 包的下载链接<br>果然，点击下面这个按钮就可以正常下载了<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142313.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142313.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142413.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142413.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>下载完成之后就可以进行手动的导入了</strong><br>我这里选择的是将我们手动下载的 jar 包，放在 maven 本地仓库的相应位置<br>首先，我们需要将后面的 <code>jdk15</code> 去掉，因为我们的依赖里是没有的。</p><p>然后根据自己的本地仓库位置，找到 json-lib的本地仓库<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143118.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143118.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>点击进入 2.4 文件夹,将我们更名之后的 jar 包放到其中<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143204.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143204.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>最后记得把带有 <code>last</code> 的文件删掉</p><p>最后到 java 项目中重新载入一下 maven 就可以了。</p></div><h2 id="4、结束"><a href="#4、结束" class="headerlink" title="4、结束"></a>4、结束</h2><div class="story post-story"><p><code>json-lib</code> 相当于 <code>jackson,fastjson</code>这样的 jar 来说，效率不高，所以建议使用后者。</p><p><code>json-lib</code>中的 <code>JSONObject.fromObject(result)</code> 方法可用<br><code>fastjson</code>中的<code>JSON.parseObject(result);</code>进行替代</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="maven" scheme="http://cyc0819.top/categories/java/maven/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="maven" scheme="http://cyc0819.top/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>回顾SSM框架整合</title>
    <link href="http://cyc0819.top/2021/11/30/2021-11-30-%E5%9B%9E%E9%A1%BESSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/"/>
    <id>http://cyc0819.top/2021/11/30/2021-11-30-%E5%9B%9E%E9%A1%BESSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/</id>
    <published>2021-11-30T05:13:21.000Z</published>
    <updated>2022-06-12T16:12:15.607Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="回顾SSM框架整合"><a href="#回顾SSM框架整合" class="headerlink" title="回顾SSM框架整合"></a>回顾SSM框架整合</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>mySQL 8.0</li><li>Tomcat 9.0.27</li></ul></div><h2 id="2、创建数据库"><a href="#2、创建数据库" class="headerlink" title="2、创建数据库"></a>2、创建数据库</h2><div class="story post-story"><p>首先创建一个测试用的数据库 books：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> books</span><br><span class="line">(</span><br><span class="line">    bid     <span class="type">int</span>     <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,</span><br><span class="line">    sname   <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span>,</span><br><span class="line">    bname   <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span>,</span><br><span class="line">    bauthor <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span>,</span><br><span class="line">    bhome   <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130132921.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130132921.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="3、创建项目"><a href="#3、创建项目" class="headerlink" title="3、创建项目"></a>3、创建项目</h2><div class="story post-story"><p>现在创建一个普通的 Maven 项目，并引入所需要的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="4、设置资源过滤"><a href="#4、设置资源过滤" class="headerlink" title="4、设置资源过滤"></a>4、设置资源过滤</h2><div class="story post-story"><p>在 pom.xm 中插入资源过滤的代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="5、添加-web-框架支持"><a href="#5、添加-web-框架支持" class="headerlink" title="5、添加 web 框架支持"></a>5、添加 web 框架支持</h2><div class="story post-story"><p>给我们创建的普通项目添加上框架支持，在项目名上右键，即可添加框架支持。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130133853.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130133853.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130134459.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130134459.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="5、创建-spring-配置文件"><a href="#5、创建-spring-配置文件" class="headerlink" title="5、创建 spring 配置文件"></a>5、创建 spring 配置文件</h2><div class="story post-story"><p>在刚刚项目的 resources 下面创建配置文件 db.properties ，其中写的是数据库的相关配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF8&amp;userSSL=true&amp;serverTimezone=GMT</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">chenyicai</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">cyc1234</span></span><br></pre></td></tr></table></figure><p>以及创建 applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    使用连接池，开源的连接池--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    阿里：druid--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    c3p0--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    hiraki：springboot默认使用的连接池--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    一个应用最大并发如果有500个，那么为了提高查询效率，预先创建500个连接，并且把500个连接放入连接池（容器）--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制器类的创建交给SpringMVC，不能配置在bean容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.chen&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 初始化连接池中的连接数，取值应在minPoolSize与maxPoolSize之间，默认为3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--最大空闲时间，60秒内未使用则连接被丢弃。若为0则永不丢弃。默认值: 0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdleTime&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--连接池中保留的最大连接数。默认值: 15 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 连接池中保留的最小连接数，默认为：3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--c3p0全局的PreparedStatements缓存的大小。如果maxStatements与maxStatementsPerConnection均为0，则缓存不生效，只要有一个不为0，则语句的缓存就能生效。如果默认值:</span></span><br><span class="line"><span class="comment">            0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 当连接池连接耗尽时，客户端调用getConnection()后等待获取新连接的时间，超时后将抛出SQLException，如设为0则无限期等待。单位毫秒。默认:</span></span><br><span class="line"><span class="comment">            0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;checkoutTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3000&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--当连接池中的连接耗尽的时候c3p0一次同时获取的连接数。默认值: 3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireIncrement&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--定义在从数据库获取新连接失败后重复尝试的次数。默认值: 30 ；小于等于0表示无限次 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireRetryAttempts&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--重新尝试的时间间隔，默认为：1000毫秒 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireRetryDelay&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--关闭连接时，是否提交未提交的事务，默认为false，即关闭连接，回滚未提交的事务 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;autoCommitOnClose&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--c3p0将建一张名为Test的空表，并使用其自带的查询语句进行测试。如果定义了这个参数那么属性preferredTestQuery将被忽略。你不能在这张Test表上进行任何操作，它将只供c3p0测试使用。默认值:</span></span><br><span class="line"><span class="comment">            null --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;automaticTestTable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--如果为false，则获取连接失败将会引起所有等待连接池来获取连接的线程抛出异常，但是数据源仍有效保留，并在下次调用getConnection()的时候继续尝试获取连接。如果设为true，那么在尝试获取连接失败后该数据源将申明已断开并永久关闭。默认:</span></span><br><span class="line"><span class="comment">            false --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;breakAfterAcquireFailure&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--每60秒检查所有连接池中的空闲连接。默认值: 0，不检查 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;idleConnectionTestPeriod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--maxStatementsPerConnection定义了连接池内单个连接所拥有的最大缓存statements数。默认值: 0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatementsPerConnection&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.chen.entity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="6、编写代码主体"><a href="#6、编写代码主体" class="headerlink" title="6、编写代码主体"></a>6、编写代码主体</h2><div class="story post-story"><p>现在来编写代码中 entity，controller，service，mapper 层的代码<br><strong>entity：books</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Books</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer bid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bauthor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bhome;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>mapper（此处演示的是传统的 DAO 的方式）:booksDao：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BooksDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>booksDaoImpl：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksDaoImpl</span> <span class="keyword">implements</span> <span class="title">BooksDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSqlSessionFactory</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionFactory = sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">int</span> out=sqlSession.delete(<span class="string">&quot;deleteByPrimaryKey&quot;</span>,bid);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">int</span> out=sqlSession.insert(<span class="string">&quot;insert&quot;</span>,record);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        Books books=sqlSession.selectOne(<span class="string">&quot;selectByPrimaryKey&quot;</span>,bid);</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">int</span> out = sqlSession.update(<span class="string">&quot;updateByPrimaryKey&quot;</span>,record);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>然后是 xml 文件，其中是执行的 sql：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org/DTD Mapper 3.0&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.chen.entity.Books&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        *</span><br><span class="line">        from books</span><br><span class="line">        where bid = #&#123;bid,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from books</span><br><span class="line">        where bid = #&#123;bid,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.chen.entity.Books&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        insert into books (sname, bname, bauthor,</span><br><span class="line">                           bhome)</span><br><span class="line">        values (#&#123;sname,jdbcType=VARCHAR&#125;, #&#123;bname,jdbcType=VARCHAR&#125;, #&#123;bauthor,jdbcType=VARCHAR&#125;,</span><br><span class="line">                #&#123;bhome,jdbcType=VARCHAR&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.chen.entity.Books&quot;</span>&gt;</span></span><br><span class="line">        update books</span><br><span class="line">        set sname = #&#123;sname,jdbcType=VARCHAR&#125;,</span><br><span class="line">            bname = #&#123;bname,jdbcType=VARCHAR&#125;,</span><br><span class="line">            bauthor = #&#123;bauthor,jdbcType=VARCHAR&#125;,</span><br><span class="line">            bhome = #&#123;bhome,jdbcType=VARCHAR&#125;</span><br><span class="line">        where bid = #&#123;bid,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>service 层：BooksService</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BooksService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>impl：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksServiceImpl</span> <span class="keyword">implements</span> <span class="title">BooksService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BooksDao booksDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.deleteByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.insert(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.selectByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.updateByPrimaryKey(record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>最后是 Controller 层：BooksController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BooksService booksService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBooksService</span><span class="params">(BooksService booksService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.booksService = booksService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/del&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.deleteByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/ins&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.insert(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/sel&quot;)</span></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.selectByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/up&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.updateByPrimaryKey(record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后项目的结构如下：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130145929.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130145929.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="7、现在需要在配置-xml-中编写扫描我们的-bean-的代码"><a href="#7、现在需要在配置-xml-中编写扫描我们的-bean-的代码" class="headerlink" title="7、现在需要在配置 xml 中编写扫描我们的 bean 的代码"></a>7、现在需要在配置 xml 中编写扫描我们的 bean 的代码</h2><div class="story post-story"><p>加入以下代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.chen.mapper.impl.BooksDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.chen.entity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath*:mapper/BooksMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150442.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150442.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150809.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150809.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="8、web-配置"><a href="#8、web-配置" class="headerlink" title="8、web 配置"></a>8、web 配置</h2><div class="story post-story"><p>在 web.xml 中配置以下内容,用于配置dispatcherServlet中心控制器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 监听器会自动读取applicationContext.xml中的bean的信息，完成bean的初始化--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span><span class="comment">&lt;!-- 前端控制器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span><span class="comment">&lt;!-- 处理所有请求，当然也包含静态资源（js、css、img...） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在创建一个 dispatcher-servlet.xml，用于 MVC 的装配</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描控制器的包，以确定哪些类是控制器类（哪些类上使用了@Controller注解） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.edu.guet.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表示：所有的静态资源使用默认的Servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 告诉SpringMVC去哪个目录找文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 文件的后缀 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过处理器适配器AnnotationMethodHandlerAdapter来开启支持@RequestMapping注解--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="9、运行测试"><a href="#9、运行测试" class="headerlink" title="9、运行测试"></a>9、运行测试</h2><div class="story post-story"><p>此时我们用 Tomcat 构建项目。<br>出现以下结果：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130172158.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130172158.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果出现这种情况，我们就需要将 maven 的包手动导入，才能成功启动项目。<br>步骤如下：</p><ol><li>打开项目结构。</li><li>点击构件，然后点击WEB-INF目录，点击新建文件夹按钮，创建lib文件夹。</li><li>然后引入库。</li><li>将其全选，然后需要的jar包便全部导入到项目中。<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130173210.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130173210.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p><strong>再运行，即可</strong></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="spring" scheme="http://cyc0819.top/categories/java/spring/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="spring" scheme="http://cyc0819.top/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>eCharts学习笔记</title>
    <link href="http://cyc0819.top/2021/11/27/2021-11-27-eCharts%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://cyc0819.top/2021/11/27/2021-11-27-eCharts%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2021-11-27T14:04:25.000Z</published>
    <updated>2022-06-12T16:10:06.437Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="eCharts-学习笔记"><a href="#eCharts-学习笔记" class="headerlink" title="eCharts 学习笔记"></a>eCharts 学习笔记</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><div class="story post-story"><p>eCharts 是百度出品的一款基于 JavaScript 的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。最开始是由百度团队开源的，后面于2018年交由Apache基金会，称为ASF孵化项目。并于2021年1月26日正式毕业。</p></div><h2 id="2、在-Vue-中使用"><a href="#2、在-Vue-中使用" class="headerlink" title="2、在 Vue 中使用"></a>2、在 Vue 中使用</h2><div class="story post-story"><ol><li>首先下载 eCharts：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure></li><li>全局引入 eCharts:<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>或者可以按需引入<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 echarts 核心模块，核心模块提供了 echarts 使用必须要的接口。</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts/core&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入柱状图图表，图表后缀都为 Chart</span></span><br><span class="line"><span class="keyword">import</span> &#123; BarChart &#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/charts&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入提示框，标题，直角坐标系，数据集，内置数据转换器组件，组件后缀都为 Component</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  TitleComponent,</span><br><span class="line">  TooltipComponent,</span><br><span class="line">  GridComponent,</span><br><span class="line">  DatasetComponent,</span><br><span class="line">  DatasetComponentOption,</span><br><span class="line">  TransformComponent</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/components&#x27;</span>;</span><br><span class="line"><span class="comment">// 标签自动布局，全局过渡动画等特性</span></span><br><span class="line"><span class="keyword">import</span> &#123; LabelLayout, UniversalTransition &#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/features&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入 Canvas 渲染器，注意引入 CanvasRenderer 或者 SVGRenderer 是必须的一步</span></span><br><span class="line"><span class="keyword">import</span> &#123; CanvasRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/renderers&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册必须的组件</span></span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,</span><br><span class="line">  TooltipComponent,</span><br><span class="line">  GridComponent,</span><br><span class="line">  DatasetComponent,</span><br><span class="line">  TransformComponent,</span><br><span class="line">  BarChart,</span><br><span class="line">  LabelLayout,</span><br><span class="line">  UniversalTransition,</span><br><span class="line">  CanvasRenderer</span><br><span class="line">]);</span><br></pre></td></tr></table></figure></div><h2 id="3、基本语法结构"><a href="#3、基本语法结构" class="headerlink" title="3、基本语法结构"></a>3、基本语法结构</h2><div class="story post-story"></li></ol><p>在使用 eCharts 之前，我们需要给它一个 DOM 容器，官方是推荐我们使用具有定义好的长和宽的一个父容器（可以是 div ）。<br>所以我们首先构建一个父容器 div 来存放 eCharts 图表</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;billreport&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:style</span>=<span class="string">&quot;&#123; width: &#x27;95%&#x27;, height: &#x27;500px&#x27; &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>由于 eCharts 基于js构建的，所以只要会js的语法，eCharts的语法自然也不在话下。<br>而 eCharts 的基本语法结构为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> data=reactive(&#123;</span><br><span class="line">    <span class="attr">option</span>:&#123;</span><br><span class="line">    <span class="comment">//图表信息</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ech = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//绘制图表的方法</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onBeforeMount(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//在页面渲染之前加载图表的信息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div><h2 id="4、图表配置信息"><a href="#4、图表配置信息" class="headerlink" title="4、图表配置信息"></a>4、图表配置信息</h2><div class="story post-story"><p>图表配置信息，即 option 中的内容，在这一部分，我们将配置一系列的信息，正是这些信息生成了对应的图表。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">option:&#123;</span><br><span class="line"><span class="attr">title</span>:&#123;</span><br><span class="line"><span class="attr">text</span>: <span class="string">&quot;收入与支出趋势图&quot;</span><span class="comment">//图表的标题</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">tooltip</span>:&#123;<span class="comment">//提示的信息</span></span><br><span class="line"><span class="attr">trigger</span>:<span class="string">&#x27;axis&#x27;</span><span class="comment">//触发方式</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">legend</span>: &#123;<span class="comment">//图例</span></span><br><span class="line">        <span class="attr">data</span>: [&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;收入&#x27;</span>,</span><br><span class="line">        <span class="comment">// 强制设置图形为圆。</span></span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">        <span class="comment">// 设置文本为红色</span></span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;支出&#x27;</span>,</span><br><span class="line">        <span class="comment">// 强制设置图形为圆。</span></span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">        <span class="comment">// 设置文本为红色</span></span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]<span class="comment">//图例的标题，分别对应 series 中的数据</span></span><br><span class="line">    &#125;，</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;<span class="comment">//配置要在x轴显示的项</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,<span class="comment">//&#x27;value&#x27; 数值轴，适用于连续数据。 &#x27;category&#x27; 类目轴，适用于离散的类目数据，为该类型时必须通过 data 设置类目数据。 &#x27;time&#x27; 时间轴，适用于连续的时序数据，与数值轴相比时间轴带有时间的格式化，在刻度计算上也有所不同，例如会根据跨度的范围来决定使用月，星期，日还是小时范围的刻度。 &#x27;log&#x27; 对数轴。适用于对数数据。</span></span><br><span class="line">        <span class="attr">boundaryGap</span>: <span class="literal">false</span>,<span class="comment">// 刻度离纵轴有无间隙，默认true有间距</span></span><br><span class="line">        <span class="attr">data</span>: []<span class="comment">//横轴坐标的值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;<span class="comment">//配置y轴的项，配置与x轴类似</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [<span class="comment">//系列列表,显示在图表中的内容</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;收入&#x27;</span>,<span class="comment">//系列名称</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,<span class="comment">//图表类型</span></span><br><span class="line">        <span class="attr">stack</span>: <span class="string">&#x27;收入&#x27;</span>,<span class="comment">//堆叠，如果有相同名称的会堆叠</span></span><br><span class="line">        <span class="attr">data</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;支出&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">        <span class="attr">stack</span>: <span class="string">&#x27;支出&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>图表类型表：</p><table><thead><tr><th>配置</th><th>图表类型</th></tr></thead><tbody><tr><td>type: ‘bar’</td><td>柱状/条形图</td></tr><tr><td>type: ‘line’</td><td>折线/面积图</td></tr><tr><td>type: ‘pie’</td><td>饼图</td></tr><tr><td>type: ‘scatter’</td><td>散点（气泡）图</td></tr><tr><td>type: ‘effectScatter’</td><td>带有涟漪特效动画的散点（气泡）</td></tr><tr><td>type: ‘radar’</td><td>雷达图</td></tr><tr><td>type: ‘tree’</td><td>树型图</td></tr><tr><td>type: ‘treemap’</td><td>树型图</td></tr><tr><td>type: ‘sunburst’</td><td>旭日图</td></tr><tr><td>type: ‘boxplot’</td><td>箱形图</td></tr><tr><td>type: ‘candlestick’</td><td>K线图</td></tr><tr><td>type: ‘heatmap’</td><td>热力图</td></tr><tr><td>type: ‘map’</td><td>地图</td></tr><tr><td>type: ‘parallel’</td><td>平行坐标系的系列</td></tr><tr><td>type: ‘lines’</td><td>线图</td></tr><tr><td>type: ‘graph’</td><td>关系图</td></tr><tr><td>type: ‘sankey’</td><td>桑基图</td></tr><tr><td>type: ‘funnel’</td><td>漏斗图</td></tr><tr><td>type: ‘gauge’</td><td>仪表盘</td></tr><tr><td>type: ‘pictorialBar’</td><td>象形柱图</td></tr><tr><td>type: ‘themeRiver’</td><td>主题河流</td></tr><tr><td>type: ‘custom’</td><td>自定义系列</td></tr></tbody></table></div><h2 id="5、x-轴、y-轴"><a href="#5、x-轴、y-轴" class="headerlink" title="5、x 轴、y 轴"></a>5、x 轴、y 轴</h2><div class="story post-story"><p>x 轴和 y 轴都由轴线、刻度、刻度标签、轴标题四个部分组成。<br>一般情况下，二维的图标结构都会有 x 轴和 y 轴，通常情况下，x 轴会在图表的下方，而 y 轴在图表的左边。<br>而 eCharts 也提供了一些特定的坐标轴的设置选项，如：<br><strong>轴线：</strong><br>我们可以通过 axisLine 来对轴线进行设置，比如轴线两头的箭头，轴线的样式等等，比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLine</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>:<span class="string">&#x27;true&#x27;</span> <span class="comment">//显示轴线</span></span><br><span class="line">      <span class="attr">symbol</span>: <span class="string">&#x27;arrow&#x27;</span>, <span class="comment">//轴线两边的箭头</span></span><br><span class="line">      <span class="attr">lineStyle</span>: &#123; <span class="comment">//轴线的样式，有颜色、宽度、类型等等</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLine</span>: &#123;</span><br><span class="line">      <span class="attr">symbol</span>: <span class="string">&#x27;arrow&#x27;</span>,</span><br><span class="line">      <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>轴线两边的箭头选项：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129165935.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129165935.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>坐标轴刻度：</strong><br>ECharts 提供了轴线 axisTick 相关的配置，我们可以根据实际情况调整，例如刻度线的长度，样式等。以下是一个坐标轴刻度的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisTick</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>:<span class="literal">true</span> <span class="comment">//开启坐标轴刻度</span></span><br><span class="line">      <span class="attr">alignWithLabel</span>:<span class="literal">true</span> <span class="comment">//使刻度与标签对其（类目轴中在 boundaryGap 为 true 的时候有效）</span></span><br><span class="line">      <span class="attr">inside</span>:<span class="literal">true</span> <span class="comment">//刻度线是否朝里（true为朝里）</span></span><br><span class="line">      interval：<span class="number">0</span> <span class="comment">//坐标轴刻度的显示间隔,如果设置为 1，表示『隔一个标签显示一个标签』，如果值为 2，表示隔两个标签显示一个标签，以此类推。</span></span><br><span class="line">      <span class="attr">length</span>: <span class="number">6</span>,<span class="comment">//刻度线的长度</span></span><br><span class="line">      <span class="attr">lineStyle</span>: &#123; <span class="comment">//样式设置</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisTick</span>: &#123;</span><br><span class="line">      <span class="attr">length</span>: <span class="number">6</span>,</span><br><span class="line">      <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>刻度标签：</strong><br>ECharts 提供了轴线 axisLabel 相关的配置，我们可以根据实际情况调整。以下是一个例子：<br><img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129171709.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129171709.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>如上图所示，下面的星期就是刻度标签</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>:<span class="literal">true</span> <span class="comment">//显示刻度标签</span></span><br><span class="line">      <span class="attr">interval</span>:<span class="number">0</span> <span class="comment">//显示刻度，同上</span></span><br><span class="line">      <span class="attr">inside</span>:<span class="literal">true</span> <span class="comment">//标签是否朝里（true朝里）</span></span><br><span class="line">      rotate：<span class="number">45</span> <span class="comment">// 标签偏移的角度</span></span><br><span class="line">      <span class="attr">margin</span>:<span class="number">5</span> <span class="comment">//标签与轴线的距离</span></span><br><span class="line">      <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; kg&#x27;</span>, <span class="comment">//刻度标签的内容格式器，支持字符串模板和回调函数两种形式。</span></span><br><span class="line">      <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span> <span class="comment">//文字水平对齐方式，默认自动。可选为：&#x27;left&#x27;,&#x27;center&#x27;,&#x27;right&#x27;</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; 元&#x27;</span>,</span><br><span class="line">      <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>标签中的formatter：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用字符串模板，模板变量为刻度默认标签 &#123;value&#125;</span></span><br><span class="line"><span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; kg&#x27;</span></span><br><span class="line"><span class="comment">// 使用函数模板，函数参数分别为刻度数值（类目），刻度的索引</span></span><br><span class="line"><span class="attr">formatter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">value, index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value + <span class="string">&#x27;kg&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多关于 formatter 的内容可以参考官方的 <a href="https://echarts.apache.org/zh/option.html#xAxis.axisLabel.formatter">API</a></p></div><h2 id="6、主题配置"><a href="#6、主题配置" class="headerlink" title="6、主题配置"></a>6、主题配置</h2><div class="story post-story"><p>在eCharts的内部，内置了两套主题，分别是亮色主题以及暗色主题<br>通过以下的方式，我们可以修改主题</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chart = echarts.init(dom, <span class="string">&#x27;light&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> chart = echarts.init(dom, <span class="string">&#x27;dark&#x27;</span>);</span><br></pre></td></tr></table></figure><p>或者我们可以通过eCharts的<a href="https://echarts.apache.org/zh/theme-builder.html">主题编辑器</a>来创建自己的主题<img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211128132725.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211128132725.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="7、数据集（dataset）"><a href="#7、数据集（dataset）" class="headerlink" title="7、数据集（dataset）"></a>7、数据集（dataset）</h2><div class="story post-story"><p>dataset 组件可以用于单独的数据集声明，从而数据可以单独管理，被多个组件复用，并且可以基于数据指定数据到视觉的映射。</p><p><strong>写法一：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataset: &#123;</span><br><span class="line">    <span class="comment">// 提供一份数据。</span></span><br><span class="line">    <span class="comment">//第一行对应的是 x 轴</span></span><br><span class="line">    <span class="attr">source</span>: [</span><br><span class="line">        [<span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;Matcha Latte&#x27;</span>, <span class="number">43.3</span>, <span class="number">85.8</span>, <span class="number">93.7</span>],</span><br><span class="line">        [<span class="string">&#x27;Milk Tea&#x27;</span>, <span class="number">83.1</span>, <span class="number">73.4</span>, <span class="number">55.1</span>],</span><br><span class="line">        [<span class="string">&#x27;Cheese Cocoa&#x27;</span>, <span class="number">86.4</span>, <span class="number">65.2</span>, <span class="number">82.5</span>],</span><br><span class="line">        [<span class="string">&#x27;Walnut Brownie&#x27;</span>, <span class="number">72.4</span>, <span class="number">53.9</span>, <span class="number">39.1</span>]</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在 dataset 中管理数据之后，就可以不用在 series 单独进行数据的声明，而是直接在 data 除进行调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明多个柱状图系列，默认情况下，每个系列会自动对应到 dataset 的每一列。</span></span><br><span class="line"><span class="attr">series</span>: [</span><br><span class="line">    &#123;<span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>写法二：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataset: &#123;</span><br><span class="line">    <span class="comment">// 这里指定了维度名的顺序，从而可以利用默认的维度到坐标轴的映射。</span></span><br><span class="line">    <span class="comment">// 如果不指定 dimensions，也可以通过指定 series.encode 完成映射，参见后文。</span></span><br><span class="line">    <span class="attr">dimensions</span>: [<span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>],</span><br><span class="line">        <span class="attr">source</span>: [</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Matcha Latte&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">43.3</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">85.8</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">93.7</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Milk Tea&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">83.1</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">73.4</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">55.1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Cheese Cocoa&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">86.4</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">65.2</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">82.5</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Walnut Brownie&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">72.4</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">53.9</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">39.1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div><h2 id="8、图例"><a href="#8、图例" class="headerlink" title="8、图例"></a>8、图例</h2><div class="story post-story"><p>图例是图表中对内容区元素的注释、用不同形状、颜色、文字等来标示不同数据列，通过点击对应数据列的标记，可以显示或隐藏该数据列。图例虽然不是图表中的主要信息、却是了解图表信息的钥匙。<br>以下是一个例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;plain&#x27;</span> <span class="comment">//图例的类型可选值：&#x27;scroll&#x27;：可滚动翻页的图例。当图例数量较多时可以使用。</span></span><br><span class="line">    <span class="comment">// Try &#x27;horizontal&#x27;</span></span><br><span class="line">    <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>, <span class="comment">//图例列表的布局朝向。可选：&#x27;horizontal&#x27;水平，&#x27;vertical&#x27;垂直</span></span><br><span class="line">    <span class="attr">right</span>: <span class="number">10</span>, <span class="comment">//图例组件离容器右侧的距离。</span></span><br><span class="line">    <span class="attr">top</span>: <span class="string">&#x27;center&#x27;</span> <span class="comment">//图例组件离容器上侧的距离。</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dataset</span>: &#123;</span><br><span class="line">    <span class="attr">source</span>: [</span><br><span class="line">      [<span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>],</span><br><span class="line">      [<span class="string">&#x27;Matcha Latte&#x27;</span>, <span class="number">43.3</span>, <span class="number">85.8</span>, <span class="number">93.7</span>],</span><br><span class="line">      [<span class="string">&#x27;Milk Tea&#x27;</span>, <span class="number">83.1</span>, <span class="number">73.4</span>, <span class="number">55.1</span>],</span><br><span class="line">      [<span class="string">&#x27;Cheese Cocoa&#x27;</span>, <span class="number">86.4</span>, <span class="number">65.2</span>, <span class="number">82.5</span>],</span><br><span class="line">      [<span class="string">&#x27;Walnut Brownie&#x27;</span>, <span class="number">72.4</span>, <span class="number">53.9</span>, <span class="number">39.1</span>]</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">xAxis</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">series</span>: [&#123; <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, &#123; <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, &#123; <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span> &#125;]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>显示内容如下：<img src="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129173307.png" class="lazyload" data-srcset="https://fastly.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129173307.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>更多内容参考官方 <a href="https://echarts.apache.org/zh/option.html#legend">API</a></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="前端" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="eCharts" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/eCharts/"/>
    
    
    <category term="前端" scheme="http://cyc0819.top/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="eCharts" scheme="http://cyc0819.top/tags/eCharts/"/>
    
  </entry>
  
  <entry>
    <title>SpringSecurity+JWT实现的登录认证</title>
    <link href="http://cyc0819.top/2021/11/20/2021-11-20-SpringSecurity+JWT%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/"/>
    <id>http://cyc0819.top/2021/11/20/2021-11-20-SpringSecurity+JWT%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/</id>
    <published>2021-11-20T01:39:55.000Z</published>
    <updated>2022-03-09T15:08:54.986Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringSecurity-JWT实现的登录认证"><a href="#SpringSecurity-JWT实现的登录认证" class="headerlink" title="SpringSecurity+JWT实现的登录认证"></a>SpringSecurity+JWT实现的登录认证</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><div class="story post-story"><ol><li><p>Spring Security<br>在 Web 编程开发中，登录安全往往也是很重要的一个部分，而 Spring Security 所做得就是这个工作。在 java 领域，成熟的安全框架解决方案一般有 Apache Shiro、Spring Security 等两种技术选型。Apache Shiro 简单易用也算是一大优势，但其功能还是远不如 Spring Security 强大。后者可以为应用提供声明式的安全访问限制，他提供了一系列的可以由开发者主动配置的 bean ，并利用 Spring IoC和 AOP等功能特性来为应用系统提供声明式的安全访问控制功能，减少了诸多重复工作。</p></li><li><p>JWT<br>JWT 的全称是：Json Web Token 。是在网路应用中传递信息的一种基于 json 的开发标准，可用于作为 json 对象在不同系统之间进行安全地信息传输。主要使用场景一般是用来在身份提供者和服务提供者间传递被认证的用户身份信息。</p></li></ol></div><h2 id="2、设计登录认证所用的表"><a href="#2、设计登录认证所用的表" class="headerlink" title="2、设计登录认证所用的表"></a>2、设计登录认证所用的表</h2><div class="story post-story"><p>本次登录认证需要用到三个表，分别是用户表，身份表以及用户和身份绑定的表。``</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for hibernate_sequence</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `hibernate_sequence`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `hibernate_sequence`  (</span><br><span class="line">  `next_val` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE <span class="operator">=</span> MyISAM AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Fixed;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of hibernate_sequence</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `hibernate_sequence` <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `hibernate_sequence` <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;ROLE_NORMAL&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_roles</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `user_roles`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_roles`  (</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `roles_id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  INDEX `FKj9553ass9uctjrmh0gkqsmv0d`(`roles_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `FK55itppkw3i07do3h7qoclqd4k`(`user_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FK55itppkw3i07do3h7qoclqd4k` <span class="keyword">FOREIGN</span> KEY (`user_id`) <span class="keyword">REFERENCES</span> `users` (`id`) <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT <span class="keyword">ON</span> UPDATE RESTRICT,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FKj9553ass9uctjrmh0gkqsmv0d` <span class="keyword">FOREIGN</span> KEY (`roles_id`) <span class="keyword">REFERENCES</span> `role` (`id`) <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT <span class="keyword">ON</span> UPDATE RESTRICT</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user_roles</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_roles` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_roles` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for users</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `users`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of users</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `users` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;chenyicai&#x27;</span>, <span class="string">&#x27;$2a$10$hZG8XjmuAcuY.izAj0D7wuQIvPDdwdz.y4KcbGPI18Mri1hx1FWA6&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/11/20/IqIxJI.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqIxJI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://z3.ax1x.com/2021/11/20/IqoFeg.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqoFeg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://z3.ax1x.com/2021/11/20/IqokwQ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqokwQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="3、创建新工程并导入依赖及实体类"><a href="#3、创建新工程并导入依赖及实体类" class="headerlink" title="3、创建新工程并导入依赖及实体类"></a>3、创建新工程并导入依赖及实体类</h2><div class="story post-story"><ol><li><p>在创建一个SpringBoot工程之后我们需要引入Security和JWT必须的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在配置文件中配置数据库信息</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/jwtdemo?useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">chenyicai</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">cyc1234</span></span><br><span class="line">  <span class="attr">ackson:</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">      <span class="attr">indent_output:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8086</span></span><br><span class="line"><span class="comment">#日志级别（一般设置为INFO）</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">cn:</span></span><br><span class="line">      <span class="attr">edu:</span></span><br><span class="line">        <span class="attr">guet:</span></span><br><span class="line">          <span class="attr">mapper:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">org:</span></span><br><span class="line">    <span class="attr">springframework:</span></span><br><span class="line">      <span class="attr">security:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">cn.edu.guet.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure></li><li><p>创建用户以及身份实体类</p></li></ol><p>Users类：（省略 getset 方法）</p><p>此处所创建的 User 类继承了 Spring Security 的 UserDetails 接口，从而成为了一个符合 Security 安全的用户，即通过继承 UserDetails，即可实现 Security 中相关的安全功能。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            authorities.add( <span class="keyword">new</span> SimpleGrantedAuthority( role.getName() ) );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Role类：（省略 getset 方法）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、JWT工具类"><a href="#4、JWT工具类" class="headerlink" title="4、JWT工具类"></a>4、JWT工具类</h2><div class="story post-story"><p>该工具类主要用于对 JWT Token 进行各项操作，比如生成Token、验证Token、刷新Token 等</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtTokenUtils</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5625635588908941275L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLAIM_KEY_USERNAME = <span class="string">&quot;sub&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLAIM_KEY_CREATED = <span class="string">&quot;created&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLAIM_KEY_AUTHORITIES=<span class="string">&quot;authorities&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成token</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateToken</span><span class="params">(UserDetails userDetails)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        claims.put( CLAIM_KEY_USERNAME, userDetails.getUsername());</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, <span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> generateToken(claims);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证token</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validateToken</span><span class="params">(String token, UserDetails userDetails)</span> </span>&#123;</span><br><span class="line">        String username = getUserNameFromToken(token);</span><br><span class="line">        <span class="keyword">return</span>  !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 刷新token</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">refreshToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        Claims claims = getClaimsFromToken(token);</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED,<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> generateToken(claims);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 验证token是否失效</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTokenExpired</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        Date expireDate = getExpiredDateFromToken(token);</span><br><span class="line">        <span class="keyword">return</span> expireDate.before(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从token中获取过期时间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getExpiredDateFromToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        Claims claims = getClaimsFromToken(token);</span><br><span class="line">        <span class="keyword">return</span> claims.getExpiration();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从token中获取用户名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserNameFromToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        String username;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Claims claims = getClaimsFromToken(token);</span><br><span class="line">            username = claims.getSubject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            username = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从token中获取荷载</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Claims <span class="title">getClaimsFromToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        Claims claims = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = Jwts.parser()</span><br><span class="line">                    .setSigningKey(Const.SECRET)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 生成过期时间</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Date <span class="title">generateExpirationDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Date(System.currentTimeMillis()+Const.EXPIRATION_TIME*<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据荷载生成token</span></span><br><span class="line">    <span class="function">String <span class="title">generateToken</span><span class="params">(Map&lt;String, Object&gt; claims)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setExpiration(generateExpirationDate())</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, Const.SECRET )</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里还有一个常量类，存储了JWT的一些常量信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5天(以毫秒ms计)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRATION_TIME = <span class="number">432_000_000</span>;</span><br><span class="line">  <span class="comment">// JWT密码</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRET = <span class="string">&quot;CodeSheepSecret&quot;</span>;</span><br><span class="line">  <span class="comment">// Token前缀</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOKEN_PREFIX = <span class="string">&quot;Bearer&quot;</span>;</span><br><span class="line">  <span class="comment">// 存放Token的Header Key</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String HEADER_STRING = <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="5、Token过滤器"><a href="#5、Token过滤器" class="headerlink" title="5、Token过滤器"></a>5、Token过滤器</h2><div class="story post-story"><p>用于每次外部对接口请求时的Token处理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtils jwtTokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 确认是否能根据key拿到value</span></span><br><span class="line">        String authHeader = httpServletRequest.getHeader( Const.HEADER_STRING );</span><br><span class="line">        <span class="keyword">if</span> (authHeader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            authHeader =Const.TOKEN_PREFIX+<span class="string">&quot; &quot;</span>+httpServletRequest.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断登录用户的token不为空和是Bearer开头的</span></span><br><span class="line">        <span class="keyword">if</span> (authHeader != <span class="keyword">null</span> &amp;&amp; authHeader.startsWith( Const.TOKEN_PREFIX )) &#123;</span><br><span class="line">            <span class="comment">// 取到token</span></span><br><span class="line">            <span class="keyword">final</span> String authToken = authHeader.substring( Const.TOKEN_PREFIX.length() );</span><br><span class="line">            <span class="comment">// 从用户请求携带的token获取用户名，能取到证明token除了时间以外都合法了</span></span><br><span class="line">            String username = jwtTokenUtil.getUserNameFromToken(authToken);</span><br><span class="line">            System.out.println(username);</span><br><span class="line">            <span class="comment">// token 存在用户名但没有认证的</span></span><br><span class="line">            <span class="keyword">if</span> (username != <span class="keyword">null</span> &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                UserDetails userDetails = <span class="keyword">this</span>.userDetailsService.loadUserByUsername(username);</span><br><span class="line">                <span class="comment">// 根据userDetails验证了token是否有效（验证时间是否过期和当前用户名是否匹配）</span></span><br><span class="line">                <span class="keyword">if</span> (jwtTokenUtil.validateToken(authToken, userDetails)) &#123;</span><br><span class="line">                    <span class="comment">// 我们的token，框架是不认识的，token有效就转化构建 UsernamePasswordAuthenticationToken表示认证通过和进行相关授权</span></span><br><span class="line">                    UsernamePasswordAuthenticationToken authentication = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(</span><br><span class="line">                            userDetails, <span class="keyword">null</span>, userDetails.getAuthorities());</span><br><span class="line">                    authentication.setDetails(<span class="keyword">new</span> WebAuthenticationDetailsSource().buildDetails(</span><br><span class="line">                            httpServletRequest));</span><br><span class="line">                    <span class="comment">// 设置了认证主体，到UsernamePasswordAuthenticationFilter就不会拦截，因为你应该带有了它的token</span></span><br><span class="line">                    SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 继续执行其他过滤器</span></span><br><span class="line">        filterChain.doFilter(httpServletRequest, httpServletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="6、Service层业务操作"><a href="#6、Service层业务操作" class="headerlink" title="6、Service层业务操作"></a>6、Service层业务操作</h2><div class="story post-story"><p>主要是登录以及注册的业务</p><p>首先是AuthService接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthService</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">register</span><span class="params">( User userToAdd )</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">login</span><span class="params">( String username, String password )</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AuthServiceImpl实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthServiceImpl</span> <span class="keyword">implements</span> <span class="title">AuthService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">( String username, String password )</span> </span>&#123;</span><br><span class="line">        UsernamePasswordAuthenticationToken upToken = <span class="keyword">new</span> UsernamePasswordAuthenticationToken( username, password );</span><br><span class="line">        <span class="keyword">final</span> Authentication authentication = authenticationManager.authenticate(upToken);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        <span class="keyword">final</span> UserDetails userDetails = userDetailsService.loadUserByUsername( username );</span><br><span class="line">        <span class="keyword">final</span> String token = jwtTokenUtil.generateToken(userDetails);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">register</span><span class="params">( User userToAdd )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String username = userToAdd.getUsername();</span><br><span class="line">        <span class="keyword">if</span>( userRepository.findByUsername(username)!=<span class="keyword">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        BCryptPasswordEncoder encoder = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">        <span class="keyword">final</span> String rawPassword = userToAdd.getPassword();</span><br><span class="line">        userToAdd.setPassword( encoder.encode(rawPassword) );</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(userToAdd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是 UserService 实现类，它实现了 UserDetailsService，可用于在登录认证时检验用户的身份</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userMapper.findByUsername(s);</span><br><span class="line">        List&lt;Role&gt; roleList =userMapper.findRoleByUsername(s);</span><br><span class="line">        user.setRoles(roleList);</span><br><span class="line">        System.out.println(user.getId());</span><br><span class="line">        System.out.println(user.getUsername());</span><br><span class="line">        System.out.println(user.getPassword());</span><br><span class="line">        System.out.println(user.getAuthorities());</span><br><span class="line">        System.out.println(user.getRoles());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="7、Spring-Security配置类编写"><a href="#7、Spring-Security配置类编写" class="headerlink" title="7、Spring Security配置类编写"></a>7、Spring Security配置类编写</h2><div class="story post-story"><p>这是比较重要的一点，这里决定了拦截的页面以及其他的一些操作。这是一个高度综合的配置类，主要是通过重写 WebSecurityConfigurerAdapter 的部分 configure 配置，来实现用户自定义的部分。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled=true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JwtFilter <span class="title">authenticationTokenFilterBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">( AuthenticationManagerBuilder auth )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.userDetailsService( userService ).passwordEncoder( <span class="keyword">new</span> BCryptPasswordEncoder() );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">( HttpSecurity httpSecurity )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        httpSecurity.csrf().disable()</span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS).and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(HttpMethod.OPTIONS, <span class="string">&quot;/**&quot;</span>).permitAll() <span class="comment">// OPTIONS请求全部放行</span></span><br><span class="line">                .antMatchers(HttpMethod.POST, <span class="string">&quot;/authentication/**&quot;</span>).permitAll()  <span class="comment">//登录和注册的接口放行，其他接口全部接受验证</span></span><br><span class="line">                .antMatchers(HttpMethod.POST).authenticated()</span><br><span class="line">                .antMatchers(HttpMethod.PUT).authenticated()</span><br><span class="line">                .antMatchers(HttpMethod.DELETE).authenticated()</span><br><span class="line">                .antMatchers(HttpMethod.GET).authenticated();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用前文自定义的 Token过滤器</span></span><br><span class="line">        httpSecurity</span><br><span class="line">                .addFilterBefore(authenticationTokenFilterBean(), UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">        httpSecurity.headers().cacheControl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="8、接下来编写Controller类进行测试"><a href="#8、接下来编写Controller类进行测试" class="headerlink" title="8、接下来编写Controller类进行测试"></a>8、接下来编写Controller类进行测试</h2><div class="story post-story"><p>首先是登陆注册的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtAuthController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthService authService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/authentication/login&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createToken</span><span class="params">( String username,String password )</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authService.login( username, password );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/authentication/register&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">register</span><span class="params">( <span class="meta">@RequestBody</span> User addedUser )</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authService.register(addedUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是测试权限的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试普通权限</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;ROLE_NORMAL&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping( value=&quot;/normal/test&quot;, method = RequestMethod.GET )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ROLE_NORMAL /normal/test接口调用成功！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试管理员权限</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;ROLE_ADMIN&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping( value = &quot;/admin/test&quot;, method = RequestMethod.GET )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ROLE_ADMIN /admin/test接口调用成功！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="9、现在我们进行测试"><a href="#9、现在我们进行测试" class="headerlink" title="9、现在我们进行测试"></a>9、现在我们进行测试</h2><div class="story post-story"><ol><li><p>首先测试能否正常登录并获取到Token<img src="https://z3.ax1x.com/2021/11/20/IqbGDK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqbGDK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以看到在账号密码正确的情况下，能返回一个Token，接下来只要访问网页时带上这个Token，就可以顺利进行访问</p></li><li><p>接下来测试能否正常访问网页<br>首先是不带Token的情况：<br><img src="https://z3.ax1x.com/2021/11/20/IqbOPJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqbOPJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>很明显，被拒绝访问了。<br>接下来我们测试一下携带Token的情况：<br><img src="https://z3.ax1x.com/2021/11/20/IqxMd0.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqxMd0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以成功访问。</p></li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="权限管理" scheme="http://cyc0819.top/categories/java/%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/"/>
    
    <category term="SpringSecurity" scheme="http://cyc0819.top/categories/java/SpringSecurity/"/>
    
    <category term="JWT" scheme="http://cyc0819.top/categories/java/JWT/"/>
    
    
    <category term="SpringSecurity" scheme="http://cyc0819.top/tags/SpringSecurity/"/>
    
    <category term="JWT" scheme="http://cyc0819.top/tags/JWT/"/>
    
  </entry>
  
</feed>
