<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>George&#39;s Blog</title>
  
  <subtitle>让我来给你讲讲他的传奇故事吧</subtitle>
  <link href="http://cyc0819.top/atom.xml" rel="self"/>
  
  <link href="http://cyc0819.top/"/>
  <updated>2022-03-06T12:40:03.671Z</updated>
  <id>http://cyc0819.top/</id>
  
  <author>
    <name>George Chan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>给个人网站加上邮箱通知</title>
    <link href="http://cyc0819.top/2022/03/06/2022-03-06-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E9%82%AE%E7%AE%B1%E9%80%9A%E7%9F%A5/"/>
    <id>http://cyc0819.top/2022/03/06/2022-03-06-%E7%BB%99%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99%E5%8A%A0%E4%B8%8A%E9%82%AE%E7%AE%B1%E9%80%9A%E7%9F%A5/</id>
    <published>2022-03-06T10:53:20.000Z</published>
    <updated>2022-03-06T12:40:03.671Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="给个人网站加上邮箱通知"><a href="#给个人网站加上邮箱通知" class="headerlink" title="给个人网站加上邮箱通知"></a>给个人网站加上邮箱通知</h1><h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><div class="story post-story"><p>一般在网站上实现邮箱通知有多种方式，原先我所使用的是<code>mailto:chenyc2021@qq.com</code>的方式，这种方式可以直接调用设备上的邮箱发送邮件，但是这样子就容易被发件人不小心修改邮箱信息，而且如果发件人的设备上没有邮箱设备，可能就无法使用这个功能了，所以本次我更新了网站中的邮件发送功能，优化用户体验。</p><p>原先的发送邮件方式：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190513.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190513.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>现如今改成使用 <a href="https://commons.apache.org/proper/commons-email/">commons-email</a> 来发送邮箱，配合前端的表单，实现邮件发送。<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190750.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306190750.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、前端部分"><a href="#2、前端部分" class="headerlink" title="2、前端部分"></a>2、前端部分</h2><div class="story post-story"><p>首先编写前端表单界面，我这里所使用的是点击按钮弹出弹框的形式进行填写，然后使用 axios 将数据传送到后端。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;Formail&quot; v-if=&quot;isAd==0&quot;&gt;</span><br><span class="line">    &lt;!--&lt;a href=&quot;mailto:chenyc2021@qq.com?subject=广告招标&amp;body=广告商家：初步报价：其他联系方式：&quot;&gt;联系管理员&lt;/a&gt;--&gt;</span><br><span class="line">    &lt;el-button type=&quot;success&quot; @click=&quot;dialogVisible = true&quot;&gt;联系管理员&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">        v-model=&quot;dialogVisible&quot;</span><br><span class="line">        title=&quot;您的广告内容&quot;</span><br><span class="line">        width=&quot;30%&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;广告标题：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.title&quot; placeholder=&quot;广告标题&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;广告内容：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.text&quot; autosize type=&quot;textarea&quot; placeholder=&quot;广告内容&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;广告报价：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.money&quot; placeholder=&quot;广告报价&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;显示日期：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.times&quot; placeholder=&quot;显示日期&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;联系方式：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.phone&quot; placeholder=&quot;联系方式&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div style=&quot;padding-top: 5px&quot;&gt;</span><br><span class="line">          &lt;span style=&quot;size: 18px;font-weight: bold&quot;&gt;您的邮箱：&lt;/span&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;input.email&quot; placeholder=&quot;您的邮箱&quot; style=&quot;width: 80%&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;template #footer&gt;</span><br><span class="line">      &lt;span class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;buyEmail&quot;&gt;发送&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">      &lt;/template&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure><p>所显示的效果如下图所示：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306202634.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306202634.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>随后是 axios 部分，将表单的数据传送给后端。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buyEmail = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      proxy.$axios.get(<span class="string">&#x27;ad/buy&#x27;</span>,&#123;<span class="attr">params</span>:&#123;<span class="string">&quot;title&quot;</span>:data.input.title,</span><br><span class="line">          <span class="string">&quot;text&quot;</span>:data.input.text,</span><br><span class="line">          <span class="string">&quot;money&quot;</span>:data.input.money,</span><br><span class="line">          <span class="string">&quot;time&quot;</span>:data.input.times,</span><br><span class="line">          <span class="string">&quot;phone&quot;</span>:data.input.phone,</span><br><span class="line">          <span class="string">&quot;buyemail&quot;</span>:data.input.email&#125;</span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        ElMessage(&#123;</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&#x27;邮件发送成功，请等待工作人员回复.&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      data.dialogVisible = <span class="literal">false</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>发送邮件之后，会反馈信息，提高用户体验。</p></div><h2 id="3、后端"><a href="#3、后端" class="headerlink" title="3、后端"></a>3、后端</h2><div class="story post-story"><p>现在就是重要的后端部分了。</p><h3 id="3-1、引入依赖"><a href="#3-1、引入依赖" class="headerlink" title="3.1、引入依赖"></a>3.1、引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-email<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2、控制器类"><a href="#3-2、控制器类" class="headerlink" title="3.2、控制器类"></a>3.2、控制器类</h3><p>编写一个控制器类，接收前端传来的数据，并在此处做邮件的发送工作。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/buy&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">buyAd</span><span class="params">(String title,String text,String money,String time,String phone,String buyemail)</span> <span class="keyword">throws</span> EmailException, MalformedURLException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建邮件</span></span><br><span class="line">    HtmlEmail email = <span class="keyword">new</span> HtmlEmail();</span><br><span class="line">    <span class="comment">// 邮箱主机，可以是域名也可以是IP地址</span></span><br><span class="line">    email.setHostName(<span class="string">&quot;smtp.qq.com&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置使用安全链接</span></span><br><span class="line">    email.setSSLOnConnect(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// QQ邮箱默认的端口是465</span></span><br><span class="line">    email.setSslSmtpPort(<span class="string">&quot;465&quot;</span>);</span><br><span class="line">    <span class="comment">// 有中文的话需要设置编码，不然会乱码</span></span><br><span class="line">    email.setCharset(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置你的邮箱名与生成的授权码</span></span><br><span class="line">    email.setAuthentication(<span class="string">&quot;chenyc2021@qq.com&quot;</span>, <span class="string">&quot;cqyruivpditnebhc&quot;</span>);</span><br><span class="line">    <span class="comment">// 发件人信息，收件人收到邮件时看到的收件人姓名</span></span><br><span class="line">    email.setFrom(buyemail, title);</span><br><span class="line">    <span class="comment">// 标题</span></span><br><span class="line">    email.setSubject(title);</span><br><span class="line">    <span class="comment">// 内容</span></span><br><span class="line">    StringBuilder sb=<span class="keyword">new</span> StringBuilder();</span><br><span class="line">    sb.append(<span class="string">&quot;广告内容：&quot;</span>).append(text).append(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    .append(<span class="string">&quot;广告报价：&quot;</span>).append(money).append(<span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">    .append(<span class="string">&quot;联系方式：&quot;</span>).append(phone).append(<span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">    .append(<span class="string">&quot;上架时间&quot;</span>).append(time);</span><br><span class="line">    email.setHtmlMsg(sb.toString());</span><br><span class="line"></span><br><span class="line">    email.addTo(<span class="string">&quot;chenyc2021@qq.com&quot;</span>);</span><br><span class="line">    <span class="comment">//发送邮件</span></span><br><span class="line">    email.send();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的代码就是发送邮件所需要的最基础的代码了。除此之外还有很多方法可供我们使用，如果只是实现简单地发送，只要上面地简短代码即可。</p><p>这里有一个邮箱的授权码，我以QQ邮箱为例子。</p><ol><li>首先打开设置中的账户<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203509.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203509.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>然后打开 POP3/SMTP服务，然后会有一个生成授权码的按钮，点击认证即可生成，然后及时复制到本地。<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203652.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220306203652.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="博客" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="个人网站" scheme="http://cyc0819.top/categories/%E5%8D%9A%E5%AE%A2/%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/"/>
    
    
    <category term="记录" scheme="http://cyc0819.top/tags/%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Java反射机制</title>
    <link href="http://cyc0819.top/2022/03/04/2022-03-04-Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"/>
    <id>http://cyc0819.top/2022/03/04/2022-03-04-Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/</id>
    <published>2022-03-04T12:19:20.000Z</published>
    <updated>2022-03-04T05:19:49.584Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Java反射机制"><a href="#Java反射机制" class="headerlink" title="Java反射机制"></a>Java反射机制</h1><h2 id="1、反射是什么"><a href="#1、反射是什么" class="headerlink" title="1、反射是什么?"></a>1、反射是什么?</h2><div class="story post-story"><p>Java反射机制（Java Reflection）是Java语言中一种动态（运行时）访问、检测以及修改它本身的能力。主要作用是动态获取类完整的结构信息和调用对象的方法。</p><p><strong>正射和反射的区别：</strong><br>一般情况下，我们使用某个类，都会知道这个类，以及要用它来做什么，可以直接通过 new 实例化创建对象，然后使用这个对象对类进行操作，这个就属于正射。<br>而反射则是不知道要初始化的是什么类，无法使用 new 来实例化创建对象，主要通过 JDK 提供的反射 API 来实现，在运行时才知道要操作的是什么类，并且可以获取到类的完整构造以及调用对应的方法，这就是反射。</p><p><strong>举例：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">//一、正射调用过程</span></span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setId(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;正射调用过程Student id:&quot;</span> + student.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//二、反射调用过程</span></span><br><span class="line">        Class clazz = Class.forName(<span class="string">&quot;com.justin.java.lang.Student&quot;</span>);</span><br><span class="line">        Constructor studentConstructor = clazz.getConstructor();</span><br><span class="line">        Object studentObj = studentConstructor.newInstance();</span><br><span class="line">        </span><br><span class="line">        Method setIdMethod = clazz.getMethod(<span class="string">&quot;setId&quot;</span>, <span class="keyword">int</span>.class);</span><br><span class="line">        setIdMethod.invoke(studentObj, <span class="number">2</span>);</span><br><span class="line">        Method getIdMethod = clazz.getMethod(<span class="string">&quot;getId&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;正射调用过程Student id:&quot;</span> + getIdMethod.invoke(studentObj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220304122334.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220304122334.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、反射获取-Class-的三种方式"><a href="#2、反射获取-Class-的三种方式" class="headerlink" title="2、反射获取 Class 的三种方式"></a>2、反射获取 Class 的三种方式</h2><div class="story post-story"><p>在 Java 中，反射获取 Class 有三种方式，这三种方式各有各的优点。<br>以下是三种获取 Class 的方式：</p><ol><li>通过 <code>类名.class</code>来获取。</li><li>通过<code>Class.forName(&quot;类的全局路径&quot;)</code>来获取。</li><li>通过<code>new 类名().getClass()</code>来获取。</li></ol><p>使用第一种方式获取 Class，JVM 会使用 ClassLoader 类加载器将类加载到内存中，但并不会做任何类的初始化工作，返回 java.lang.Class 对象。<br>使用第二种方式获取 Class，类会被 JVM 加载到内存中，并且会进行类的静态初始化工作，返回 java.lang.Class 对象。<br>第三种获取 Class 的方式，它使用了 new 进行实例化操作，因此静态初始化和非静态初始化工作都会进行，getClass 方法属于顶级 Object 类中的方法，任何子类对象都可以调用，哪个子类调用，就返回那个子类的 java.lang.Class 对象。</p></div><h2 id="3、反射的优缺点"><a href="#3、反射的优缺点" class="headerlink" title="3、反射的优缺点"></a>3、反射的优缺点</h2><div class="story post-story"><p><strong>优点:</strong><br>在运行时获得类的各种内容，进行反编译，对于Java这种先编译再运行的语言，能够让我们很方便的创建灵活的代码，这些代码可以在运行时装配，无需在组件之间进行源代码的链接，更加容易实现面向对象。</p><p><strong>缺点:</strong><br>（1）反射会消耗一定的系统资源，因此，如果不需要动态地创建一个对象，那么就不需要用反射；<br>（2）反射调用方法时可以忽略权限检查，因此可能会破坏封装性而导致安全问题。</p></div><h2 id="4、方法的反射"><a href="#4、方法的反射" class="headerlink" title="4、方法的反射"></a>4、方法的反射</h2><div class="story post-story"><p><strong>步骤思路：</strong><br>1.获取该类的类类型<br>2.通过类类型获取类的方法（getMethods()）<br>3.循环遍历所获取到的方法<br>4.通过这些方法的getReturnType()得到返回值类型的类类型，又通过该类类型得到返回值类型的名字<br>5.getName()得到方法的名称，getParameterTypes()获取这个方法里面的参数类型的类类型。</p><p><strong>实例：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassMethodMessage</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        <span class="comment">//想要获取类的信息,首先我们要获取类的类类型</span></span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">        <span class="comment">//Object类是一切类的父类，所以我们传递的是哪个子类的对象，c就是该子类的类类型。</span></span><br><span class="line">        <span class="comment">//然后获取类的名称</span></span><br><span class="line">        System.out.println(<span class="string">&quot;类的名称是:&quot;</span>+c.getName());</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *既然方法也是对象，那么是谁的对象呢？</span></span><br><span class="line"><span class="comment">        * 在java里面，方法是Method类的对象</span></span><br><span class="line"><span class="comment">        *一个成员方法就是一个Method的对象，那么Method就封装了对这个成员</span></span><br><span class="line"><span class="comment">        *方法的操作</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//如果我们要获得所有的方法，可以用getMethods()方法，这个方法获取的是所有的Public的函数，包括父类继承而来的。如果我们要获取所有该类自己声明的方法，就可以用getDeclaredMethods()方法，这个方法是不问访问权限的。</span></span><br><span class="line">        Method[] ms = c.getMethods();<span class="comment">//c.getDeclaredMethods()</span></span><br><span class="line">        <span class="comment">//接下来我们拿到这些方法之后干什么？我们就可以获取这些方法的信息，比如方法的名字。</span></span><br><span class="line">        <span class="comment">//首先我们要循环遍历这些方法</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ms.length;i++)&#123;</span><br><span class="line">            <span class="comment">//然后可以得到方法的返回值类型的类类型</span></span><br><span class="line">            Class returnType = ms[i].getReturnType();</span><br><span class="line">            <span class="comment">//得到方法的返回值类型的名字</span></span><br><span class="line">            System.out.print(returnType.getName()+<span class="string">&quot; &quot;</span>);</span><br><span class="line">            <span class="comment">//得到方法的名称</span></span><br><span class="line">            System.out.print(ms[i].getName()+<span class="string">&quot;(&quot;</span>);</span><br><span class="line">            <span class="comment">//获取参数类型---&gt;得到的是参数列表的类型的类类型</span></span><br><span class="line">            Class[] paramTypes = ms[i].getParameterTypes();</span><br><span class="line">            <span class="keyword">for</span> (Class class1 : paramTypes) &#123;</span><br><span class="line">            System.out.print(class1.getName()+<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、成员变量的反射"><a href="#5、成员变量的反射" class="headerlink" title="5、成员变量的反射"></a>5、成员变量的反射</h2><div class="story post-story"><p>成员变量也是对象，是java.lang.reflect.Field类的对象，那么也就是说Field类封装了关于成员变量的操作。既然它封装了成员变量，我们又该如何获取这些成员变量呢？它有这么一个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFieldMessage</span><span class="params">(Object obj)</span></span>&#123;</span><br><span class="line">        Class c = obj.getClass();</span><br><span class="line">        Field[] fs = c.getFields();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的getFields()方法获取的所有的public的成员变量的信息。和方法的反射那里public的成员变量，也有一个获取所有自己声明的成员变量的信息：<code>Field[] fs = c.getDeclaredFields();</code><br>我们得到它之后，可以进行遍历（既然封装了Field的信息，那么我们就可以得到Field类型）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Field field : fs) &#123;</span><br><span class="line">    <span class="comment">//得到成员变量的类型的类类型</span></span><br><span class="line">    Class fieldType = field.getType();</span><br><span class="line">    String typeName = fieldType.getName();</span><br><span class="line">    <span class="comment">//得到成员变量的名称</span></span><br><span class="line">    String fieldName = field.getName();</span><br><span class="line">    System.out.println(typeName+<span class="string">&quot; &quot;</span>+fieldName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="6、Class类的动态加载类"><a href="#6、Class类的动态加载类" class="headerlink" title="6、Class类的动态加载类"></a>6、Class类的动态加载类</h2><div class="story post-story"><p>动态加载是啥意思？怎么样动态加载一个类呢？<br>首先我们需要明白的是，动态加载和静态加载的概念以及区别。<br>我们一般所理解的，在编译的时候所加载的类是静态加载类；而运行的时候加载的类是动态加载类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Class A&#123;</span><br><span class="line">    <span class="function">Public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;B&quot;</span>.equal(args[<span class="number">0</span>]))&#123;</span><br><span class="line">            B b=<span class="keyword">new</span> B();</span><br><span class="line">            b.start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;C&quot;</span>.equal(args[<span class="number">0</span>]))&#123;</span><br><span class="line">            C c=<span class="keyword">new</span> C();</span><br><span class="line">            C.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面这一段代码，如果我们仅仅是在 IDEA 之中运行，是可以正常运行不发生错误的，而如果我们在 CMD 控制台运行的话，就会抛出问题。如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">A.java：7：错误：找不到符号</span><br><span class="line">B b=new B();</span><br><span class="line">符号:  类B</span><br><span class="line">位置： 类A</span><br><span class="line">A.java：7：错误：找不到符号</span><br><span class="line">B b=new B();</span><br><span class="line">符号:  类B</span><br><span class="line">位置： 类A</span><br><span class="line">A.java：12：错误：找不到符号</span><br><span class="line">C c=new C();</span><br><span class="line">符号:  类C</span><br><span class="line">位置： 类A</span><br><span class="line">A.java：12：错误：找不到符号</span><br><span class="line">C c=new C();</span><br><span class="line">符号:  类C</span><br><span class="line">位置： 类A</span><br><span class="line">4个错误</span><br></pre></td></tr></table></figure><p>此时，因为B不存在，就应该是错误的。<br>但是，仔细想想，会发现B我们不一定使用，C我们也不一定使用。<br>现在我们来模拟一下B存在的情况。<br>也就是先编译B，然后再编译A。<br>但是此时还是有问题，C也是不存在的。<br>但是我们现在根本就不想用C，我们只想用B，那怎么办？<br>想要正常使用B，我们就不得不将C一起编译。而如果有ABCDEFGHIJKLMN个类，我们同样只想用B，那么我们是不是同样得全部编译他们呢？答案是肯定的。这样子肯定不是很好的。<br>以上这种说法就是所谓的静态加载类。<br>而解决这个问题的方法也很简单，就是改为动态加载类。即要使用的时候再创建。</p><p>我们新建一个类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Class All&#123;</span><br><span class="line">    <span class="function">Public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">            Class cl= Class.forName(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="comment">//通过类类型，创建该类的对象</span></span><br><span class="line">            cl.newInstance();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Class.forName(“类的全称”)，它不仅仅表示了类的类类型，还表示了动态加载类。当我们javac A.ava的时候，它不会报任何错误，也就是说在编译的时候是没有错误的。只有当我们具体用某个类的时候，那个类不存在，它才会报错。</p><p>如果我们要加载B，那么就需要：<code>B bt = (B) cl.newInstance();</code><br>加载C，就是：<code>C ct = (C) cl.newInstance();</code><br>DEFG等等都是这样。</p><p>但是如果有一百各类，我们不可能写一百句这个，太冗余了。<br>我们可以写一个统一处理的方法，统一一个标准，只要满足这个标准的都可以使用这个方法。<br><code>and s = (Stand) cl.newInstance();</code></p><p>例如B类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class B implements Stand&#123;</span><br><span class="line">    <span class="function">Public <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.print(<span class="string">&quot;B...satrt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即满足了前面的标准。就可以通过这个统一的标准来运行。</p><p>如果以后想用某一个类，不需要重新编译，只需要实现这个标准的接口即可。只需要动态的加载新的东西就行了。<br>这就是<strong>动态加载类</strong>。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="反射" scheme="http://cyc0819.top/categories/java/%E5%8F%8D%E5%B0%84/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>自定义注解</title>
    <link href="http://cyc0819.top/2022/02/09/2022-02-09-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/"/>
    <id>http://cyc0819.top/2022/02/09/2022-02-09-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3/</id>
    <published>2022-02-09T13:38:33.000Z</published>
    <updated>2022-02-10T04:13:05.384Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h1><h2 id="1、注解"><a href="#1、注解" class="headerlink" title="1、注解"></a>1、注解</h2><div class="story post-story"><p>注解是 java 这一门编程语言中很重要的一个知识点，利用注解，我们可以很方便实现很多功能。<br>它可以用于创建文档，跟踪代码中的依赖性，甚至执行基本编译时检查。<br>注解不会影响代码的正常运行，他与我们的代码处于两个时空中，但是注解和我们的代码又在某些方面相互影响。<br>java 中，所有的注解都继承了 Annotation 接口。<br>java 中，已经预定义了很多注解，以方便我们的使用，我们可以在编程过程中直接对这些注解进行调用，实现我们所需要的功能。<br>以下列出了一些平时会用到的注解：</p><h3 id="1-1、基础注解"><a href="#1-1、基础注解" class="headerlink" title="1.1、基础注解"></a>1.1、基础注解</h3><p><code>@Override</code>:<br>表示该方法是重写的方法。<br><code>@Deprecated</code>:<br>表示该方法是过时的方法，我们在一些旧版本的 API 文档中警方会看到这个注解。</p><h3 id="1-2、元注解"><a href="#1-2、元注解" class="headerlink" title="1.2、元注解"></a>1.2、元注解</h3><p>在我们自定义注解的过程中，就会使用到这些元注解，它可以帮助我们构建自己的自定义注解，就是用在注解中的注解。</p><p><code>@Target</code>:<br>表示该注解可以被放在哪个位置。<br>它的参数类型如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ElementType.TYPE：能修饰类、接口或枚举类型</span><br><span class="line">ElementType.FIELD：能修饰成员变量</span><br><span class="line">ElementType.METHOD：能修饰方法</span><br><span class="line">ElementType.PARAMETER：能修饰参数</span><br><span class="line">ElementType.CONSTRUCTOR：能修饰构造器</span><br><span class="line">ElementType.LOCAL_VARIABLE：能修饰局部变量</span><br><span class="line">ElementType.ANNOTATION_TYPE：能修饰注解</span><br><span class="line">ElementType.PACKAGE：能修饰包</span><br></pre></td></tr></table></figure><p><code>@Retention</code>:<br>用于声明生命周期。<br>参数类型如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RetentionPolicy.SOURCE：源码阶段</span><br><span class="line">RetentionPolicy.CLASS： 编译阶段</span><br><span class="line">RetentionPolicy.RUNTIME：运行阶段</span><br></pre></td></tr></table></figure><p><code>@Inherited</code>:<br>表示注解可以被子类继承。即子类继承父类以后，也可以继承父类的注解。</p><p><code>@Documented</code>:<br>表示生成 API 。</p><p><code>@Repeatable</code>:<br>表示注解在同一个地方可以出现多次，如果不加这个注解的话，同一个地方注解只能出现一次。</p></div><h2 id="2、自定义注解"><a href="#2、自定义注解" class="headerlink" title="2、自定义注解"></a>2、自定义注解</h2><div class="story post-story"><p>对于自定义注解，说起来其实十分简单，用<code>@interface</code>修饰一个我们所创建的“类”，然后再加上我们需要的一些元注解，就可以实现一个自定义注解了。</p><p>对于创建的自定义注解，我们需要考虑以下几个问题：</p><ol><li>注解用在什么地方？</li><li>注解什么时候使用？</li><li>注解想要实现什么功能？</li></ol><p>在考虑好上面的这些问题之后，通过合理使用元注解，我们就能解决以上的一些问题。<br>可以说自定义注解和元注解之间的关系密不可分！就比如说盖楼时我们必须打地基一样。</p><p>自定义注解可以有很多种形式，以下是几个自定义注解的例子。</p><h3 id="2-1、自定义注解可以存放变量"><a href="#2-1、自定义注解可以存放变量" class="headerlink" title="2.1、自定义注解可以存放变量"></a>2.1、自定义注解可以存放变量</h3><p>首先我们创建一个以下的自定义注解：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209224224.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209224224.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>可以看出来，这个自定义注解中有三个变量，分别是<code>id</code>，<code>name</code>，<code>age</code>。<br>别处通过注解，可以很方便的使用它们。</p><p>当我们创建一个类，标上这个注解的时候，他会提示我们所需要的三个变量：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209225911.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209225911.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>此时我们输入所需元素：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230104.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230104.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果我们想拿到注解中我们设置好的结果，通过以下的方法即可拿到：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230840.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220209230840.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-2、自定义注解实现某个功能"><a href="#2-2、自定义注解实现某个功能" class="headerlink" title="2.2、自定义注解实现某个功能"></a>2.2、自定义注解实现某个功能</h3><p>上面的用法通常不太常见，我们更多所见到的，是通过注解来实现某个功能，所以下面就是一个这样的例子。</p><p>因为参数校验是位于业务逻辑执行执行，可以考虑将其拆分。<br>所以这个注解可以简单实现检验一个参数是否为空等检验功能。<br>由于并不是所有的方法，都需要校验(某些方法允许空参数)，所以考虑使用自定义注解，让开发者进行灵活控制。</p><p>首先创建以下的一个注解：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112425.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112425.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后是注解用于检验的类<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112726.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112726.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后在需要验证的字段上添加上这个注解<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112920.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210112920.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>最后创建一个控制器类，来检验我们的代码<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113128.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113128.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当我们标注的 name 字段有值的时候，可以正常返回信息<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113421.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113421.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>而当值为空的时候，则会出现错误，后台会提示具体的错误信息<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113505.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210113505.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210114008.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20220210114008.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以上就是一个验证字段是否为空的自定义注解的例子。</p></div><h2 id="3、附录"><a href="#3、附录" class="headerlink" title="3、附录"></a>3、附录</h2><div class="story post-story"><p><code>testInt1</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> test2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> demo1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/9 21:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> testInt1 &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>l1</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> test2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> demo1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/2/9 22:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@testInt1(id = 1,name = &quot;chenyicai&quot;,age = 22)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">l1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        testInt1 testInt1=l1.class.getAnnotation(demo1.testInt1.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(testInt1.id());</span><br><span class="line">        System.out.println(testInt1.name());</span><br><span class="line">        System.out.println(testInt1.age());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        f1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isNotNull</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//仅仅用于请求字段的非空校验</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="comment">//需要jvm运行时使用</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//使用validator时必须添加，指定与NotNullValidator自定义校验器配合使用</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = isNotNullValidator.class)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">//@interface 代表此类是注解类</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> isNotNull &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认错误信息</span></span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> &quot;不能为空&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isNotNullValidator</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">isNotNullValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">isNotNull</span>,<span class="title">Object</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(Object o, ConstraintValidatorContext constraintValidatorContext)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//此时name是当前非空校验的字段名</span></span><br><span class="line">        String name = String.valueOf(((ConstraintValidatorContextImpl) constraintValidatorContext)</span><br><span class="line">                .getConstraintViolationCreationContexts().get(<span class="number">0</span>).getPath());</span><br><span class="line">        System.out.println(name + <span class="string">&quot; value is &quot;</span> + String.valueOf(o));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//o是字段的值，我们需要校验是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> == o ||<span class="string">&quot;&quot;</span>==o)&#123;</span><br><span class="line">            <span class="comment">// 获取到注解中message的值</span></span><br><span class="line">            System.err.println(((ConstraintValidatorContextImpl) constraintValidatorContext)</span><br><span class="line">                    .getConstraintViolationCreationContexts().get(<span class="number">0</span>).getMessage());</span><br><span class="line">            <span class="comment">//返回false代表校验失败</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回true代表校验成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Users</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@isNotNull(message = &quot;姓名不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>TestController</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">addUser</span><span class="params">(<span class="meta">@Valid</span> Users users)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;111&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="注解" scheme="http://cyc0819.top/categories/java/%E6%B3%A8%E8%A7%A3/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="注解" scheme="http://cyc0819.top/tags/%E6%B3%A8%E8%A7%A3/"/>
    
  </entry>
  
  <entry>
    <title>位运算</title>
    <link href="http://cyc0819.top/2022/02/01/2022-02-01-%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
    <id>http://cyc0819.top/2022/02/01/2022-02-01-%E4%BD%8D%E8%BF%90%E7%AE%97/</id>
    <published>2022-02-01T03:24:53.000Z</published>
    <updated>2022-02-01T06:55:00.818Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="1、位运算"><a href="#1、位运算" class="headerlink" title="1、位运算"></a>1、位运算</h1><p>程序中的所有数在计算机内存中都是以二进制的形式储存的。<br>位运算就是直接对整数在内存中的二进制位进行操作。<br>比如，and运算本来是一个逻辑运算符，但整数与整数之间也可以进行and运算。<br>举个例子，6的二进制是110，11的二进制是1011，那么6 and 11的结果就是2，它是二进制对应位进行逻辑运算的结果.<br>&amp;运算时，当且仅当两者都为 1 时，结果才为 1.<br>使用二进制来表示就是如下：<br>6  ：0 1 1 0<br>11：1 0 1 1<br>——————<br>2  ：0 0 1 0</p><p>相比于使用常规的运算符，在计算机语言中，合理使用位运算符能很好地帮助我们提高效率。</p><h2 id="2-1、位运算符"><a href="#2-1、位运算符" class="headerlink" title="2.1、位运算符"></a>2.1、位运算符</h2><div class="story post-story"><table><thead><tr><th>符号</th><th>描述</th><th>运算规则</th></tr></thead><tbody><tr><td>&amp;</td><td>与</td><td>两个位都为1时，结果才为1</td></tr><tr><td>|</td><td>或</td><td>两个位都为0时，结果才为0</td></tr><tr><td>^</td><td>异或</td><td>两个位相同为0，相异为1</td></tr><tr><td>~</td><td>非</td><td>0变1，1变0</td></tr><tr><td>&lt;&lt;</td><td>左移</td><td>各二进位全部左移若干位，高位丢弃，低位补0</td></tr><tr><td>&gt;&gt;</td><td>右移</td><td>各二进位全部右移若干位，对无符号数，高位补0，有符号数，各编译器处理方法不一样，有的补符号位（算术右移），有的补0（逻辑右移）</td></tr></tbody></table></div><h2 id="2-2、实例"><a href="#2-2、实例" class="headerlink" title="2.2、实例"></a>2.2、实例</h2><div class="story post-story"><h3 id="2-2-1、与"><a href="#2-2-1、与" class="headerlink" title="2.2.1、与"></a>2.2.1、与</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">11：1 0 1 1</span><br><span class="line">————————————</span><br><span class="line">2 ：0 0 1 0</span><br></pre></td></tr></table></figure><p>当且仅当两者都为 1 的时候，结果才为 1，所以在这里只有第三位两者都为 1 ，所以结果就是 0010。</p><h3 id="2-2-2、或"><a href="#2-2-2、或" class="headerlink" title="2.2.2、或"></a>2.2.2、或</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">11：1 0 1 1</span><br><span class="line">————————————</span><br><span class="line">15：1 1 1 1</span><br></pre></td></tr></table></figure><p>当且仅当两者都为 0 的时候，结果才为 0，所以在这里所有的结果都为 1  ，所以结果就是 1111。</p><h3 id="2-2-3、非"><a href="#2-2-3、非" class="headerlink" title="2.2.3、非"></a>2.2.3、非</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">————————————</span><br><span class="line">9 ：1 0 0 1</span><br></pre></td></tr></table></figure><p>非的规则是将 1 变成 0，0 变成 1，所以0110非操作之后就是1001，为9.</p><h3 id="2-2-4、异或"><a href="#2-2-4、异或" class="headerlink" title="2.2.4、异或"></a>2.2.4、异或</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">11：1 0 1 1</span><br><span class="line">————————————</span><br><span class="line">13：1 1 0 1</span><br></pre></td></tr></table></figure><p>异或的运算规则：0^0=0  0^1=1  1^0=1  1^1=0 相同为 0，相异为 1.</p><h3 id="2-2-5、左移和右移"><a href="#2-2-5、左移和右移" class="headerlink" title="2.2.5、左移和右移"></a>2.2.5、左移和右移</h3><p><strong>左移：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">————————————</span><br><span class="line">12：1 1 0 0</span><br></pre></td></tr></table></figure><p>左移就是将所有的 1 都左移一位，然后空位上补0，所以 6 左移一位的结果就是 12.相当于 6 乘 2 等于 12.<br><strong>右移：</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6 ：0 1 1 0</span><br><span class="line">————————————</span><br><span class="line">3 ：0 0 1 1</span><br></pre></td></tr></table></figure><p>右移就是将所有的 1 都右移一位，然后空位上补0，所以 6 右移一位的结果就是 3.相当于 6 除 2 等于 3.</p><p>从上面可以看出，如果我们在平时需要用到乘法或者除法，就可以使用左移和右移来进行替代，可以更好地提高效率。</p></div><h2 id="2-3、使用技巧"><a href="#2-3、使用技巧" class="headerlink" title="2.3、使用技巧"></a>2.3、使用技巧</h2><div class="story post-story"><h3 id="2-3-1、实现乘除法"><a href="#2-3-1、实现乘除法" class="headerlink" title="2.3.1、实现乘除法"></a>2.3.1、实现乘除法</h3><p>数 a 向右移一位，相当于将 a 除以 2；数 a 向左移一位，相当于将 a 乘以 2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int a = 2;</span><br><span class="line">a &gt;&gt; 1; ---&gt; 1</span><br><span class="line">a &lt;&lt; 1; ---&gt; 4</span><br></pre></td></tr></table></figure><h3 id="2-3-2、交换两个数"><a href="#2-3-2、交换两个数" class="headerlink" title="2.3.2、交换两个数"></a>2.3.2、交换两个数</h3><p>使用位运算交换两个数的时候，可以不使用第三个变量，虽然这个操作普通的运算也能做到，但是效率远不如位运算。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">  a = a + b;</span><br><span class="line">  b = a - b;</span><br><span class="line">  a = a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//位与操作</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b)</span> </span>&#123;</span><br><span class="line">  a ^= b;</span><br><span class="line">  b ^= a;</span><br><span class="line">  a ^= b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-3、判断奇偶数"><a href="#2-3-3、判断奇偶数" class="headerlink" title="2.3.3、判断奇偶数"></a>2.3.3、判断奇偶数</h3><p>只要根据数的最后一位是 0 还是 1 来决定即可，为 0 就是偶数，为 1 就是奇数。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="number">0</span> == (a &amp; <span class="number">1</span>)) &#123;</span><br><span class="line"> <span class="comment">//偶数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-4、交换符号"><a href="#2-3-4、交换符号" class="headerlink" title="2.3.4、交换符号"></a>2.3.4、交换符号</h3><p>交换符号将正数变成负数，负数变成正数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">reversal</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ~a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-5、求绝对值"><a href="#2-3-5、求绝对值" class="headerlink" title="2.3.5、求绝对值"></a>2.3.5、求绝对值</h3><p>整数的绝对值是其本身，负数的绝对值正好可以对其进行取反加一求得，即我们首先判断其符号位（整数右移 31 位得到 0，负数右移 31 位得到 -1,即 0xffffffff），然后根据符号进行相应的操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = a &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">return</span> i == <span class="number">0</span> ? a : (~a + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的操作可以进行优化，可以将 i == 0 的条件判断语句去掉。我们都知道符号位 i 只有两种情况，即 i = 0 为正，i = -1 为负。对于任何数与 0 异或都会保持不变，与 -1 即 0xffffffff 进行异或就相当于对此数进行取反,因此可以将上面三目元算符转换为((a^i)-i)，即整数时 a 与 0 异或得到本身，再减去 0，负数时与 0xffffffff 异或将 a 进行取反，然后在加上 1，即减去 i(i =-1)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">abs2</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i = a &gt;&gt; <span class="number">31</span>;</span><br><span class="line">  <span class="keyword">return</span> ((a^i) - i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>除此之外，还有很多用途。</p></div><h2 id="2-4、写法"><a href="#2-4、写法" class="headerlink" title="2.4、写法"></a>2.4、写法</h2><div class="story post-story"><p>和普通的运算符一样，位运算符也可以组成复合运算符的形式。<br>如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&amp;=        例：a&amp;=b    相当于     a=a&amp;b</span><br><span class="line">|=        例：a|=b    相当于     a=a|b</span><br><span class="line">&gt;&gt;=      例：a&gt;&gt;=b   相当于     a=a&gt;&gt;b</span><br><span class="line">&lt;&lt;=      例：a&lt;&lt;=b     相当于      a=a&lt;&lt;b</span><br><span class="line">^=        例：a^=b    相当于   a= a^b</span><br></pre></td></tr></table></figure></div><h2 id="2-5、算法题应用"><a href="#2-5、算法题应用" class="headerlink" title="2.5、算法题应用"></a>2.5、算法题应用</h2><div class="story post-story"><h3 id="2-5-1、只出现一次的数字"><a href="#2-5-1、只出现一次的数字" class="headerlink" title="2.5.1、只出现一次的数字"></a>2.5.1、只出现一次的数字</h3><p><strong>问题描述</strong><br>给定一个非空整数数组，除了某个元素只出现一次以外，<strong>其余每个元素均出现两次</strong>。找出那个只出现了一次的元素。<br>说明：你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p><p><strong>分析</strong></p><ol><li>0和任意数字进行异或操作结果为数字本身.</li><li>两个相同的数字进行异或的结果为0.</li></ol><p><strong>解答</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> value=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            value^=nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-2、只出现一次的数字"><a href="#2-5-2、只出现一次的数字" class="headerlink" title="2.5.2、只出现一次的数字"></a>2.5.2、只出现一次的数字</h3><p><strong>问题描述</strong><br>给定一个非空整数数组，除了某个元素只出现一次以外，<strong>其余每个元素均出现了三次</strong>。找出那个只出现了一次的元素。<br>说明：你的算法应该具有线性时间复杂度。 你可以不使用额外空间来实现吗？</p><p><strong>分析</strong><br>这题和上一题的思路略有不同，这题其他数字出现了3次，那么我们如果直接使用位运算异或操作的话无法直接找到结果，就需要巧妙的运用二进制的其他特性：判断整除求余操作。即判断所有数字二进制1的总个数和0的总个数一定有一个不是三的整数倍，如果0不是三的整数倍那么就说明结果的该位二进制数字为0，同理否则为1.<br>在具体的操作实现上，问题中给出数组中的数据在int范围之内，那么我们就可以在实现上可以对int的32个位每个位进行依次判断该位1的个数求余3后是否为1，如果为1说明结果该位二进制为1可以将结果加上去。最终得到的值即为答案。<br><strong>解答</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> value=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">32</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> num:nums)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(((num&gt;&gt;i)&amp;<span class="number">1</span>)==<span class="number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    sum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum%<span class="number">3</span>==<span class="number">1</span>)</span><br><span class="line">                value+=(<span class="number">1</span>&lt;&lt;i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>2021年终总结</title>
    <link href="http://cyc0819.top/2022/01/10/2022-01-10-2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>http://cyc0819.top/2022/01/10/2022-01-10-2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2022-01-10T13:54:53.000Z</published>
    <updated>2022-01-10T15:25:03.363Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="1、2021"><a href="#1、2021" class="headerlink" title="1、2021"></a>1、2021</h1><p>2021是崭新的一年，是疫情的第二年，也是大学生涯的第三年。</p><h2 id="1-1、编程学习"><a href="#1-1、编程学习" class="headerlink" title="1.1、编程学习"></a>1.1、编程学习</h2><div class="story post-story"><p>今年一年，是冲刺学习 java 的一年，大部分的知识都是在今年学习到的。<br>在今年，当了四个项目的组长，虽然都是简单的单体项目，但是在学习中一步一步成长的感觉还是十分舒服的。四个项目分别是：点餐系统、桂电宿舍管理系统、国医堂小程序以及骏泰理发店管理系统。<br>2月，尽管是过年时间，线上学习还是不能停。<br>6月，其他同学都放假回家了，我们留在学校加班学习，第一次不回家过暑假，看着家里的朋友在家喝茶玩耍，真是恨不得当场买票回去。但是想到以后工作之后，这将成为常态，感觉自己还是得适应，同时也感叹自己即将步入社会，也会开始怀念大学生活了。<br>暑假的加班学习是为了今后更好的就业，所以我也一直在加油。<br>8月，开发了自己的第一个博客，用的是 hexo 的框架，主要是图方便，还好看，主题多。然后博客是用 GitHubPage 搭建的，所有内容都存在GitHub上。想着这个博客里分享一些自己学到的技术，还有写一些自己的感想什么的。<br>9月，开始面试了。在面试过程中，第一家公司，也就是现在签三方的公司，面试过程都比较轻松，感觉面试官也比较看重我。后面在面试一家工资较高的公司的时候，虽然笔试成绩还算不错，但是因为学的不够深入，很多问题没有回答上来，所以就被刷下来了。<br>总结一下今年的秋招面试：有遗憾，但是也很满足了。<br>11月，想着自己有一个闲置的服务器，就想着用来做点什么，就自己开发了一个书签项目，放在服务器里面，里面存了一些自己用过的书签网站，还可以快速跳转到我的博客，还可以快速搜索，自己还异想天开弄了一个广告框，想着有人能打广告，赚点零花钱。以后还会自己开发这个项目，增加更多功能。<br>12月和好兄弟一起开发了一个真实的项目：桂林医学院报修系统！这个项目虽然是学长留下的二手项目，但是在接手项目时，从阅读源码到本地运行，从本地开发到正式上线，我真实感觉到了自己从项目中学习到了很多新的思想。一开始接手项目时，基本上是从0开始阅读源码，到现在已经可以灵活使用以及修改项目中的每一处代码，从中看到了自己的进步，同时也看到了自己和其他人的差距所在。<br>印象比较深刻的是第一次上线自己写的程序的时候，刚刚一开始上线，系统就进不去了，折腾了一个晚上还是没有解决，最后还是靠学长帮忙才得以解决（虽然后面发现其实并不是我们的锅）。<br>知道前几天，一起开发的兄弟才发现，原来是服务器jar的加密问题，具体的我也不太懂。<br>其间还跟着老师去见了一次甲方，对项目的二期需求进行一个沟通，第一次真实经历这种场面，一开始还真有点紧张，但是到后面也逐渐放松了下来这样的经验是很珍贵的，对以后的职场应对有很大的帮助。在沟通过程中甲方有些不经过脑子的需求确实很难以理解，但是在积极的沟通之下还是进行的很顺利。<br>现在项目一期也已经验收通过了，老师也说二期不用太过着急，但是还是要提上日程，尽快完成需要的项目。<br>而另一个理发店项目基本处于放羊状态，也不着急，我们就慢慢做了。</p><p>目前也在学习算法，只要算法玩的好，大厂什么的根本不是梦。</p></div><h2 id="1-2、专业学习"><a href="#1-2、专业学习" class="headerlink" title="1.2、专业学习"></a>1.2、专业学习</h2><div class="story post-story"><p>今年是毕业年级了，要考虑的不只是学习，还有自己未来的发展方向。<br>3月，现在是大三的下学期，这个学期会接触到更多的编程方面的课程，比如说：Java语言程序设计、算法分析与设计、软件工程、ACM程序设计等等。这样的课程对我来说是比较感兴趣的，相对于数学，我觉得我更适合编程，果然自己是一个科研废物。<br>7月，成绩全都出了，今年终于迎来自己第一个大满贯，没有挂科科目，继续加油，争取更好成绩！今年暑假留校，加班学习。<br>9月，正式成为一个大四狗。今年除了面对学习的压力，更多的是来自就业方面的，由于疫情的影响，大学生就业形式不容乐观，提升自己专业能力，才是使自己更有优势的唯一途径。<br>12月，又是一个大满贯，终于把所有的课程都修完了，困扰了我多年的英语也终于都通过了。接下来就是毕业论文了，我做的内容是纯理论研究，对于我这样一个科研废物来说，这样的内容无疑是要我老命，但是没办法，终究自己还是数学专业的人，只能硬着头皮做了。<br>奖项方面，今年跟同学一起拿了几个小奖项，数学建模竞赛校内三等奖、市场调查大赛校内三等奖、金融证券大赛南部赛区团队一等奖。<br>感觉专业学习方面的年终总结确实写不出啥东西，毕竟科研方面自己还是不如其他同学。。。</p><h1 id="2、年度总结"><a href="#2、年度总结" class="headerlink" title="2、年度总结"></a>2、年度总结</h1><p>年度编程语言：java<br>年度框架：Spring Boot<br>年度IDE：IntelliJ IDEA<br>年度技术社区：CSDN<br>年度学科：数学<br>年度歌手：五月天<br>年度演员：沈腾<br>年度电影：《飞驰人生》<br>年度游戏：城市天际线<br>年度社交软件：微信<br>年度音乐软件：QQ音乐<br>年度视频平台：bilibili<br>年度UP主：徐大虾<br>年度综艺：下一个是谁<br>年度动漫：某科学的超电磁炮<br>年度运动：篮球<br>年度球队：洛杉矶湖人<br>年度球星：凯尔 库兹马</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="随笔" scheme="http://cyc0819.top/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="年终总结" scheme="http://cyc0819.top/categories/%E9%9A%8F%E7%AC%94/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    
    
    <category term="随笔" scheme="http://cyc0819.top/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot发送微信模板消息</title>
    <link href="http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/"/>
    <id>http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/</id>
    <published>2021-12-10T04:54:26.000Z</published>
    <updated>2021-12-10T04:55:18.938Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringBoot发送微信模板消息"><a href="#SpringBoot发送微信模板消息" class="headerlink" title="SpringBoot发送微信模板消息"></a>SpringBoot发送微信模板消息</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>MySQL 8.0</li></ul></div><h2 id="2、工作"><a href="#2、工作" class="headerlink" title="2、工作"></a>2、工作</h2><div class="story post-story"><p>这段时间在做项目的时候，甲方要求将之前的易班消息推送更换成微信公众号模板消息推送，所以本文就是记录一下使用模板消息的过程，</p><p>开发的时候我用的是微信的<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">测试公众账号</a>，但是实际的功能和企业的账号是一样的。</p></div><h2 id="3、准备工作"><a href="#3、准备工作" class="headerlink" title="3、准备工作"></a>3、准备工作</h2><div class="story post-story"><p>首先我们要知道，<wavy>模板消息</wavy>是什么？以下就是公众号模板消息，我们在生活中很多场景都会接触到它。<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:15%;" /></p><p>在进入了测试号的管理后台之后，我们可以在这里设置我们的模板消息的<wavy>模板</wavy></p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>首先我们要在公众平台中设置好我们的模板，然后 java 中根据模板信息来添加相应的内容。</p></div><h2 id="4、java后端编写"><a href="#4、java后端编写" class="headerlink" title="4、java后端编写"></a>4、java后端编写</h2><div class="story post-story"><p>我们创建一个名为<code>WeChatNotify</code>的工具类，里面存放的是模板消息的设置内容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeChatNotify</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IDictService ds;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ParseUtil pu;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdrService js;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送模板信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">push</span><span class="params">(String openid,String map, Bxd bxd)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1，配置</span></span><br><span class="line">        WxMpInMemoryConfigStorage wxStorage = <span class="keyword">new</span> WxMpInMemoryConfigStorage();</span><br><span class="line">        wxStorage.setAppId(<span class="string">&quot;wxacc93d31c5dbd26f&quot;</span>);</span><br><span class="line">        wxStorage.setSecret(<span class="string">&quot;f8c9e82b590ac71eb12e96f77cf65740&quot;</span>);</span><br><span class="line">        WxMpService wxMpService = <span class="keyword">new</span> WxMpServiceImpl();</span><br><span class="line">        wxMpService.setWxMpConfigStorage(wxStorage);</span><br><span class="line">        <span class="comment">//2,推送消息</span></span><br><span class="line">        WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder()</span><br><span class="line">                .toUser(openid)<span class="comment">//要推送的用户openid</span></span><br><span class="line">                .templateId(<span class="string">&quot;-1pT4MrVw4asKamh0IQMF6c22Ih74dRjxqN8fwhjoQs&quot;</span>)<span class="comment">//模版id</span></span><br><span class="line">                .url(<span class="string">&quot;https://www.cyc0819.top&quot;</span>)<span class="comment">//点击模版消息要访问的网址</span></span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取保修类别</span></span><br><span class="line">        String bxlb=pu.paraseBxlb(bxd.getBxlb());</span><br><span class="line">        <span class="comment">//3,正式版发送模版消息，这里需要配置你的信息，替换微信公众号上创建的模板内容</span></span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;map&quot;</span>, map, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;type&quot;</span>,bxlb, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;text&quot;</span>, bxd.getXxdd()+bxd.getBxnr(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;time&quot;</span>, bxd.getYysj(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;name&quot;</span>, bxd.getSbr(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        templateMessage.addData(<span class="keyword">new</span> WxMpTemplateData(<span class="string">&quot;phone&quot;</span>, bxd.getSbrsj(), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;推送成功&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;推送失败：&quot;</span> + e.getMessage());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;推送失败&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查openid是否已经绑定</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">selOpenid</span><span class="params">(String ybid)</span></span>&#123;</span><br><span class="line">        String openid=js.selOpenidForYbid(ybid);</span><br><span class="line">        <span class="keyword">if</span> (openid == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> openid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，我们需要公众号的<code>appid,appsecret</code>，以及接收人的<code>openid</code>。</p><div class="note warning"><p>如何获取用户的 openid 可以看以下这篇文章。</p></div><div class="tag link"><a class="link-card" title="SpringBoot+Vue微信授权获取用户openid" href="http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">SpringBoot+Vue微信授权获取用户openid</p><p class="url">http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/</p></div></a></div><p>给足所需要的消息，然后在要发送消息的地方调用即可</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">zdpdWeChat</span><span class="params">(String eid, String bxlb,Bxd bxd)</span></span>&#123;</span><br><span class="line">    String ybid=zdpd(eid,bxlb);</span><br><span class="line">    String map=es.selxxwz(Integer.parseInt(eid));</span><br><span class="line">    <span class="comment">//调用发送模板信息</span></span><br><span class="line">    wcn.push(<span class="string">&quot;OPENID&quot;</span>,map,bxd);</span><br><span class="line">    <span class="keyword">return</span> ybid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/categories/java/SpringBoot/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot+Vue微信授权获取用户openid</title>
    <link href="http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/"/>
    <id>http://cyc0819.top/2021/12/09/2021-12-09-SpringBoot+Vue%E5%BE%AE%E4%BF%A1%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7openid/</id>
    <published>2021-12-08T16:16:46.000Z</published>
    <updated>2022-02-09T13:39:41.764Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringBoot-Vue微信授权获取用户openid"><a href="#SpringBoot-Vue微信授权获取用户openid" class="headerlink" title="SpringBoot+Vue微信授权获取用户openid"></a>SpringBoot+Vue微信授权获取用户openid</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>MySQL 8.0</li><li>Vue 3.0</li></ul></div><h2 id="2、需求"><a href="#2、需求" class="headerlink" title="2、需求"></a>2、需求</h2><div class="story post-story"><p>这几天在做桂林医学院的项目的时候，甲方提出了需求说能不能将消息通知改成微信公众号通知，因为公众号的效率比较高，同时受众也是比较多（原本用的是易班的 api，文档及其不友好，bug 官方也不解决，按照上一届学长的说法，之前发送消息接收人得等两天之后才能收到）。</p><p>而如果用到微信的公众号，必须就得接收人主动绑定自己的微信号，我们才能获取他的 openid ，才能对其发送模板消息。</p></div><h2 id="3、微信公众号模板消息"><a href="#3、微信公众号模板消息" class="headerlink" title="3、微信公众号模板消息"></a>3、微信公众号模板消息</h2><div class="story post-story"><p>开发的时候我用的是微信的<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login">测试公众账号</a>，但是实际的功能和企业的账号是一样的。</p><p>首先我们要知道，<wavy>模板消息</wavy>是什么？以下就是公众号模板消息，我们在生活中很多场景都会接触到它。<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/Screenshot_2021-12-06-23-00-46-398_com.tencent.mm.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="zoom:15%;" /></p><p>在进入了测试号的管理后台之后，我们可以在这里设置我们的模板消息的<wavy>模板</wavy></p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209002928.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当然，本文的主题并不是模板消息的发送，而是使用模板消息的时候引发的其他问题，具体的模板消息可以移步我的：</p><div class="tag link"><a class="link-card" title="SpringBoot发送微信模板消息" href="http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/"><div class="left"><img src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/logo/256/safari.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="/></div><div class="right"><p class="text">SpringBoot发送微信模板消息</p><p class="url">http://cyc0819.top/2021/12/10/2021-12-10-SpringBoot%E5%8F%91%E9%80%81%E5%BE%AE%E4%BF%A1%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/</p></div></a></div></div><h2 id="4、SpringBoot获取openid"><a href="#4、SpringBoot获取openid" class="headerlink" title="4、SpringBoot获取openid"></a>4、SpringBoot获取openid</h2><div class="story post-story"><p>openid 是微信用户的唯一标识，就跟人的身份证一样，每个微信号都有一个自己的 openid ，用于识别每个微信，一般情况下，我们无法看到，更无法修改我们的 openid，此时如果需要获取，就需要微信官方给我们提供的接口：</p><p>我们点开下图中的<span class='p blue'>蓝色</span>字体,<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以进入到<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">网页授权</a>的界面：</p><p>里面详细介绍了获取openid，甚至是用户信息的过程：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003923.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003923.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>以下是我通过 java 实现的一些过程，可供参考。</p><h3 id="4-1、用户同意授权，获取code"><a href="#4-1、用户同意授权，获取code" class="headerlink" title="4.1、用户同意授权，获取code"></a>4.1、用户同意授权，获取code</h3><p>根据官方的说法，我们需要请求一个链接来获取到用户的 CODE<br>链接如下：<br><code>https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</code></p><p>这里有几个参数，官方文档都有说明，这里重点是把要去上一步中：</p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209003547.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>最后面的修改那里，将域名改成与  REDIRECT_URI 一致</p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209004933.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209004933.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>而此时我们选择的<code>scope</code>是需要用户手动通过授权的<code>snsapi_userinfo</code></p><p>然后我们就有了我们的链接，此时就要去代码中对其进行请求了。</p><p>以下就是java代码<br>首先我们在 SpringBoot模块中建一个 <code>WechatOAuth</code> 控制器，用来接受前端发来的请求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;wechat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatOAuth</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthUtil authUtil;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户同意授权，获取code</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oauth&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">oauth</span><span class="params">(HttpServletResponse response, String id)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// System.out.println(&quot;开始询问用户是否同统一授权&quot;);</span></span><br><span class="line">        String appid = <span class="string">&quot;wxac**********d26f&quot;</span>;</span><br><span class="line">        String path = <span class="string">&quot;http://10.33.73.62:8089/wechat/invoke&quot;</span>;</span><br><span class="line">        path = URLEncoder.encode(path, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String url = <span class="string">&quot;https://open.weixin.qq.com/connect/oauth2/authorize?appid=&quot;</span> + appid</span><br><span class="line">                + <span class="string">&quot;&amp;response_type=code&amp;scope=snsapi_userinfo&amp;redirect_uri=&quot;</span> + path</span><br><span class="line">                + <span class="string">&quot;&amp;state=&quot;</span> + id</span><br><span class="line">                + <span class="string">&quot;&amp;connect_redirect=1#wechat_redirect&quot;</span>;</span><br><span class="line">        <span class="comment">//请求转发链接</span></span><br><span class="line">        response.sendRedirect(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这里，我们请求链接获得 code ，然后返回我们设置好的<wavy>回调地址</wavy>，也就是上面的 path，（注意，此处的地址要和前面我们设置的一致，后面的端口可以改变）</p><h3 id="4-2、通过code换取网页授权openid"><a href="#4-2、通过code换取网页授权openid" class="headerlink" title="4.2、通过code换取网页授权openid"></a>4.2、通过code换取网页授权openid</h3><p>然后我们再写一个转发之后的控制器。<br>也就是上一步中<code>String path = &quot;http://10.33.73.62:8089/wechat/invoke&quot;;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户同意授权</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/invoke&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">oauthInvoke</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得code</span></span><br><span class="line">        System.out.println(<span class="string">&quot;用户同意授权，开始获取openid&quot;</span>);</span><br><span class="line">        String code = request.getParameter(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">        String state = request.getParameter(<span class="string">&quot;state&quot;</span>);</span><br><span class="line">        System.out.println(code);</span><br><span class="line">        System.out.println(state);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否绑定过openid</span></span><br><span class="line">        String isOpenid=userService.selUser(state).getOpenid();</span><br><span class="line">        <span class="keyword">if</span> (isOpenid!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;您已经绑定过微信了,如需修改请联系管理员&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 通过token获取access_token</span></span><br><span class="line">        String appid = <span class="string">&quot;wxacc93d31c5dbd26f&quot;</span>;</span><br><span class="line">        String secret = <span class="string">&quot;f8c9e82b590ac71eb12e96f77cf65740&quot;</span>;</span><br><span class="line">        String url = <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=&quot;</span> + appid</span><br><span class="line">                + <span class="string">&quot;&amp;secret=&quot;</span> + secret</span><br><span class="line">                + <span class="string">&quot;&amp;code=&quot;</span> + code</span><br><span class="line">                + <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JSONObject jsonObject = authUtil.doGetJson(url);</span><br><span class="line">            String openid= (String) jsonObject.get(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line">            System.out.println(openid);</span><br><span class="line">            <span class="comment">// 将openid插入到user表中</span></span><br><span class="line">            userService.addOpenid(state,openid);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;授权成功,绑定微信成功&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>此处同样是请求链接，就可以返回一个 json 数据，里面就有我们所需要的数据，如果还需要用户信息的数据，可以继续跟着官方的步骤继续往下做，但是我们这里只需要一个 openid，所以就到这一步。</p><p>在这一步中，我们请求该链接，然后用<code>authUtil</code>工具里来解析，将其返回的数据转换为 json 数据，以方便我们的提取使用，转换为 json 数据之后，只要从中通过 <code>key</code> 取出来即可。</p><p>此处首先会判断用户的 openid 是否存在，如果存在就弹出提示，不执行以下的操作，否则在查出用户的openid 之后，即可绑定到数据库，弹出提示信息。</p><p>以下是此处用到的 authUtil 工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPID = <span class="string">&quot;wx45c1428e5584fcdb&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String APPSECRET = <span class="string">&quot;98174450eb706ada330f37e646be85d5&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JSONObject <span class="title">doGetJson</span><span class="params">(String url)</span> <span class="keyword">throws</span> ClientProtocolException, IOException </span>&#123;</span><br><span class="line">        JSONObject jsonObject = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//首先初始化HttpClient对象</span></span><br><span class="line">        DefaultHttpClient client = <span class="keyword">new</span> DefaultHttpClient();</span><br><span class="line">        <span class="comment">//通过get方式进行提交</span></span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> HttpGet(url);</span><br><span class="line">        <span class="comment">//通过HTTPclient的execute方法进行发送请求</span></span><br><span class="line">        HttpResponse response = client.execute(httpGet);</span><br><span class="line">        <span class="comment">//从response里面拿自己想要的结果</span></span><br><span class="line">        HttpEntity entity = response.getEntity();</span><br><span class="line">        <span class="keyword">if</span>(entity != <span class="keyword">null</span>)&#123;</span><br><span class="line">            String result = EntityUtils.toString(entity,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            <span class="comment">// jsonObject = JSONObject.fromObject(result);</span></span><br><span class="line">            jsonObject= JSON.parseObject(result);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//把链接释放掉</span></span><br><span class="line">        httpGet.releaseConnection();</span><br><span class="line">        <span class="keyword">return</span> jsonObject;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、前端请求后端接口"><a href="#5、前端请求后端接口" class="headerlink" title="5、前端请求后端接口"></a>5、前端请求后端接口</h2><div class="story post-story"><p>我们需要一个能看得过去，能让用户输入账号密码的前端界面，所以以下是我们 vue 的代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;form-login&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;form&quot; :model=&quot;data.form&quot; &gt;</span><br><span class="line">        &lt;el-form-item label=&quot;账户&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;data.form.name&quot; class=&quot;input-login&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;密码&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;data.form.pass&quot; type=&quot;password&quot; class=&quot;input-login&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot;  @click=&quot;Wechatlogin&quot;&gt;微信授权&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123;getCurrentInstance, reactive&#125; from &quot;vue&quot;;</span><br><span class="line">import qs from &quot;qs&quot;;</span><br><span class="line">import router from &quot;../../router&quot;;</span><br><span class="line">import &#123; ElLoading &#125; from &#x27;element-plus&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;Wechar&quot;,</span><br><span class="line">  setup()&#123;</span><br><span class="line">    const &#123;proxy&#125;=getCurrentInstance();</span><br><span class="line">    const qs=require(&#x27;qs&#x27;);</span><br><span class="line">    const data=reactive(&#123;</span><br><span class="line">      form: &#123;</span><br><span class="line">        name: &#x27;&#x27;,</span><br><span class="line">        pass: &#x27;&#x27;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    const Wechatlogin = () =&gt; &#123;</span><br><span class="line">      const loading = ElLoading.service(&#123;</span><br><span class="line">        lock: true,</span><br><span class="line">        text: &#x27;Loading&#x27;,</span><br><span class="line">        background: &#x27;rgba(0, 0, 0, 0.7)&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">      proxy.$axios.post(&#x27;user/login&#x27;,qs.stringify(&#123; &quot;userId&quot;:data.form.name,&quot;userPass&quot;:data.form.pass &#125;)).then(res=&gt;&#123;</span><br><span class="line">        if (&quot;允许登录&quot;==res.data)&#123;</span><br><span class="line">          window.location.href=&quot;http://10.33.73.62:8089/wechat/oauth?id=&quot;+data.form.name</span><br><span class="line">          loading.close()</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">          loading.close()</span><br><span class="line">          alert(res.data);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    return&#123;</span><br><span class="line">      data,Wechatlogin,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>这里点击授权的按钮之后，首先会判断用户是否存在以及密码是否正确，然后就去调用后端的接口。</p><div class="note warning"><p>注意此处有一个坑： 可以看到我这里<code>window.location.href=http://10.33.73.62:8089/wechat/oauth?id=+data.form.name</code>使用的是<code>window.location.href</code>请求后端接口。 这里是不能用<code>axios</code>进行请求的，会出现跨域异常（跨域到微信的服务器）。 算是一个逼坑指南。</p></div></div><h2 id="6、完整流程"><a href="#6、完整流程" class="headerlink" title="6、完整流程"></a>6、完整流程</h2><div class="story post-story"><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115733.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115733.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115941.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209115941.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120057.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120057.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120115.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120115.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120147.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211209120147.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">        </p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/categories/java/SpringBoot/"/>
    
    <category term="前端" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="Vue" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/Vue/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="SpringBoot" scheme="http://cyc0819.top/tags/SpringBoot/"/>
    
    <category term="Vue" scheme="http://cyc0819.top/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>json—lib依赖无法下载问题</title>
    <link href="http://cyc0819.top/2021/12/08/2021-12-08-json%E2%80%94lib%E4%BE%9D%E8%B5%96%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%E9%97%AE%E9%A2%98/"/>
    <id>http://cyc0819.top/2021/12/08/2021-12-08-json%E2%80%94lib%E4%BE%9D%E8%B5%96%E6%97%A0%E6%B3%95%E4%B8%8B%E8%BD%BD%E9%97%AE%E9%A2%98/</id>
    <published>2021-12-08T05:53:12.000Z</published>
    <updated>2021-12-08T09:32:01.537Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="json-lib依赖无法下载问题"><a href="#json-lib依赖无法下载问题" class="headerlink" title="json-lib依赖无法下载问题"></a>json-lib依赖无法下载问题</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>Maven源：阿里云</li></ul></div><h2 id="2、问题"><a href="#2、问题" class="headerlink" title="2、问题"></a>2、问题</h2><div class="story post-story"><p>昨天在研究微信验证时，需要用到 <code>JSONObject.fromObject(result);</code> 这个方法，所以需要引入 <code>json-lib</code> 的依赖，引入依赖很简单，本以为复制黏贴就可以了，但是不知道为什么阿里云的 maven 仓库却死活无法找到这个依赖的包。后面通过手动引入的方式解决。</p></div><h2 id="3、解决"><a href="#3、解决" class="headerlink" title="3、解决"></a>3、解决</h2><div class="story post-story"><h3 id="3-1、引入的依赖"><a href="#3-1、引入的依赖" class="headerlink" title="3.1、引入的依赖"></a>3.1、引入的依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.sf.json-lib/json-lib --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.json-lib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json-lib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2、报错"><a href="#3-2、报错" class="headerlink" title="3.2、报错"></a>3.2、报错</h3><p>此时直接进行下载会提示找不到依赖的相关内容</p><h3 id="3-3、解决方法一"><a href="#3-3、解决方法一" class="headerlink" title="3.3、解决方法一"></a>3.3、解决方法一</h3><p>翻阅了网上的说法，说是在依赖后面加上一句：<code>&lt;classifier&gt;jdk15&lt;/classifier&gt;</code> ，因为远程提供了两个包，我试了一下在我这里并不管用。<br>所以，此方法基本放弃。</p><h3 id="3-4、解决方法二"><a href="#3-4、解决方法二" class="headerlink" title="3.4、解决方法二"></a>3.4、解决方法二</h3><p>另一个方法，就是去<a href="https://mvnrepository.com/">MAVEN存储库</a>直接下载jar包，<br>但是在我打开网站的时候，点击 jar 包进行下载，却发现，这里的也无法下载了<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141505.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141505.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141543.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208141543.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>所以基本上可以判断不是我们自己的问题了。</p><p>偶然之间，我发现这个依赖竟然有一个官网：<a href="http://json-lib.sourceforge.net/">JSON-lib</a></p><p>进去看看<img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142229.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142229.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>官网里应该有 jar 包的下载链接<br>果然，点击下面这个按钮就可以正常下载了<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142313.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142313.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142413.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208142413.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>下载完成之后就可以进行手动的导入了</strong><br>我这里选择的是将我们手动下载的 jar 包，放在 maven 本地仓库的相应位置<br>首先，我们需要将后面的 <code>jdk15</code> 去掉，因为我们的依赖里是没有的。</p><p>然后根据自己的本地仓库位置，找到 json-lib的本地仓库<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143118.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143118.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>点击进入 2.4 文件夹,将我们更名之后的 jar 包放到其中<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143204.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211208143204.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>最后记得把带有 <code>last</code> 的文件删掉</p><p>最后到 java 项目中重新载入一下 maven 就可以了。</p></div><h2 id="4、结束"><a href="#4、结束" class="headerlink" title="4、结束"></a>4、结束</h2><div class="story post-story"><p><code>json-lib</code> 相当于 <code>jackson,fastjson</code>这样的 jar 来说，效率不高，所以建议使用后者。</p><p><code>json-lib</code>中的 <code>JSONObject.fromObject(result)</code> 方法可用<br><code>fastjson</code>中的<code>JSON.parseObject(result);</code>进行替代</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="maven" scheme="http://cyc0819.top/categories/java/maven/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="maven" scheme="http://cyc0819.top/tags/maven/"/>
    
  </entry>
  
  <entry>
    <title>回顾SSM框架整合</title>
    <link href="http://cyc0819.top/2021/11/30/2021-11-30-%E5%9B%9E%E9%A1%BESSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/"/>
    <id>http://cyc0819.top/2021/11/30/2021-11-30-%E5%9B%9E%E9%A1%BESSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88/</id>
    <published>2021-11-30T05:13:21.000Z</published>
    <updated>2021-12-08T09:31:52.507Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="回顾SSM框架整合"><a href="#回顾SSM框架整合" class="headerlink" title="回顾SSM框架整合"></a>回顾SSM框架整合</h1><h2 id="1、环境"><a href="#1、环境" class="headerlink" title="1、环境"></a>1、环境</h2><div class="story post-story"><ul><li>jdk 1.8.0_271</li><li>Maven 3.6.1</li><li>mySQL 8.0</li><li>Tomcat 9.0.27</li></ul></div><h2 id="2、创建数据库"><a href="#2、创建数据库" class="headerlink" title="2、创建数据库"></a>2、创建数据库</h2><div class="story post-story"><p>首先创建一个测试用的数据库 books：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> books</span><br><span class="line">(</span><br><span class="line">    bid     <span class="type">int</span>     <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key,</span><br><span class="line">    sname   <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span>,</span><br><span class="line">    bname   <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span>,</span><br><span class="line">    bauthor <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span>,</span><br><span class="line">    bhome   <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130132921.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130132921.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="3、创建项目"><a href="#3、创建项目" class="headerlink" title="3、创建项目"></a>3、创建项目</h2><div class="story post-story"><p>现在创建一个普通的 Maven 项目，并引入所需要的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>5.2.3.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zaxxer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>HikariCP<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mchange<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="4、设置资源过滤"><a href="#4、设置资源过滤" class="headerlink" title="4、设置资源过滤"></a>4、设置资源过滤</h2><div class="story post-story"><p>在 pom.xm 中插入资源过滤的代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="5、添加-web-框架支持"><a href="#5、添加-web-框架支持" class="headerlink" title="5、添加 web 框架支持"></a>5、添加 web 框架支持</h2><div class="story post-story"><p>给我们创建的普通项目添加上框架支持，在项目名上右键，即可添加框架支持。<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130133853.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130133853.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130134459.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130134459.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="5、创建-spring-配置文件"><a href="#5、创建-spring-配置文件" class="headerlink" title="5、创建 spring 配置文件"></a>5、创建 spring 配置文件</h2><div class="story post-story"><p>在刚刚项目的 resources 下面创建配置文件 db.properties ，其中写的是数据库的相关配置</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF8&amp;userSSL=true&amp;serverTimezone=GMT</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">chenyicai</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">cyc1234</span></span><br></pre></td></tr></table></figure><p>以及创建 applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--    使用连接池，开源的连接池--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    阿里：druid--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    c3p0--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    hiraki：springboot默认使用的连接池--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    一个应用最大并发如果有500个，那么为了提高查询效率，预先创建500个连接，并且把500个连接放入连接池（容器）--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制器类的创建交给SpringMVC，不能配置在bean容器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.chen&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 初始化连接池中的连接数，取值应在minPoolSize与maxPoolSize之间，默认为3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--最大空闲时间，60秒内未使用则连接被丢弃。若为0则永不丢弃。默认值: 0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdleTime&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--连接池中保留的最大连接数。默认值: 15 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 连接池中保留的最小连接数，默认为：3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--c3p0全局的PreparedStatements缓存的大小。如果maxStatements与maxStatementsPerConnection均为0，则缓存不生效，只要有一个不为0，则语句的缓存就能生效。如果默认值:</span></span><br><span class="line"><span class="comment">            0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatements&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 当连接池连接耗尽时，客户端调用getConnection()后等待获取新连接的时间，超时后将抛出SQLException，如设为0则无限期等待。单位毫秒。默认:</span></span><br><span class="line"><span class="comment">            0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;checkoutTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3000&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--当连接池中的连接耗尽的时候c3p0一次同时获取的连接数。默认值: 3 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireIncrement&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--定义在从数据库获取新连接失败后重复尝试的次数。默认值: 30 ；小于等于0表示无限次 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireRetryAttempts&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--重新尝试的时间间隔，默认为：1000毫秒 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;acquireRetryDelay&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5000&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--关闭连接时，是否提交未提交的事务，默认为false，即关闭连接，回滚未提交的事务 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;autoCommitOnClose&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--c3p0将建一张名为Test的空表，并使用其自带的查询语句进行测试。如果定义了这个参数那么属性preferredTestQuery将被忽略。你不能在这张Test表上进行任何操作，它将只供c3p0测试使用。默认值:</span></span><br><span class="line"><span class="comment">            null --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;automaticTestTable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--如果为false，则获取连接失败将会引起所有等待连接池来获取连接的线程抛出异常，但是数据源仍有效保留，并在下次调用getConnection()的时候继续尝试获取连接。如果设为true，那么在尝试获取连接失败后该数据源将申明已断开并永久关闭。默认:</span></span><br><span class="line"><span class="comment">            false --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;breakAfterAcquireFailure&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--每60秒检查所有连接池中的空闲连接。默认值: 0，不检查 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;idleConnectionTestPeriod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--maxStatementsPerConnection定义了连接池内单个连接所拥有的最大缓存statements数。默认值: 0 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxStatementsPerConnection&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.chen.entity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="6、编写代码主体"><a href="#6、编写代码主体" class="headerlink" title="6、编写代码主体"></a>6、编写代码主体</h2><div class="story post-story"><p>现在来编写代码中 entity，controller，service，mapper 层的代码<br><strong>entity：books</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Books</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer bid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bauthor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bhome;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>mapper（此处演示的是传统的 DAO 的方式）:booksDao：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BooksDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>booksDaoImpl：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksDaoImpl</span> <span class="keyword">implements</span> <span class="title">BooksDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSqlSessionFactory</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sqlSessionFactory = sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">int</span> out=sqlSession.delete(<span class="string">&quot;deleteByPrimaryKey&quot;</span>,bid);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">int</span> out=sqlSession.insert(<span class="string">&quot;insert&quot;</span>,record);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        Books books=sqlSession.selectOne(<span class="string">&quot;selectByPrimaryKey&quot;</span>,bid);</span><br><span class="line">        <span class="keyword">return</span> books;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();</span><br><span class="line">        <span class="keyword">int</span> out = sqlSession.update(<span class="string">&quot;updateByPrimaryKey&quot;</span>,record);</span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>然后是 xml 文件，其中是执行的 sql：</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org/DTD Mapper 3.0&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.chen.entity.Books&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        *</span><br><span class="line">        from books</span><br><span class="line">        where bid = #&#123;bid,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        delete from books</span><br><span class="line">        where bid = #&#123;bid,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.chen.entity.Books&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        insert into books (sname, bname, bauthor,</span><br><span class="line">                           bhome)</span><br><span class="line">        values (#&#123;sname,jdbcType=VARCHAR&#125;, #&#123;bname,jdbcType=VARCHAR&#125;, #&#123;bauthor,jdbcType=VARCHAR&#125;,</span><br><span class="line">                #&#123;bhome,jdbcType=VARCHAR&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByPrimaryKey&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.chen.entity.Books&quot;</span>&gt;</span></span><br><span class="line">        update books</span><br><span class="line">        set sname = #&#123;sname,jdbcType=VARCHAR&#125;,</span><br><span class="line">            bname = #&#123;bname,jdbcType=VARCHAR&#125;,</span><br><span class="line">            bauthor = #&#123;bauthor,jdbcType=VARCHAR&#125;,</span><br><span class="line">            bhome = #&#123;bhome,jdbcType=VARCHAR&#125;</span><br><span class="line">        where bid = #&#123;bid,jdbcType=INTEGER&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>service 层：BooksService</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BooksService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>impl：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksServiceImpl</span> <span class="keyword">implements</span> <span class="title">BooksService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BooksDao booksDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.deleteByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.insert(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.selectByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksDao.updateByPrimaryKey(record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>最后是 Controller 层：BooksController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BooksController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BooksService booksService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBooksService</span><span class="params">(BooksService booksService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.booksService = booksService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/del&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bid)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.deleteByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/ins&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.insert(record);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/sel&quot;)</span></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bid)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.selectByPrimaryKey(bid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/up&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> booksService.updateByPrimaryKey(record);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后项目的结构如下：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130145929.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130145929.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="7、现在需要在配置-xml-中编写扫描我们的-bean-的代码"><a href="#7、现在需要在配置-xml-中编写扫描我们的-bean-的代码" class="headerlink" title="7、现在需要在配置 xml 中编写扫描我们的 bean 的代码"></a>7、现在需要在配置 xml 中编写扫描我们的 bean 的代码</h2><div class="story post-story"><p>加入以下代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.chen.mapper.impl.BooksDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.chen.entity&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath*:mapper/BooksMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如图：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150442.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150442.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150809.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130150809.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="8、web-配置"><a href="#8、web-配置" class="headerlink" title="8、web 配置"></a>8、web 配置</h2><div class="story post-story"><p>在 web.xml 中配置以下内容,用于配置dispatcherServlet中心控制器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;4.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 监听器会自动读取applicationContext.xml中的bean的信息，完成bean的初始化--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span><span class="comment">&lt;!-- 前端控制器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span><span class="comment">&lt;!-- 处理所有请求，当然也包含静态资源（js、css、img...） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在创建一个 dispatcher-servlet.xml，用于 MVC 的装配</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描控制器的包，以确定哪些类是控制器类（哪些类上使用了@Controller注解） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;cn.edu.guet.controller&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 表示：所有的静态资源使用默认的Servlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:default-servlet-handler</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;internalResourceViewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/jsp/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 告诉SpringMVC去哪个目录找文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!-- 文件的后缀 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--通过处理器适配器AnnotationMethodHandlerAdapter来开启支持@RequestMapping注解--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></div><h2 id="9、运行测试"><a href="#9、运行测试" class="headerlink" title="9、运行测试"></a>9、运行测试</h2><div class="story post-story"><p>此时我们用 Tomcat 构建项目。<br>出现以下结果：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130172158.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130172158.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果出现这种情况，我们就需要将 maven 的包手动导入，才能成功启动项目。<br>步骤如下：</p><ol><li>打开项目结构。</li><li>点击构件，然后点击WEB-INF目录，点击新建文件夹按钮，创建lib文件夹。</li><li>然后引入库。</li><li>将其全选，然后需要的jar包便全部导入到项目中。<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130173210.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211130173210.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p><strong>再运行，即可</strong></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="spring" scheme="http://cyc0819.top/categories/java/spring/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="spring" scheme="http://cyc0819.top/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>eCharts学习笔记</title>
    <link href="http://cyc0819.top/2021/11/27/2021-11-27-eCharts%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://cyc0819.top/2021/11/27/2021-11-27-eCharts%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2021-11-27T14:04:25.000Z</published>
    <updated>2021-12-08T09:31:43.846Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="eCharts-学习笔记"><a href="#eCharts-学习笔记" class="headerlink" title="eCharts 学习笔记"></a>eCharts 学习笔记</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><div class="story post-story"><p>eCharts 是百度出品的一款基于 JavaScript 的数据可视化图表库，提供直观，生动，可交互，可个性化定制的数据可视化图表。最开始是由百度团队开源的，后面于2018年交由Apache基金会，称为ASF孵化项目。并于2021年1月26日正式毕业。</p></div><h2 id="2、在-Vue-中使用"><a href="#2、在-Vue-中使用" class="headerlink" title="2、在 Vue 中使用"></a>2、在 Vue 中使用</h2><div class="story post-story"><ol><li>首先下载 eCharts：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install echarts --save</span><br></pre></td></tr></table></figure></li><li>全局引入 eCharts:<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li>或者可以按需引入<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 echarts 核心模块，核心模块提供了 echarts 使用必须要的接口。</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> echarts <span class="keyword">from</span> <span class="string">&#x27;echarts/core&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入柱状图图表，图表后缀都为 Chart</span></span><br><span class="line"><span class="keyword">import</span> &#123; BarChart &#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/charts&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入提示框，标题，直角坐标系，数据集，内置数据转换器组件，组件后缀都为 Component</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  TitleComponent,</span><br><span class="line">  TooltipComponent,</span><br><span class="line">  GridComponent,</span><br><span class="line">  DatasetComponent,</span><br><span class="line">  DatasetComponentOption,</span><br><span class="line">  TransformComponent</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/components&#x27;</span>;</span><br><span class="line"><span class="comment">// 标签自动布局，全局过渡动画等特性</span></span><br><span class="line"><span class="keyword">import</span> &#123; LabelLayout, UniversalTransition &#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/features&#x27;</span>;</span><br><span class="line"><span class="comment">// 引入 Canvas 渲染器，注意引入 CanvasRenderer 或者 SVGRenderer 是必须的一步</span></span><br><span class="line"><span class="keyword">import</span> &#123; CanvasRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;echarts/renderers&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册必须的组件</span></span><br><span class="line">echarts.use([</span><br><span class="line">  TitleComponent,</span><br><span class="line">  TooltipComponent,</span><br><span class="line">  GridComponent,</span><br><span class="line">  DatasetComponent,</span><br><span class="line">  TransformComponent,</span><br><span class="line">  BarChart,</span><br><span class="line">  LabelLayout,</span><br><span class="line">  UniversalTransition,</span><br><span class="line">  CanvasRenderer</span><br><span class="line">]);</span><br></pre></td></tr></table></figure></div><h2 id="3、基本语法结构"><a href="#3、基本语法结构" class="headerlink" title="3、基本语法结构"></a>3、基本语法结构</h2><div class="story post-story"></li></ol><p>在使用 eCharts 之前，我们需要给它一个 DOM 容器，官方是推荐我们使用具有定义好的长和宽的一个父容器（可以是 div ）。<br>所以我们首先构建一个父容器 div 来存放 eCharts 图表</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;billreport&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:style</span>=<span class="string">&quot;&#123; width: &#x27;95%&#x27;, height: &#x27;500px&#x27; &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>由于 eCharts 基于js构建的，所以只要会js的语法，eCharts的语法自然也不在话下。<br>而 eCharts 的基本语法结构为：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">setup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> data=reactive(&#123;</span><br><span class="line">    <span class="attr">option</span>:&#123;</span><br><span class="line">    <span class="comment">//图表信息</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ech = <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//绘制图表的方法</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">onBeforeMount(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="comment">//在页面渲染之前加载图表的信息</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div><h2 id="4、图表配置信息"><a href="#4、图表配置信息" class="headerlink" title="4、图表配置信息"></a>4、图表配置信息</h2><div class="story post-story"><p>图表配置信息，即 option 中的内容，在这一部分，我们将配置一系列的信息，正是这些信息生成了对应的图表。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">option:&#123;</span><br><span class="line"><span class="attr">title</span>:&#123;</span><br><span class="line"><span class="attr">text</span>: <span class="string">&quot;收入与支出趋势图&quot;</span><span class="comment">//图表的标题</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">tooltip</span>:&#123;<span class="comment">//提示的信息</span></span><br><span class="line"><span class="attr">trigger</span>:<span class="string">&#x27;axis&#x27;</span><span class="comment">//触发方式</span></span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">legend</span>: &#123;<span class="comment">//图例</span></span><br><span class="line">        <span class="attr">data</span>: [&#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;收入&#x27;</span>,</span><br><span class="line">        <span class="comment">// 强制设置图形为圆。</span></span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">        <span class="comment">// 设置文本为红色</span></span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;支出&#x27;</span>,</span><br><span class="line">        <span class="comment">// 强制设置图形为圆。</span></span><br><span class="line">        <span class="attr">icon</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">        <span class="comment">// 设置文本为红色</span></span><br><span class="line">        <span class="attr">textStyle</span>: &#123;</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]<span class="comment">//图例的标题，分别对应 series 中的数据</span></span><br><span class="line">    &#125;，</span><br><span class="line">    <span class="attr">xAxis</span>: &#123;<span class="comment">//配置要在x轴显示的项</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,<span class="comment">//&#x27;value&#x27; 数值轴，适用于连续数据。 &#x27;category&#x27; 类目轴，适用于离散的类目数据，为该类型时必须通过 data 设置类目数据。 &#x27;time&#x27; 时间轴，适用于连续的时序数据，与数值轴相比时间轴带有时间的格式化，在刻度计算上也有所不同，例如会根据跨度的范围来决定使用月，星期，日还是小时范围的刻度。 &#x27;log&#x27; 对数轴。适用于对数数据。</span></span><br><span class="line">        <span class="attr">boundaryGap</span>: <span class="literal">false</span>,<span class="comment">// 刻度离纵轴有无间隙，默认true有间距</span></span><br><span class="line">        <span class="attr">data</span>: []<span class="comment">//横轴坐标的值</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">yAxis</span>: &#123;<span class="comment">//配置y轴的项，配置与x轴类似</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">series</span>: [<span class="comment">//系列列表,显示在图表中的内容</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;收入&#x27;</span>,<span class="comment">//系列名称</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,<span class="comment">//图表类型</span></span><br><span class="line">        <span class="attr">stack</span>: <span class="string">&#x27;收入&#x27;</span>,<span class="comment">//堆叠，如果有相同名称的会堆叠</span></span><br><span class="line">        <span class="attr">data</span>: []</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;支出&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">        <span class="attr">stack</span>: <span class="string">&#x27;支出&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: []</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>图表类型表：</p><table><thead><tr><th>配置</th><th>图表类型</th></tr></thead><tbody><tr><td>type: ‘bar’</td><td>柱状/条形图</td></tr><tr><td>type: ‘line’</td><td>折线/面积图</td></tr><tr><td>type: ‘pie’</td><td>饼图</td></tr><tr><td>type: ‘scatter’</td><td>散点（气泡）图</td></tr><tr><td>type: ‘effectScatter’</td><td>带有涟漪特效动画的散点（气泡）</td></tr><tr><td>type: ‘radar’</td><td>雷达图</td></tr><tr><td>type: ‘tree’</td><td>树型图</td></tr><tr><td>type: ‘treemap’</td><td>树型图</td></tr><tr><td>type: ‘sunburst’</td><td>旭日图</td></tr><tr><td>type: ‘boxplot’</td><td>箱形图</td></tr><tr><td>type: ‘candlestick’</td><td>K线图</td></tr><tr><td>type: ‘heatmap’</td><td>热力图</td></tr><tr><td>type: ‘map’</td><td>地图</td></tr><tr><td>type: ‘parallel’</td><td>平行坐标系的系列</td></tr><tr><td>type: ‘lines’</td><td>线图</td></tr><tr><td>type: ‘graph’</td><td>关系图</td></tr><tr><td>type: ‘sankey’</td><td>桑基图</td></tr><tr><td>type: ‘funnel’</td><td>漏斗图</td></tr><tr><td>type: ‘gauge’</td><td>仪表盘</td></tr><tr><td>type: ‘pictorialBar’</td><td>象形柱图</td></tr><tr><td>type: ‘themeRiver’</td><td>主题河流</td></tr><tr><td>type: ‘custom’</td><td>自定义系列</td></tr></tbody></table></div><h2 id="5、x-轴、y-轴"><a href="#5、x-轴、y-轴" class="headerlink" title="5、x 轴、y 轴"></a>5、x 轴、y 轴</h2><div class="story post-story"><p>x 轴和 y 轴都由轴线、刻度、刻度标签、轴标题四个部分组成。<br>一般情况下，二维的图标结构都会有 x 轴和 y 轴，通常情况下，x 轴会在图表的下方，而 y 轴在图表的左边。<br>而 eCharts 也提供了一些特定的坐标轴的设置选项，如：<br><strong>轴线：</strong><br>我们可以通过 axisLine 来对轴线进行设置，比如轴线两头的箭头，轴线的样式等等，比如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLine</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>:<span class="string">&#x27;true&#x27;</span> <span class="comment">//显示轴线</span></span><br><span class="line">      <span class="attr">symbol</span>: <span class="string">&#x27;arrow&#x27;</span>, <span class="comment">//轴线两边的箭头</span></span><br><span class="line">      <span class="attr">lineStyle</span>: &#123; <span class="comment">//轴线的样式，有颜色、宽度、类型等等</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLine</span>: &#123;</span><br><span class="line">      <span class="attr">symbol</span>: <span class="string">&#x27;arrow&#x27;</span>,</span><br><span class="line">      <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>轴线两边的箭头选项：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129165935.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129165935.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>坐标轴刻度：</strong><br>ECharts 提供了轴线 axisTick 相关的配置，我们可以根据实际情况调整，例如刻度线的长度，样式等。以下是一个坐标轴刻度的例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisTick</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>:<span class="literal">true</span> <span class="comment">//开启坐标轴刻度</span></span><br><span class="line">      <span class="attr">alignWithLabel</span>:<span class="literal">true</span> <span class="comment">//使刻度与标签对其（类目轴中在 boundaryGap 为 true 的时候有效）</span></span><br><span class="line">      <span class="attr">inside</span>:<span class="literal">true</span> <span class="comment">//刻度线是否朝里（true为朝里）</span></span><br><span class="line">      interval：<span class="number">0</span> <span class="comment">//坐标轴刻度的显示间隔,如果设置为 1，表示『隔一个标签显示一个标签』，如果值为 2，表示隔两个标签显示一个标签，以此类推。</span></span><br><span class="line">      <span class="attr">length</span>: <span class="number">6</span>,<span class="comment">//刻度线的长度</span></span><br><span class="line">      <span class="attr">lineStyle</span>: &#123; <span class="comment">//样式设置</span></span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisTick</span>: &#123;</span><br><span class="line">      <span class="attr">length</span>: <span class="number">6</span>,</span><br><span class="line">      <span class="attr">lineStyle</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;dashed&#x27;</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>刻度标签：</strong><br>ECharts 提供了轴线 axisLabel 相关的配置，我们可以根据实际情况调整。以下是一个例子：<br><img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129171709.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129171709.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>如上图所示，下面的星期就是刻度标签</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">xAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">show</span>:<span class="literal">true</span> <span class="comment">//显示刻度标签</span></span><br><span class="line">      <span class="attr">interval</span>:<span class="number">0</span> <span class="comment">//显示刻度，同上</span></span><br><span class="line">      <span class="attr">inside</span>:<span class="literal">true</span> <span class="comment">//标签是否朝里（true朝里）</span></span><br><span class="line">      rotate：<span class="number">45</span> <span class="comment">// 标签偏移的角度</span></span><br><span class="line">      <span class="attr">margin</span>:<span class="number">5</span> <span class="comment">//标签与轴线的距离</span></span><br><span class="line">      <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; kg&#x27;</span>, <span class="comment">//刻度标签的内容格式器，支持字符串模板和回调函数两种形式。</span></span><br><span class="line">      <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span> <span class="comment">//文字水平对齐方式，默认自动。可选为：&#x27;left&#x27;,&#x27;center&#x27;,&#x27;right&#x27;</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;</span><br><span class="line">    <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">      <span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; 元&#x27;</span>,</span><br><span class="line">      <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>标签中的formatter：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用字符串模板，模板变量为刻度默认标签 &#123;value&#125;</span></span><br><span class="line"><span class="attr">formatter</span>: <span class="string">&#x27;&#123;value&#125; kg&#x27;</span></span><br><span class="line"><span class="comment">// 使用函数模板，函数参数分别为刻度数值（类目），刻度的索引</span></span><br><span class="line"><span class="attr">formatter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">value, index</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value + <span class="string">&#x27;kg&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>更多关于 formatter 的内容可以参考官方的 <a href="https://echarts.apache.org/zh/option.html#xAxis.axisLabel.formatter">API</a></p></div><h2 id="6、主题配置"><a href="#6、主题配置" class="headerlink" title="6、主题配置"></a>6、主题配置</h2><div class="story post-story"><p>在eCharts的内部，内置了两套主题，分别是亮色主题以及暗色主题<br>通过以下的方式，我们可以修改主题</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> chart = echarts.init(dom, <span class="string">&#x27;light&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> chart = echarts.init(dom, <span class="string">&#x27;dark&#x27;</span>);</span><br></pre></td></tr></table></figure><p>或者我们可以通过eCharts的<a href="https://echarts.apache.org/zh/theme-builder.html">主题编辑器</a>来创建自己的主题<img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211128132725.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211128132725.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="7、数据集（dataset）"><a href="#7、数据集（dataset）" class="headerlink" title="7、数据集（dataset）"></a>7、数据集（dataset）</h2><div class="story post-story"><p>dataset 组件可以用于单独的数据集声明，从而数据可以单独管理，被多个组件复用，并且可以基于数据指定数据到视觉的映射。</p><p><strong>写法一：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataset: &#123;</span><br><span class="line">    <span class="comment">// 提供一份数据。</span></span><br><span class="line">    <span class="comment">//第一行对应的是 x 轴</span></span><br><span class="line">    <span class="attr">source</span>: [</span><br><span class="line">        [<span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>],</span><br><span class="line">        [<span class="string">&#x27;Matcha Latte&#x27;</span>, <span class="number">43.3</span>, <span class="number">85.8</span>, <span class="number">93.7</span>],</span><br><span class="line">        [<span class="string">&#x27;Milk Tea&#x27;</span>, <span class="number">83.1</span>, <span class="number">73.4</span>, <span class="number">55.1</span>],</span><br><span class="line">        [<span class="string">&#x27;Cheese Cocoa&#x27;</span>, <span class="number">86.4</span>, <span class="number">65.2</span>, <span class="number">82.5</span>],</span><br><span class="line">        [<span class="string">&#x27;Walnut Brownie&#x27;</span>, <span class="number">72.4</span>, <span class="number">53.9</span>, <span class="number">39.1</span>]</span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>在 dataset 中管理数据之后，就可以不用在 series 单独进行数据的声明，而是直接在 data 除进行调用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 声明多个柱状图系列，默认情况下，每个系列会自动对应到 dataset 的每一列。</span></span><br><span class="line"><span class="attr">series</span>: [</span><br><span class="line">    &#123;<span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>写法二：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dataset: &#123;</span><br><span class="line">    <span class="comment">// 这里指定了维度名的顺序，从而可以利用默认的维度到坐标轴的映射。</span></span><br><span class="line">    <span class="comment">// 如果不指定 dimensions，也可以通过指定 series.encode 完成映射，参见后文。</span></span><br><span class="line">    <span class="attr">dimensions</span>: [<span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>],</span><br><span class="line">        <span class="attr">source</span>: [</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Matcha Latte&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">43.3</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">85.8</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">93.7</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Milk Tea&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">83.1</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">73.4</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">55.1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Cheese Cocoa&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">86.4</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">65.2</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">82.5</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">product</span>: <span class="string">&#x27;Walnut Brownie&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>: <span class="number">72.4</span>, <span class="string">&#x27;2016&#x27;</span>: <span class="number">53.9</span>, <span class="string">&#x27;2017&#x27;</span>: <span class="number">39.1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></div><h2 id="8、图例"><a href="#8、图例" class="headerlink" title="8、图例"></a>8、图例</h2><div class="story post-story"><p>图例是图表中对内容区元素的注释、用不同形状、颜色、文字等来标示不同数据列，通过点击对应数据列的标记，可以显示或隐藏该数据列。图例虽然不是图表中的主要信息、却是了解图表信息的钥匙。<br>以下是一个例子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  <span class="attr">legend</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="string">&#x27;plain&#x27;</span> <span class="comment">//图例的类型可选值：&#x27;scroll&#x27;：可滚动翻页的图例。当图例数量较多时可以使用。</span></span><br><span class="line">    <span class="comment">// Try &#x27;horizontal&#x27;</span></span><br><span class="line">    <span class="attr">orient</span>: <span class="string">&#x27;vertical&#x27;</span>, <span class="comment">//图例列表的布局朝向。可选：&#x27;horizontal&#x27;水平，&#x27;vertical&#x27;垂直</span></span><br><span class="line">    <span class="attr">right</span>: <span class="number">10</span>, <span class="comment">//图例组件离容器右侧的距离。</span></span><br><span class="line">    <span class="attr">top</span>: <span class="string">&#x27;center&#x27;</span> <span class="comment">//图例组件离容器上侧的距离。</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dataset</span>: &#123;</span><br><span class="line">    <span class="attr">source</span>: [</span><br><span class="line">      [<span class="string">&#x27;product&#x27;</span>, <span class="string">&#x27;2015&#x27;</span>, <span class="string">&#x27;2016&#x27;</span>, <span class="string">&#x27;2017&#x27;</span>],</span><br><span class="line">      [<span class="string">&#x27;Matcha Latte&#x27;</span>, <span class="number">43.3</span>, <span class="number">85.8</span>, <span class="number">93.7</span>],</span><br><span class="line">      [<span class="string">&#x27;Milk Tea&#x27;</span>, <span class="number">83.1</span>, <span class="number">73.4</span>, <span class="number">55.1</span>],</span><br><span class="line">      [<span class="string">&#x27;Cheese Cocoa&#x27;</span>, <span class="number">86.4</span>, <span class="number">65.2</span>, <span class="number">82.5</span>],</span><br><span class="line">      [<span class="string">&#x27;Walnut Brownie&#x27;</span>, <span class="number">72.4</span>, <span class="number">53.9</span>, <span class="number">39.1</span>]</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">xAxis</span>: &#123; <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">yAxis</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">series</span>: [&#123; <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, &#123; <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span> &#125;, &#123; <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span> &#125;]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>显示内容如下：<img src="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129173307.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/chenyicai0819/MyImage/Imgs/20211129173307.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>更多内容参考官方 <a href="https://echarts.apache.org/zh/option.html#legend">API</a></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="前端" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="eCharts" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/eCharts/"/>
    
    
    <category term="前端" scheme="http://cyc0819.top/tags/%E5%89%8D%E7%AB%AF/"/>
    
    <category term="eCharts" scheme="http://cyc0819.top/tags/eCharts/"/>
    
  </entry>
  
  <entry>
    <title>SpringSecurity+JWT实现的登录认证</title>
    <link href="http://cyc0819.top/2021/11/20/2021-11-20-SpringSecurity+JWT%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/"/>
    <id>http://cyc0819.top/2021/11/20/2021-11-20-SpringSecurity+JWT%E5%AE%9E%E7%8E%B0%E7%9A%84%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/</id>
    <published>2021-11-20T01:39:55.000Z</published>
    <updated>2021-12-08T09:37:34.904Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringSecurity-JWT实现的登录认证"><a href="#SpringSecurity-JWT实现的登录认证" class="headerlink" title="SpringSecurity+JWT实现的登录认证"></a>SpringSecurity+JWT实现的登录认证</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><div class="story post-story"><ol><li><p>Spring Security<br>在 Web 编程开发中，登录安全往往也是很重要的一个部分，而 Spring Security 所做得就是这个工作。在 java 领域，成熟的安全框架解决方案一般有 Apache Shiro、Spring Security 等两种技术选型。Apache Shiro 简单易用也算是一大优势，但其功能还是远不如 Spring Security 强大。后者可以为应用提供声明式的安全访问限制，他提供了一系列的可以由开发者主动配置的 bean ，并利用 Spring IoC和 AOP等功能特性来为应用系统提供声明式的安全访问控制功能，减少了诸多重复工作。</p></li><li><p>JWT<br>JWT 的全称是：Json Web Token 。是在网路应用中传递信息的一种基于 json 的开发标准，可用于作为 json 对象在不同系统之间进行安全地信息传输。主要使用场景一般是用来在身份提供者和服务提供者间传递被认证的用户身份信息。</p></li></ol></div><h2 id="2、设计登录认证所用的表"><a href="#2、设计登录认证所用的表" class="headerlink" title="2、设计登录认证所用的表"></a>2、设计登录认证所用的表</h2><div class="story post-story"><p>本次登录认证需要用到三个表，分别是用户表，身份表以及用户和身份绑定的表。``</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for hibernate_sequence</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `hibernate_sequence`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `hibernate_sequence`  (</span><br><span class="line">  `next_val` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE <span class="operator">=</span> MyISAM AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Fixed;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of hibernate_sequence</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `hibernate_sequence` <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `hibernate_sequence` <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;ROLE_NORMAL&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;ROLE_ADMIN&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_roles</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `user_roles`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_roles`  (</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `roles_id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  INDEX `FKj9553ass9uctjrmh0gkqsmv0d`(`roles_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  INDEX `FK55itppkw3i07do3h7qoclqd4k`(`user_id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FK55itppkw3i07do3h7qoclqd4k` <span class="keyword">FOREIGN</span> KEY (`user_id`) <span class="keyword">REFERENCES</span> `users` (`id`) <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT <span class="keyword">ON</span> UPDATE RESTRICT,</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `FKj9553ass9uctjrmh0gkqsmv0d` <span class="keyword">FOREIGN</span> KEY (`roles_id`) <span class="keyword">REFERENCES</span> `role` (`id`) <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT <span class="keyword">ON</span> UPDATE RESTRICT</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user_roles</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_roles` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_roles` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for users</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `users`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of users</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `users` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;chenyicai&#x27;</span>, <span class="string">&#x27;$2a$10$hZG8XjmuAcuY.izAj0D7wuQIvPDdwdz.y4KcbGPI18Mri1hx1FWA6&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><img src="https://z3.ax1x.com/2021/11/20/IqIxJI.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqIxJI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://z3.ax1x.com/2021/11/20/IqoFeg.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqoFeg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://z3.ax1x.com/2021/11/20/IqokwQ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqokwQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="3、创建新工程并导入依赖及实体类"><a href="#3、创建新工程并导入依赖及实体类" class="headerlink" title="3、创建新工程并导入依赖及实体类"></a>3、创建新工程并导入依赖及实体类</h2><div class="story post-story"><ol><li><p>在创建一个SpringBoot工程之后我们需要引入Security和JWT必须的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在配置文件中配置数据库信息</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/jwtdemo?useSSL=false&amp;serverTimezone=UTC&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">chenyicai</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">cyc1234</span></span><br><span class="line">  <span class="attr">ackson:</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">      <span class="attr">indent_output:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8086</span></span><br><span class="line"><span class="comment">#日志级别（一般设置为INFO）</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">cn:</span></span><br><span class="line">      <span class="attr">edu:</span></span><br><span class="line">        <span class="attr">guet:</span></span><br><span class="line">          <span class="attr">mapper:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">org:</span></span><br><span class="line">    <span class="attr">springframework:</span></span><br><span class="line">      <span class="attr">security:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">cn.edu.guet.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure></li><li><p>创建用户以及身份实体类</p></li></ol><p>Users类：（省略 getset 方法）</p><p>此处所创建的 User 类继承了 Spring Security 的 UserDetails 接口，从而成为了一个符合 Security 安全的用户，即通过继承 UserDetails，即可实现 Security 中相关的安全功能。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        List&lt;GrantedAuthority&gt; authorities = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            authorities.add( <span class="keyword">new</span> SimpleGrantedAuthority( role.getName() ) );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Role类：（省略 getset 方法）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、JWT工具类"><a href="#4、JWT工具类" class="headerlink" title="4、JWT工具类"></a>4、JWT工具类</h2><div class="story post-story"><p>该工具类主要用于对 JWT Token 进行各项操作，比如生成Token、验证Token、刷新Token 等</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtTokenUtils</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5625635588908941275L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLAIM_KEY_USERNAME = <span class="string">&quot;sub&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLAIM_KEY_CREATED = <span class="string">&quot;created&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLAIM_KEY_AUTHORITIES=<span class="string">&quot;authorities&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成token</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateToken</span><span class="params">(UserDetails userDetails)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        claims.put( CLAIM_KEY_USERNAME, userDetails.getUsername());</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED, <span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> generateToken(claims);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证token</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">validateToken</span><span class="params">(String token, UserDetails userDetails)</span> </span>&#123;</span><br><span class="line">        String username = getUserNameFromToken(token);</span><br><span class="line">        <span class="keyword">return</span>  !isTokenExpired(token);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 刷新token</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">refreshToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        Claims claims = getClaimsFromToken(token);</span><br><span class="line">        claims.put(CLAIM_KEY_CREATED,<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">return</span> generateToken(claims);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 验证token是否失效</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTokenExpired</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        Date expireDate = getExpiredDateFromToken(token);</span><br><span class="line">        <span class="keyword">return</span> expireDate.before(<span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从token中获取过期时间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getExpiredDateFromToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        Claims claims = getClaimsFromToken(token);</span><br><span class="line">        <span class="keyword">return</span> claims.getExpiration();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从token中获取用户名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserNameFromToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        String username;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Claims claims = getClaimsFromToken(token);</span><br><span class="line">            username = claims.getSubject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            username = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 从token中获取荷载</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Claims <span class="title">getClaimsFromToken</span><span class="params">(String token)</span></span>&#123;</span><br><span class="line">        Claims claims = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = Jwts.parser()</span><br><span class="line">                    .setSigningKey(Const.SECRET)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> claims;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 生成过期时间</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Date <span class="title">generateExpirationDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Date(System.currentTimeMillis()+Const.EXPIRATION_TIME*<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据荷载生成token</span></span><br><span class="line">    <span class="function">String <span class="title">generateToken</span><span class="params">(Map&lt;String, Object&gt; claims)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setExpiration(generateExpirationDate())</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, Const.SECRET )</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里还有一个常量类，存储了JWT的一些常量信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Const</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 5天(以毫秒ms计)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRATION_TIME = <span class="number">432_000_000</span>;</span><br><span class="line">  <span class="comment">// JWT密码</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRET = <span class="string">&quot;CodeSheepSecret&quot;</span>;</span><br><span class="line">  <span class="comment">// Token前缀</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOKEN_PREFIX = <span class="string">&quot;Bearer&quot;</span>;</span><br><span class="line">  <span class="comment">// 存放Token的Header Key</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String HEADER_STRING = <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="5、Token过滤器"><a href="#5、Token过滤器" class="headerlink" title="5、Token过滤器"></a>5、Token过滤器</h2><div class="story post-story"><p>用于每次外部对接口请求时的Token处理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtils jwtTokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 确认是否能根据key拿到value</span></span><br><span class="line">        String authHeader = httpServletRequest.getHeader( Const.HEADER_STRING );</span><br><span class="line">        <span class="keyword">if</span> (authHeader == <span class="keyword">null</span>) &#123;</span><br><span class="line">            authHeader =Const.TOKEN_PREFIX+<span class="string">&quot; &quot;</span>+httpServletRequest.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断登录用户的token不为空和是Bearer开头的</span></span><br><span class="line">        <span class="keyword">if</span> (authHeader != <span class="keyword">null</span> &amp;&amp; authHeader.startsWith( Const.TOKEN_PREFIX )) &#123;</span><br><span class="line">            <span class="comment">// 取到token</span></span><br><span class="line">            <span class="keyword">final</span> String authToken = authHeader.substring( Const.TOKEN_PREFIX.length() );</span><br><span class="line">            <span class="comment">// 从用户请求携带的token获取用户名，能取到证明token除了时间以外都合法了</span></span><br><span class="line">            String username = jwtTokenUtil.getUserNameFromToken(authToken);</span><br><span class="line">            System.out.println(username);</span><br><span class="line">            <span class="comment">// token 存在用户名但没有认证的</span></span><br><span class="line">            <span class="keyword">if</span> (username != <span class="keyword">null</span> &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                UserDetails userDetails = <span class="keyword">this</span>.userDetailsService.loadUserByUsername(username);</span><br><span class="line">                <span class="comment">// 根据userDetails验证了token是否有效（验证时间是否过期和当前用户名是否匹配）</span></span><br><span class="line">                <span class="keyword">if</span> (jwtTokenUtil.validateToken(authToken, userDetails)) &#123;</span><br><span class="line">                    <span class="comment">// 我们的token，框架是不认识的，token有效就转化构建 UsernamePasswordAuthenticationToken表示认证通过和进行相关授权</span></span><br><span class="line">                    UsernamePasswordAuthenticationToken authentication = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(</span><br><span class="line">                            userDetails, <span class="keyword">null</span>, userDetails.getAuthorities());</span><br><span class="line">                    authentication.setDetails(<span class="keyword">new</span> WebAuthenticationDetailsSource().buildDetails(</span><br><span class="line">                            httpServletRequest));</span><br><span class="line">                    <span class="comment">// 设置了认证主体，到UsernamePasswordAuthenticationFilter就不会拦截，因为你应该带有了它的token</span></span><br><span class="line">                    SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 继续执行其他过滤器</span></span><br><span class="line">        filterChain.doFilter(httpServletRequest, httpServletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="6、Service层业务操作"><a href="#6、Service层业务操作" class="headerlink" title="6、Service层业务操作"></a>6、Service层业务操作</h2><div class="story post-story"><p>主要是登录以及注册的业务</p><p>首先是AuthService接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthService</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">register</span><span class="params">( User userToAdd )</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">login</span><span class="params">( String username, String password )</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AuthServiceImpl实现类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthServiceImpl</span> <span class="keyword">implements</span> <span class="title">AuthService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtTokenUtil jwtTokenUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">( String username, String password )</span> </span>&#123;</span><br><span class="line">        UsernamePasswordAuthenticationToken upToken = <span class="keyword">new</span> UsernamePasswordAuthenticationToken( username, password );</span><br><span class="line">        <span class="keyword">final</span> Authentication authentication = authenticationManager.authenticate(upToken);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        <span class="keyword">final</span> UserDetails userDetails = userDetailsService.loadUserByUsername( username );</span><br><span class="line">        <span class="keyword">final</span> String token = jwtTokenUtil.generateToken(userDetails);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">register</span><span class="params">( User userToAdd )</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String username = userToAdd.getUsername();</span><br><span class="line">        <span class="keyword">if</span>( userRepository.findByUsername(username)!=<span class="keyword">null</span> ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        BCryptPasswordEncoder encoder = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">        <span class="keyword">final</span> String rawPassword = userToAdd.getPassword();</span><br><span class="line">        userToAdd.setPassword( encoder.encode(rawPassword) );</span><br><span class="line">        <span class="keyword">return</span> userRepository.save(userToAdd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是 UserService 实现类，它实现了 UserDetailsService，可用于在登录认证时检验用户的身份</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        User user = userMapper.findByUsername(s);</span><br><span class="line">        List&lt;Role&gt; roleList =userMapper.findRoleByUsername(s);</span><br><span class="line">        user.setRoles(roleList);</span><br><span class="line">        System.out.println(user.getId());</span><br><span class="line">        System.out.println(user.getUsername());</span><br><span class="line">        System.out.println(user.getPassword());</span><br><span class="line">        System.out.println(user.getAuthorities());</span><br><span class="line">        System.out.println(user.getRoles());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="7、Spring-Security配置类编写"><a href="#7、Spring-Security配置类编写" class="headerlink" title="7、Spring Security配置类编写"></a>7、Spring Security配置类编写</h2><div class="story post-story"><p>这是比较重要的一点，这里决定了拦截的页面以及其他的一些操作。这是一个高度综合的配置类，主要是通过重写 WebSecurityConfigurerAdapter 的部分 configure 配置，来实现用户自定义的部分。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled=true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JwtFilter <span class="title">authenticationTokenFilterBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JwtFilter();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">( AuthenticationManagerBuilder auth )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.userDetailsService( userService ).passwordEncoder( <span class="keyword">new</span> BCryptPasswordEncoder() );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">( HttpSecurity httpSecurity )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        httpSecurity.csrf().disable()</span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS).and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(HttpMethod.OPTIONS, <span class="string">&quot;/**&quot;</span>).permitAll() <span class="comment">// OPTIONS请求全部放行</span></span><br><span class="line">                .antMatchers(HttpMethod.POST, <span class="string">&quot;/authentication/**&quot;</span>).permitAll()  <span class="comment">//登录和注册的接口放行，其他接口全部接受验证</span></span><br><span class="line">                .antMatchers(HttpMethod.POST).authenticated()</span><br><span class="line">                .antMatchers(HttpMethod.PUT).authenticated()</span><br><span class="line">                .antMatchers(HttpMethod.DELETE).authenticated()</span><br><span class="line">                .antMatchers(HttpMethod.GET).authenticated();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用前文自定义的 Token过滤器</span></span><br><span class="line">        httpSecurity</span><br><span class="line">                .addFilterBefore(authenticationTokenFilterBean(), UsernamePasswordAuthenticationFilter.class);</span><br><span class="line"></span><br><span class="line">        httpSecurity.headers().cacheControl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="8、接下来编写Controller类进行测试"><a href="#8、接下来编写Controller类进行测试" class="headerlink" title="8、接下来编写Controller类进行测试"></a>8、接下来编写Controller类进行测试</h2><div class="story post-story"><p>首先是登陆注册的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtAuthController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthService authService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/authentication/login&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createToken</span><span class="params">( String username,String password )</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authService.login( username, password );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/authentication/register&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">register</span><span class="params">( <span class="meta">@RequestBody</span> User addedUser )</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> authService.register(addedUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是测试权限的类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试普通权限</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;ROLE_NORMAL&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping( value=&quot;/normal/test&quot;, method = RequestMethod.GET )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ROLE_NORMAL /normal/test接口调用成功！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试管理员权限</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAuthority(&#x27;ROLE_ADMIN&#x27;)&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping( value = &quot;/admin/test&quot;, method = RequestMethod.GET )</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ROLE_ADMIN /admin/test接口调用成功！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="9、现在我们进行测试"><a href="#9、现在我们进行测试" class="headerlink" title="9、现在我们进行测试"></a>9、现在我们进行测试</h2><div class="story post-story"><ol><li><p>首先测试能否正常登录并获取到Token<img src="https://z3.ax1x.com/2021/11/20/IqbGDK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqbGDK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以看到在账号密码正确的情况下，能返回一个Token，接下来只要访问网页时带上这个Token，就可以顺利进行访问</p></li><li><p>接下来测试能否正常访问网页<br>首先是不带Token的情况：<br><img src="https://z3.ax1x.com/2021/11/20/IqbOPJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqbOPJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>很明显，被拒绝访问了。<br>接下来我们测试一下携带Token的情况：<br><img src="https://z3.ax1x.com/2021/11/20/IqxMd0.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/11/20/IqxMd0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>可以成功访问。</p></li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="SpringSecurity" scheme="http://cyc0819.top/categories/java/SpringSecurity/"/>
    
    <category term="JWT" scheme="http://cyc0819.top/categories/java/JWT/"/>
    
    
    <category term="SpringSecurity" scheme="http://cyc0819.top/tags/SpringSecurity/"/>
    
    <category term="JWT" scheme="http://cyc0819.top/tags/JWT/"/>
    
  </entry>
  
  <entry>
    <title>我们还有必要深入学习jQuery吗</title>
    <link href="http://cyc0819.top/2021/11/17/2021-11-17-%E6%88%91%E4%BB%AC%E8%BF%98%E6%9C%89%E5%BF%85%E8%A6%81%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0jQuery%E5%90%97/"/>
    <id>http://cyc0819.top/2021/11/17/2021-11-17-%E6%88%91%E4%BB%AC%E8%BF%98%E6%9C%89%E5%BF%85%E8%A6%81%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0jQuery%E5%90%97/</id>
    <published>2021-11-17T15:27:41.000Z</published>
    <updated>2021-12-08T09:38:56.041Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="我们还有必要深入学习-jQuery-吗"><a href="#我们还有必要深入学习-jQuery-吗" class="headerlink" title="我们还有必要深入学习 jQuery 吗"></a>我们还有必要深入学习 jQuery 吗</h1><h2 id="表达想法"><a href="#表达想法" class="headerlink" title="表达想法"></a>表达想法</h2><div class="story post-story"><p>前几天在某个视频平台看到一个博主的视频，该博主对于『 我们还有必要深入学习 jQuery 吗？』这个问题做出了一个很肯定的答案：就是没有必要。</p><p>而他对于这个结论并也不是空穴来风，同样是做出了一系列的解释。比如说：jQuery 已经过时了、Vue.js以及React.js这样的前端框架能更好地实现jQuery所能实现的功能等等。</p><p>当然，作为该博主的个人想法，评论区自然是炸开了锅，有人赞同该博主的言论，而也有人对该博主的言论表示不敢苟同。这里我说说我个人的想法：</p><p>我认为 jQuery 虽然是一个多年以前的技术，但是他作为学习路上所必须经历的一段经历，我认为还是有必要进行学习的，但是也不用过度深入，在该阶段花费过多的时间。</p><p>jQuery 的开发模式和 Vue.js 等框架的开发模式是不同的两种开发模式，只有体会到两种开发模式的不同之处，我们才能更深入地理解如今所流行的前端框架所流行的原因，以及 jQuery 落后的原因等等。同样在若干年以后，可能会有更多新的前端框架的出现，替代现在地 vue.js、react.js 等等，到时候，经历过 vue.js 时代的我们，是不是又能从一种新的层面看到多种开发模式地区别呢？我们所了解到的是：为什么是这样子？而不是本来就是这样子。永远保持好奇与探索，对一个开发者来说是极其重要的。</p><p>而对于 js ，我认为我们应该重点对原生的js进行学习，毕竟 jQuery，vue，react 这些框架都是在js的基础上进行封装的，所以说我们在使用这些框架的时候，实际上我们还是在使用 js ，但是方便就方便在这些框架的一些优秀的封装类帮我们实现了 js 中很多复杂操作，我们只要按照框架所规定的语法进行编写，就能很方便的实现 js 中一些复杂的操作，这也是为什么框架技术能够如此流行的原因之一。</p><p>而我们不能只知道使用，而不知原理，这样子是走不远的，但是这并不表示我们就应该去生啃这些框架的源码，而是说我们应该学好 js 的语法，这样子在我们使用时也能很好地理解框架的原理，在使用的过程中，逐步地理解框架。</p></div><h2 id="jQuery-有什么优点？"><a href="#jQuery-有什么优点？" class="headerlink" title="jQuery 有什么优点？"></a>jQuery 有什么优点？</h2><div class="story post-story"><p>抛开现在流行的 vue 等前端框架不谈，我们来说说 jQuery 时代，他都有哪些有优点。</p><ol><li><p>能很好的操作 DOM<br>有这样一个例子，如果我要修改一个元素的样式，我用原生的js是这样子完成地：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dom=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">dom.style.color=<span class="string">&#x27;red&#x27;</span></span><br></pre></td></tr></table></figure><p>而我用 jQuery 来替代上面地代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test&#x27;</span>).css(<span class="string">&#x27;color&#x27;</span>,<span class="string">&#x27;red&#x27;</span>);</span><br></pre></td></tr></table></figure><p>相对于原生的 js 来说，我们的代码精简了许多，在 jQuery 中我们用<code>$</code>来替代了原生 js 中的<code>document.getElementById</code>这一行语句，所以代码精简了许多。</p></li><li><p>极其方便地 ajax 操作<br>在jQuery中，如果我们要使用ajax访问后台的数据，我们可以这样子实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line"><span class="attr">url</span>:<span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line"><span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;请求成功&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>而如果我们要在原生的js中使用 ajax ，那别提有多复杂了，我们首先得创建一个异步对象，然后再设置请求的 url 以及参数，然后发送请求，最后我们需要将其注册到一个事件上，才能进行访问。虽然我们也能将其封装成一个可重复使用的方法，但是对于 jQuery 来说，他还是太麻烦了。</p></li><li><p>更方便的页面动效<br>通常我们的界面需要用到一些很有趣的画面，我们在 jQuery 中可以这样子实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#test&quot;</span>).animate(&#123;<span class="attr">left</span>:<span class="string">&#x27;100px&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></li></ol><p>以上的这些操作，说实话在 js 中我们都可以实现，而 jQuery 作为一个很好的 js 框架，他所封装的很多函数可以大大方便我们的操作，所以这也就是 jQuery 为什么会流行的原因之一。我们自己也能封装一个这样的代码库，只是我们可能不能做到这么优秀，也不一定有时间和精力来做这样的工作。</p></div><h2 id="MVVM-框架是怎么替代-jQuery-的？"><a href="#MVVM-框架是怎么替代-jQuery-的？" class="headerlink" title="MVVM 框架是怎么替代 jQuery 的？"></a>MVVM 框架是怎么替代 jQuery 的？</h2><div class="story post-story"><p>现在的 MVVM 框架，他们都引入了几个新的概念：模块化、组件化。并采用了虚拟 DOM 的方式来替代原来的 DOM 操作，在这些框架中，数据和视图实现了分离，对数据的操作不在需要引用响应的 DOM 对象，达到了编程世界中一个共同的目标——解耦。</p><ol><li><p>针对 DOM 操作<br>在 MVVM 框架中，我们基本看不到 DOM 操作的影子，是因为他们采用了一种绑定元素渲染的方式，来绑定我们的视图以及数据。比如说 vue 框架中的<code>v-model</code>。<br>但是 DOM 操作不可能完全不需要，某些特殊情况还是会用到。</p></li><li><p>针对 ajax 操作<br>在 ajax 操作方面，基本上是被 axios 这样的库给替代了，而且所实现的功能与 ajax 都差不多，而且能更好地契合这些框架。</p></li><li><p>针对界面动效<br>CSS 3已经能很好地实现界面动态地效果。而且有很多优秀的动效库，能完美适配现在流行的框架，并能更好的实现很多好看的动效。</p></li></ol></div><h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><div class="story post-story"><p>可能在若干年后地某一天，又会出现更新的比现在更好的框架，那时候又会更加方便我们的使用。而我们同样要顺应时代地潮流，去学习这些新的技术，从入了编程这一行开始，我就深知这是一个需要不断学习知识，更新自己的行业，如果停止学习，就会被高速发展的互联网行业抛弃。所以这是一个很『内卷』的行业，我喜欢这种挑战，也渴望能从这种挑战中获得一个不断进步的自己。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="随笔" scheme="http://cyc0819.top/categories/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="前端" scheme="http://cyc0819.top/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
    <category term="随笔" scheme="http://cyc0819.top/tags/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="前端" scheme="http://cyc0819.top/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Service中包含哪些代码</title>
    <link href="http://cyc0819.top/2021/11/12/2021-11-12-Service%E4%B8%AD%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E4%BB%A3%E7%A0%81/"/>
    <id>http://cyc0819.top/2021/11/12/2021-11-12-Service%E4%B8%AD%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E4%BB%A3%E7%A0%81/</id>
    <published>2021-11-12T15:49:01.000Z</published>
    <updated>2021-12-08T09:31:05.817Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Service中包含哪些代码"><a href="#Service中包含哪些代码" class="headerlink" title="Service中包含哪些代码"></a>Service中包含哪些代码</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><div class="story post-story"><p>Service层中 = 核心功能(几十行 上百代码) + 额外功能(附加功能)</p><ol><li>核心功能<br>业务运算<br>DAO调用</li><li>额外功能 <ol><li>不属于业务</li><li>可有可无</li><li>代码量很小 </li></ol></li></ol><p>以及：事务、日志、性能…</p><p>Service层，作为程序的业务层面，其中最重要的必然是程序的业务流程，只有对程序的业务流程有足够的了解，才能写出优秀的Service层代码。</p><p>不冗余，是一个程序员代码水平的一个体现。</p></div><h2 id="2、接口"><a href="#2、接口" class="headerlink" title="2、接口"></a>2、接口</h2><div class="story post-story"><p>为什么要先写接口？<br>接口的作用是什么？</p><p>这里我引用一句话:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接口主要用于描述类具有什么功能，而并不给出每个功能的具体实现。一个类可以实现一个或多个接口，并在需要接口的地方，随时使用实现了相应接口的对象。——《Java核心技术卷一》</span><br></pre></td></tr></table></figure><p>这句话所描述的是接口的扩展性。简而言就是：接口是一个统一的插座，如果有需要我们就可以直接进行调用，实现了即插即用。</p><p>例如：有一个登录功能需要我们去实现，而该系统又有多种登陆方式，我们不可能每种接口都写一个Service代码给Controller进行调用，这样是十分繁琐的。而我们将多种登陆的方式统一成一个接口，然后根据用户的需求来分配最后实际的实现类。此时对于使用者来说，他们只需要关注的是登陆这个方法，整个登陆操作变得十分灵活，根据不同的场景使用不同的方式登陆。</p><p>对于开发者来说，接口中清晰地列出了所有地方法，对于后期的维护以及修改也是有极大的方便。</p></div><h2 id="3、Service之间的互相调用"><a href="#3、Service之间的互相调用" class="headerlink" title="3、Service之间的互相调用"></a>3、Service之间的互相调用</h2><div class="story post-story"><p>Service层之间可以相互调用吗？</p><p>这个问题相信很多人都有过思考，理论上来讲是不应该相互进行调用的，因为Service层的存在的一个很重要的目的就是 <strong>解耦</strong> 。</p><p>将业务层的每一个业务独立出来，以至于他们之间不相互影响，能够实现代码的优化，否则多种业务的代码混在一起，长久之后谁都看不出来代码的逻辑。所以说Service层就实现了这一个很重要的功能。</p><p>所以如果Service层之间的代码相互调用，是不是会是一种倒退呢？</p><p>有些人可能会问，有些业务中确实是会使用到其他业务中的代码，那这部分代码怎么办？重新写？那是不可能的，这又犯了冗余这个错误。所以我们该怎么解决呢？</p><p>首先，我们要清楚，这个情况是出于Service间有通用的逻辑，而不是通用的业务，每个Service对应一个业务，业务之间应该有明确的分界，不然会出现业务间的耦合，这是设计的不合理。</p><p> 既然是通用的逻辑，我们是不是又可以把他们抽象出来，独立成一个工具类，当我们需要的时候直接进行调用这个工具类就可以了呢？</p><p> 所以我个人认为Service层之间是不建议相互调用的。</p></div><h2 id="4、需要向Conrtroller层展示业务吗？"><a href="#4、需要向Conrtroller层展示业务吗？" class="headerlink" title="4、需要向Conrtroller层展示业务吗？"></a>4、需要向Conrtroller层展示业务吗？</h2><div class="story post-story"><p>当我们实现一个登录功能的时候，Controller层，调用Service层，往往我以前的写法是，Service返回登录成功或者失败的代码，然后Controller进行一个判断，判断是否成功登录，然后再向前端返回信息。这样子的写法有个问题，Controller判断的一个过程，算不算是业务？如果算，是不是Controller层又接触到了业务？</p><p>又回到了之前的问题，为什么要有Service层？</p><p>所以说，我们应该让Controller层尽可能少的接触到业务，所以我们的写法可以优化为，再Service层做完所有业务相关的工作，最后返回给Controller层的是一个开箱即用的接口，这样子是不是可以避免Controller层接触到业务相关的代码呢？<br>这就又符合了我们使用Service层的初衷了。</p></div><h2 id="5、最后"><a href="#5、最后" class="headerlink" title="5、最后"></a>5、最后</h2><div class="story post-story"><p>在看了一些文章之后，个人的一些小小观点。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_leetcode设计模块</title>
    <link href="http://cyc0819.top/2021/10/09/2021-10-09-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_leetcode%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9D%97/"/>
    <id>http://cyc0819.top/2021/10/09/2021-10-09-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_leetcode%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9D%97/</id>
    <published>2021-10-09T06:39:20.000Z</published>
    <updated>2021-12-08T09:30:51.311Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="leetcode设计模块"><a href="#leetcode设计模块" class="headerlink" title="leetcode设计模块"></a>leetcode设计模块</h1><h2 id="1、子矩形查询"><a href="#1、子矩形查询" class="headerlink" title="1、子矩形查询"></a>1、子矩形查询</h2><div class="story post-story"><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/subrectangle-queries/">lettcode-1476题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FPlgH.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FPlgH.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>按照题目的要求，我们需要根据输入的坐标，拿到该坐标的值。<br>以及根据输入的两个坐标和一个值，修改两个坐标之间的值为所给出来的值。<br>所以实现这两个功能首先我们需要一个二维数组。拿到坐标的值并不难。<br>主要是修改两个坐标之间的值。<br>因为输入的两个坐标，假如是<code>(1,1)</code>和<code>(3,4)</code> ,所以可以看出来纵坐标是修改1和4之间的值，然后横坐标是修改1，3之间的值。所以通过遍历可以遍历第一行的1-4列，第二行的1-4列一直循环下去，最终修改所有的值。</p><h3 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubrectangleQueries</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[][] rectangle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubrectangleQueries</span><span class="params">(<span class="keyword">int</span>[][] rectangle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rectangle=rectangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSubrectangle</span><span class="params">(<span class="keyword">int</span> row1, <span class="keyword">int</span> col1, <span class="keyword">int</span> row2, <span class="keyword">int</span> col2, <span class="keyword">int</span> newValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=row1;i&lt;=row2;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=col1;j&lt;=col2;j++)&#123;</span><br><span class="line">                rectangle[i][j]=newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rectangle[row][col];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="2、TinyURL-的加密与解密"><a href="#2、TinyURL-的加密与解密" class="headerlink" title="2、TinyURL 的加密与解密"></a>2、TinyURL 的加密与解密</h2><div class="story post-story"><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/encode-and-decode-tinyurl/">lettcode-535题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FkmEq.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FkmEq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h3><p>为了加密 URL，我们使用计数器 (ii) ，每遇到一个新的 URL 都加一。我们将 URL 与它的次数 ii 放在哈希表 HashMap 中，这样我们在稍后的解密中可以轻易地获得原本的 URL</p><h3 id="具体代码-1"><a href="#具体代码-1" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Codec</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;Integer, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Encodes a URL to a shortened URL.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(String longUrl)</span> </span>&#123;</span><br><span class="line">        map.put(i,longUrl);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http://tinyurl.com/&quot;</span> + i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Decodes a shortened URL to its original URL.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">decode</span><span class="params">(String shortUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(Integer.parseInt(shortUrl.replace(<span class="string">&quot;http://tinyurl.com/&quot;</span>, <span class="string">&quot;&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="3、二叉搜索树迭代器"><a href="#3、二叉搜索树迭代器" class="headerlink" title="3、二叉搜索树迭代器"></a>3、二叉搜索树迭代器</h2><div class="story post-story"><h3 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/binary-search-tree-iterator/">lettcode-173题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FAJSS.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FAJSS.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h3><p>二叉树，我们可以使用一个TreeNode来实现，其中我们将遍历到的值错放到一个list集合中去。<br>二叉树的中序遍历，遍历顺序是：左节点-中节点-右节点。<br>所以我们在方法中输入一个二叉树，重复进行遍历，即可得到最后中序遍历的结果。</p><h3 id="具体代码-2"><a href="#具体代码-2" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BSTIterator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; arr;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BSTIterator</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">        arr = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        inorderTraversal(root, arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arr.get(index++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index &lt; arr.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inorderTraversal</span><span class="params">(TreeNode root, List&lt;Integer&gt; arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//实现中序遍历 左-中-右</span></span><br><span class="line">        inorderTraversal(root.left, arr);</span><br><span class="line">        arr.add(root.val);</span><br><span class="line">        inorderTraversal(root.right, arr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、设计一个支持增量操作的栈"><a href="#4、设计一个支持增量操作的栈" class="headerlink" title="4、设计一个支持增量操作的栈"></a>4、设计一个支持增量操作的栈</h2><div class="story post-story"><h3 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/design-a-stack-with-increment-operation/">lettcode-1381题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5F35b6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5F35b6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目要求这个栈需要有一个最大数量，所以我们需要定义一个变量来限制栈的大小。<br>如果没有达到最大数量，就将新元素添加到栈的顶端，否则就不允许添加。<br>当删除栈中元素的时候，首先删除栈顶端的元素，如果栈中没有东西，就返回一个 -1<br>更新栈中的元素的时候首先判断栈中的数量与输入的k的大小关系，如果k大，就将栈中元素数量作为更新的数量，由于index是由0开始的，所以数量就是index+1，否则就是以k作为数量。</p><h3 id="具体代码-3"><a href="#具体代码-3" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">int</span>[] myStack=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> head=-<span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomStack</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line">        myStack=<span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">        <span class="keyword">this</span>.maxSize=maxSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head==myStack.length-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            myStack[++head]=x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head==-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> myStack[head--];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> min;</span><br><span class="line">        <span class="keyword">if</span> (head&lt;k)&#123;</span><br><span class="line">            min=head+<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            min=k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;min;i++)&#123;</span><br><span class="line">            myStack[i]+=val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、在受污染的二叉树中查找元素"><a href="#5、在受污染的二叉树中查找元素" class="headerlink" title="5、在受污染的二叉树中查找元素"></a>5、在受污染的二叉树中查找元素</h2><div class="story post-story"><h3 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/find-elements-in-a-contaminated-binary-tree/">lettcode-1261题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FJsVP.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FJsVP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h3><p>通过题目我们可以看出，根节点的左子树是2x+1，右子树是2x+2，所以以此类推下去，就能还原出二叉树。<br>首先得判断是否有子节点。<br>然后如果一个节点没有父子树，就说明他是根节点，就将他设为0</p><h3 id="具体代码-4"><a href="#具体代码-4" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FindElements</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Set&lt;Integer&gt; set=<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FindElements</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        rebuildTree(root, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断 Set 集合是否包含指定的对象</span></span><br><span class="line">        <span class="keyword">return</span> set.contains(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rebuildTree</span><span class="params">(TreeNode root, TreeNode parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果没有父节点，就设为0</span></span><br><span class="line">        <span class="comment">// 否则就执行下面的条件</span></span><br><span class="line">        <span class="keyword">if</span> (parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">            root.val = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.val = root == parent.left ?</span><br><span class="line">                    (parent.val &lt;&lt; <span class="number">1</span>) + <span class="number">1</span> : (parent.val &lt;&lt; <span class="number">1</span>) + <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将结果添加到set中</span></span><br><span class="line">        set.add(root.val);</span><br><span class="line">        <span class="comment">// 重复执行上面的内容</span></span><br><span class="line">        rebuildTree(root.left, root);</span><br><span class="line">        rebuildTree(root.right, root);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="6、扁平化嵌套列表迭代器"><a href="#6、扁平化嵌套列表迭代器" class="headerlink" title="6、扁平化嵌套列表迭代器"></a>6、扁平化嵌套列表迭代器</h2><div class="story post-story"><h3 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/flatten-nested-list-iterator/">lettcode-341题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5Faz40.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5Faz40.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h3><p>从题目上看，题目所输入的数据就是一个嵌套的数组，一个数组中可以存放整数，也可以存放一个新的数组。<br>而当我们进行遍历时需要先遍历完一个数组，然后再遍历后面的数组，相当于把多个数组中的值给摊开成一个只有整数的数组。<br>所以我们在遍历时，将遍历的方法抽成一个独立的方法。如果碰到嵌套数组，我们就再次对遍历的方法进行调用，依次重复多次，就可以实现对多个嵌套数组的遍历。</p><h3 id="具体代码-5"><a href="#具体代码-5" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NestedIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NestedIterator</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;</span><br><span class="line">        add(nestedList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (NestedInteger nestedInteger : nestedList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nestedInteger.isInteger()) &#123;</span><br><span class="line">                list.add(nestedInteger.getInteger());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//重新遍历嵌套的数组</span></span><br><span class="line">                add(nestedInteger.getList());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.get(index++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index&lt;list.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="7、实现-Trie-前缀树"><a href="#7、实现-Trie-前缀树" class="headerlink" title="7、实现 Trie (前缀树)"></a>7、实现 Trie (前缀树)</h2><div class="story post-story"><h3 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/implement-trie-prefix-tree/">lettcode-208题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FBvsU.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FBvsU.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h3><p>前缀树，又叫做字典树。通过阅读题目，这一题我们可以用List数组来实现。<br>其中添加元素可以用add方法来实现，而contains方法可以用来判断数组中书否有该元素。<br>startsWith方法即可用用于判断数组中的元素是否包含某一个值。</p><h3 id="具体代码-6"><a href="#具体代码-6" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        list.add(word);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(word)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String lists:list)&#123;</span><br><span class="line">            <span class="keyword">if</span> (lists.startsWith(prefix))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="8、皇位继承顺序"><a href="#8、皇位继承顺序" class="headerlink" title="8、皇位继承顺序"></a>8、皇位继承顺序</h2><div class="story post-story"><h3 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/throne-inheritance/">lettcode-1600题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FyFWn.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FyFWn.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h3><p>这题一开始读起来有点晦涩难懂，和后面读起来其实就是类似于我国古代的世袭机制。<br>首先是皇帝，然后长子次子，但是长子之后的皇帝应该是长子的后代，如果长子没有后代了，皇帝才会传给次子。类似这样子循环下去。<br>然后我们需要每个人有一个列表来存储他的后代们。所以可以使用HashMap来实现这一功能。<br>然后该Map的键是String类型，值是一个list类型。所以比如说皇帝A，他的A就是键，他的后代就构成了Map的值list。<br>死亡人员我们可以用一个Set来实现，因为他是不可重复的，一个人也不可能死很多次，所以我们将死亡的人员放到其中。<br>最后是排序。首先判断在set中的人员，将他们删除，然后循环遍历List中的值。首先我们输入皇帝的名字，然后就会遍历皇帝的后代，遍历到皇帝的第一个后代，又会遍历到他的第一个后代的后代，一直到完，就是深度优先遍历。<br>所以我们可以将便利的代码抽成一个独立的方法，以供重复进行调用，实现这个功能。</p><h3 id="具体代码-7"><a href="#具体代码-7" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThroneInheritance</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String kingName;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;String&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">//不可重复</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; deathSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThroneInheritance</span><span class="params">(String kingName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.kingName=kingName;</span><br><span class="line">        map.put(kingName,<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">birth</span><span class="params">(String parentName, String childName)</span> </span>&#123;</span><br><span class="line">        map.get(parentName).add(childName);</span><br><span class="line">        map.put(childName,<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">death</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        deathSet.add(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getInheritanceOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        add(list,kingName);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(List&lt;String&gt; list, String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!deathSet.contains(name))&#123;</span><br><span class="line">            list.add(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//遍历该人物的子孙</span></span><br><span class="line">        <span class="keyword">for</span> (String names:map.get(name))&#123;</span><br><span class="line">            add(list,names);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="算法" scheme="http://cyc0819.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="算法" scheme="http://cyc0819.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ入门使用</title>
    <link href="http://cyc0819.top/2021/10/06/2021-10-06-RabbitMQ%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
    <id>http://cyc0819.top/2021/10/06/2021-10-06-RabbitMQ%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/</id>
    <published>2021-10-06T13:49:01.000Z</published>
    <updated>2021-12-08T09:30:44.667Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RabbitMQ入门使用"><a href="#RabbitMQ入门使用" class="headerlink" title="RabbitMQ入门使用"></a>RabbitMQ入门使用</h1><h2 id="1、同步、异步通信"><a href="#1、同步、异步通信" class="headerlink" title="1、同步、异步通信"></a>1、同步、异步通信</h2><div class="story post-story"><p>我们服务之间的通信，一般分为同步和异步两种方式。</p><p><strong>同步</strong>就是：当两个服务间通信时，必须要每一步按照顺序进行之后再进行下一步的内容。看上去同步可以立即得到结果，好像很好。但是这样的通信方式往往就会产生一些问题。</p><ol><li>耦合度较高。当我们加入新的需求时，需要修改很多的代码。</li><li>性能不好。因为每次都要等待上一个服务完成，所以会消耗很多时间，导致性能下降.</li><li>资源浪费。在等待服务完成的时候，不能释放资源，也不能做事情，就导致了资源的浪费。</li><li>级联失败。如果服务调用过程中一个环节出现错误，就会导致其他环节跟着出现错误。就像是多米诺骨牌一样。</li></ol><p><strong>异步</strong>就是：当两个服务间通信时，A将资料传给B的时候，就可以继续去做自己的事情，而不用一直等待B传送消息回来，在B有空的时候处理就可以。同时，异步通信解决了一些同步通信存在的问题：<code>耦合度低</code>，<code>吞吐量提升</code>，<code>故障隔离</code> ，<code>流量削峰</code>。<br>但是同时也带来了一些新的问题：</p><ol><li>依赖于Broker的可靠性、安全性、吞吐能力</li><li>架构复杂了，业务没有明显的流程线，不好追踪管理</li></ol><p>所以我们在使用的时候，应该根据实际情况来使用异步或者同步通信。</p></div><h2 id="2、消息队列（MQ）简介"><a href="#2、消息队列（MQ）简介" class="headerlink" title="2、消息队列（MQ）简介"></a>2、消息队列（MQ）简介</h2><div class="story post-story"><p>MQ （MessageQueue），中文是消息队列，字面来看就是存放消息的队列。也就是事件驱动架构中的Broker。</p><p>消息队列中间件是分布式系统中重要的组件，主要解决应用耦合、异步消息、流量削锋等问题。实现高性能、高可用、可伸缩和最终一致性架构。是大型分布式系统不可缺少的中间件。</p><h3 id="2-1、常见的MQ"><a href="#2-1、常见的MQ" class="headerlink" title="2.1、常见的MQ"></a>2.1、常见的MQ</h3><p>以下就是四种我们常用的MQ以及它们之间的对比：<br><img src="https://i.bmp.ovh/imgs/2021/10/6d1e83477fe9a9c8.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6d1e83477fe9a9c8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>接下来我们就以RabbitMQ来作为我们学习的工具。</p><h3 id="2-2、RabbitMQ介绍以及安装"><a href="#2-2、RabbitMQ介绍以及安装" class="headerlink" title="2.2、RabbitMQ介绍以及安装"></a>2.2、RabbitMQ介绍以及安装</h3><p>RabbitMQ是基于Erlang语言开发的开源消息通信中间件，官网地址：<a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p><p>由于它是基于Erlang语言开发的，所以我们必须安装Erlang语言的开发环境。<br>为了省时间，我们这里直接在Dockers里面进行安装并做一个映射。<br>步骤如下：</p><ol><li>下载RabbitMQ的镜像<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure></li><li>安装mq<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=chenyicai \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123456 \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq1 \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3-management</span><br></pre></td></tr></table></figure>然后我们的RabbitMQ就安装完成了，现在我们可以在浏览器输入服务器地址+15672进入RabbitMQ的控制台<br><img src="https://i.bmp.ovh/imgs/2021/10/d864df3d43bd58c4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/d864df3d43bd58c4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>账号密码就是我们前面设置好的<code>chenyicai</code>和<code>123456</code><br>登录之后：<br><img src="https://i.bmp.ovh/imgs/2021/10/9079fb7ec4d8d3db.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/9079fb7ec4d8d3db.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>以下是RabbitMQ中的几个基本概念：</p><ul><li>channel：操作MQ的工具</li><li>exchange：路由消息到队列中</li><li>queue：缓存消息</li><li>virtual host：虚拟主机，是对queue、exchange等资源的逻辑分组</li></ul></div><h2 id="3、常见的消息模型"><a href="#3、常见的消息模型" class="headerlink" title="3、常见的消息模型"></a>3、常见的消息模型</h2><div class="story post-story"><h3 id="3-1、官方给出的消息模型"><a href="#3-1、官方给出的消息模型" class="headerlink" title="3.1、官方给出的消息模型"></a>3.1、官方给出的消息模型</h3><p>官方一共给出的五个MQ的Demo，分别对应了几种不同的用法：</p><ol><li>基本消息队列（BasicQueue）</li><li>工作消息队列（WorkQueue）</li><li>发布订阅（Publish、Subscribe），又根据交换机类型不同分为三种：<ol><li>Fanout Exchange：广播</li><li>Direct Exchange：路由</li><li>Topic Exchange：主题</li></ol></li></ol><p><img src="https://i.bmp.ovh/imgs/2021/10/6e351b659680b5ee.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6e351b659680b5ee.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://i.bmp.ovh/imgs/2021/10/830978c3cd4ea8dc.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/830978c3cd4ea8dc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="3-2、Hello-World"><a href="#3-2、Hello-World" class="headerlink" title="3.2、Hello World"></a>3.2、Hello World</h3><p>现在我们就在SpringBoot里面实现以下官方示例中的Hello World这个例子。<br>官方的HelloWorld是基于最基础的消息队列模型来实现的，只包括三个角色：</p><ol><li>publisher：消息发布者，将消息发送到队列queue</li><li>queue：消息队列，负责接受并缓存消息</li><li>consumer：订阅队列，处理队列中的消息</li></ol><p>所以我们实现这个例子的步骤如下：<br>基本消息队列的消息发送流程：</p><ol><li>建立connection<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></span><br><span class="line">factory.setHost(<span class="string">&quot;8.129.212.155&quot;</span>);</span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">factory.setUsername(<span class="string">&quot;chenyicai&quot;</span>);</span><br><span class="line">factory.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br></pre></td></tr></table></figure></li><li>创建通道channel<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Channel channel = connection.createChannel();</span><br></pre></td></tr></table></figure></li><li>利用channel声明队列<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//队列名</span></span><br><span class="line">String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line"><span class="comment">//队列的属性</span></span><br><span class="line">channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure></li><li>利用channel向队列发送消息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String message = <span class="string">&quot;hello, rabbitmq!&quot;</span>;</span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">System.out.println(<span class="string">&quot;发送消息成功：【&quot;</span> + message + <span class="string">&quot;】&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><p>基本消息队列的消息接收流程：</p><ol><li>建立connection</li><li>创建通道channel</li><li>利用channel声明队列</li><li>定义consumer的消费行为handleDelivery()<br>利用channel将消费者与队列绑定<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">channel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope,</span></span></span><br><span class="line"><span class="params"><span class="function">             AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">// 5.处理消息</span></span><br><span class="line">String message = <span class="keyword">new</span> String(body);</span><br><span class="line">System.out.println(<span class="string">&quot;接收到消息：【&quot;</span> + message + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;等待接收消息。。。。&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><p>很显然如果每次使用消息队列都这样开关连接，那么是非常不好的一种现象，所以我们接下来就要使用Spring的一个框架，来更好地帮助我们对消息队列进行使用。</p></div><h2 id="4、SpringAMQP"><a href="#4、SpringAMQP" class="headerlink" title="4、SpringAMQP"></a>4、SpringAMQP</h2><div class="story post-story"><h3 id="4-1、什么是SpringAMQP"><a href="#4-1、什么是SpringAMQP" class="headerlink" title="4.1、什么是SpringAMQP"></a>4.1、什么是SpringAMQP</h3><p>SpringAmqp的官方地址：<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a><br><img src="https://i.bmp.ovh/imgs/2021/10/a347fedc49140107.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/a347fedc49140107.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>AMQP：是用于在应用程序之间传递业务消息的开放标准。该协议与语言和平台无关，更符合微服务中独立性的要求。</p><p>SpringAMQP：是基于AMQP协议定义的一套API规范，提供了模板来发送和接受消息。包含两部分，其中Spring-AMQP是基础抽象，Spring-rabbit是底层的默认实现。</p><h3 id="4-2、SpringAMQP实现Hello-World"><a href="#4-2、SpringAMQP实现Hello-World" class="headerlink" title="4.2、SpringAMQP实现Hello World"></a>4.2、SpringAMQP实现Hello World</h3><p>Spring中已经集成了AMQP的依赖，所以我们只需要引入依赖就可以实现自动注入，具体步骤如下：</p><ol><li>引入SpringAMQP的依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>在publisher中编写一个yml配置文件，添加mq连接的信息<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">8.129</span><span class="number">.212</span><span class="number">.155</span> <span class="comment"># rabbitMQ的ip地址</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">chenyicai</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure></li><li>在publisher服务中新建一个测试类，编写测试方法发送消息：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAmqpTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMessage2SimpleQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        String message = <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>如果此时我们没有接受信息，信息就会存在mq的缓存区里面，如下:<br><img src="https://i.bmp.ovh/imgs/2021/10/7fff7b4306ad9074.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/7fff7b4306ad9074.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://i.bmp.ovh/imgs/2021/10/77dd30c482f123d4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/77dd30c482f123d4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>在consumer中接受消息（consumer中也要创建连接配置文件）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenSimpleQueue</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到simple.queue的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>现在我们就完成了一个Hello World的例子的实现。<br>结果如下：<br><img src="https://i.bmp.ovh/imgs/2021/10/6d5247dea94d40d9.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6d5247dea94d40d9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>消息队列是阅后即焚的，是一个不可逆的过程。<br>现在我们看看剩下的几个例子。</li></ol><h3 id="4-3、Work-Queue-工作队列"><a href="#4-3、Work-Queue-工作队列" class="headerlink" title="4.3、Work Queue 工作队列"></a>4.3、Work Queue 工作队列</h3><p>工作队列，可以提高消息处理速度，避免队列消息堆积<br>他的逻辑图如下：<br><img src="https://i.bmp.ovh/imgs/2021/10/71a3d073f2914be1.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/71a3d073f2914be1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>现在我们要来实现一个工作队列</p><ol><li>在publisher服务中添加一个测试方法，循环发送50条消息到simple.queue队列<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAmqpTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMessage2WorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        String message = <span class="string">&quot;hello, message__&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) &#123;</span><br><span class="line">            rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">            Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在consumer服务中添加一个消费者，也监听simple.queue：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者1接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;消费者2........接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>然后我们修改yml配置文件，添加以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment">#每次只能获取一条消息，处理完成才能获取下一个消息</span></span><br></pre></td></tr></table></figure></li><li>然后我们进行测试，结果如下<br><img src="https://z3.ax1x.com/2021/10/06/5SSH0J.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5SSH0J.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>两个消费者就会交替获取信息，而睡眠20毫秒的用户会比睡眠200毫秒的用户获取更多的信息。</p><h3 id="4-4、发布（-Publish-）、订阅（-Subscribe-）"><a href="#4-4、发布（-Publish-）、订阅（-Subscribe-）" class="headerlink" title="4.4、发布（ Publish ）、订阅（ Subscribe ）"></a>4.4、发布（ Publish ）、订阅（ Subscribe ）</h3><p>发布订阅模式与之前案例的区别就是允许将同一消息发送给多个消费者。实现方式是加入了exchange（交换机）。<br>常见exchange类型包括：</p><ul><li>Fanout：广播</li><li>Direct：路由</li><li>Topic：话题</li></ul><p><img src="https://z3.ax1x.com/2021/10/06/5SpKBQ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5SpKBQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>注意</strong>：exchange负责消息路由，而不是存储，路由失败则消息丢失</p><h4 id="4-4-1、发布订阅-Fanout-Exchange"><a href="#4-4-1、发布订阅-Fanout-Exchange" class="headerlink" title="4.4.1、发布订阅-Fanout Exchange"></a>4.4.1、发布订阅-Fanout Exchange</h4><p><code>Fanout Exchange</code> 会将接收到的消息广播到每一个跟其绑定的queue</p><p>具体实现步骤如下：</p><ol><li>在<code>consumer</code>服务声明<code>Exchange</code>、<code>Queue</code>、<code>Binding</code><br>在<code>consumer</code>服务常见一个类，添加<code>@Configuration</code> 注解，并声明<code>FanoutExchange</code>、<code>Queue</code>和绑定关系对象<code>Binding</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// itcast.fanout</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fanout.queue1</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueue1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定队列1到交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">fanoutBinding1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(fanoutQueue1)</span><br><span class="line">                .to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fanout.queue2</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueue2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定队列2到交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">fanoutBinding2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(fanoutQueue2)</span><br><span class="line">                .to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在<code>consumer</code>服务的<code>SpringRabbitListener</code>类中，添加两个方法，分别监听<code>fanout.queue1</code>和<code>fanout.queue2</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenFanoutQueue1</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到fanout.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenFanoutQueue2</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到fanout.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在<code>publisher</code>服务发送消息到<code>FanoutExchange</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendFanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 交换机名称</span></span><br><span class="line">       String exchangeName = <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">       <span class="comment">// 消息</span></span><br><span class="line">       String message = <span class="string">&quot;hello, every one!&quot;</span>;</span><br><span class="line">       <span class="comment">// 发送消息</span></span><br><span class="line">       rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li>测试，此时两个消费者都会受到这条消息<br><img src="https://z3.ax1x.com/2021/10/06/5S9Va9.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5S9Va9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h4 id="4-4-2、发布订阅-DirectExchange"><a href="#4-4-2、发布订阅-DirectExchange" class="headerlink" title="4.4.2、发布订阅-DirectExchange"></a>4.4.2、发布订阅-DirectExchange</h4><p><code>Direct Exchange</code> 会将接收到的消息根据规则路由到指定的<code>Queue</code>，因此称为路由模式（routes）。</p><ul><li>每一个<code>Queue</code>都与<code>Exchange</code>设置一个<code>BindingKey</code></li><li>发布者发送消息时，指定消息的<code>RoutingKey</code></li><li><code>Exchange</code>将消息路由到<code>BindingKey</code>与消息<code>RoutingKey</code>一致的队列<br><img src="https://z3.ax1x.com/2021/10/06/5S9KxK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5S9KxK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ul><p>具体实现步骤如下：</p><ol><li>在<code>consumer</code>服务中，编写两个消费者方法，分别监听<code>direct.queue1</code>和<code>direct.queue2</code>。并利用<code>@RabbitListener</code>声明<code>Exchange</code>、<code>Queue</code>、<code>RoutingKey</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">           key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenDirectQueue1</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">           key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenDirectQueue2</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在<code>publisher</code>服务发送消息到<code>DirectExchange</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendDirectExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 交换机名称</span></span><br><span class="line">       String exchangeName = <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">       <span class="comment">// 消息</span></span><br><span class="line">       String message = <span class="string">&quot;hello, red!&quot;</span>;</span><br><span class="line">       <span class="comment">// 发送消息</span></span><br><span class="line">       rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ol><p>测试如下：<br><img src="https://z3.ax1x.com/2021/10/07/5S9Lz6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5S9Lz6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>两个都能收到<code>red</code>的消息，而我们现在换一种发送消息的方式看看，发送一个<code>blue</code>的消息，按照规定<code>direct.queue2</code>应该是没有消息的。<br><img src="https://z3.ax1x.com/2021/10/07/5SCkSP.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCkSP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>确实是这个样子。</p><h4 id="4-4-3、发布订阅-TopicExchange"><a href="#4-4-3、发布订阅-TopicExchange" class="headerlink" title="4.4.3、发布订阅-TopicExchange"></a>4.4.3、发布订阅-TopicExchange</h4><p><code>TopicExchange</code>与<code>DirectExchange</code>类似，区别在于<code>routingKey</code>必须是多个单词的列表，并且以 <code>. </code>分割。<br><code>Queue</code>与<code>Exchange</code>指定<code>BindingKey</code>时可以使用通配符：</p><ul><li>#：代指0个或多个单词</li><li>*：代指一个单词</li></ul><p><img src="https://z3.ax1x.com/2021/10/07/5SCQWq.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCQWq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>实现步骤如下：</p><ol><li>在<code>consumer</code>服务中，编写两个消费者方法，分别监听<code>topic.queue1</code>和<code>topic.queue2</code>。<br>并利用<code>@RabbitListener</code>声明<code>Exchange</code>、<code>Queue</code>、<code>RoutingKey</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">           key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenTopicQueue1</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到topic.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">           key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenTopicQueue2</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到topic.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li>在<code>publisher</code>服务发送消息到<code>TopicExchange</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendTopicExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 交换机名称</span></span><br><span class="line">       String exchangeName = <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">       <span class="comment">// 消息</span></span><br><span class="line">       String message = <span class="string">&quot;中国新闻&quot;</span>;</span><br><span class="line">       <span class="comment">// 发送消息</span></span><br><span class="line">       rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ol><p>进行测试，此时两个消费者都能接收到消息<br><img src="https://z3.ax1x.com/2021/10/07/5SCc0e.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCc0e.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果修改<code>key</code>的值，后面不为<code>news</code>时，<code>topic.queue2</code>将无法收到消息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendTopicExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 交换机名称</span></span><br><span class="line">        String exchangeName = <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">        <span class="comment">// 消息</span></span><br><span class="line">        String message = <span class="string">&quot;中国新闻,一条&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.new&quot;</span>, message);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>结果如下：<br><img src="https://z3.ax1x.com/2021/10/07/5SCI6f.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCI6f.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="4-5、SpringAMQP-消息转换器"><a href="#4-5、SpringAMQP-消息转换器" class="headerlink" title="4.5、SpringAMQP-消息转换器"></a>4.5、SpringAMQP-消息转换器</h3><p>在<code>SpringAMQP</code>的发送方法中，接收消息的类型是<code>Object</code>，也就是说我们可以发送任意对象类型的消息，<code>SpringAMQP</code>会帮我们序列化为字节后发送。</p><p>我们在<code>consumer</code>中利用<code>@Bean</code>声明一个队列：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">objectQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;object.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>publisher</code>中发送消息以测试:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       <span class="comment">// 准备消息    </span></span><br><span class="line">       Map&lt;String,Object&gt; msg = <span class="keyword">new</span> HashMap&lt;&gt;();    </span><br><span class="line">       msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);    </span><br><span class="line">       msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">       <span class="comment">// 发送消息 </span></span><br><span class="line">       rabbitTemplate.convertAndSend(<span class="string">&quot;object.queue&quot;</span>, msg);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>会发现在消息队列中我们传过去的是一堆乱码<br><img src="https://z3.ax1x.com/2021/10/07/5SP6g0.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SP6g0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其实就是<code>java</code>将我们的消息进行了一个序列化来进行传输，但是这样子十分不具有可读性，而且字符串较长，会影响到传输的效率。</p><p><code>Spring</code>的对消息对象的处理是由<code>org.springframework.amqp.support.converter.MessageConverter</code>来处理的。而默认实现是<code>SimpleMessageConverter</code>，基于<code>JDK</code>的<code>ObjectOutputStream</code>完成序列化。<br>如果要修改只需要定义一个<code>MessageConverter</code> 类型的<code>Bean</code>即可。推荐用<code>JSON</code>方式序列化，步骤如下：</p><ol><li>首先我们需要引入json的依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>publisher服务声明MessageConverter（可以放在启动类上）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MessageConverter <span class="title">messageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>然后我们进行测试<br><img src="https://z3.ax1x.com/2021/10/07/5SiFr8.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SiFr8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>此时显示的消息就很有可读性了。</p></div><h2 id="5、总结"><a href="#5、总结" class="headerlink" title="5、总结"></a>5、总结</h2><div class="story post-story"><p>以上就是我对RabbirMQ入门学习的一个总结，还有很多的内容需要去学习，以后学到了会继续补充。s</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="消息队列" scheme="http://cyc0819.top/categories/java/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="消息队列" scheme="http://cyc0819.top/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>Swagger3入门使用</title>
    <link href="http://cyc0819.top/2021/10/05/2021-10-05-Swagger3%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
    <id>http://cyc0819.top/2021/10/05/2021-10-05-Swagger3%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/</id>
    <published>2021-10-05T01:57:56.000Z</published>
    <updated>2021-12-08T09:30:34.938Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Swagger3入门使用"><a href="#Swagger3入门使用" class="headerlink" title="Swagger3入门使用"></a>Swagger3入门使用</h1><h2 id="1、Swagger3简介"><a href="#1、Swagger3简介" class="headerlink" title="1、Swagger3简介"></a>1、Swagger3简介</h2><div class="story post-story"><p>Swagger 是一套基于 OpenAPI 规范（OpenAPI Specification，OAS）构建的开源工具，后来成为了 Open API 标准的主要定义者。<br>对于 Rest API 来说很重要的一部分内容就是文档，Swagger 为我们提供了一套通过代码和注解自动生成文档的方法，这一点对于保证API 文档的及时性将有很大的帮助。</p><p><strong>swagger2于17年停止维护，现在最新的版本为17年发布的 Swagger3（Open Api3）</strong></p></div><h2 id="2-Swagger3与Swagger2-x比较"><a href="#2-Swagger3与Swagger2-x比较" class="headerlink" title="2. Swagger3与Swagger2.x比较"></a>2. Swagger3与Swagger2.x比较</h2><div class="story post-story"><ul><li>应用主类添加注解@EnableOpenApi (swagger2是@EnableSwagger2)</li><li>swagger配置类SwaggerProperties.class，与swagger2.xx 版本有差异，具体看下文</li><li>自定义一个配置类 SwaggerConfiguration.class,看下文</li><li>访问地址：<a href="http://localhost:8080/swagger-ui/index.html">http://localhost:8080/swagger-ui/index.html</a> (swagger2.xx版本访问的地址为<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a>)</li></ul></div><h2 id="3、SpringBoot整合Swagger3"><a href="#3、SpringBoot整合Swagger3" class="headerlink" title="3、SpringBoot整合Swagger3"></a>3、SpringBoot整合Swagger3</h2><div class="story post-story"><h3 id="3-1、引入依赖"><a href="#3-1、引入依赖" class="headerlink" title="3.1、引入依赖"></a>3.1、引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2、在Controller类上添加注解"><a href="#3-2、在Controller类上添加注解" class="headerlink" title="3.2、在Controller类上添加注解"></a>3.2、在Controller类上添加注解</h3><p>Swagger通过几个注解，就能实现api的添加。</p><p><code>@Api</code> ：用在controller类，描述API接口<br><code>@EnableOpenApi</code> :表示开启SwaggerApi<br><code>@ApiOperation</code> ：描述接口方法<br><code>@ApiModel</code> ：描述对象<br><code>@ApiModelProperty</code> ：描述对象属性<br><code>@ApiImplicitParams</code>  ：描述接口参数<br><code>@ApiResponses</code> ：描述接口响应<br><code>@ApiIgnore</code> ：忽略接口方法<br><code>@ApiParam</code> ：为 Rest 接口参数添加其它元数据</p><p>如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableOpenApi</span> <span class="comment">// 也可以不写此注解</span></span><br><span class="line"><span class="meta">@Api(description=&quot;讲师管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/edu/teacher&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;所有讲师列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Teacher&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacherService.list();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据ID删除讲师&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeById</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacherService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询某个讲师&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/setlct/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Teacher <span class="title">teacher</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span> <span class="meta">@PathVariable</span> String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacherService.teacher(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3、自定义一个配置类SwaggerProperties-class"><a href="#3-3、自定义一个配置类SwaggerProperties-class" class="headerlink" title="3.3、自定义一个配置类SwaggerProperties.class"></a>3.3、自定义一个配置类SwaggerProperties.class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;swagger&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerProperties</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否开启swagger，生产环境一般关闭，所以这里定义一个变量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enable;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目应用名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目版本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationVersion;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目描述信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationDescription;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接口调试地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tryHost;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getEnable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> enable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnable</span><span class="params">(Boolean enable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.enable = enable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationName</span><span class="params">(String applicationName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationName = applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationVersion;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationVersion</span><span class="params">(String applicationVersion)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationVersion = applicationVersion;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationDescription</span><span class="params">(String applicationDescription)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationDescription = applicationDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTryHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tryHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTryHost</span><span class="params">(String tryHost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tryHost = tryHost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4、自定义springfox-swagger3配置类SwaggerConfiguration-class"><a href="#3-4、自定义springfox-swagger3配置类SwaggerConfiguration-class" class="headerlink" title="3.4、自定义springfox swagger3配置类SwaggerConfiguration.class"></a>3.4、自定义springfox swagger3配置类SwaggerConfiguration.class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.reflect.FieldUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringBootVersion;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ReflectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.oas.annotations.EnableOpenApi;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.*;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SwaggerProperties swaggerProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SwaggerConfiguration</span><span class="params">(SwaggerProperties swaggerProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.swaggerProperties = swaggerProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.OAS_30).pathMapping(<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 定义是否开启swagger，false为关闭，可以通过变量控制</span></span><br><span class="line">                .enable(swaggerProperties.getEnable())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将api的元信息设置为包含在json ResourceListing响应中。 </span></span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接口调试地址</span></span><br><span class="line">                .host(swaggerProperties.getTryHost())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 选择哪些接口作为swagger的doc发布</span></span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.any())</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build()</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 支持的通讯协议集合</span></span><br><span class="line">                .protocols(newHashSet(<span class="string">&quot;https&quot;</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息设置，必要的header token等认证信息</span></span><br><span class="line">                .securitySchemes(securitySchemes())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息全局应用</span></span><br><span class="line">                .securityContexts(securityContexts());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API 页面上半部分展示信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(swaggerProperties.getApplicationName() + <span class="string">&quot; Api Doc&quot;</span>)</span><br><span class="line">                .description(swaggerProperties.getApplicationDescription())</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;lighter&quot;</span>, <span class="keyword">null</span>, <span class="string">&quot;123456@gmail.com&quot;</span>))</span><br><span class="line">                .version(<span class="string">&quot;Application Version: &quot;</span> + swaggerProperties.getApplicationVersion() + <span class="string">&quot;, Spring Boot Version: &quot;</span> + SpringBootVersion.getVersion())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置授权信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityScheme&gt; <span class="title">securitySchemes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApiKey apiKey = <span class="keyword">new</span> ApiKey(<span class="string">&quot;BASE_TOKEN&quot;</span>, <span class="string">&quot;token&quot;</span>, In.HEADER.toValue());</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(apiKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权信息全局应用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityContext&gt; <span class="title">securityContexts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(</span><br><span class="line">                SecurityContext.builder()</span><br><span class="line">                        .securityReferences(Collections.singletonList(<span class="keyword">new</span> SecurityReference(<span class="string">&quot;BASE_TOKEN&quot;</span>, <span class="keyword">new</span> AuthorizationScope[]&#123;<span class="keyword">new</span> AuthorizationScope(<span class="string">&quot;global&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;)))</span><br><span class="line">                        .build()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SafeVarargs</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> &lt;T&gt; <span class="function">Set&lt;T&gt; <span class="title">newHashSet</span><span class="params">(T... ts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ts.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(ts));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用拦截器排除swagger设置，所有拦截器都会自动加swagger相关的资源排除信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field registrationsField = FieldUtils.getField(InterceptorRegistry.class, <span class="string">&quot;registrations&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            List&lt;InterceptorRegistration&gt; registrations = (List&lt;InterceptorRegistration&gt;) ReflectionUtils.getField(registrationsField, registry);</span><br><span class="line">            <span class="keyword">if</span> (registrations != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (InterceptorRegistration interceptorRegistration : registrations) &#123;</span><br><span class="line">                    interceptorRegistration</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/swagger**/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/v3/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/doc.html&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h2><div class="story post-story"><p>完成上述的编写之后可以打开下面的地址查看是否成功创建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/swagger-ui/index.html</span><br></pre></td></tr></table></figure><p>成功显示如下<img src="https://z3.ax1x.com/2021/10/05/4jUGVJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4jUGVJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://z3.ax1x.com/2021/10/05/4jUa26.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4jUa26.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="Swagger" scheme="http://cyc0819.top/categories/java/Swagger/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="Swagger" scheme="http://cyc0819.top/tags/Swagger/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_最小栈</title>
    <link href="http://cyc0819.top/2021/10/04/2021-10-04-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%9C%80%E5%B0%8F%E6%A0%88/"/>
    <id>http://cyc0819.top/2021/10/04/2021-10-04-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%9C%80%E5%B0%8F%E6%A0%88/</id>
    <published>2021-10-03T16:05:20.000Z</published>
    <updated>2021-12-08T09:30:05.039Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="最小栈"><a href="#最小栈" class="headerlink" title="最小栈"></a>最小栈</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/min-stack/">lettcode-155题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/874db5e3352e9d73.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/874db5e3352e9d73.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>题目基本上就是要求找出一个栈中最小的值，通过java中内置的栈的方法即可实现这一目标</p><p>首先我的想法是通过遍历比较所有的值来找出最小的那个值，但是这样子消耗了较多的时间，而且题目希望是设计一种栈的结构，而不是直接用栈的方法。</p><p>所以后面换了一种新的方法，就是使用链表来实现，这样子的效率是较高的，相比于之前的方法，用时整整少了200多毫秒<img src="https://i.bmp.ovh/imgs/2021/10/677ed412598a9dc4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/677ed412598a9dc4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>具体实现方式如下</p></div><h2 id="具体代码-第一种思路"><a href="#具体代码-第一种思路" class="headerlink" title="具体代码(第一种思路)"></a>具体代码(第一种思路)</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Integer&gt; stack;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stack = <span class="keyword">new</span> Stack&lt;Integer&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        stack.push(val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stack.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> min=stack.get(<span class="number">0</span>);;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;stack.size();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (stack.get(i)&lt;min)&#123;</span><br><span class="line">                min=stack.get(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="具体代码-第二种思路"><a href="#具体代码-第二种思路" class="headerlink" title="具体代码(第二种思路)"></a>具体代码(第二种思路)</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>) </span><br><span class="line">            head = <span class="keyword">new</span> Node(x, x);</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            head = <span class="keyword">new</span> Node(x, Math.min(x, head.min), head);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        head = head.next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> head.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> head.min;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> val;</span><br><span class="line">        <span class="keyword">int</span> min;</span><br><span class="line">        Node next;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> min)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(val, min, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> min, Node next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.val = val;</span><br><span class="line">            <span class="keyword">this</span>.min = min;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="算法" scheme="http://cyc0819.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="算法" scheme="http://cyc0819.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_设计hash集合、hash映射</title>
    <link href="http://cyc0819.top/2021/10/03/2021-10-03-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1hash%E9%9B%86%E5%90%88%E3%80%81hash%E6%98%A0%E5%B0%84/"/>
    <id>http://cyc0819.top/2021/10/03/2021-10-03-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1hash%E9%9B%86%E5%90%88%E3%80%81hash%E6%98%A0%E5%B0%84/</id>
    <published>2021-10-03T14:21:21.000Z</published>
    <updated>2021-12-08T09:30:00.187Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="设计hash集合、hash映射"><a href="#设计hash集合、hash映射" class="headerlink" title="设计hash集合、hash映射"></a>设计hash集合、hash映射</h1><h2 id="题目1"><a href="#题目1" class="headerlink" title="题目1"></a>题目1</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/design-hashset/">lettcode-705题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/40b4bcb17c130bf0.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/40b4bcb17c130bf0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>既然说是一个HashSet，所以他就是一个不可重复的集合，就意味着在该集合中每个元素只能出现一次。</p><p>所以说我们就可以用boolean类型的数组来模拟出这样的一个集合</p><p>数组的索引就对应了set的key，数组所对应的布尔值就是set的value，当其为true1时就说明存在，否则就是不存在</p><p>具体实现方式如下</p></div><h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashSet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个boolean类型的数组</span></span><br><span class="line">    <span class="keyword">boolean</span>[] map=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyHashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">1000001</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        map[key]=<span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        map[key]=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map[key]==<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="题目2"><a href="#题目2" class="headerlink" title="题目2"></a>题目2</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/design-hashmap/">lettcode-706题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/6d0c43c3b85e5903.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6d0c43c3b85e5903.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>从题目中我们可以看出来跟上一题差不多，无非是一个set一个map的差别</p><p>阅读题目要求我们可以知道对应的<code>key</code>和<code>value</code> 都是<code>int</code> 类型的，所以我们可以定义一个int类型的数组来存储数据</p><p>取值的时候如果取值为空就返回一个<code>-1</code> ，所以我做了一个判断，判断是否有值</p><p>具体实现方式如下</p></div><h2 id="具体代码-1"><a href="#具体代码-1" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashMap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个int类型的数组</span></span><br><span class="line">    Integer[] map=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map=<span class="keyword">new</span> Integer[<span class="number">1000001</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        map[key]=value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map[key]!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> value=map[key];</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        map[key]=<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="算法" scheme="http://cyc0819.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="算法" scheme="http://cyc0819.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud微服务入门</title>
    <link href="http://cyc0819.top/2021/10/03/2021-10-03-SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/"/>
    <id>http://cyc0819.top/2021/10/03/2021-10-03-SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/</id>
    <published>2021-10-03T05:44:20.000Z</published>
    <updated>2021-12-08T09:30:21.245Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringCloud微服务入门"><a href="#SpringCloud微服务入门" class="headerlink" title="SpringCloud微服务入门"></a>SpringCloud微服务入门</h1><h2 id="1、微服务的发展历程"><a href="#1、微服务的发展历程" class="headerlink" title="1、微服务的发展历程"></a>1、微服务的发展历程</h2><div class="story post-story"><h3 id="1-1、单体结构"><a href="#1-1、单体结构" class="headerlink" title="1.1、单体结构"></a>1.1、单体结构</h3><p>简介：将业务的所有功能集中在一个项目中开发，打成一个包部署。我们之前所做的学生管理系统基本都是单体结构<br>优点：结构简单、部署成本低<br>缺点：耦合度高</p><h3 id="1-2、分布式结构"><a href="#1-2、分布式结构" class="headerlink" title="1.2、分布式结构"></a>1.2、分布式结构</h3><p>简介：根据业务功能对系统进行拆分，每个业务模块作为独立项目开发，称为一个服务。<br>优点：降低服务耦合、有利于服务升级拓展<br>分布式架构的要考虑的问题：<br>服务拆分粒度如何？<br>服务集群地址如何维护？<br>服务之间如何实现远程调用？<br>服务健康状态如何感知？</p><h3 id="1-3、微服务架构"><a href="#1-3、微服务架构" class="headerlink" title="1.3、微服务架构"></a>1.3、微服务架构</h3><p>简介：微服务是一种经过良好架构设计的分布式架构方案。<br>优点：拆分粒度更小、服务更独立、耦合度更低<br>缺点：架构非常复杂，运维、监控、部署难度提高<br>微服务架构的特征：</p><ul><li>单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责，避免重复业务开发</li><li>面向服务：微服务对外暴露业务接口</li><li>自治：团队独立、技术独立、数据独立、部署独立</li><li>隔离性强：服务调用做好隔离、容错、降级，避免出现级联问题</li></ul></div><h2 id="2、使用SpringCloud"><a href="#2、使用SpringCloud" class="headerlink" title="2、使用SpringCloud"></a>2、使用SpringCloud</h2><div class="story post-story"><p>SpringCloud并不是一个全新的框架，其实他是一个将其他开源的框架集合的一个大篮子<br>得益于SpringBoot框架方便的使用，我们也能很轻松地在SpringBoot上整合SpriongCloud的模块<br>以下是SpringBoot和SpringCloud的版本匹配表，如果不按照这个规则，就有可能出现很多奇怪的问题<img src="https://bu.dusays.com/2021/10/03/9337d5a6f9ca0.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/9337d5a6f9ca0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-1、服务拆分"><a href="#2-1、服务拆分" class="headerlink" title="2.1、服务拆分"></a>2.1、服务拆分</h3><p>当我们使用微服务时，实际上就是相当于把原本在一起的模块拆分成一个一个的小的模块，所以我们在进行服务拆分时必须注意以下几点：</p><ol><li>单一职责：不同微服务，不要重复开发相同业务</li><li>数据独立：不要访问其它微服务的数据库</li><li>面向服务：将自己的业务暴露为接口，供其它微服务调用</li></ol><h3 id="2-2、服务调用"><a href="#2-2、服务调用" class="headerlink" title="2.2、服务调用"></a>2.2、服务调用</h3><p>当我们成功拆分出两个服务的时候，在使用时，肯定会出现A调用B，B调用C的情况出现，而此时我们想到的第一个方法就是根据服务的IP地址和端口进行调用。<img src="https://bu.dusays.com/2021/10/03/3cfda9ed84286.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/3cfda9ed84286.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是此时会出现一个问题，实际情况中我们一个服务肯定不只是只有一个地址，可能会有多个一样的服务，作为负载均衡。但是如果每个服务我们都需要通过IP+端口的方式来连接，那么当我们修改一个服务的端口时，就要相应地修改很多个调用他的端口的服务，显然是很麻烦的，而且也不能实现真正的负载均衡。所以我们需要一个注册中心来统一管理我们的所有服务。<br>所以就有了eureka</p><h3 id="2-3、eureka注册中心"><a href="#2-3、eureka注册中心" class="headerlink" title="2.3、eureka注册中心"></a>2.3、eureka注册中心</h3><p>消费者该如何获取服务提供者具体信息？</p><ul><li>服务提供者启动时向eureka注册自己的信息</li><li>eureka保存这些信息</li><li>消费者根据服务名称向eureka拉取提供者信息</li></ul><p>如果有多个服务提供者，消费者该如何选择？</p><ul><li>服务消费者利用负载均衡算法，从服务列表中挑选一个</li></ul><p>消费者如何感知服务提供者健康状态？</p><ul><li>服务提供者会每隔30秒向EurekaServer发送心跳请求，报告健康状态</li><li>eureka会更新记录服务列表信息，心跳不正常会被剔除</li><li>消费者就可以拉取到最新的信息</li></ul><p>现在我们来创建一个eureka注册中心：</p><ol><li>我们需要创建一个普通的maven项目，然后在其中引入依赖：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;    </span><br><span class="line">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;    </span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>在启动类上添加<code>@EnableEurekaServer</code>注解</li><li>然后创建一个配置文件<code>Application.yml</code>,在其中添加以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line"><span class="attr">port:</span> <span class="number">10086</span> <span class="comment">#端口</span></span><br><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"><span class="attr">application:</span>    </span><br><span class="line"><span class="attr">name:</span> <span class="string">eurekaserver</span><span class="comment">#服务名称</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line"><span class="attr">client:</span>    </span><br><span class="line"><span class="attr">service-url:</span>       </span><br><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka/</span> <span class="comment"># eureka的地址，将自己注册到eureka中</span></span><br></pre></td></tr></table></figure></li></ol><p>以上就成功创建了一个eureka注册中心，运行打开端口，就可以看到我们创建好的注册中心<img src="https://bu.dusays.com/2021/10/03/aee959c4bd69a.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/aee959c4bd69a.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>注册成功的服务会显示在<code>Instances currently registered with Eureka</code>处</p><p>接下来我们将客户端注册到注册中心去</p><ol><li>我们在需要加入的服务中添加以下依赖：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;    </span><br><span class="line">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;    </span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>然后再配置文件中添加以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line"><span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka/</span></span><br></pre></td></tr></table></figure>与上面一样，将自己注册到了注册中心中<img src="https://bu.dusays.com/2021/10/03/28ced8e089410.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/28ced8e089410.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="2-4、eureka服务调用"><a href="#2-4、eureka服务调用" class="headerlink" title="2.4、eureka服务调用"></a>2.4、eureka服务调用</h3><p>在成功将服务注册到eureka中之后，我们就可以使用服务名来替代端口地址对服务进行调用了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId();</span><br></pre></td></tr></table></figure><p>但这不是一个真实有效的地址，是不能直接进行访问的，只能通过eureka进行访问</p></div><h2 id="3、负载均衡"><a href="#3、负载均衡" class="headerlink" title="3、负载均衡"></a>3、负载均衡</h2><div class="story post-story"><h3 id="3-1、认识负载均衡"><a href="#3-1、认识负载均衡" class="headerlink" title="3.1、认识负载均衡"></a>3.1、认识负载均衡</h3><p>以下是负载均衡的一个流程图（此流程图也解释了如何通过服务名调用对应的服务）<img src="https://bu.dusays.com/2021/10/03/7165d0dd07c93.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/7165d0dd07c93.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>负载均衡简单来说就是我们有多个同名的服务，他们做的是一样的事情，我们希望所有的请求给他们所有人一起分担，而不是一个人抗下所有的请求，所以这个时候负载均衡就起到了作用，根据不同的规则，负载均衡可以以不同的策略对请求的服务进行管理，可以极大减小服务器的压力。</p><h3 id="3-2、负载均衡策略"><a href="#3-2、负载均衡策略" class="headerlink" title="3.2、负载均衡策略"></a>3.2、负载均衡策略</h3><p>以下就是负载均衡的策略规则<br><img src="https://bu.dusays.com/2021/10/03/c6326bca1dd7c.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/c6326bca1dd7c.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://bu.dusays.com/2021/10/03/eb43a6d5349a9.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/eb43a6d5349a9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>饥饿加载</strong><br>Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalanceClient，请求时间会很长。<br>而饥饿加载则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：</p><p>在yml配置文件中加入以下内容，就可以开启饥饿加载模式：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line"><span class="attr">eager-load:</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启饥饿加载 </span></span><br><span class="line"><span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment"># 指定对userservice这个服务饥饿加载</span></span><br></pre></td></tr></table></figure></div><h2 id="4、SpringCloud-Alibaba"><a href="#4、SpringCloud-Alibaba" class="headerlink" title="4、SpringCloud Alibaba"></a>4、SpringCloud Alibaba</h2><div class="story post-story"><p>Spring Cloud Alibaba 是阿里巴巴提供的微服务开发一站式解决方案，是阿里巴巴开源中间件与 Spring Cloud 体系的融合。</p><p>Spring Cloud Alibaba在自身有很多新的组件之外，还可以兼容SpringCloudNetflix的部分组件，如eureka、zuul等等</p><h3 id="4-1、注册中心Nacos"><a href="#4-1、注册中心Nacos" class="headerlink" title="4.1、注册中心Nacos"></a>4.1、注册中心Nacos</h3><p>Nacos是阿里巴巴的产品，现在是SpringCloud中的一个组件。相比Eureka功能更加丰富，在国内受欢迎程度较高</p><p><strong>在使用之前我们得先进行安装</strong><br>首先得去Github上下载Nacos的压缩包,<a href="https://github.com/alibaba/nacos/releases">点击跳转</a><br>下载完成后放到一个没有中文的路径<br>在<code>bin</code>路径处打开cmd，输入以下命令，即可运行Nacos</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>以下是运行成功的标志<img src="https://i.bmp.ovh/imgs/2021/10/f421f5312ec052f6.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/f421f5312ec052f6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>然后我们在浏览器输入地址和端口就可以进入到nacos里面去</p><p><strong>可能报错</strong><br>在启动的时候碰到以下错误</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在启动时碰见这个提示：此时不应有 \nacos&quot;\logs\java<span class="emphasis">_heapdump.hprof -XX:-UseLargePages&quot;</span></span><br></pre></td></tr></table></figure><p>此时我们打开自带的编译器，将下面的语句注释掉</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REM if %MODE% == &quot;cluster&quot; (    REM echo &quot;nacos is starting with cluster&quot;  REM if %EMBEDDED_STORAGE% == &quot;embedded&quot; (      REM set &quot;NACOS_OPTS=-DembeddedStorage=true&quot;  REM )    REM set &quot;NACOS_JVM_OPTS=-server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=%BASE_DIR%\logs\java_heapdump.hprof -XX:-UseLargePages&quot;REM )</span><br></pre></td></tr></table></figure><p>再次运行即可通过</p><h3 id="4-2、将服务注册到Nacos"><a href="#4-2、将服务注册到Nacos" class="headerlink" title="4.2、将服务注册到Nacos"></a>4.2、将服务注册到Nacos</h3><ol><li>在微服务的父工程文件中添加以下内容<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;    &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">&lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>注释掉所有的eureka依赖文件</li><li>添加Nacos依赖<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>然后修改yml文件，注释掉eureka的地址，添加上Nacos的地址<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos服务地址</span></span><br></pre></td></tr></table></figure>启动服务就可以注册到Nacos中了<img src="https://i.bmp.ovh/imgs/2021/10/72e709e90cb38267.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/72e709e90cb38267.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="4-3、服务集群"><a href="#4-3、服务集群" class="headerlink" title="4.3、服务集群"></a>4.3、服务集群</h3><p>服务调用尽可能选择本地集群的服务，跨集群调用延迟较高<br>本地集群不可访问时，再去访问其它集群</p><p><strong>现在我们来设置服务的集群</strong></p><ol><li><p>首先我们在yml文件中添加以下的内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">SH</span> <span class="comment">#cluster-name就是集群的名称</span></span><br></pre></td></tr></table></figure></li><li><p>然后重新运行就可以看到变化<img src="https://i.bmp.ovh/imgs/2021/10/d5fd108812f6fef4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/d5fd108812f6fef4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>然后在order-service中设置负载均衡的IRule为NacosRule，这个规则优先会寻找与自己同集群的服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userservice:</span><br><span class="line">  ribbon:</span><br><span class="line">    NFLoadBalancerRuleClassName: com.alibaba.cloud.nacos.ribbon.NacosRule  # 负载均衡规则</span><br></pre></td></tr></table></figure><p>当本地集群正常运行时，服务就会优先调用本地集群的服务，而随后再考虑远程集群</p></li></ol><h3 id="4-4、环境隔离-namespace"><a href="#4-4、环境隔离-namespace" class="headerlink" title="4.4、环境隔离 - namespace"></a>4.4、环境隔离 - namespace</h3><p>Nacos中服务存储和数据存储的最外层都是一个名为namespace的东西，用来做最外层隔离</p><ol><li><p>在nacos的控制太我们可以创建一个命名空间<img src="https://z3.ax1x.com/2021/10/04/4Oh4bR.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Oh4bR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>填写好命名空间的信息，然后复制命名空间的ID</p></li><li><p>然后修改yml文件，添加命名空间的配置(添加最后一句)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos服务地址</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="attr">cluster-name:</span> <span class="string">HZ</span></span><br><span class="line">      <span class="attr">ephemeral:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">4d6ce343-9e1b-44df-a90f-2cf2b6b3d177</span> <span class="comment"># dev环境</span></span><br></pre></td></tr></table></figure></li><li><p>启动服务就会看到相应的变化</p></li><li><p>此时不同空间中的服务是不能相互访问的</p></li></ol></div><h2 id="5、Nacos配置管理"><a href="#5、Nacos配置管理" class="headerlink" title="5、Nacos配置管理"></a>5、Nacos配置管理</h2><div class="story post-story"><h3 id="5-1、Nacos实现配置的管理"><a href="#5-1、Nacos实现配置的管理" class="headerlink" title="5.1、Nacos实现配置的管理"></a>5.1、Nacos实现配置的管理</h3><p>Nacos有一个功能，就是可以将为服务的配置管理到自己的注册中心去，然后我们就可以通过远程调用，来使用这些配置在远端的配置文件。<br>但是这又有什么用处呢？<br>用处就是当我们有一些需要修改的开关型配置文件，我们希望修改时不影响到程序的运行，只要我们对程序进行了更改，就会自动进行配置，也叫做热部署。<br>所以Nacos的配置管理就可以实现这样的一个功能。<br>那么要怎么实现呢？</p><ol><li><p>首先我们进入到Nacos的配置管理界面，打开配置列表，点击右上角的<code>+</code> 创建新的配置<img src="https://z3.ax1x.com/2021/10/04/4XiLA1.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XiLA1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>如下图一样配置好文件，然后可以在下面的黑色输入框以<code>yml</code> 文件的格式输入你想要的配置内容，完成之后点击发布即可<img src="https://z3.ax1x.com/2021/10/04/4XkuRK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XkuRK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>现在我们就可以去java代码中进行配置的拉取了</p></li></ol><h3 id="5-2、配置的拉取"><a href="#5-2、配置的拉取" class="headerlink" title="5.2、配置的拉取"></a>5.2、配置的拉取</h3><p>创建好了配置文件，我们现在需要去java代码中对其进行拉取。<br>而以往我们运行微服务时直接就会读取 <code>application.yml</code> 这个配置文件，如何在读取他之前先读取Nacos上的配置文件呢？<br>这时，我们就可以添加一个优先级更高的配置文件<code>bootstrap.yml</code> ，在里面编写读取Nacos配置的配置。</p><p><img src="https://z3.ax1x.com/2021/10/04/4XA3lT.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XA3lT.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol><li><p>首先引入Nacos配置文件的依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--&lt;nacos配置依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li><p>然后我们创建一个 <code>bootstrap.yml</code> ，里面写的是拉取远程配置的代码</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br></pre></td></tr></table></figure><p>比如这里我们读取了 <code>userservice-dev.yaml</code> 文件的内容</p></li><li><p>然后我们检验一下是否能拿到远程的配置，以下是我们的远程配置文件中所包含的内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">yyyy/MM/dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure><p>然后我们在Controller文件中获取一下配置文件，然后输出到屏幕上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String dateformat;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">now</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果读取成功屏幕上就会按照前面的格式输出时间<img src="https://z3.ax1x.com/2021/10/04/4XEA41.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XEA41.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ol><h3 id="5-3、配置热更新"><a href="#5-3、配置热更新" class="headerlink" title="5.3、配置热更新"></a>5.3、配置热更新</h3><p>有了配置文件之后，我们现在要来配置热更新了。<br>最简单的方法就是通过注解的方式来进行添加，就是以下的这种方法</p><p>在 <code>@Value</code> 注入的变量所在类上添加注解 <code>@RefreshScope</code></p><p>另一种方法就是使用 <code>@ConfigurationProperties</code> 注解来实现。</p><p>首先我们创建一个 <code>PatternProperties </code> 类，然后在上面标上 <code>@ConfigurationProperties(prefix = &quot;pattern&quot;)</code> ,<code>@Component</code> ,<code>@Data</code> 等注解。<br>然后在类中创建一个私有成员变量<code>private String dateformat;</code> ，然后其他的控制器中对其进行注入并调用，就可以实现热更新。</p><h3 id="5-4、多环境配置共享"><a href="#5-4、多环境配置共享" class="headerlink" title="5.4、多环境配置共享"></a>5.4、多环境配置共享</h3><p><img src="https://z3.ax1x.com/2021/10/04/4XZMtA.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XZMtA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>而在不同微服务之间可以共享配置文件，可以通过下面的两种方式来指定：</p><ol><li>方式一<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">userservice</span> <span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境，</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line"><span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos地址</span></span><br><span class="line"><span class="attr">config:</span> </span><br><span class="line"><span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br><span class="line"><span class="attr">shared-configs:</span> <span class="comment"># 多微服务间共享的配置列表</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">common.yaml</span> <span class="comment"># 要共享的配置文件id</span></span><br></pre></td></tr></table></figure></li><li>方式二<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">userservice</span> <span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境，</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line"><span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos地址</span></span><br><span class="line"><span class="attr">config:</span> </span><br><span class="line">            <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br><span class="line"><span class="attr">extends-configs:</span> <span class="comment"># 多微服务间共享的配置列表</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">extend.yaml</span> <span class="comment"># 要共享的配置文件id</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-5、Nacos集群搭建"><a href="#5-5、Nacos集群搭建" class="headerlink" title="5.5、Nacos集群搭建"></a>5.5、Nacos集群搭建</h3><p>以下是教程中所要搭建的集群结构</p><p><img src="https://z3.ax1x.com/2021/10/04/4Xe2Kf.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Xe2Kf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>三个nacos节点的地址：</p><table><thead><tr><th>节点</th><th>ip</th><th>port</th></tr></thead><tbody><tr><td>nacos1</td><td>192.168.150.1</td><td>8845</td></tr><tr><td>nacos2</td><td>192.168.150.1</td><td>8846</td></tr><tr><td>nacos3</td><td>192.168.150.1</td><td>8847</td></tr></tbody></table><p><strong>然后我们现在开始搭建我们的集群</strong></p><p>搭建集群的基本步骤：</p><ul><li>搭建数据库，初始化数据库表结构</li><li>下载nacos安装包</li><li>配置nacos</li><li>启动nacos集群</li><li>nginx反向代理</li></ul><ol><li><p>初始化数据库</p><p>我们在我们的数据库中创建好一个我们所需要的数据库</p></li><li><p>然后安装包我们已经下载过了，就可以直接跳过，然后配置一下nacos</p><p>进入nacos的conf目录，修改配置文件cluster.conf.example，重命名为cluster.conf：<br><img src="https://z3.ax1x.com/2021/10/04/4Xeva4.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Xeva4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后添加以下三个地址</p><p><img src="https://z3.ax1x.com/2021/10/04/4XmfQx.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XmfQx.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后修改application.properties文件，添加数据库配置</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="meta">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">db.password.0</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>启动</p><p>将nacos文件夹复制三份，分别命名为：nacos1、nacos2、nacos3</p><p>然后分别修改三个文件夹中的 <code>application.properties</code> ，</p><p>nacos1:</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8845</span></span><br></pre></td></tr></table></figure><p>   nacos2:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8846</span></span><br></pre></td></tr></table></figure><p>   nacos3:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8847</span></span><br></pre></td></tr></table></figure><p>   然后分别启动三个nacos节点：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd</span><br></pre></td></tr></table></figure><ol start="4"><li>Nginx反向代理</li></ol><p>安装好nginx之后，打开文件夹。修改conf/nginx.conf文件，配置如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> nacos-cluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8845</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8846</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8847</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /nacos &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在浏览器访问：<a href="http://localhost/nacos%E5%8D%B3%E5%8F%AF%E3%80%82">http://localhost/nacos即可。</a></p><p>代码中application.yml文件配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"> <span class="attr">cloud:</span></span><br><span class="line">   <span class="attr">nacos:</span></span><br><span class="line">     <span class="attr">server-addr:</span> <span class="string">localhost:80</span> <span class="comment"># Nacos地址</span></span><br></pre></td></tr></table></figure></div><h2 id="6、客户端Feign"><a href="#6、客户端Feign" class="headerlink" title="6、客户端Feign"></a>6、客户端Feign</h2><div class="story post-story"><p>Feign是一个声明式的http客户端，官方地址：<a href="https://github.com/OpenFeign/feign">https://github.com/OpenFeign/feign</a><br>其作用就是帮助我们优雅的实现http请求的发送</p><p><img src="https://z3.ax1x.com/2021/10/04/4Xtf4x.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Xtf4x.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="6-1、使用"><a href="#6-1、使用" class="headerlink" title="6.1、使用"></a>6.1、使用</h3><ol><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在order-service的启动类添加注解开启Feign的功能：<img src="https://z3.ax1x.com/2021/10/04/4XNUMD.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XNUMD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>编写feign客户端</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserClient</span> </span>&#123;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span> </span><br><span class="line"><span class="function">User <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要是基于SpringMVC的注解来声明远程调用的信息，比如：</p></li></ol><ul><li>服务名称：userservice</li><li>请求方式：GET</li><li>请求路径：/user/{id}</li><li>请求参数：Long id</li><li>返回值类型：User</li></ul><p>使用这种方式就可以很方便地代替之前的url的调用方式，代码变得更加清晰简洁。<br>以下就是调用的内容</p><ol start="4"><li>调用<br><img src="https://z3.ax1x.com/2021/10/04/4XUSF1.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XUSF1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="6-2、自定义Feign的配置"><a href="#6-2、自定义Feign的配置" class="headerlink" title="6.2、自定义Feign的配置"></a>6.2、自定义Feign的配置</h3><p>Feign运行自定义配置来覆盖默认配置，可以修改的配置如下：<img src="https://z3.ax1x.com/2021/10/04/4XUiQO.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XUiQO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>一般情况下我们会修改日志级别,最好用basic或none</p><h3 id="6-3、配置Feign的日志"><a href="#6-3、配置Feign的日志" class="headerlink" title="6.3、配置Feign的日志"></a>6.3、配置Feign的日志</h3><p>配置日志时我们也有两种方式，一种是配置文件的方式，另一种是java代码的方式</p><ol><li>配置文件方式</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line"><span class="attr">default:</span> <span class="comment"># 这里用default就是全局配置，如果是写服务名称，则是针对某个微服务的配置</span></span><br><span class="line"><span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  日志级别</span></span><br></pre></td></tr></table></figure><ol start="2"><li>java代码方式</li></ol><p>首先我们声明一个Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignClientConfiguration</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Logger.<span class="function">Level <span class="title">feignLogLevel</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> Logger.Level.BASIC; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后如果是全局配置，我们就放到 <code>@EnableFeignClients</code> 这个注解中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = FeignClientConfiguration.class)</span> </span><br></pre></td></tr></table></figure><p>如果是局部配置，我们就放到 <code>@FeignClient</code> 这个注解中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = FeignClientConfiguration.class)</span> </span><br></pre></td></tr></table></figure><h3 id="6-4、性能优化"><a href="#6-4、性能优化" class="headerlink" title="6.4、性能优化"></a>6.4、性能优化</h3><p>Feign底层发起http请求，依赖于其它的框架。其底层客户端实现包括：</p><ul><li>URLConnection：默认实现，不支持连接池</li><li>Apache HttpClient ：支持连接池</li><li>OKHttp：支持连接池</li></ul><p>因此提高Feign的性能主要手段就是使用<strong>连接池</strong>代替默认的URLConnection。<br>这里我们用Apache的HttpClient来演示。</p><ol><li>引入依赖<br>在order-service的pom文件中引入Apache的HttpClient依赖：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpClient的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>配置连接池<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># default全局的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">BASIC</span> <span class="comment"># 日志级别，BASIC就是基本的请求和响应信息</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启feign对HttpClient的支持</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># 最大的连接数</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># 每个路径的最大连接数</span></span><br></pre></td></tr></table></figure></li><li>优化总结<br>总结，Feign的优化：</li></ol><p>1.日志级别尽量用basic<br>2.使用HttpClient或OKHttp代替URLConnection<br>①  引入feign-httpClient依赖<br>②  配置文件开启httpClient功能，设置连接池参数</p><h3 id="6-5、最佳实践"><a href="#6-5、最佳实践" class="headerlink" title="6.5、最佳实践"></a>6.5、最佳实践</h3><p>所谓最近实践，就是使用过程中总结的经验，最好的一种使用方式。<br>自习观察可以发现，Feign的客户端与服务提供者的controller代码非常相似：<br>feign客户端：<img src="https://z3.ax1x.com/2021/10/04/4X0pHe.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0pHe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>UserController：<img src="https://z3.ax1x.com/2021/10/04/4X0k9I.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0k9I.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们有两种方法来优化重复的代码编写</p><ol><li>继承方式</li><li>抽取方式</li></ol><p>首先来说一下<strong>继承方式</strong>：<br>一样的代码可以通过继承来共享：<br>1）定义一个API接口，利用定义方法，并基于SpringMVC注解做声明。<br>2）Feign客户端和Controller都集成这个接口<img src="https://z3.ax1x.com/2021/10/04/4X0EgP.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0EgP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>优点：</p><ul><li>简单</li><li>实现了代码共享</li></ul><p>缺点：</p><ul><li>服务提供方、服务消费方紧耦合</li><li>参数列表中的注解映射并不会继承，因此Controller中必须再次声明方法、参数列表、注解</li></ul><p>然后是<strong>抽取的方式</strong><br>将Feign的Client抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用。<br>例如，将UserClient、User、Feign的默认配置都抽取到一个feign-api包中，所有微服务引用该依赖包，即可直接使用<br><img src="https://z3.ax1x.com/2021/10/04/4X0dUJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0dUJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="6-6、基于抽取的最佳实践"><a href="#6-6、基于抽取的最佳实践" class="headerlink" title="6.6、基于抽取的最佳实践"></a>6.6、基于抽取的最佳实践</h3><ol><li>首先创建一个公共类 <code>feign-api</code></li><li>在这个类中引入依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>然后，order-service中编写的UserClient、User、DefaultFeignConfiguration都复制到feign-api项目中<br><img src="https://z3.ax1x.com/2021/10/04/4X0RVe.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0RVe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>在order-service中使用feign-api（引入api的依赖）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>修改order-service中的所有与上述三个组件有关的导包部分，改成导入feign-api中的包</li><li>此时当我们重启测试的时候，就会发现出错了，出错内容如下<br><img src="https://z3.ax1x.com/2021/10/04/4X07Kf.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X07Kf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>这是因为UserClient现在在cn.itcast.feign.clients包下，<br>而order-service的@EnableFeignClients注解是在cn.itcast.order包下，不在同一个包，无法扫描到UserClient。<br>7. 解决扫描包问题</p><p>有两种方法，一种是：指定Feign应该扫描的包</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;cn.itcast.feign.clients&quot;)</span></span><br></pre></td></tr></table></figure><p>一种是指定要加载的Client的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span></span><br></pre></td></tr></table></figure><ol start="8"><li>至此，就设置完毕了</li></ol></div><h2 id="7、Gateway网关"><a href="#7、Gateway网关" class="headerlink" title="7、Gateway网关"></a>7、Gateway网关</h2><div class="story post-story"><p>为什么需要网关？网关用来干嘛<br>网关可以用于：</p><ul><li>身份认证和权限校验</li><li>服务路由、负载均衡</li><li>请求限流</li></ul><p>在SpringCloud中有两种网关服务，一种是Gateway，另一种是Zuul<br>而两者的差别是：Zuul是基于Servlet的实现，属于阻塞式编程。而SpringCloudGateway则是基于Spring5中提供的WebFlux，属于响应式编程的实现，具备更好的性能。</p><h3 id="7-1、搭建一个Gateway网关"><a href="#7-1、搭建一个Gateway网关" class="headerlink" title="7.1、搭建一个Gateway网关"></a>7.1、搭建一个Gateway网关</h3><p>我们需要创建一个网关的类来搭建一个网关，具体步骤如下：</p><ol><li><p>创建新的module，引入SpringCloudGateway的依赖和nacos的服务发现依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--网关依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos服务发现依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>然后在网关的yml文件中编写路由配置及nacos地址</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> <span class="comment"># 网关端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由id，自定义，只要唯一即可</span></span><br><span class="line">          <span class="comment"># uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址 lb就是负载均衡，后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 这个是按照路径匹配，只要以/user/开头就符合要求</span></span><br></pre></td></tr></table></figure><p>此时，如果我们在控制台输入nacos的地址，以及加上断言中配置好的路径进行访问，就会被网关带到制定好的位置。<br>比如说我访问<code>localhost:8848/user/now</code>，就会被带到userservice的now方法去，这就是网关的服务路由功能，是使用断言来实现的。</p></li></ol><h3 id="7-2、断言工厂"><a href="#7-2、断言工厂" class="headerlink" title="7.2、断言工厂"></a>7.2、断言工厂</h3><p>在yml文件中有这样一个配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predicates：路由断言，判断请求是否符合要求，符合则转发到路由目的地</span><br></pre></td></tr></table></figure><p>我们在配置文件中写的断言规则只是字符串，这些字符串会被<code>Predicate Factory</code>读取并处理，转变为路由判断的条件<br>例如 <code>Path=/user/**</code><br>是按照路径匹配，这个规则是由<code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code> 类来处理的<br>像这样的断言工厂在<code>SpringCloudGateway</code>还有十几个</p><p>Spring给我们提供了很多种Predicate工厂<br><img src="https://z3.ax1x.com/2021/10/05/4j49G6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j49G6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>但是我们一般用的比较多的还是 <code>Path</code> 这种方式.</p><h3 id="7-3、路由过滤器-过滤器工厂"><a href="#7-3、路由过滤器-过滤器工厂" class="headerlink" title="7.3、路由过滤器/过滤器工厂"></a>7.3、路由过滤器/过滤器工厂</h3><p>GatewayFilter是网关中提供的一种过滤器，可以对进入网关的请求和微服务返回的响应做处理：<br><img src="https://z3.ax1x.com/2021/10/05/4j41sg.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j41sg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Spring提供了31种不同的路由过滤器工厂,例如：<br><img src="https://z3.ax1x.com/2021/10/05/4j4yw9.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j4yw9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>现在我们通过一个简单的例子，实际应用一下这个功能：<br>给所有的userservice添加一个请求头</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line"><span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://userservice</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line">  <span class="attr">filters:</span> <span class="comment"># 过滤器</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">GUET</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> <span class="comment"># 添加请求头</span></span><br></pre></td></tr></table></figure><p>此时所有的userservice的请求都加上了<code>Truth, GUET is freaking awesome!</code>这个请求头。</p><p>而此时其他的不受影响，那么怎么样才能修改所有的请求头呢？<br>有一个简单的方法，就是使用 <code>default-filters</code><br>例子如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line"><span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line"><span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> </span><br><span class="line">   <span class="attr">uri:</span> <span class="string">lb://userservice</span> </span><br><span class="line">  <span class="attr">predicates:</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://orderservice</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/order/**</span></span><br><span class="line"><span class="attr">default-filters:</span> <span class="comment"># 默认过滤器，会对所有的路由请求都生效</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">GUET</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> <span class="comment"># 添加请求头</span></span><br></pre></td></tr></table></figure><p>此时，过滤器并没有指定加载哪一个服务上面，而是加在了<code>routes</code>的同一级上，包括了所有的service服务，所以他的含义就是为所有的服务都统一添加了这样的一个请求头</p><h3 id="7-4、全局过滤器"><a href="#7-4、全局过滤器" class="headerlink" title="7.4、全局过滤器"></a>7.4、全局过滤器</h3><p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与<code>GatewayFilter</code>的作用一样。<br>区别在于<code>GatewayFilter</code>通过配置定义，处理逻辑是固定的。而<code>GlobalFilter</code>的逻辑需要自己写代码实现。<br>定义方式是实现<code>GlobalFilter</code>接口。<br><img src="https://z3.ax1x.com/2021/10/05/4j5I3V.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j5I3V.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>下面我们以一个案例来说明：</p><p>需求：定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件：</p><ul><li>参数中是否有 <code>authorization</code>，</li><li><code>authorization</code> 参数值是否为admin</li></ul><p>如果同时满足则放行，否则拦截.<br>我们现在自定义一个类，实现FlobalFilter接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.获取请求参数</span></span><br><span class="line">MultiValueMap&lt;String, String&gt; params = exchange.getRequest().getQueryParams();</span><br><span class="line"><span class="comment">// 2.获取authorization参数</span></span><br><span class="line">String auth = params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line"><span class="comment">// 3.校验</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(auth)) &#123;</span><br><span class="line"><span class="comment">// 放行</span></span><br><span class="line"><span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4.拦截</span></span><br><span class="line"><span class="comment">// 4.1.禁止访问</span></span><br><span class="line">exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line"><span class="comment">// 4.2.结束处理</span></span><br><span class="line"><span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意一点，<strong>在Order注解中，包含的值越小，优先级越高</strong></p><p><strong>接下来我们看看过滤器的执行顺序：</strong></p><ul><li>每一个过滤器都必须指定一个int类型的order值，order值越小，优先级越高，执行顺序越靠前。</li><li>GlobalFilter通过实现Ordered接口，或者添加@Order注解来指定order值，由我们自己指定</li><li>路由过滤器和defaultFilter的order由Spring指定，默认是按照声明顺序从1递增。</li><li>当过滤器的order值一样时，会按照 defaultFilter &gt; 路由过滤器 &gt; GlobalFilter的顺序执行。</li></ul><h3 id="7-5、Cors跨域"><a href="#7-5、Cors跨域" class="headerlink" title="7.5、Cors跨域"></a>7.5、Cors跨域</h3><p>跨域：域名不一致就是跨域，主要包括：<br>域名不同： <a href="http://www.taobao.com/">www.taobao.com</a> 和 <a href="http://www.taobao.org/">www.taobao.org</a> 和 <a href="http://www.jd.com/">www.jd.com</a> 和 miaosha.jd.com<br>域名相同，端口不同：localhost:8080和localhost8081<br>跨域问题：浏览器禁止请求的发起者与服务端发生跨域ajax请求，请求被浏览器拦截的问题<br>解决方案：CORS</p><p>只需要简单配置即可实现，如下所示：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line"><span class="attr">globalcors:</span> <span class="comment"># 全局的跨域处理</span></span><br><span class="line"><span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># 解决options请求被拦截问题</span></span><br><span class="line"><span class="attr">corsConfigurations:</span></span><br><span class="line"><span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line"><span class="attr">allowedOrigins:</span> <span class="comment"># 允许哪些网站的跨域请求 </span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;http://localhost:8090&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;http://www.leyou.com&quot;</span></span><br><span class="line"><span class="attr">allowedMethods:</span> <span class="comment"># 允许的跨域ajax的请求方式</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line"><span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 允许在请求中携带的头信息</span></span><br><span class="line"><span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带cookie</span></span><br><span class="line"><span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 这次跨域检测的有效期</span></span><br></pre></td></tr></table></figure><p>java代码就会根据上面配置的内容执行跨域的请求。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="java" scheme="http://cyc0819.top/categories/java/"/>
    
    <category term="SpringCloud" scheme="http://cyc0819.top/categories/java/SpringCloud/"/>
    
    
    <category term="java" scheme="http://cyc0819.top/tags/java/"/>
    
    <category term="SpringCloud" scheme="http://cyc0819.top/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_栈实现队列、队列实现栈</title>
    <link href="http://cyc0819.top/2021/10/01/2021-10-01-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97%E3%80%81%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E6%A0%88/"/>
    <id>http://cyc0819.top/2021/10/01/2021-10-01-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97%E3%80%81%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E6%A0%88/</id>
    <published>2021-10-01T03:22:43.000Z</published>
    <updated>2021-12-08T09:29:50.776Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="栈实现队列、队列实现栈"><a href="#栈实现队列、队列实现栈" class="headerlink" title="栈实现队列、队列实现栈"></a>栈实现队列、队列实现栈</h1><h2 id="题目1、用栈来实现队列"><a href="#题目1、用栈来实现队列" class="headerlink" title="题目1、用栈来实现队列"></a>题目1、用栈来实现队列</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/implement-queue-using-stacks/">lettcode-232题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/0e1d526ab12c4731.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/0e1d526ab12c4731.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="1-1、-解题思路"><a href="#1-1、-解题思路" class="headerlink" title="1.1、 解题思路"></a>1.1、 解题思路</h3><p>栈是一个先进后出的数据结构，而队列是一个先进先出的数据结构，所以我们想要用栈来实现队列，就必须要用到两个栈，第一个栈出栈到第二个栈中，第二个栈再进行出栈，就可以实现队列先进先出的功能。</p><p>具体代码如下</p><h3 id="1-2、具体代码"><a href="#1-2、具体代码" class="headerlink" title="1.2、具体代码"></a>1.2、具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; a;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a=<span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        b=<span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        a.push(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span> (!a.isEmpty())&#123;</span><br><span class="line">                b.push(a.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回栈顶元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span> (!a.isEmpty())&#123;</span><br><span class="line">                b.push(a.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断栈空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.isEmpty()&amp;&amp;b.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="题目2、用队列来实现栈"><a href="#题目2、用队列来实现栈" class="headerlink" title="题目2、用队列来实现栈"></a>题目2、用队列来实现栈</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/implement-stack-using-queues/">lettcode-225题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/69ec1eaccdf3cbb8.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/69ec1eaccdf3cbb8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-1、解题思路"><a href="#2-1、解题思路" class="headerlink" title="2.1、解题思路"></a>2.1、解题思路</h3><p>与上一题相同，我们需要用两个队列来实现一个栈</p><p>利用队列中的基本方法们就可以实现栈的先进后出的操作</p><p>代码如下：</p><h3 id="2-2、具体代码"><a href="#2-2、具体代码" class="headerlink" title="2.2、具体代码"></a>2.2、具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Integer&gt; a;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Integer&gt; b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        b=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        a.offer(x);</span><br><span class="line">        <span class="comment">// 将b队列中元素全部转给a队列</span></span><br><span class="line">        <span class="keyword">while</span>(!b.isEmpty()) &#123;</span><br><span class="line">            a.offer(b.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 交换a和b,使得a队列没有在push()的时候始终为空队列</span></span><br><span class="line">        Queue temp = a;</span><br><span class="line">        a = b;</span><br><span class="line">        b = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.poll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回栈顶元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断栈是否为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="算法" scheme="http://cyc0819.top/categories/%E7%AE%97%E6%B3%95/"/>
    
    
    <category term="算法" scheme="http://cyc0819.top/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
</feed>
