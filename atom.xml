<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>George&#39;s Blog</title>
  
  <subtitle>让我来给你讲讲他的传奇故事吧</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-11-18T15:28:26.651Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>George Chan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>我们还有必要深入学习jQuery吗</title>
    <link href="http://example.com/2021/11/17/2021-11-17-%E6%88%91%E4%BB%AC%E8%BF%98%E6%9C%89%E5%BF%85%E8%A6%81%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0jQuery%E5%90%97/"/>
    <id>http://example.com/2021/11/17/2021-11-17-%E6%88%91%E4%BB%AC%E8%BF%98%E6%9C%89%E5%BF%85%E8%A6%81%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0jQuery%E5%90%97/</id>
    <published>2021-11-17T15:27:41.000Z</published>
    <updated>2021-11-18T15:28:26.651Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="我们还有必要深入学习-jQuery-吗"><a href="#我们还有必要深入学习-jQuery-吗" class="headerlink" title="我们还有必要深入学习 jQuery 吗"></a>我们还有必要深入学习 jQuery 吗</h1><h2 id="表达想法"><a href="#表达想法" class="headerlink" title="表达想法"></a>表达想法</h2><div class="story post-story"><p>前几天在某个视频平台看到一个博主的视频，该博主对于『 我们还有必要深入学习 jQuery 吗？』这个问题做出了一个很肯定的答案：就是没有必要。</p><p>而他对于这个结论并也不是空穴来风，同样是做出了一系列的解释。比如说：jQuery 已经过时了、Vue.js以及React.js这样的前端框架能更好地实现jQuery所能实现的功能等等。</p><p>当然，作为该博主的个人想法，评论区自然是炸开了锅，有人赞同该博主的言论，而也有人对该博主的言论表示不敢苟同。这里我说说我个人的想法：</p><p>我认为 jQuery 虽然是一个多年以前的技术，但是他作为学习路上所必须经历的一段经历，我认为还是有必要进行学习的，但是也不用过度深入，在该阶段花费过多的时间。</p><p>jQuery 的开发模式和 Vue.js 等框架的开发模式是不同的两种开发模式，只有体会到两种开发模式的不同之处，我们才能更深入地理解如今所流行的前端框架所流行的原因，以及 jQuery 落后的原因等等。同样在若干年以后，可能会有更多新的前端框架的出现，替代现在地 vue.js、react.js 等等，到时候，经历过 vue.js 时代的我们，是不是又能从一种新的层面看到多种开发模式地区别呢？我们所了解到的是：为什么是这样子？而不是本来就是这样子。永远保持好奇与探索，对一个开发者来说是极其重要的。</p><p>而对于 js ，我认为我们应该重点对原生的js进行学习，毕竟 jQuery，vue，react 这些框架都是在js的基础上进行封装的，所以说我们在使用这些框架的时候，实际上我们还是在使用 js ，但是方便就方便在这些框架的一些优秀的封装类帮我们实现了 js 中很多复杂操作，我们只要按照框架所规定的语法进行编写，就能很方便的实现 js 中一些复杂的操作，这也是为什么框架技术能够如此流行的原因之一。</p><p>而我们不能只知道使用，而不知原理，这样子是走不远的，但是这并不表示我们就应该去生啃这些框架的源码，而是说我们应该学好 js 的语法，这样子在我们使用时也能很好地理解框架的原理，在使用的过程中，逐步地理解框架。</p></div><h2 id="jQuery-有什么优点？"><a href="#jQuery-有什么优点？" class="headerlink" title="jQuery 有什么优点？"></a>jQuery 有什么优点？</h2><div class="story post-story"><p>抛开现在流行的 vue 等前端框架不谈，我们来说说 jQuery 时代，他都有哪些有优点。</p><ol><li><p>能很好的操作 DOM<br>有这样一个例子，如果我要修改一个元素的样式，我用原生的js是这样子完成地：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dom=<span class="built_in">document</span>.getElementById(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">dom.style.color=<span class="string">&#x27;red&#x27;</span></span><br></pre></td></tr></table></figure><p>而我用 jQuery 来替代上面地代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test&#x27;</span>).css(<span class="string">&#x27;color&#x27;</span>,<span class="string">&#x27;red&#x27;</span>);</span><br></pre></td></tr></table></figure><p>相对于原生的 js 来说，我们的代码精简了许多，在 jQuery 中我们用<code>$</code>来替代了原生 js 中的<code>document.getElementById</code>这一行语句，所以代码精简了许多。</p></li><li><p>极其方便地 ajax 操作<br>在jQuery中，如果我们要使用ajax访问后台的数据，我们可以这样子实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line"><span class="attr">url</span>:<span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line"><span class="attr">success</span>:<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;请求成功&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>而如果我们要在原生的js中使用 ajax ，那别提有多复杂了，我们首先得创建一个异步对象，然后再设置请求的 url 以及参数，然后发送请求，最后我们需要将其注册到一个事件上，才能进行访问。虽然我们也能将其封装成一个可重复使用的方法，但是对于 jQuery 来说，他还是太麻烦了。</p></li><li><p>更方便的页面动效<br>通常我们的界面需要用到一些很有趣的画面，我们在 jQuery 中可以这样子实现：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#test&quot;</span>).animate(&#123;<span class="attr">left</span>:<span class="string">&#x27;100px&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure></li></ol><p>以上的这些操作，说实话在 js 中我们都可以实现，而 jQuery 作为一个很好的 js 框架，他所封装的很多函数可以大大方便我们的操作，所以这也就是 jQuery 为什么会流行的原因之一。我们自己也能封装一个这样的代码库，只是我们可能不能做到这么优秀，也不一定有时间和精力来做这样的工作。</p></div><h2 id="MVVM-框架是怎么替代-jQuery-的？"><a href="#MVVM-框架是怎么替代-jQuery-的？" class="headerlink" title="MVVM 框架是怎么替代 jQuery 的？"></a>MVVM 框架是怎么替代 jQuery 的？</h2><div class="story post-story"><p>现在的 MVVM 框架，他们都引入了几个新的概念：模块化、组件化。并采用了虚拟 DOM 的方式来替代原来的 DOM 操作，在这些框架中，数据和视图实现了分离，对数据的操作不在需要引用响应的 DOM 对象，达到了编程世界中一个共同的目标——解耦。</p><ol><li><p>针对 DOM 操作<br>在 MVVM 框架中，我们基本看不到 DOM 操作的影子，是因为他们采用了一种绑定元素渲染的方式，来绑定我们的视图以及数据。比如说 vue 框架中的<code>v-model</code>。<br>但是 DOM 操作不可能完全不需要，某些特殊情况还是会用到。</p></li><li><p>针对 ajax 操作<br>在 ajax 操作方面，基本上是被 axios 这样的库给替代了，而且所实现的功能与 ajax 都差不多，而且能更好地契合这些框架。</p></li><li><p>针对界面动效<br>CSS 3已经能很好地实现界面动态地效果。而且有很多优秀的动效库，能完美适配现在流行的框架，并能更好的实现很多好看的动效。</p></li></ol></div><h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><div class="story post-story"><p>可能在若干年后地某一天，又会出现更新的比现在更好的框架，那时候又会更加方便我们的使用。而我们同样要顺应时代地潮流，去学习这些新的技术，从入了编程这一行开始，我就深知这是一个需要不断学习知识，更新自己的行业，如果停止学习，就会被高速发展的互联网行业抛弃。所以这是一个很『内卷』的行业，我喜欢这种挑战，也渴望能从这种挑战中获得一个不断进步的自己。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="随笔" scheme="http://example.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
    <category term="前端" scheme="http://example.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>Service中包含哪些代码</title>
    <link href="http://example.com/2021/11/12/2021-11-12-Service%E4%B8%AD%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E4%BB%A3%E7%A0%81/"/>
    <id>http://example.com/2021/11/12/2021-11-12-Service%E4%B8%AD%E5%8C%85%E5%90%AB%E5%93%AA%E4%BA%9B%E4%BB%A3%E7%A0%81/</id>
    <published>2021-11-12T15:49:01.000Z</published>
    <updated>2021-11-12T16:35:26.168Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Service中包含哪些代码"><a href="#Service中包含哪些代码" class="headerlink" title="Service中包含哪些代码"></a>Service中包含哪些代码</h1><h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><div class="story post-story"><p>Service层中 = 核心功能(几十行 上百代码) + 额外功能(附加功能)</p><ol><li>核心功能<br>业务运算<br>DAO调用</li><li>额外功能 <ol><li>不属于业务</li><li>可有可无</li><li>代码量很小 </li></ol></li></ol><p>以及：事务、日志、性能…</p><p>Service层，作为程序的业务层面，其中最重要的必然是程序的业务流程，只有对程序的业务流程有足够的了解，才能写出优秀的Service层代码。</p><p>不冗余，是一个程序员代码水平的一个体现。</p></div><h2 id="2、接口"><a href="#2、接口" class="headerlink" title="2、接口"></a>2、接口</h2><div class="story post-story"><p>为什么要先写接口？<br>接口的作用是什么？</p><p>这里我引用一句话:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接口主要用于描述类具有什么功能，而并不给出每个功能的具体实现。一个类可以实现一个或多个接口，并在需要接口的地方，随时使用实现了相应接口的对象。——《Java核心技术卷一》</span><br></pre></td></tr></table></figure><p>这句话所描述的是接口的扩展性。简而言就是：接口是一个统一的插座，如果有需要我们就可以直接进行调用，实现了即插即用。</p><p>例如：有一个登录功能需要我们去实现，而该系统又有多种登陆方式，我们不可能每种接口都写一个Service代码给Controller进行调用，这样是十分繁琐的。而我们将多种登陆的方式统一成一个接口，然后根据用户的需求来分配最后实际的实现类。此时对于使用者来说，他们只需要关注的是登陆这个方法，整个登陆操作变得十分灵活，根据不同的场景使用不同的方式登陆。</p><p>对于开发者来说，接口中清晰地列出了所有地方法，对于后期的维护以及修改也是有极大的方便。</p></div><h2 id="3、Service之间的互相调用"><a href="#3、Service之间的互相调用" class="headerlink" title="3、Service之间的互相调用"></a>3、Service之间的互相调用</h2><div class="story post-story"><p>Service层之间可以相互调用吗？</p><p>这个问题相信很多人都有过思考，理论上来讲是不应该相互进行调用的，因为Service层的存在的一个很重要的目的就是 <strong>解耦</strong> 。</p><p>将业务层的每一个业务独立出来，以至于他们之间不相互影响，能够实现代码的优化，否则多种业务的代码混在一起，长久之后谁都看不出来代码的逻辑。所以说Service层就实现了这一个很重要的功能。</p><p>所以如果Service层之间的代码相互调用，是不是会是一种倒退呢？</p><p>有些人可能会问，有些业务中确实是会使用到其他业务中的代码，那这部分代码怎么办？重新写？那是不可能的，这又犯了冗余这个错误。所以我们该怎么解决呢？</p><p>首先，我们要清楚，这个情况是出于Service间有通用的逻辑，而不是通用的业务，每个Service对应一个业务，业务之间应该有明确的分界，不然会出现业务间的耦合，这是设计的不合理。</p><p> 既然是通用的逻辑，我们是不是又可以把他们抽象出来，独立成一个工具类，当我们需要的时候直接进行调用这个工具类就可以了呢？</p><p> 所以我个人认为Service层之间是不建议相互调用的。</p></div><h2 id="4、需要向Conrtroller层展示业务吗？"><a href="#4、需要向Conrtroller层展示业务吗？" class="headerlink" title="4、需要向Conrtroller层展示业务吗？"></a>4、需要向Conrtroller层展示业务吗？</h2><div class="story post-story"><p>当我们实现一个登录功能的时候，Controller层，调用Service层，往往我以前的写法是，Service返回登录成功或者失败的代码，然后Controller进行一个判断，判断是否成功登录，然后再向前端返回信息。这样子的写法有个问题，Controller判断的一个过程，算不算是业务？如果算，是不是Controller层又接触到了业务？</p><p>又回到了之前的问题，为什么要有Service层？</p><p>所以说，我们应该让Controller层尽可能少的接触到业务，所以我们的写法可以优化为，再Service层做完所有业务相关的工作，最后返回给Controller层的是一个开箱即用的接口，这样子是不是可以避免Controller层接触到业务相关的代码呢？<br>这就又符合了我们使用Service层的初衷了。</p></div><h2 id="5、最后"><a href="#5、最后" class="headerlink" title="5、最后"></a>5、最后</h2><div class="story post-story"><p>在看了一些文章之后，个人的一些小小观点。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_leetcode设计模块</title>
    <link href="http://example.com/2021/10/09/2021-10-09-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_leetcode%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9D%97/"/>
    <id>http://example.com/2021/10/09/2021-10-09-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_leetcode%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%9D%97/</id>
    <published>2021-10-09T06:39:20.000Z</published>
    <updated>2021-10-09T09:10:54.276Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="leetcode设计模块"><a href="#leetcode设计模块" class="headerlink" title="leetcode设计模块"></a>leetcode设计模块</h1><h2 id="1、子矩形查询"><a href="#1、子矩形查询" class="headerlink" title="1、子矩形查询"></a>1、子矩形查询</h2><div class="story post-story"><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/subrectangle-queries/">lettcode-1476题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FPlgH.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FPlgH.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>按照题目的要求，我们需要根据输入的坐标，拿到该坐标的值。<br>以及根据输入的两个坐标和一个值，修改两个坐标之间的值为所给出来的值。<br>所以实现这两个功能首先我们需要一个二维数组。拿到坐标的值并不难。<br>主要是修改两个坐标之间的值。<br>因为输入的两个坐标，假如是<code>(1,1)</code>和<code>(3,4)</code> ,所以可以看出来纵坐标是修改1和4之间的值，然后横坐标是修改1，3之间的值。所以通过遍历可以遍历第一行的1-4列，第二行的1-4列一直循环下去，最终修改所有的值。</p><h3 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubrectangleQueries</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[][] rectangle;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubrectangleQueries</span><span class="params">(<span class="keyword">int</span>[][] rectangle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rectangle=rectangle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateSubrectangle</span><span class="params">(<span class="keyword">int</span> row1, <span class="keyword">int</span> col1, <span class="keyword">int</span> row2, <span class="keyword">int</span> col2, <span class="keyword">int</span> newValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=row1;i&lt;=row2;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=col1;j&lt;=col2;j++)&#123;</span><br><span class="line">                rectangle[i][j]=newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rectangle[row][col];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="2、TinyURL-的加密与解密"><a href="#2、TinyURL-的加密与解密" class="headerlink" title="2、TinyURL 的加密与解密"></a>2、TinyURL 的加密与解密</h2><div class="story post-story"><h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/encode-and-decode-tinyurl/">lettcode-535题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FkmEq.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FkmEq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h3><p>为了加密 URL，我们使用计数器 (ii) ，每遇到一个新的 URL 都加一。我们将 URL 与它的次数 ii 放在哈希表 HashMap 中，这样我们在稍后的解密中可以轻易地获得原本的 URL</p><h3 id="具体代码-1"><a href="#具体代码-1" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Codec</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;Integer, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Encodes a URL to a shortened URL.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(String longUrl)</span> </span>&#123;</span><br><span class="line">        map.put(i,longUrl);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http://tinyurl.com/&quot;</span> + i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Decodes a shortened URL to its original URL.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">decode</span><span class="params">(String shortUrl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map.get(Integer.parseInt(shortUrl.replace(<span class="string">&quot;http://tinyurl.com/&quot;</span>, <span class="string">&quot;&quot;</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="3、二叉搜索树迭代器"><a href="#3、二叉搜索树迭代器" class="headerlink" title="3、二叉搜索树迭代器"></a>3、二叉搜索树迭代器</h2><div class="story post-story"><h3 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/binary-search-tree-iterator/">lettcode-173题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FAJSS.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FAJSS.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h3><p>二叉树，我们可以使用一个TreeNode来实现，其中我们将遍历到的值错放到一个list集合中去。<br>二叉树的中序遍历，遍历顺序是：左节点-中节点-右节点。<br>所以我们在方法中输入一个二叉树，重复进行遍历，即可得到最后中序遍历的结果。</p><h3 id="具体代码-2"><a href="#具体代码-2" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BSTIterator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; arr;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BSTIterator</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        index = <span class="number">0</span>;</span><br><span class="line">        arr = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">        inorderTraversal(root, arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arr.get(index++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index &lt; arr.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inorderTraversal</span><span class="params">(TreeNode root, List&lt;Integer&gt; arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//实现中序遍历 左-中-右</span></span><br><span class="line">        inorderTraversal(root.left, arr);</span><br><span class="line">        arr.add(root.val);</span><br><span class="line">        inorderTraversal(root.right, arr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、设计一个支持增量操作的栈"><a href="#4、设计一个支持增量操作的栈" class="headerlink" title="4、设计一个支持增量操作的栈"></a>4、设计一个支持增量操作的栈</h2><div class="story post-story"><h3 id="题目-3"><a href="#题目-3" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/design-a-stack-with-increment-operation/">lettcode-1381题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5F35b6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5F35b6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h3><p>题目要求这个栈需要有一个最大数量，所以我们需要定义一个变量来限制栈的大小。<br>如果没有达到最大数量，就将新元素添加到栈的顶端，否则就不允许添加。<br>当删除栈中元素的时候，首先删除栈顶端的元素，如果栈中没有东西，就返回一个 -1<br>更新栈中的元素的时候首先判断栈中的数量与输入的k的大小关系，如果k大，就将栈中元素数量作为更新的数量，由于index是由0开始的，所以数量就是index+1，否则就是以k作为数量。</p><h3 id="具体代码-3"><a href="#具体代码-3" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> maxSize;</span><br><span class="line">    <span class="keyword">int</span>[] myStack=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> head=-<span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomStack</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line">        myStack=<span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">        <span class="keyword">this</span>.maxSize=maxSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head==myStack.length-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            myStack[++head]=x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head==-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> myStack[head--];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> min;</span><br><span class="line">        <span class="keyword">if</span> (head&lt;k)&#123;</span><br><span class="line">            min=head+<span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            min=k;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;min;i++)&#123;</span><br><span class="line">            myStack[i]+=val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="5、在受污染的二叉树中查找元素"><a href="#5、在受污染的二叉树中查找元素" class="headerlink" title="5、在受污染的二叉树中查找元素"></a>5、在受污染的二叉树中查找元素</h2><div class="story post-story"><h3 id="题目-4"><a href="#题目-4" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/find-elements-in-a-contaminated-binary-tree/">lettcode-1261题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FJsVP.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FJsVP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h3><p>通过题目我们可以看出，根节点的左子树是2x+1，右子树是2x+2，所以以此类推下去，就能还原出二叉树。<br>首先得判断是否有子节点。<br>然后如果一个节点没有父子树，就说明他是根节点，就将他设为0</p><h3 id="具体代码-4"><a href="#具体代码-4" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FindElements</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Set&lt;Integer&gt; set=<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FindElements</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">        rebuildTree(root, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断 Set 集合是否包含指定的对象</span></span><br><span class="line">        <span class="keyword">return</span> set.contains(target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rebuildTree</span><span class="params">(TreeNode root, TreeNode parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果没有父节点，就设为0</span></span><br><span class="line">        <span class="comment">// 否则就执行下面的条件</span></span><br><span class="line">        <span class="keyword">if</span> (parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">            root.val = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.val = root == parent.left ?</span><br><span class="line">                    (parent.val &lt;&lt; <span class="number">1</span>) + <span class="number">1</span> : (parent.val &lt;&lt; <span class="number">1</span>) + <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将结果添加到set中</span></span><br><span class="line">        set.add(root.val);</span><br><span class="line">        <span class="comment">// 重复执行上面的内容</span></span><br><span class="line">        rebuildTree(root.left, root);</span><br><span class="line">        rebuildTree(root.right, root);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="6、扁平化嵌套列表迭代器"><a href="#6、扁平化嵌套列表迭代器" class="headerlink" title="6、扁平化嵌套列表迭代器"></a>6、扁平化嵌套列表迭代器</h2><div class="story post-story"><h3 id="题目-5"><a href="#题目-5" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/flatten-nested-list-iterator/">lettcode-341题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5Faz40.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5Faz40.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h3><p>从题目上看，题目所输入的数据就是一个嵌套的数组，一个数组中可以存放整数，也可以存放一个新的数组。<br>而当我们进行遍历时需要先遍历完一个数组，然后再遍历后面的数组，相当于把多个数组中的值给摊开成一个只有整数的数组。<br>所以我们在遍历时，将遍历的方法抽成一个独立的方法。如果碰到嵌套数组，我们就再次对遍历的方法进行调用，依次重复多次，就可以实现对多个嵌套数组的遍历。</p><h3 id="具体代码-5"><a href="#具体代码-5" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NestedIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NestedIterator</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;</span><br><span class="line">        add(nestedList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (NestedInteger nestedInteger : nestedList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nestedInteger.isInteger()) &#123;</span><br><span class="line">                list.add(nestedInteger.getInteger());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//重新遍历嵌套的数组</span></span><br><span class="line">                add(nestedInteger.getList());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.get(index++);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> index&lt;list.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="7、实现-Trie-前缀树"><a href="#7、实现-Trie-前缀树" class="headerlink" title="7、实现 Trie (前缀树)"></a>7、实现 Trie (前缀树)</h2><div class="story post-story"><h3 id="题目-6"><a href="#题目-6" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/implement-trie-prefix-tree/">lettcode-208题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FBvsU.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FBvsU.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h3><p>前缀树，又叫做字典树。通过阅读题目，这一题我们可以用List数组来实现。<br>其中添加元素可以用add方法来实现，而contains方法可以用来判断数组中书否有该元素。<br>startsWith方法即可用用于判断数组中的元素是否包含某一个值。</p><h3 id="具体代码-6"><a href="#具体代码-6" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Trie</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Trie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        list.add(word);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">search</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (list.contains(word)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">startsWith</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String lists:list)&#123;</span><br><span class="line">            <span class="keyword">if</span> (lists.startsWith(prefix))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="8、皇位继承顺序"><a href="#8、皇位继承顺序" class="headerlink" title="8、皇位继承顺序"></a>8、皇位继承顺序</h2><div class="story post-story"><h3 id="题目-7"><a href="#题目-7" class="headerlink" title="题目"></a>题目</h3><p><a href="https://leetcode-cn.com/problems/throne-inheritance/">lettcode-1600题</a><br>难度：中等<img src="https://z3.ax1x.com/2021/10/09/5FyFWn.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/09/5FyFWn.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p><h3 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h3><p>这题一开始读起来有点晦涩难懂，和后面读起来其实就是类似于我国古代的世袭机制。<br>首先是皇帝，然后长子次子，但是长子之后的皇帝应该是长子的后代，如果长子没有后代了，皇帝才会传给次子。类似这样子循环下去。<br>然后我们需要每个人有一个列表来存储他的后代们。所以可以使用HashMap来实现这一功能。<br>然后该Map的键是String类型，值是一个list类型。所以比如说皇帝A，他的A就是键，他的后代就构成了Map的值list。<br>死亡人员我们可以用一个Set来实现，因为他是不可重复的，一个人也不可能死很多次，所以我们将死亡的人员放到其中。<br>最后是排序。首先判断在set中的人员，将他们删除，然后循环遍历List中的值。首先我们输入皇帝的名字，然后就会遍历皇帝的后代，遍历到皇帝的第一个后代，又会遍历到他的第一个后代的后代，一直到完，就是深度优先遍历。<br>所以我们可以将便利的代码抽成一个独立的方法，以供重复进行调用，实现这个功能。</p><h3 id="具体代码-7"><a href="#具体代码-7" class="headerlink" title="具体代码"></a>具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThroneInheritance</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String kingName;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;String&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">//不可重复</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; deathSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThroneInheritance</span><span class="params">(String kingName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.kingName=kingName;</span><br><span class="line">        map.put(kingName,<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">birth</span><span class="params">(String parentName, String childName)</span> </span>&#123;</span><br><span class="line">        map.get(parentName).add(childName);</span><br><span class="line">        map.put(childName,<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">death</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        deathSet.add(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getInheritanceOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        add(list,kingName);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(List&lt;String&gt; list, String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!deathSet.contains(name))&#123;</span><br><span class="line">            list.add(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//遍历该人物的子孙</span></span><br><span class="line">        <span class="keyword">for</span> (String names:map.get(name))&#123;</span><br><span class="line">            add(list,names);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ入门使用</title>
    <link href="http://example.com/2021/10/06/2021-10-06-RabbitMQ%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2021/10/06/2021-10-06-RabbitMQ%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/</id>
    <published>2021-10-06T13:49:01.000Z</published>
    <updated>2021-10-06T16:30:03.342Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RabbitMQ入门使用"><a href="#RabbitMQ入门使用" class="headerlink" title="RabbitMQ入门使用"></a>RabbitMQ入门使用</h1><h2 id="1、同步、异步通信"><a href="#1、同步、异步通信" class="headerlink" title="1、同步、异步通信"></a>1、同步、异步通信</h2><div class="story post-story"><p>我们服务之间的通信，一般分为同步和异步两种方式。</p><p><strong>同步</strong>就是：当两个服务间通信时，必须要每一步按照顺序进行之后再进行下一步的内容。看上去同步可以立即得到结果，好像很好。但是这样的通信方式往往就会产生一些问题。</p><ol><li>耦合度较高。当我们加入新的需求时，需要修改很多的代码。</li><li>性能不好。因为每次都要等待上一个服务完成，所以会消耗很多时间，导致性能下降.</li><li>资源浪费。在等待服务完成的时候，不能释放资源，也不能做事情，就导致了资源的浪费。</li><li>级联失败。如果服务调用过程中一个环节出现错误，就会导致其他环节跟着出现错误。就像是多米诺骨牌一样。</li></ol><p><strong>异步</strong>就是：当两个服务间通信时，A将资料传给B的时候，就可以继续去做自己的事情，而不用一直等待B传送消息回来，在B有空的时候处理就可以。同时，异步通信解决了一些同步通信存在的问题：<code>耦合度低</code>，<code>吞吐量提升</code>，<code>故障隔离</code> ，<code>流量削峰</code>。<br>但是同时也带来了一些新的问题：</p><ol><li>依赖于Broker的可靠性、安全性、吞吐能力</li><li>架构复杂了，业务没有明显的流程线，不好追踪管理</li></ol><p>所以我们在使用的时候，应该根据实际情况来使用异步或者同步通信。</p></div><h2 id="2、消息队列（MQ）简介"><a href="#2、消息队列（MQ）简介" class="headerlink" title="2、消息队列（MQ）简介"></a>2、消息队列（MQ）简介</h2><div class="story post-story"><p>MQ （MessageQueue），中文是消息队列，字面来看就是存放消息的队列。也就是事件驱动架构中的Broker。</p><p>消息队列中间件是分布式系统中重要的组件，主要解决应用耦合、异步消息、流量削锋等问题。实现高性能、高可用、可伸缩和最终一致性架构。是大型分布式系统不可缺少的中间件。</p><h3 id="2-1、常见的MQ"><a href="#2-1、常见的MQ" class="headerlink" title="2.1、常见的MQ"></a>2.1、常见的MQ</h3><p>以下就是四种我们常用的MQ以及它们之间的对比：<br><img src="https://i.bmp.ovh/imgs/2021/10/6d1e83477fe9a9c8.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6d1e83477fe9a9c8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>接下来我们就以RabbitMQ来作为我们学习的工具。</p><h3 id="2-2、RabbitMQ介绍以及安装"><a href="#2-2、RabbitMQ介绍以及安装" class="headerlink" title="2.2、RabbitMQ介绍以及安装"></a>2.2、RabbitMQ介绍以及安装</h3><p>RabbitMQ是基于Erlang语言开发的开源消息通信中间件，官网地址：<a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p><p>由于它是基于Erlang语言开发的，所以我们必须安装Erlang语言的开发环境。<br>为了省时间，我们这里直接在Dockers里面进行安装并做一个映射。<br>步骤如下：</p><ol><li>下载RabbitMQ的镜像<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3-management</span><br></pre></td></tr></table></figure></li><li>安装mq<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line"> -e RABBITMQ_DEFAULT_USER=chenyicai \</span><br><span class="line"> -e RABBITMQ_DEFAULT_PASS=123456 \</span><br><span class="line"> --name mq \</span><br><span class="line"> --hostname mq1 \</span><br><span class="line"> -p 15672:15672 \</span><br><span class="line"> -p 5672:5672 \</span><br><span class="line"> -d \</span><br><span class="line"> rabbitmq:3-management</span><br></pre></td></tr></table></figure>然后我们的RabbitMQ就安装完成了，现在我们可以在浏览器输入服务器地址+15672进入RabbitMQ的控制台<br><img src="https://i.bmp.ovh/imgs/2021/10/d864df3d43bd58c4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/d864df3d43bd58c4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>账号密码就是我们前面设置好的<code>chenyicai</code>和<code>123456</code><br>登录之后：<br><img src="https://i.bmp.ovh/imgs/2021/10/9079fb7ec4d8d3db.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/9079fb7ec4d8d3db.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>以下是RabbitMQ中的几个基本概念：</p><ul><li>channel：操作MQ的工具</li><li>exchange：路由消息到队列中</li><li>queue：缓存消息</li><li>virtual host：虚拟主机，是对queue、exchange等资源的逻辑分组</li></ul></div><h2 id="3、常见的消息模型"><a href="#3、常见的消息模型" class="headerlink" title="3、常见的消息模型"></a>3、常见的消息模型</h2><div class="story post-story"><h3 id="3-1、官方给出的消息模型"><a href="#3-1、官方给出的消息模型" class="headerlink" title="3.1、官方给出的消息模型"></a>3.1、官方给出的消息模型</h3><p>官方一共给出的五个MQ的Demo，分别对应了几种不同的用法：</p><ol><li>基本消息队列（BasicQueue）</li><li>工作消息队列（WorkQueue）</li><li>发布订阅（Publish、Subscribe），又根据交换机类型不同分为三种：<ol><li>Fanout Exchange：广播</li><li>Direct Exchange：路由</li><li>Topic Exchange：主题</li></ol></li></ol><p><img src="https://i.bmp.ovh/imgs/2021/10/6e351b659680b5ee.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6e351b659680b5ee.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://i.bmp.ovh/imgs/2021/10/830978c3cd4ea8dc.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/830978c3cd4ea8dc.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="3-2、Hello-World"><a href="#3-2、Hello-World" class="headerlink" title="3.2、Hello World"></a>3.2、Hello World</h3><p>现在我们就在SpringBoot里面实现以下官方示例中的Hello World这个例子。<br>官方的HelloWorld是基于最基础的消息队列模型来实现的，只包括三个角色：</p><ol><li>publisher：消息发布者，将消息发送到队列queue</li><li>queue：消息队列，负责接受并缓存消息</li><li>consumer：订阅队列，处理队列中的消息</li></ol><p>所以我们实现这个例子的步骤如下：<br>基本消息队列的消息发送流程：</p><ol><li>建立connection<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"><span class="comment">//设置连接参数，分别是：主机名、端口号、vhost、用户名、密码</span></span><br><span class="line">factory.setHost(<span class="string">&quot;8.129.212.155&quot;</span>);</span><br><span class="line">factory.setPort(<span class="number">5672</span>);</span><br><span class="line">factory.setVirtualHost(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">factory.setUsername(<span class="string">&quot;chenyicai&quot;</span>);</span><br><span class="line">factory.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line"><span class="comment">//建立连接</span></span><br><span class="line">Connection connection = factory.newConnection();</span><br></pre></td></tr></table></figure></li><li>创建通道channel<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Channel channel = connection.createChannel();</span><br></pre></td></tr></table></figure></li><li>利用channel声明队列<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//队列名</span></span><br><span class="line">String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line"><span class="comment">//队列的属性</span></span><br><span class="line">channel.queueDeclare(queueName, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br></pre></td></tr></table></figure></li><li>利用channel向队列发送消息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String message = <span class="string">&quot;hello, rabbitmq!&quot;</span>;</span><br><span class="line">channel.basicPublish(<span class="string">&quot;&quot;</span>, queueName, <span class="keyword">null</span>, message.getBytes());</span><br><span class="line">System.out.println(<span class="string">&quot;发送消息成功：【&quot;</span> + message + <span class="string">&quot;】&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><p>基本消息队列的消息接收流程：</p><ol><li>建立connection</li><li>创建通道channel</li><li>利用channel声明队列</li><li>定义consumer的消费行为handleDelivery()<br>利用channel将消费者与队列绑定<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">channel.basicConsume(queueName, <span class="keyword">true</span>, <span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope,</span></span></span><br><span class="line"><span class="params"><span class="function">             AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">// 5.处理消息</span></span><br><span class="line">String message = <span class="keyword">new</span> String(body);</span><br><span class="line">System.out.println(<span class="string">&quot;接收到消息：【&quot;</span> + message + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;等待接收消息。。。。&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><p>很显然如果每次使用消息队列都这样开关连接，那么是非常不好的一种现象，所以我们接下来就要使用Spring的一个框架，来更好地帮助我们对消息队列进行使用。</p></div><h2 id="4、SpringAMQP"><a href="#4、SpringAMQP" class="headerlink" title="4、SpringAMQP"></a>4、SpringAMQP</h2><div class="story post-story"><h3 id="4-1、什么是SpringAMQP"><a href="#4-1、什么是SpringAMQP" class="headerlink" title="4.1、什么是SpringAMQP"></a>4.1、什么是SpringAMQP</h3><p>SpringAmqp的官方地址：<a href="https://spring.io/projects/spring-amqp">https://spring.io/projects/spring-amqp</a><br><img src="https://i.bmp.ovh/imgs/2021/10/a347fedc49140107.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/a347fedc49140107.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>AMQP：是用于在应用程序之间传递业务消息的开放标准。该协议与语言和平台无关，更符合微服务中独立性的要求。</p><p>SpringAMQP：是基于AMQP协议定义的一套API规范，提供了模板来发送和接受消息。包含两部分，其中Spring-AMQP是基础抽象，Spring-rabbit是底层的默认实现。</p><h3 id="4-2、SpringAMQP实现Hello-World"><a href="#4-2、SpringAMQP实现Hello-World" class="headerlink" title="4.2、SpringAMQP实现Hello World"></a>4.2、SpringAMQP实现Hello World</h3><p>Spring中已经集成了AMQP的依赖，所以我们只需要引入依赖就可以实现自动注入，具体步骤如下：</p><ol><li>引入SpringAMQP的依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>在publisher中编写一个yml配置文件，添加mq连接的信息<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">8.129</span><span class="number">.212</span><span class="number">.155</span> <span class="comment"># rabbitMQ的ip地址</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span> <span class="comment"># 端口</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">chenyicai</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">virtual-host:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure></li><li>在publisher服务中新建一个测试类，编写测试方法发送消息：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAmqpTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMessage2SimpleQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        String message = <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(queueName, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>如果此时我们没有接受信息，信息就会存在mq的缓存区里面，如下:<br><img src="https://i.bmp.ovh/imgs/2021/10/7fff7b4306ad9074.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/7fff7b4306ad9074.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br><img src="https://i.bmp.ovh/imgs/2021/10/77dd30c482f123d4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/77dd30c482f123d4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>在consumer中接受消息（consumer中也要创建连接配置文件）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenSimpleQueue</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到simple.queue的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>现在我们就完成了一个Hello World的例子的实现。<br>结果如下：<br><img src="https://i.bmp.ovh/imgs/2021/10/6d5247dea94d40d9.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6d5247dea94d40d9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>消息队列是阅后即焚的，是一个不可逆的过程。<br>现在我们看看剩下的几个例子。</li></ol><h3 id="4-3、Work-Queue-工作队列"><a href="#4-3、Work-Queue-工作队列" class="headerlink" title="4.3、Work Queue 工作队列"></a>4.3、Work Queue 工作队列</h3><p>工作队列，可以提高消息处理速度，避免队列消息堆积<br>他的逻辑图如下：<br><img src="https://i.bmp.ovh/imgs/2021/10/71a3d073f2914be1.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/71a3d073f2914be1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>现在我们要来实现一个工作队列</p><ol><li>在publisher服务中添加一个测试方法，循环发送50条消息到simple.queue队列<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAmqpTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMessage2WorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        String queueName = <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">        String message = <span class="string">&quot;hello, message__&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">50</span>; i++) &#123;</span><br><span class="line">            rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">            Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在consumer服务中添加一个消费者，也监听simple.queue：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者1接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;消费者2........接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>然后我们修改yml配置文件，添加以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">prefetch:</span> <span class="number">1</span> <span class="comment">#每次只能获取一条消息，处理完成才能获取下一个消息</span></span><br></pre></td></tr></table></figure></li><li>然后我们进行测试，结果如下<br><img src="https://z3.ax1x.com/2021/10/06/5SSH0J.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5SSH0J.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>两个消费者就会交替获取信息，而睡眠20毫秒的用户会比睡眠200毫秒的用户获取更多的信息。</p><h3 id="4-4、发布（-Publish-）、订阅（-Subscribe-）"><a href="#4-4、发布（-Publish-）、订阅（-Subscribe-）" class="headerlink" title="4.4、发布（ Publish ）、订阅（ Subscribe ）"></a>4.4、发布（ Publish ）、订阅（ Subscribe ）</h3><p>发布订阅模式与之前案例的区别就是允许将同一消息发送给多个消费者。实现方式是加入了exchange（交换机）。<br>常见exchange类型包括：</p><ul><li>Fanout：广播</li><li>Direct：路由</li><li>Topic：话题</li></ul><p><img src="https://z3.ax1x.com/2021/10/06/5SpKBQ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5SpKBQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>注意</strong>：exchange负责消息路由，而不是存储，路由失败则消息丢失</p><h4 id="4-4-1、发布订阅-Fanout-Exchange"><a href="#4-4-1、发布订阅-Fanout-Exchange" class="headerlink" title="4.4.1、发布订阅-Fanout Exchange"></a>4.4.1、发布订阅-Fanout Exchange</h4><p><code>Fanout Exchange</code> 会将接收到的消息广播到每一个跟其绑定的queue</p><p>具体实现步骤如下：</p><ol><li>在<code>consumer</code>服务声明<code>Exchange</code>、<code>Queue</code>、<code>Binding</code><br>在<code>consumer</code>服务常见一个类，添加<code>@Configuration</code> 注解，并声明<code>FanoutExchange</code>、<code>Queue</code>和绑定关系对象<code>Binding</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">// itcast.fanout</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fanout.queue1</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueue1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定队列1到交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">fanoutBinding1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(fanoutQueue1)</span><br><span class="line">                .to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fanout.queue2</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueue2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 绑定队列2到交换机</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">fanoutBinding2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder</span><br><span class="line">                .bind(fanoutQueue2)</span><br><span class="line">                .to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在<code>consumer</code>服务的<code>SpringRabbitListener</code>类中，添加两个方法，分别监听<code>fanout.queue1</code>和<code>fanout.queue2</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringRabbitListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenFanoutQueue1</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到fanout.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenFanoutQueue2</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到fanout.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>在<code>publisher</code>服务发送消息到<code>FanoutExchange</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendFanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 交换机名称</span></span><br><span class="line">       String exchangeName = <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">       <span class="comment">// 消息</span></span><br><span class="line">       String message = <span class="string">&quot;hello, every one!&quot;</span>;</span><br><span class="line">       <span class="comment">// 发送消息</span></span><br><span class="line">       rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li>测试，此时两个消费者都会受到这条消息<br><img src="https://z3.ax1x.com/2021/10/06/5S9Va9.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5S9Va9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h4 id="4-4-2、发布订阅-DirectExchange"><a href="#4-4-2、发布订阅-DirectExchange" class="headerlink" title="4.4.2、发布订阅-DirectExchange"></a>4.4.2、发布订阅-DirectExchange</h4><p><code>Direct Exchange</code> 会将接收到的消息根据规则路由到指定的<code>Queue</code>，因此称为路由模式（routes）。</p><ul><li>每一个<code>Queue</code>都与<code>Exchange</code>设置一个<code>BindingKey</code></li><li>发布者发送消息时，指定消息的<code>RoutingKey</code></li><li><code>Exchange</code>将消息路由到<code>BindingKey</code>与消息<code>RoutingKey</code>一致的队列<br><img src="https://z3.ax1x.com/2021/10/06/5S9KxK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/06/5S9KxK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ul><p>具体实现步骤如下：</p><ol><li>在<code>consumer</code>服务中，编写两个消费者方法，分别监听<code>direct.queue1</code>和<code>direct.queue2</code>。并利用<code>@RabbitListener</code>声明<code>Exchange</code>、<code>Queue</code>、<code>RoutingKey</code></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">           key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenDirectQueue1</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">           key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenDirectQueue2</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在<code>publisher</code>服务发送消息到<code>DirectExchange</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendDirectExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 交换机名称</span></span><br><span class="line">       String exchangeName = <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">       <span class="comment">// 消息</span></span><br><span class="line">       String message = <span class="string">&quot;hello, red!&quot;</span>;</span><br><span class="line">       <span class="comment">// 发送消息</span></span><br><span class="line">       rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ol><p>测试如下：<br><img src="https://z3.ax1x.com/2021/10/07/5S9Lz6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5S9Lz6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>两个都能收到<code>red</code>的消息，而我们现在换一种发送消息的方式看看，发送一个<code>blue</code>的消息，按照规定<code>direct.queue2</code>应该是没有消息的。<br><img src="https://z3.ax1x.com/2021/10/07/5SCkSP.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCkSP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>确实是这个样子。</p><h4 id="4-4-3、发布订阅-TopicExchange"><a href="#4-4-3、发布订阅-TopicExchange" class="headerlink" title="4.4.3、发布订阅-TopicExchange"></a>4.4.3、发布订阅-TopicExchange</h4><p><code>TopicExchange</code>与<code>DirectExchange</code>类似，区别在于<code>routingKey</code>必须是多个单词的列表，并且以 <code>. </code>分割。<br><code>Queue</code>与<code>Exchange</code>指定<code>BindingKey</code>时可以使用通配符：</p><ul><li>#：代指0个或多个单词</li><li>*：代指一个单词</li></ul><p><img src="https://z3.ax1x.com/2021/10/07/5SCQWq.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCQWq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>实现步骤如下：</p><ol><li>在<code>consumer</code>服务中，编写两个消费者方法，分别监听<code>topic.queue1</code>和<code>topic.queue2</code>。<br>并利用<code>@RabbitListener</code>声明<code>Exchange</code>、<code>Queue</code>、<code>RoutingKey</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;topic.queue1&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">           key = &quot;china.#&quot;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenTopicQueue1</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到topic.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">           value = @Queue(name = &quot;topic.queue2&quot;),</span></span><br><span class="line"><span class="meta">           exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span></span><br><span class="line"><span class="meta">           key = &quot;#.news&quot;</span></span><br><span class="line"><span class="meta">   ))</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listenTopicQueue2</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;消费者接收到topic.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li><li>在<code>publisher</code>服务发送消息到<code>TopicExchange</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendTopicExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 交换机名称</span></span><br><span class="line">       String exchangeName = <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">       <span class="comment">// 消息</span></span><br><span class="line">       String message = <span class="string">&quot;中国新闻&quot;</span>;</span><br><span class="line">       <span class="comment">// 发送消息</span></span><br><span class="line">       rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.news&quot;</span>, message);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li></ol><p>进行测试，此时两个消费者都能接收到消息<br><img src="https://z3.ax1x.com/2021/10/07/5SCc0e.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCc0e.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>如果修改<code>key</code>的值，后面不为<code>news</code>时，<code>topic.queue2</code>将无法收到消息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendTopicExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 交换机名称</span></span><br><span class="line">        String exchangeName = <span class="string">&quot;itcast.topic&quot;</span>;</span><br><span class="line">        <span class="comment">// 消息</span></span><br><span class="line">        String message = <span class="string">&quot;中国新闻,一条&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;china.new&quot;</span>, message);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>结果如下：<br><img src="https://z3.ax1x.com/2021/10/07/5SCI6f.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SCI6f.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="4-5、SpringAMQP-消息转换器"><a href="#4-5、SpringAMQP-消息转换器" class="headerlink" title="4.5、SpringAMQP-消息转换器"></a>4.5、SpringAMQP-消息转换器</h3><p>在<code>SpringAMQP</code>的发送方法中，接收消息的类型是<code>Object</code>，也就是说我们可以发送任意对象类型的消息，<code>SpringAMQP</code>会帮我们序列化为字节后发送。</p><p>我们在<code>consumer</code>中利用<code>@Bean</code>声明一个队列：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">objectQueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;object.queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>publisher</code>中发送消息以测试:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendMap</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       <span class="comment">// 准备消息    </span></span><br><span class="line">       Map&lt;String,Object&gt; msg = <span class="keyword">new</span> HashMap&lt;&gt;();    </span><br><span class="line">       msg.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jack&quot;</span>);    </span><br><span class="line">       msg.put(<span class="string">&quot;age&quot;</span>, <span class="number">21</span>);</span><br><span class="line">       <span class="comment">// 发送消息 </span></span><br><span class="line">       rabbitTemplate.convertAndSend(<span class="string">&quot;object.queue&quot;</span>, msg);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>会发现在消息队列中我们传过去的是一堆乱码<br><img src="https://z3.ax1x.com/2021/10/07/5SP6g0.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SP6g0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>其实就是<code>java</code>将我们的消息进行了一个序列化来进行传输，但是这样子十分不具有可读性，而且字符串较长，会影响到传输的效率。</p><p><code>Spring</code>的对消息对象的处理是由<code>org.springframework.amqp.support.converter.MessageConverter</code>来处理的。而默认实现是<code>SimpleMessageConverter</code>，基于<code>JDK</code>的<code>ObjectOutputStream</code>完成序列化。<br>如果要修改只需要定义一个<code>MessageConverter</code> 类型的<code>Bean</code>即可。推荐用<code>JSON</code>方式序列化，步骤如下：</p><ol><li>首先我们需要引入json的依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>publisher服务声明MessageConverter（可以放在启动类上）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> MessageConverter <span class="title">messageConverter</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>然后我们进行测试<br><img src="https://z3.ax1x.com/2021/10/07/5SiFr8.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/07/5SiFr8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>此时显示的消息就很有可读性了。</p></div><h2 id="5、总结"><a href="#5、总结" class="headerlink" title="5、总结"></a>5、总结</h2><div class="story post-story"><p>以上就是我对RabbirMQ入门学习的一个总结，还有很多的内容需要去学习，以后学到了会继续补充。s</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="消息队列" scheme="http://example.com/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>Swagger3入门使用</title>
    <link href="http://example.com/2021/10/05/2021-10-05-Swagger3%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2021/10/05/2021-10-05-Swagger3%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/</id>
    <published>2021-10-05T01:57:56.000Z</published>
    <updated>2021-11-18T15:29:10.382Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Swagger3入门使用"><a href="#Swagger3入门使用" class="headerlink" title="Swagger3入门使用"></a>Swagger3入门使用</h1><h2 id="1、Swagger3简介"><a href="#1、Swagger3简介" class="headerlink" title="1、Swagger3简介"></a>1、Swagger3简介</h2><div class="story post-story"><p>Swagger 是一套基于 OpenAPI 规范（OpenAPI Specification，OAS）构建的开源工具，后来成为了 Open API 标准的主要定义者。<br>对于 Rest API 来说很重要的一部分内容就是文档，Swagger 为我们提供了一套通过代码和注解自动生成文档的方法，这一点对于保证API 文档的及时性将有很大的帮助。</p><p><strong>swagger2于17年停止维护，现在最新的版本为17年发布的 Swagger3（Open Api3）</strong></p></div><h2 id="2-Swagger3与Swagger2-x比较"><a href="#2-Swagger3与Swagger2-x比较" class="headerlink" title="2. Swagger3与Swagger2.x比较"></a>2. Swagger3与Swagger2.x比较</h2><div class="story post-story"><ul><li>应用主类添加注解@EnableOpenApi (swagger2是@EnableSwagger2)</li><li>swagger配置类SwaggerProperties.class，与swagger2.xx 版本有差异，具体看下文</li><li>自定义一个配置类 SwaggerConfiguration.class,看下文</li><li>访问地址：<a href="http://localhost:8080/swagger-ui/index.html">http://localhost:8080/swagger-ui/index.html</a> (swagger2.xx版本访问的地址为<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a>)</li></ul></div><h2 id="3、SpringBoot整合Swagger3"><a href="#3、SpringBoot整合Swagger3" class="headerlink" title="3、SpringBoot整合Swagger3"></a>3、SpringBoot整合Swagger3</h2><div class="story post-story"><h3 id="3-1、引入依赖"><a href="#3-1、引入依赖" class="headerlink" title="3.1、引入依赖"></a>3.1、引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-2、在Controller类上添加注解"><a href="#3-2、在Controller类上添加注解" class="headerlink" title="3.2、在Controller类上添加注解"></a>3.2、在Controller类上添加注解</h3><p>Swagger通过几个注解，就能实现api的添加。</p><p><code>@Api</code> ：用在controller类，描述API接口<br><code>@EnableOpenApi</code> :表示开启SwaggerApi<br><code>@ApiOperation</code> ：描述接口方法<br><code>@ApiModel</code> ：描述对象<br><code>@ApiModelProperty</code> ：描述对象属性<br><code>@ApiImplicitParams</code>  ：描述接口参数<br><code>@ApiResponses</code> ：描述接口响应<br><code>@ApiIgnore</code> ：忽略接口方法<br><code>@ApiParam</code> ：为 Rest 接口参数添加其它元数据</p><p>如下所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableOpenApi</span> <span class="comment">// 也可以不写此注解</span></span><br><span class="line"><span class="meta">@Api(description=&quot;讲师管理&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/edu/teacher&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TeacherService teacherService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;所有讲师列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Teacher&gt; <span class="title">list</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacherService.list();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据ID删除讲师&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeById</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span></span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacherService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询某个讲师&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/setlct/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Teacher <span class="title">teacher</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;讲师ID&quot;, required = true)</span> <span class="meta">@PathVariable</span> String id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> teacherService.teacher(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3、自定义一个配置类SwaggerProperties-class"><a href="#3-3、自定义一个配置类SwaggerProperties-class" class="headerlink" title="3.3、自定义一个配置类SwaggerProperties.class"></a>3.3、自定义一个配置类SwaggerProperties.class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;swagger&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerProperties</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否开启swagger，生产环境一般关闭，所以这里定义一个变量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enable;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目应用名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目版本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationVersion;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目描述信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationDescription;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接口调试地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tryHost;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getEnable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> enable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnable</span><span class="params">(Boolean enable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.enable = enable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationName</span><span class="params">(String applicationName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationName = applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationVersion;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationVersion</span><span class="params">(String applicationVersion)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationVersion = applicationVersion;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationDescription</span><span class="params">(String applicationDescription)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationDescription = applicationDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTryHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tryHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTryHost</span><span class="params">(String tryHost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tryHost = tryHost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4、自定义springfox-swagger3配置类SwaggerConfiguration-class"><a href="#3-4、自定义springfox-swagger3配置类SwaggerConfiguration-class" class="headerlink" title="3.4、自定义springfox swagger3配置类SwaggerConfiguration.class"></a>3.4、自定义springfox swagger3配置类SwaggerConfiguration.class</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io.swagger.models.auth.In;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.reflect.FieldUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringBootVersion;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ReflectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.oas.annotations.EnableOpenApi;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.*;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.service.contexts.SecurityContext;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SwaggerProperties swaggerProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SwaggerConfiguration</span><span class="params">(SwaggerProperties swaggerProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.swaggerProperties = swaggerProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.OAS_30).pathMapping(<span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 定义是否开启swagger，false为关闭，可以通过变量控制</span></span><br><span class="line">                .enable(swaggerProperties.getEnable())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将api的元信息设置为包含在json ResourceListing响应中。 </span></span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接口调试地址</span></span><br><span class="line">                .host(swaggerProperties.getTryHost())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 选择哪些接口作为swagger的doc发布</span></span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.any())</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build()</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 支持的通讯协议集合</span></span><br><span class="line">                .protocols(newHashSet(<span class="string">&quot;https&quot;</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息设置，必要的header token等认证信息</span></span><br><span class="line">                .securitySchemes(securitySchemes())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息全局应用</span></span><br><span class="line">                .securityContexts(securityContexts());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API 页面上半部分展示信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(swaggerProperties.getApplicationName() + <span class="string">&quot; Api Doc&quot;</span>)</span><br><span class="line">                .description(swaggerProperties.getApplicationDescription())</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;lighter&quot;</span>, <span class="keyword">null</span>, <span class="string">&quot;123456@gmail.com&quot;</span>))</span><br><span class="line">                .version(<span class="string">&quot;Application Version: &quot;</span> + swaggerProperties.getApplicationVersion() + <span class="string">&quot;, Spring Boot Version: &quot;</span> + SpringBootVersion.getVersion())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置授权信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityScheme&gt; <span class="title">securitySchemes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApiKey apiKey = <span class="keyword">new</span> ApiKey(<span class="string">&quot;BASE_TOKEN&quot;</span>, <span class="string">&quot;token&quot;</span>, In.HEADER.toValue());</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(apiKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权信息全局应用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityContext&gt; <span class="title">securityContexts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(</span><br><span class="line">                SecurityContext.builder()</span><br><span class="line">                        .securityReferences(Collections.singletonList(<span class="keyword">new</span> SecurityReference(<span class="string">&quot;BASE_TOKEN&quot;</span>, <span class="keyword">new</span> AuthorizationScope[]&#123;<span class="keyword">new</span> AuthorizationScope(<span class="string">&quot;global&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;)))</span><br><span class="line">                        .build()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SafeVarargs</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> &lt;T&gt; <span class="function">Set&lt;T&gt; <span class="title">newHashSet</span><span class="params">(T... ts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ts.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(ts));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用拦截器排除swagger设置，所有拦截器都会自动加swagger相关的资源排除信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field registrationsField = FieldUtils.getField(InterceptorRegistry.class, <span class="string">&quot;registrations&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            List&lt;InterceptorRegistration&gt; registrations = (List&lt;InterceptorRegistration&gt;) ReflectionUtils.getField(registrationsField, registry);</span><br><span class="line">            <span class="keyword">if</span> (registrations != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (InterceptorRegistration interceptorRegistration : registrations) &#123;</span><br><span class="line">                    interceptorRegistration</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/swagger**/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/v3/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/doc.html&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="4、测试"><a href="#4、测试" class="headerlink" title="4、测试"></a>4、测试</h2><div class="story post-story"><p>完成上述的编写之后可以打开下面的地址查看是否成功创建</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/swagger-ui/index.html</span><br></pre></td></tr></table></figure><p>成功显示如下<img src="https://z3.ax1x.com/2021/10/05/4jUGVJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4jUGVJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://z3.ax1x.com/2021/10/05/4jUa26.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4jUa26.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="Swagger" scheme="http://example.com/tags/Swagger/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_最小栈</title>
    <link href="http://example.com/2021/10/04/2021-10-04-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%9C%80%E5%B0%8F%E6%A0%88/"/>
    <id>http://example.com/2021/10/04/2021-10-04-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%9C%80%E5%B0%8F%E6%A0%88/</id>
    <published>2021-10-03T16:05:20.000Z</published>
    <updated>2021-10-03T16:23:11.610Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="最小栈"><a href="#最小栈" class="headerlink" title="最小栈"></a>最小栈</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/min-stack/">lettcode-155题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/874db5e3352e9d73.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/874db5e3352e9d73.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>题目基本上就是要求找出一个栈中最小的值，通过java中内置的栈的方法即可实现这一目标</p><p>首先我的想法是通过遍历比较所有的值来找出最小的那个值，但是这样子消耗了较多的时间，而且题目希望是设计一种栈的结构，而不是直接用栈的方法。</p><p>所以后面换了一种新的方法，就是使用链表来实现，这样子的效率是较高的，相比于之前的方法，用时整整少了200多毫秒<img src="https://i.bmp.ovh/imgs/2021/10/677ed412598a9dc4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/677ed412598a9dc4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>具体实现方式如下</p></div><h2 id="具体代码-第一种思路"><a href="#具体代码-第一种思路" class="headerlink" title="具体代码(第一种思路)"></a>具体代码(第一种思路)</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Integer&gt; stack;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stack = <span class="keyword">new</span> Stack&lt;Integer&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        stack.push(val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stack.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> min=stack.get(<span class="number">0</span>);;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;stack.size();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (stack.get(i)&lt;min)&#123;</span><br><span class="line">                min=stack.get(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="具体代码-第二种思路"><a href="#具体代码-第二种思路" class="headerlink" title="具体代码(第二种思路)"></a>具体代码(第二种思路)</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node head;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="keyword">null</span>) </span><br><span class="line">            head = <span class="keyword">new</span> Node(x, x);</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            head = <span class="keyword">new</span> Node(x, Math.min(x, head.min), head);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        head = head.next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> head.val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> head.min;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> val;</span><br><span class="line">        <span class="keyword">int</span> min;</span><br><span class="line">        Node next;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> min)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>(val, min, <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> val, <span class="keyword">int</span> min, Node next)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.val = val;</span><br><span class="line">            <span class="keyword">this</span>.min = min;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_设计hash集合、hash映射</title>
    <link href="http://example.com/2021/10/03/2021-10-03-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1hash%E9%9B%86%E5%90%88%E3%80%81hash%E6%98%A0%E5%B0%84/"/>
    <id>http://example.com/2021/10/03/2021-10-03-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1hash%E9%9B%86%E5%90%88%E3%80%81hash%E6%98%A0%E5%B0%84/</id>
    <published>2021-10-03T14:21:21.000Z</published>
    <updated>2021-10-03T15:10:28.956Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="设计hash集合、hash映射"><a href="#设计hash集合、hash映射" class="headerlink" title="设计hash集合、hash映射"></a>设计hash集合、hash映射</h1><h2 id="题目1"><a href="#题目1" class="headerlink" title="题目1"></a>题目1</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/design-hashset/">lettcode-705题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/40b4bcb17c130bf0.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/40b4bcb17c130bf0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>既然说是一个HashSet，所以他就是一个不可重复的集合，就意味着在该集合中每个元素只能出现一次。</p><p>所以说我们就可以用boolean类型的数组来模拟出这样的一个集合</p><p>数组的索引就对应了set的key，数组所对应的布尔值就是set的value，当其为true1时就说明存在，否则就是不存在</p><p>具体实现方式如下</p></div><h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashSet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个boolean类型的数组</span></span><br><span class="line">    <span class="keyword">boolean</span>[] map=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyHashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map=<span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">1000001</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        map[key]=<span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        map[key]=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map[key]==<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="题目2"><a href="#题目2" class="headerlink" title="题目2"></a>题目2</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/design-hashmap/">lettcode-706题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/6d0c43c3b85e5903.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/6d0c43c3b85e5903.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>从题目中我们可以看出来跟上一题差不多，无非是一个set一个map的差别</p><p>阅读题目要求我们可以知道对应的<code>key</code>和<code>value</code> 都是<code>int</code> 类型的，所以我们可以定义一个int类型的数组来存储数据</p><p>取值的时候如果取值为空就返回一个<code>-1</code> ，所以我做了一个判断，判断是否有值</p><p>具体实现方式如下</p></div><h2 id="具体代码-1"><a href="#具体代码-1" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHashMap</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个int类型的数组</span></span><br><span class="line">    Integer[] map=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        map=<span class="keyword">new</span> Integer[<span class="number">1000001</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        map[key]=value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map[key]!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> value=map[key];</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        map[key]=<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud微服务入门</title>
    <link href="http://example.com/2021/10/03/2021-10-03-SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/"/>
    <id>http://example.com/2021/10/03/2021-10-03-SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8/</id>
    <published>2021-10-03T05:44:20.000Z</published>
    <updated>2021-11-18T15:28:50.416Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="SpringCloud微服务入门"><a href="#SpringCloud微服务入门" class="headerlink" title="SpringCloud微服务入门"></a>SpringCloud微服务入门</h1><h2 id="1、微服务的发展历程"><a href="#1、微服务的发展历程" class="headerlink" title="1、微服务的发展历程"></a>1、微服务的发展历程</h2><div class="story post-story"><h3 id="1-1、单体结构"><a href="#1-1、单体结构" class="headerlink" title="1.1、单体结构"></a>1.1、单体结构</h3><p>简介：将业务的所有功能集中在一个项目中开发，打成一个包部署。我们之前所做的学生管理系统基本都是单体结构<br>优点：结构简单、部署成本低<br>缺点：耦合度高</p><h3 id="1-2、分布式结构"><a href="#1-2、分布式结构" class="headerlink" title="1.2、分布式结构"></a>1.2、分布式结构</h3><p>简介：根据业务功能对系统进行拆分，每个业务模块作为独立项目开发，称为一个服务。<br>优点：降低服务耦合、有利于服务升级拓展<br>分布式架构的要考虑的问题：<br>服务拆分粒度如何？<br>服务集群地址如何维护？<br>服务之间如何实现远程调用？<br>服务健康状态如何感知？</p><h3 id="1-3、微服务架构"><a href="#1-3、微服务架构" class="headerlink" title="1.3、微服务架构"></a>1.3、微服务架构</h3><p>简介：微服务是一种经过良好架构设计的分布式架构方案。<br>优点：拆分粒度更小、服务更独立、耦合度更低<br>缺点：架构非常复杂，运维、监控、部署难度提高<br>微服务架构的特征：</p><ul><li>单一职责：微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责，避免重复业务开发</li><li>面向服务：微服务对外暴露业务接口</li><li>自治：团队独立、技术独立、数据独立、部署独立</li><li>隔离性强：服务调用做好隔离、容错、降级，避免出现级联问题</li></ul></div><h2 id="2、使用SpringCloud"><a href="#2、使用SpringCloud" class="headerlink" title="2、使用SpringCloud"></a>2、使用SpringCloud</h2><div class="story post-story"><p>SpringCloud并不是一个全新的框架，其实他是一个将其他开源的框架集合的一个大篮子<br>得益于SpringBoot框架方便的使用，我们也能很轻松地在SpringBoot上整合SpriongCloud的模块<br>以下是SpringBoot和SpringCloud的版本匹配表，如果不按照这个规则，就有可能出现很多奇怪的问题<img src="https://bu.dusays.com/2021/10/03/9337d5a6f9ca0.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/9337d5a6f9ca0.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-1、服务拆分"><a href="#2-1、服务拆分" class="headerlink" title="2.1、服务拆分"></a>2.1、服务拆分</h3><p>当我们使用微服务时，实际上就是相当于把原本在一起的模块拆分成一个一个的小的模块，所以我们在进行服务拆分时必须注意以下几点：</p><ol><li>单一职责：不同微服务，不要重复开发相同业务</li><li>数据独立：不要访问其它微服务的数据库</li><li>面向服务：将自己的业务暴露为接口，供其它微服务调用</li></ol><h3 id="2-2、服务调用"><a href="#2-2、服务调用" class="headerlink" title="2.2、服务调用"></a>2.2、服务调用</h3><p>当我们成功拆分出两个服务的时候，在使用时，肯定会出现A调用B，B调用C的情况出现，而此时我们想到的第一个方法就是根据服务的IP地址和端口进行调用。<img src="https://bu.dusays.com/2021/10/03/3cfda9ed84286.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/3cfda9ed84286.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>但是此时会出现一个问题，实际情况中我们一个服务肯定不只是只有一个地址，可能会有多个一样的服务，作为负载均衡。但是如果每个服务我们都需要通过IP+端口的方式来连接，那么当我们修改一个服务的端口时，就要相应地修改很多个调用他的端口的服务，显然是很麻烦的，而且也不能实现真正的负载均衡。所以我们需要一个注册中心来统一管理我们的所有服务。<br>所以就有了eureka</p><h3 id="2-3、eureka注册中心"><a href="#2-3、eureka注册中心" class="headerlink" title="2.3、eureka注册中心"></a>2.3、eureka注册中心</h3><p>消费者该如何获取服务提供者具体信息？</p><ul><li>服务提供者启动时向eureka注册自己的信息</li><li>eureka保存这些信息</li><li>消费者根据服务名称向eureka拉取提供者信息</li></ul><p>如果有多个服务提供者，消费者该如何选择？</p><ul><li>服务消费者利用负载均衡算法，从服务列表中挑选一个</li></ul><p>消费者如何感知服务提供者健康状态？</p><ul><li>服务提供者会每隔30秒向EurekaServer发送心跳请求，报告健康状态</li><li>eureka会更新记录服务列表信息，心跳不正常会被剔除</li><li>消费者就可以拉取到最新的信息</li></ul><p>现在我们来创建一个eureka注册中心：</p><ol><li>我们需要创建一个普通的maven项目，然后在其中引入依赖：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;    </span><br><span class="line">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;    </span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>在启动类上添加<code>@EnableEurekaServer</code>注解</li><li>然后创建一个配置文件<code>Application.yml</code>,在其中添加以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line"><span class="attr">port:</span> <span class="number">10086</span> <span class="comment">#端口</span></span><br><span class="line"><span class="attr">spring:</span>  </span><br><span class="line"><span class="attr">application:</span>    </span><br><span class="line"><span class="attr">name:</span> <span class="string">eurekaserver</span><span class="comment">#服务名称</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line"><span class="attr">client:</span>    </span><br><span class="line"><span class="attr">service-url:</span>       </span><br><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka/</span> <span class="comment"># eureka的地址，将自己注册到eureka中</span></span><br></pre></td></tr></table></figure></li></ol><p>以上就成功创建了一个eureka注册中心，运行打开端口，就可以看到我们创建好的注册中心<img src="https://bu.dusays.com/2021/10/03/aee959c4bd69a.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/aee959c4bd69a.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>注册成功的服务会显示在<code>Instances currently registered with Eureka</code>处</p><p>接下来我们将客户端注册到注册中心去</p><ol><li>我们在需要加入的服务中添加以下依赖：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;    </span><br><span class="line">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;    </span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>然后再配置文件中添加以下内容<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line"><span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line"><span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka/</span></span><br></pre></td></tr></table></figure>与上面一样，将自己注册到了注册中心中<img src="https://bu.dusays.com/2021/10/03/28ced8e089410.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/28ced8e089410.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="2-4、eureka服务调用"><a href="#2-4、eureka服务调用" class="headerlink" title="2.4、eureka服务调用"></a>2.4、eureka服务调用</h3><p>在成功将服务注册到eureka中之后，我们就可以使用服务名来替代端口地址对服务进行调用了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String url = <span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId();</span><br></pre></td></tr></table></figure><p>但这不是一个真实有效的地址，是不能直接进行访问的，只能通过eureka进行访问</p></div><h2 id="3、负载均衡"><a href="#3、负载均衡" class="headerlink" title="3、负载均衡"></a>3、负载均衡</h2><div class="story post-story"><h3 id="3-1、认识负载均衡"><a href="#3-1、认识负载均衡" class="headerlink" title="3.1、认识负载均衡"></a>3.1、认识负载均衡</h3><p>以下是负载均衡的一个流程图（此流程图也解释了如何通过服务名调用对应的服务）<img src="https://bu.dusays.com/2021/10/03/7165d0dd07c93.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/7165d0dd07c93.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>负载均衡简单来说就是我们有多个同名的服务，他们做的是一样的事情，我们希望所有的请求给他们所有人一起分担，而不是一个人抗下所有的请求，所以这个时候负载均衡就起到了作用，根据不同的规则，负载均衡可以以不同的策略对请求的服务进行管理，可以极大减小服务器的压力。</p><h3 id="3-2、负载均衡策略"><a href="#3-2、负载均衡策略" class="headerlink" title="3.2、负载均衡策略"></a>3.2、负载均衡策略</h3><p>以下就是负载均衡的策略规则<br><img src="https://bu.dusays.com/2021/10/03/c6326bca1dd7c.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/c6326bca1dd7c.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><img src="https://bu.dusays.com/2021/10/03/eb43a6d5349a9.png" class="lazyload" data-srcset="https://bu.dusays.com/2021/10/03/eb43a6d5349a9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p><strong>饥饿加载</strong><br>Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalanceClient，请求时间会很长。<br>而饥饿加载则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：</p><p>在yml配置文件中加入以下内容，就可以开启饥饿加载模式：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line"><span class="attr">eager-load:</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启饥饿加载 </span></span><br><span class="line"><span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment"># 指定对userservice这个服务饥饿加载</span></span><br></pre></td></tr></table></figure></div><h2 id="4、SpringCloud-Alibaba"><a href="#4、SpringCloud-Alibaba" class="headerlink" title="4、SpringCloud Alibaba"></a>4、SpringCloud Alibaba</h2><div class="story post-story"><p>Spring Cloud Alibaba 是阿里巴巴提供的微服务开发一站式解决方案，是阿里巴巴开源中间件与 Spring Cloud 体系的融合。</p><p>Spring Cloud Alibaba在自身有很多新的组件之外，还可以兼容SpringCloudNetflix的部分组件，如eureka、zuul等等</p><h3 id="4-1、注册中心Nacos"><a href="#4-1、注册中心Nacos" class="headerlink" title="4.1、注册中心Nacos"></a>4.1、注册中心Nacos</h3><p>Nacos是阿里巴巴的产品，现在是SpringCloud中的一个组件。相比Eureka功能更加丰富，在国内受欢迎程度较高</p><p><strong>在使用之前我们得先进行安装</strong><br>首先得去Github上下载Nacos的压缩包,<a href="https://github.com/alibaba/nacos/releases">点击跳转</a><br>下载完成后放到一个没有中文的路径<br>在<code>bin</code>路径处打开cmd，输入以下命令，即可运行Nacos</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure><p>以下是运行成功的标志<img src="https://i.bmp.ovh/imgs/2021/10/f421f5312ec052f6.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/f421f5312ec052f6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>然后我们在浏览器输入地址和端口就可以进入到nacos里面去</p><p><strong>可能报错</strong><br>在启动的时候碰到以下错误</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在启动时碰见这个提示：此时不应有 \nacos&quot;\logs\java<span class="emphasis">_heapdump.hprof -XX:-UseLargePages&quot;</span></span><br></pre></td></tr></table></figure><p>此时我们打开自带的编译器，将下面的语句注释掉</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REM if %MODE% == &quot;cluster&quot; (    REM echo &quot;nacos is starting with cluster&quot;  REM if %EMBEDDED_STORAGE% == &quot;embedded&quot; (      REM set &quot;NACOS_OPTS=-DembeddedStorage=true&quot;  REM )    REM set &quot;NACOS_JVM_OPTS=-server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=%BASE_DIR%\logs\java_heapdump.hprof -XX:-UseLargePages&quot;REM )</span><br></pre></td></tr></table></figure><p>再次运行即可通过</p><h3 id="4-2、将服务注册到Nacos"><a href="#4-2、将服务注册到Nacos" class="headerlink" title="4.2、将服务注册到Nacos"></a>4.2、将服务注册到Nacos</h3><ol><li>在微服务的父工程文件中添加以下内容<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;    &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">&lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>注释掉所有的eureka依赖文件</li><li>添加Nacos依赖<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li>然后修改yml文件，注释掉eureka的地址，添加上Nacos的地址<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos服务地址</span></span><br></pre></td></tr></table></figure>启动服务就可以注册到Nacos中了<img src="https://i.bmp.ovh/imgs/2021/10/72e709e90cb38267.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/72e709e90cb38267.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="4-3、服务集群"><a href="#4-3、服务集群" class="headerlink" title="4.3、服务集群"></a>4.3、服务集群</h3><p>服务调用尽可能选择本地集群的服务，跨集群调用延迟较高<br>本地集群不可访问时，再去访问其它集群</p><p><strong>现在我们来设置服务的集群</strong></p><ol><li><p>首先我们在yml文件中添加以下的内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">SH</span> <span class="comment">#cluster-name就是集群的名称</span></span><br></pre></td></tr></table></figure></li><li><p>然后重新运行就可以看到变化<img src="https://i.bmp.ovh/imgs/2021/10/d5fd108812f6fef4.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/d5fd108812f6fef4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>然后在order-service中设置负载均衡的IRule为NacosRule，这个规则优先会寻找与自己同集群的服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userservice:</span><br><span class="line">  ribbon:</span><br><span class="line">    NFLoadBalancerRuleClassName: com.alibaba.cloud.nacos.ribbon.NacosRule  # 负载均衡规则</span><br></pre></td></tr></table></figure><p>当本地集群正常运行时，服务就会优先调用本地集群的服务，而随后再考虑远程集群</p></li></ol><h3 id="4-4、环境隔离-namespace"><a href="#4-4、环境隔离-namespace" class="headerlink" title="4.4、环境隔离 - namespace"></a>4.4、环境隔离 - namespace</h3><p>Nacos中服务存储和数据存储的最外层都是一个名为namespace的东西，用来做最外层隔离</p><ol><li><p>在nacos的控制太我们可以创建一个命名空间<img src="https://z3.ax1x.com/2021/10/04/4Oh4bR.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Oh4bR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>填写好命名空间的信息，然后复制命名空间的ID</p></li><li><p>然后修改yml文件，添加命名空间的配置(添加最后一句)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos服务地址</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="attr">cluster-name:</span> <span class="string">HZ</span></span><br><span class="line">      <span class="attr">ephemeral:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">4d6ce343-9e1b-44df-a90f-2cf2b6b3d177</span> <span class="comment"># dev环境</span></span><br></pre></td></tr></table></figure></li><li><p>启动服务就会看到相应的变化</p></li><li><p>此时不同空间中的服务是不能相互访问的</p></li></ol></div><h2 id="5、Nacos配置管理"><a href="#5、Nacos配置管理" class="headerlink" title="5、Nacos配置管理"></a>5、Nacos配置管理</h2><div class="story post-story"><h3 id="5-1、Nacos实现配置的管理"><a href="#5-1、Nacos实现配置的管理" class="headerlink" title="5.1、Nacos实现配置的管理"></a>5.1、Nacos实现配置的管理</h3><p>Nacos有一个功能，就是可以将为服务的配置管理到自己的注册中心去，然后我们就可以通过远程调用，来使用这些配置在远端的配置文件。<br>但是这又有什么用处呢？<br>用处就是当我们有一些需要修改的开关型配置文件，我们希望修改时不影响到程序的运行，只要我们对程序进行了更改，就会自动进行配置，也叫做热部署。<br>所以Nacos的配置管理就可以实现这样的一个功能。<br>那么要怎么实现呢？</p><ol><li><p>首先我们进入到Nacos的配置管理界面，打开配置列表，点击右上角的<code>+</code> 创建新的配置<img src="https://z3.ax1x.com/2021/10/04/4XiLA1.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XiLA1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>如下图一样配置好文件，然后可以在下面的黑色输入框以<code>yml</code> 文件的格式输入你想要的配置内容，完成之后点击发布即可<img src="https://z3.ax1x.com/2021/10/04/4XkuRK.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XkuRK.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>现在我们就可以去java代码中进行配置的拉取了</p></li></ol><h3 id="5-2、配置的拉取"><a href="#5-2、配置的拉取" class="headerlink" title="5.2、配置的拉取"></a>5.2、配置的拉取</h3><p>创建好了配置文件，我们现在需要去java代码中对其进行拉取。<br>而以往我们运行微服务时直接就会读取 <code>application.yml</code> 这个配置文件，如何在读取他之前先读取Nacos上的配置文件呢？<br>这时，我们就可以添加一个优先级更高的配置文件<code>bootstrap.yml</code> ，在里面编写读取Nacos配置的配置。</p><p><img src="https://z3.ax1x.com/2021/10/04/4XA3lT.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XA3lT.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><ol><li><p>首先引入Nacos配置文件的依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--&lt;nacos配置依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li><p>然后我们创建一个 <code>bootstrap.yml</code> ，里面写的是拉取远程配置的代码</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br></pre></td></tr></table></figure><p>比如这里我们读取了 <code>userservice-dev.yaml</code> 文件的内容</p></li><li><p>然后我们检验一下是否能拿到远程的配置，以下是我们的远程配置文件中所包含的内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">yyyy/MM/dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure><p>然后我们在Controller文件中获取一下配置文件，然后输出到屏幕上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String dateformat;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;now&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">now</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果读取成功屏幕上就会按照前面的格式输出时间<img src="https://z3.ax1x.com/2021/10/04/4XEA41.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XEA41.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li></ol><h3 id="5-3、配置热更新"><a href="#5-3、配置热更新" class="headerlink" title="5.3、配置热更新"></a>5.3、配置热更新</h3><p>有了配置文件之后，我们现在要来配置热更新了。<br>最简单的方法就是通过注解的方式来进行添加，就是以下的这种方法</p><p>在 <code>@Value</code> 注入的变量所在类上添加注解 <code>@RefreshScope</code></p><p>另一种方法就是使用 <code>@ConfigurationProperties</code> 注解来实现。</p><p>首先我们创建一个 <code>PatternProperties </code> 类，然后在上面标上 <code>@ConfigurationProperties(prefix = &quot;pattern&quot;)</code> ,<code>@Component</code> ,<code>@Data</code> 等注解。<br>然后在类中创建一个私有成员变量<code>private String dateformat;</code> ，然后其他的控制器中对其进行注入并调用，就可以实现热更新。</p><h3 id="5-4、多环境配置共享"><a href="#5-4、多环境配置共享" class="headerlink" title="5.4、多环境配置共享"></a>5.4、多环境配置共享</h3><p><img src="https://z3.ax1x.com/2021/10/04/4XZMtA.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XZMtA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>而在不同微服务之间可以共享配置文件，可以通过下面的两种方式来指定：</p><ol><li>方式一<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">userservice</span> <span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境，</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line"><span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos地址</span></span><br><span class="line"><span class="attr">config:</span> </span><br><span class="line"><span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br><span class="line"><span class="attr">shared-configs:</span> <span class="comment"># 多微服务间共享的配置列表</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">common.yaml</span> <span class="comment"># 要共享的配置文件id</span></span><br></pre></td></tr></table></figure></li><li>方式二<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">userservice</span> <span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">profiles:</span></span><br><span class="line"><span class="attr">active:</span> <span class="string">dev</span> <span class="comment"># 环境，</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line"><span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># Nacos地址</span></span><br><span class="line"><span class="attr">config:</span> </span><br><span class="line">            <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment"># 文件后缀名</span></span><br><span class="line"><span class="attr">extends-configs:</span> <span class="comment"># 多微服务间共享的配置列表</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">dataId:</span> <span class="string">extend.yaml</span> <span class="comment"># 要共享的配置文件id</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-5、Nacos集群搭建"><a href="#5-5、Nacos集群搭建" class="headerlink" title="5.5、Nacos集群搭建"></a>5.5、Nacos集群搭建</h3><p>以下是教程中所要搭建的集群结构</p><p><img src="https://z3.ax1x.com/2021/10/04/4Xe2Kf.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Xe2Kf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>三个nacos节点的地址：</p><table><thead><tr><th>节点</th><th>ip</th><th>port</th></tr></thead><tbody><tr><td>nacos1</td><td>192.168.150.1</td><td>8845</td></tr><tr><td>nacos2</td><td>192.168.150.1</td><td>8846</td></tr><tr><td>nacos3</td><td>192.168.150.1</td><td>8847</td></tr></tbody></table><p><strong>然后我们现在开始搭建我们的集群</strong></p><p>搭建集群的基本步骤：</p><ul><li>搭建数据库，初始化数据库表结构</li><li>下载nacos安装包</li><li>配置nacos</li><li>启动nacos集群</li><li>nginx反向代理</li></ul><ol><li><p>初始化数据库</p><p>我们在我们的数据库中创建好一个我们所需要的数据库</p></li><li><p>然后安装包我们已经下载过了，就可以直接跳过，然后配置一下nacos</p><p>进入nacos的conf目录，修改配置文件cluster.conf.example，重命名为cluster.conf：<br><img src="https://z3.ax1x.com/2021/10/04/4Xeva4.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Xeva4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后添加以下三个地址</p><p><img src="https://z3.ax1x.com/2021/10/04/4XmfQx.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XmfQx.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>然后修改application.properties文件，添加数据库配置</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="meta">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="meta">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="meta">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">db.password.0</span>=<span class="string">123</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>启动</p><p>将nacos文件夹复制三份，分别命名为：nacos1、nacos2、nacos3</p><p>然后分别修改三个文件夹中的 <code>application.properties</code> ，</p><p>nacos1:</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8845</span></span><br></pre></td></tr></table></figure><p>   nacos2:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8846</span></span><br></pre></td></tr></table></figure><p>   nacos3:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8847</span></span><br></pre></td></tr></table></figure><p>   然后分别启动三个nacos节点：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd</span><br></pre></td></tr></table></figure><ol start="4"><li>Nginx反向代理</li></ol><p>安装好nginx之后，打开文件夹。修改conf/nginx.conf文件，配置如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> nacos-cluster &#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">127.0.0.1:8845</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8846</span>;</span><br><span class="line"><span class="attribute">server</span> <span class="number">127.0.0.1:8847</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> /nacos &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://nacos-cluster;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在浏览器访问：<a href="http://localhost/nacos%E5%8D%B3%E5%8F%AF%E3%80%82">http://localhost/nacos即可。</a></p><p>代码中application.yml文件配置如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"> <span class="attr">cloud:</span></span><br><span class="line">   <span class="attr">nacos:</span></span><br><span class="line">     <span class="attr">server-addr:</span> <span class="string">localhost:80</span> <span class="comment"># Nacos地址</span></span><br></pre></td></tr></table></figure></div><h2 id="6、客户端Feign"><a href="#6、客户端Feign" class="headerlink" title="6、客户端Feign"></a>6、客户端Feign</h2><div class="story post-story"><p>Feign是一个声明式的http客户端，官方地址：<a href="https://github.com/OpenFeign/feign">https://github.com/OpenFeign/feign</a><br>其作用就是帮助我们优雅的实现http请求的发送</p><p><img src="https://z3.ax1x.com/2021/10/04/4Xtf4x.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4Xtf4x.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="6-1、使用"><a href="#6-1、使用" class="headerlink" title="6.1、使用"></a>6.1、使用</h3><ol><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在order-service的启动类添加注解开启Feign的功能：<img src="https://z3.ax1x.com/2021/10/04/4XNUMD.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XNUMD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></li><li><p>编写feign客户端</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserClient</span> </span>&#123;</span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span> </span><br><span class="line"><span class="function">User <span class="title">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要是基于SpringMVC的注解来声明远程调用的信息，比如：</p></li></ol><ul><li>服务名称：userservice</li><li>请求方式：GET</li><li>请求路径：/user/{id}</li><li>请求参数：Long id</li><li>返回值类型：User</li></ul><p>使用这种方式就可以很方便地代替之前的url的调用方式，代码变得更加清晰简洁。<br>以下就是调用的内容</p><ol start="4"><li>调用<br><img src="https://z3.ax1x.com/2021/10/04/4XUSF1.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XUSF1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><h3 id="6-2、自定义Feign的配置"><a href="#6-2、自定义Feign的配置" class="headerlink" title="6.2、自定义Feign的配置"></a>6.2、自定义Feign的配置</h3><p>Feign运行自定义配置来覆盖默认配置，可以修改的配置如下：<img src="https://z3.ax1x.com/2021/10/04/4XUiQO.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4XUiQO.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>一般情况下我们会修改日志级别,最好用basic或none</p><h3 id="6-3、配置Feign的日志"><a href="#6-3、配置Feign的日志" class="headerlink" title="6.3、配置Feign的日志"></a>6.3、配置Feign的日志</h3><p>配置日志时我们也有两种方式，一种是配置文件的方式，另一种是java代码的方式</p><ol><li>配置文件方式</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line"><span class="attr">client:</span></span><br><span class="line"><span class="attr">config:</span></span><br><span class="line"><span class="attr">default:</span> <span class="comment"># 这里用default就是全局配置，如果是写服务名称，则是针对某个微服务的配置</span></span><br><span class="line"><span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#  日志级别</span></span><br></pre></td></tr></table></figure><ol start="2"><li>java代码方式</li></ol><p>首先我们声明一个Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignClientConfiguration</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Logger.<span class="function">Level <span class="title">feignLogLevel</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> Logger.Level.BASIC; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后如果是全局配置，我们就放到 <code>@EnableFeignClients</code> 这个注解中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = FeignClientConfiguration.class)</span> </span><br></pre></td></tr></table></figure><p>如果是局部配置，我们就放到 <code>@FeignClient</code> 这个注解中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = FeignClientConfiguration.class)</span> </span><br></pre></td></tr></table></figure><h3 id="6-4、性能优化"><a href="#6-4、性能优化" class="headerlink" title="6.4、性能优化"></a>6.4、性能优化</h3><p>Feign底层发起http请求，依赖于其它的框架。其底层客户端实现包括：</p><ul><li>URLConnection：默认实现，不支持连接池</li><li>Apache HttpClient ：支持连接池</li><li>OKHttp：支持连接池</li></ul><p>因此提高Feign的性能主要手段就是使用<strong>连接池</strong>代替默认的URLConnection。<br>这里我们用Apache的HttpClient来演示。</p><ol><li>引入依赖<br>在order-service的pom文件中引入Apache的HttpClient依赖：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--httpClient的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>配置连接池<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">default:</span> <span class="comment"># default全局的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">BASIC</span> <span class="comment"># 日志级别，BASIC就是基本的请求和响应信息</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启feign对HttpClient的支持</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment"># 最大的连接数</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment"># 每个路径的最大连接数</span></span><br></pre></td></tr></table></figure></li><li>优化总结<br>总结，Feign的优化：</li></ol><p>1.日志级别尽量用basic<br>2.使用HttpClient或OKHttp代替URLConnection<br>①  引入feign-httpClient依赖<br>②  配置文件开启httpClient功能，设置连接池参数</p><h3 id="6-5、最佳实践"><a href="#6-5、最佳实践" class="headerlink" title="6.5、最佳实践"></a>6.5、最佳实践</h3><p>所谓最近实践，就是使用过程中总结的经验，最好的一种使用方式。<br>自习观察可以发现，Feign的客户端与服务提供者的controller代码非常相似：<br>feign客户端：<img src="https://z3.ax1x.com/2021/10/04/4X0pHe.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0pHe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>UserController：<img src="https://z3.ax1x.com/2021/10/04/4X0k9I.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0k9I.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>我们有两种方法来优化重复的代码编写</p><ol><li>继承方式</li><li>抽取方式</li></ol><p>首先来说一下<strong>继承方式</strong>：<br>一样的代码可以通过继承来共享：<br>1）定义一个API接口，利用定义方法，并基于SpringMVC注解做声明。<br>2）Feign客户端和Controller都集成这个接口<img src="https://z3.ax1x.com/2021/10/04/4X0EgP.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0EgP.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>优点：</p><ul><li>简单</li><li>实现了代码共享</li></ul><p>缺点：</p><ul><li>服务提供方、服务消费方紧耦合</li><li>参数列表中的注解映射并不会继承，因此Controller中必须再次声明方法、参数列表、注解</li></ul><p>然后是<strong>抽取的方式</strong><br>将Feign的Client抽取为独立模块，并且把接口有关的POJO、默认的Feign配置都放到这个模块中，提供给所有消费者使用。<br>例如，将UserClient、User、Feign的默认配置都抽取到一个feign-api包中，所有微服务引用该依赖包，即可直接使用<br><img src="https://z3.ax1x.com/2021/10/04/4X0dUJ.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0dUJ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="6-6、基于抽取的最佳实践"><a href="#6-6、基于抽取的最佳实践" class="headerlink" title="6.6、基于抽取的最佳实践"></a>6.6、基于抽取的最佳实践</h3><ol><li>首先创建一个公共类 <code>feign-api</code></li><li>在这个类中引入依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>然后，order-service中编写的UserClient、User、DefaultFeignConfiguration都复制到feign-api项目中<br><img src="https://z3.ax1x.com/2021/10/04/4X0RVe.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X0RVe.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li><li>在order-service中使用feign-api（引入api的依赖）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>修改order-service中的所有与上述三个组件有关的导包部分，改成导入feign-api中的包</li><li>此时当我们重启测试的时候，就会发现出错了，出错内容如下<br><img src="https://z3.ax1x.com/2021/10/04/4X07Kf.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/04/4X07Kf.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></li></ol><p>这是因为UserClient现在在cn.itcast.feign.clients包下，<br>而order-service的@EnableFeignClients注解是在cn.itcast.order包下，不在同一个包，无法扫描到UserClient。<br>7. 解决扫描包问题</p><p>有两种方法，一种是：指定Feign应该扫描的包</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;cn.itcast.feign.clients&quot;)</span></span><br></pre></td></tr></table></figure><p>一种是指定要加载的Client的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span></span><br></pre></td></tr></table></figure><ol start="8"><li>至此，就设置完毕了</li></ol></div><h2 id="7、Gateway网关"><a href="#7、Gateway网关" class="headerlink" title="7、Gateway网关"></a>7、Gateway网关</h2><div class="story post-story"><p>为什么需要网关？网关用来干嘛<br>网关可以用于：</p><ul><li>身份认证和权限校验</li><li>服务路由、负载均衡</li><li>请求限流</li></ul><p>在SpringCloud中有两种网关服务，一种是Gateway，另一种是Zuul<br>而两者的差别是：Zuul是基于Servlet的实现，属于阻塞式编程。而SpringCloudGateway则是基于Spring5中提供的WebFlux，属于响应式编程的实现，具备更好的性能。</p><h3 id="7-1、搭建一个Gateway网关"><a href="#7-1、搭建一个Gateway网关" class="headerlink" title="7.1、搭建一个Gateway网关"></a>7.1、搭建一个Gateway网关</h3><p>我们需要创建一个网关的类来搭建一个网关，具体步骤如下：</p><ol><li><p>创建新的module，引入SpringCloudGateway的依赖和nacos的服务发现依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--网关依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos服务发现依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>然后在网关的yml文件中编写路由配置及nacos地址</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10010</span> <span class="comment"># 网关端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> <span class="comment"># 路由id，自定义，只要唯一即可</span></span><br><span class="line">          <span class="comment"># uri: http://127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://userservice</span> <span class="comment"># 路由的目标地址 lb就是负载均衡，后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># 路由断言，也就是判断请求是否符合路由规则的条件</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/**</span> <span class="comment"># 这个是按照路径匹配，只要以/user/开头就符合要求</span></span><br></pre></td></tr></table></figure><p>此时，如果我们在控制台输入nacos的地址，以及加上断言中配置好的路径进行访问，就会被网关带到制定好的位置。<br>比如说我访问<code>localhost:8848/user/now</code>，就会被带到userservice的now方法去，这就是网关的服务路由功能，是使用断言来实现的。</p></li></ol><h3 id="7-2、断言工厂"><a href="#7-2、断言工厂" class="headerlink" title="7.2、断言工厂"></a>7.2、断言工厂</h3><p>在yml文件中有这样一个配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predicates：路由断言，判断请求是否符合要求，符合则转发到路由目的地</span><br></pre></td></tr></table></figure><p>我们在配置文件中写的断言规则只是字符串，这些字符串会被<code>Predicate Factory</code>读取并处理，转变为路由判断的条件<br>例如 <code>Path=/user/**</code><br>是按照路径匹配，这个规则是由<code>org.springframework.cloud.gateway.handler.predicate.PathRoutePredicateFactory</code> 类来处理的<br>像这样的断言工厂在<code>SpringCloudGateway</code>还有十几个</p><p>Spring给我们提供了很多种Predicate工厂<br><img src="https://z3.ax1x.com/2021/10/05/4j49G6.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j49G6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><br>但是我们一般用的比较多的还是 <code>Path</code> 这种方式.</p><h3 id="7-3、路由过滤器-过滤器工厂"><a href="#7-3、路由过滤器-过滤器工厂" class="headerlink" title="7.3、路由过滤器/过滤器工厂"></a>7.3、路由过滤器/过滤器工厂</h3><p>GatewayFilter是网关中提供的一种过滤器，可以对进入网关的请求和微服务返回的响应做处理：<br><img src="https://z3.ax1x.com/2021/10/05/4j41sg.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j41sg.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>Spring提供了31种不同的路由过滤器工厂,例如：<br><img src="https://z3.ax1x.com/2021/10/05/4j4yw9.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j4yw9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>现在我们通过一个简单的例子，实际应用一下这个功能：<br>给所有的userservice添加一个请求头</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line"><span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://userservice</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line">  <span class="attr">filters:</span> <span class="comment"># 过滤器</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">GUET</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> <span class="comment"># 添加请求头</span></span><br></pre></td></tr></table></figure><p>此时所有的userservice的请求都加上了<code>Truth, GUET is freaking awesome!</code>这个请求头。</p><p>而此时其他的不受影响，那么怎么样才能修改所有的请求头呢？<br>有一个简单的方法，就是使用 <code>default-filters</code><br>例子如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">application:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">gateway</span> <span class="comment"># 服务名称</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">nacos:</span></span><br><span class="line"><span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># nacos地址</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line"><span class="attr">routes:</span> <span class="comment"># 网关路由配置</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user-service</span> </span><br><span class="line">   <span class="attr">uri:</span> <span class="string">lb://userservice</span> </span><br><span class="line">  <span class="attr">predicates:</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/user/**</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">order-service</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://orderservice</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">Path=/order/**</span></span><br><span class="line"><span class="attr">default-filters:</span> <span class="comment"># 默认过滤器，会对所有的路由请求都生效</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">AddRequestHeader=Truth,</span> <span class="string">GUET</span> <span class="string">is</span> <span class="string">freaking</span> <span class="string">awesome!</span> <span class="comment"># 添加请求头</span></span><br></pre></td></tr></table></figure><p>此时，过滤器并没有指定加载哪一个服务上面，而是加在了<code>routes</code>的同一级上，包括了所有的service服务，所以他的含义就是为所有的服务都统一添加了这样的一个请求头</p><h3 id="7-4、全局过滤器"><a href="#7-4、全局过滤器" class="headerlink" title="7.4、全局过滤器"></a>7.4、全局过滤器</h3><p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与<code>GatewayFilter</code>的作用一样。<br>区别在于<code>GatewayFilter</code>通过配置定义，处理逻辑是固定的。而<code>GlobalFilter</code>的逻辑需要自己写代码实现。<br>定义方式是实现<code>GlobalFilter</code>接口。<br><img src="https://z3.ax1x.com/2021/10/05/4j5I3V.png" class="lazyload" data-srcset="https://z3.ax1x.com/2021/10/05/4j5I3V.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>下面我们以一个案例来说明：</p><p>需求：定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件：</p><ul><li>参数中是否有 <code>authorization</code>，</li><li><code>authorization</code> 参数值是否为admin</li></ul><p>如果同时满足则放行，否则拦截.<br>我们现在自定义一个类，实现FlobalFilter接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(-1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthorizeFilter</span> <span class="keyword">implements</span> <span class="title">GlobalFilter</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.获取请求参数</span></span><br><span class="line">MultiValueMap&lt;String, String&gt; params = exchange.getRequest().getQueryParams();</span><br><span class="line"><span class="comment">// 2.获取authorization参数</span></span><br><span class="line">String auth = params.getFirst(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line"><span class="comment">// 3.校验</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(auth)) &#123;</span><br><span class="line"><span class="comment">// 放行</span></span><br><span class="line"><span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4.拦截</span></span><br><span class="line"><span class="comment">// 4.1.禁止访问</span></span><br><span class="line">exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line"><span class="comment">// 4.2.结束处理</span></span><br><span class="line"><span class="keyword">return</span> exchange.getResponse().setComplete();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意一点，<strong>在Order注解中，包含的值越小，优先级越高</strong></p><p><strong>接下来我们看看过滤器的执行顺序：</strong></p><ul><li>每一个过滤器都必须指定一个int类型的order值，order值越小，优先级越高，执行顺序越靠前。</li><li>GlobalFilter通过实现Ordered接口，或者添加@Order注解来指定order值，由我们自己指定</li><li>路由过滤器和defaultFilter的order由Spring指定，默认是按照声明顺序从1递增。</li><li>当过滤器的order值一样时，会按照 defaultFilter &gt; 路由过滤器 &gt; GlobalFilter的顺序执行。</li></ul><h3 id="7-5、Cors跨域"><a href="#7-5、Cors跨域" class="headerlink" title="7.5、Cors跨域"></a>7.5、Cors跨域</h3><p>跨域：域名不一致就是跨域，主要包括：<br>域名不同： <a href="http://www.taobao.com/">www.taobao.com</a> 和 <a href="http://www.taobao.org/">www.taobao.org</a> 和 <a href="http://www.jd.com/">www.jd.com</a> 和 miaosha.jd.com<br>域名相同，端口不同：localhost:8080和localhost8081<br>跨域问题：浏览器禁止请求的发起者与服务端发生跨域ajax请求，请求被浏览器拦截的问题<br>解决方案：CORS</p><p>只需要简单配置即可实现，如下所示：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">cloud:</span></span><br><span class="line"><span class="attr">gateway:</span></span><br><span class="line"><span class="attr">globalcors:</span> <span class="comment"># 全局的跨域处理</span></span><br><span class="line"><span class="attr">add-to-simple-url-handler-mapping:</span> <span class="literal">true</span> <span class="comment"># 解决options请求被拦截问题</span></span><br><span class="line"><span class="attr">corsConfigurations:</span></span><br><span class="line"><span class="string">&#x27;[/**]&#x27;</span><span class="string">:</span></span><br><span class="line"><span class="attr">allowedOrigins:</span> <span class="comment"># 允许哪些网站的跨域请求 </span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;http://localhost:8090&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;http://www.leyou.com&quot;</span></span><br><span class="line"><span class="attr">allowedMethods:</span> <span class="comment"># 允许的跨域ajax的请求方式</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;GET&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;POST&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;PUT&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line"><span class="attr">allowedHeaders:</span> <span class="string">&quot;*&quot;</span> <span class="comment"># 允许在请求中携带的头信息</span></span><br><span class="line"><span class="attr">allowCredentials:</span> <span class="literal">true</span> <span class="comment"># 是否允许携带cookie</span></span><br><span class="line"><span class="attr">maxAge:</span> <span class="number">360000</span> <span class="comment"># 这次跨域检测的有效期</span></span><br></pre></td></tr></table></figure><p>java代码就会根据上面配置的内容执行跨域的请求。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="SpringCloud" scheme="http://example.com/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_栈实现队列、队列实现栈</title>
    <link href="http://example.com/2021/10/01/2021-10-01-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97%E3%80%81%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E6%A0%88/"/>
    <id>http://example.com/2021/10/01/2021-10-01-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97%E3%80%81%E9%98%9F%E5%88%97%E5%AE%9E%E7%8E%B0%E6%A0%88/</id>
    <published>2021-10-01T03:22:43.000Z</published>
    <updated>2021-10-01T16:05:19.531Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="栈实现队列、队列实现栈"><a href="#栈实现队列、队列实现栈" class="headerlink" title="栈实现队列、队列实现栈"></a>栈实现队列、队列实现栈</h1><h2 id="题目1、用栈来实现队列"><a href="#题目1、用栈来实现队列" class="headerlink" title="题目1、用栈来实现队列"></a>题目1、用栈来实现队列</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/implement-queue-using-stacks/">lettcode-232题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/0e1d526ab12c4731.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/0e1d526ab12c4731.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="1-1、-解题思路"><a href="#1-1、-解题思路" class="headerlink" title="1.1、 解题思路"></a>1.1、 解题思路</h3><p>栈是一个先进后出的数据结构，而队列是一个先进先出的数据结构，所以我们想要用栈来实现队列，就必须要用到两个栈，第一个栈出栈到第二个栈中，第二个栈再进行出栈，就可以实现队列先进先出的功能。</p><p>具体代码如下</p><h3 id="1-2、具体代码"><a href="#1-2、具体代码" class="headerlink" title="1.2、具体代码"></a>1.2、具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyQueue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; a;</span><br><span class="line">    <span class="keyword">private</span> Stack&lt;Integer&gt; b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a=<span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">        b=<span class="keyword">new</span> Stack&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        a.push(x);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span> (!a.isEmpty())&#123;</span><br><span class="line">                b.push(a.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b.pop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回栈顶元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">while</span> (!a.isEmpty())&#123;</span><br><span class="line">                b.push(a.pop());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断栈空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.isEmpty()&amp;&amp;b.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="题目2、用队列来实现栈"><a href="#题目2、用队列来实现栈" class="headerlink" title="题目2、用队列来实现栈"></a>题目2、用队列来实现栈</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/implement-stack-using-queues/">lettcode-225题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/69ec1eaccdf3cbb8.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/69ec1eaccdf3cbb8.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><h3 id="2-1、解题思路"><a href="#2-1、解题思路" class="headerlink" title="2.1、解题思路"></a>2.1、解题思路</h3><p>与上一题相同，我们需要用两个队列来实现一个栈</p><p>利用队列中的基本方法们就可以实现栈的先进后出的操作</p><p>代码如下：</p><h3 id="2-2、具体代码"><a href="#2-2、具体代码" class="headerlink" title="2.2、具体代码"></a>2.2、具体代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Integer&gt; a;</span><br><span class="line">    <span class="keyword">private</span> Queue&lt;Integer&gt; b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyStack</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        b=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        a.offer(x);</span><br><span class="line">        <span class="comment">// 将b队列中元素全部转给a队列</span></span><br><span class="line">        <span class="keyword">while</span>(!b.isEmpty()) &#123;</span><br><span class="line">            a.offer(b.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 交换a和b,使得a队列没有在push()的时候始终为空队列</span></span><br><span class="line">        Queue temp = a;</span><br><span class="line">        a = b;</span><br><span class="line">        b = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 出栈</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.poll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回栈顶元素</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.peek();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断栈是否为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">empty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_最近的请求次数</title>
    <link href="http://example.com/2021/10/01/2021-10-01-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%9C%80%E8%BF%91%E7%9A%84%E8%AF%B7%E6%B1%82%E6%AC%A1%E6%95%B0/"/>
    <id>http://example.com/2021/10/01/2021-10-01-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E6%9C%80%E8%BF%91%E7%9A%84%E8%AF%B7%E6%B1%82%E6%AC%A1%E6%95%B0/</id>
    <published>2021-10-01T02:53:20.000Z</published>
    <updated>2021-10-01T16:05:22.021Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="最近的请求次数"><a href="#最近的请求次数" class="headerlink" title="最近的请求次数"></a>最近的请求次数</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/number-of-recent-calls/">lettcode-933题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/10/19b9897eff6dedb1.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/10/19b9897eff6dedb1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="1633055736251"></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>从题目上来看，一时半会看不出来是什么意思。</p><p>其实所输入的数字t就是一个毫秒数，根据这个数来判断3000毫秒之前的数，如果小于3000毫秒之前的就删除小于的那个。</p><p>所以当我们输入3002时，3000-3000=2，而1小于2，所以1就会被删除。</p><p>所以说这个题是一个先进先出的方式，所以我们可以使用队列来实现。</p><p>具体实现方式如下</p></div><h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RecentCounter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造一个队列，LinkedList的队列</span></span><br><span class="line">    Queue&lt;Integer&gt; queue;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RecentCounter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        queue=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">ping</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将输入的数值入队</span></span><br><span class="line">        queue.add(t);</span><br><span class="line">        <span class="comment">//判断栈顶元素是否小于t-3000</span></span><br><span class="line">        <span class="comment">//如果小于t-3000，将其出队</span></span><br><span class="line">        <span class="keyword">while</span> (queue.peek()&lt;t-<span class="number">3000</span>)&#123;</span><br><span class="line">            queue.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回队列的长度</span></span><br><span class="line">        <span class="keyword">return</span> queue.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Redis使用注解实现二级缓存</title>
    <link href="http://example.com/2021/09/29/2021-09-29-Redis%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98/"/>
    <id>http://example.com/2021/09/29/2021-09-29-Redis%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98/</id>
    <published>2021-09-29T09:34:06.000Z</published>
    <updated>2021-10-01T16:03:41.055Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Redis使用注解实现二级缓存"><a href="#Redis使用注解实现二级缓存" class="headerlink" title="Redis使用注解实现二级缓存"></a>Redis使用注解实现二级缓存</h1><h2 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h2><div class="story post-story"><p>上一篇文章中，我们实现二级缓存的方式是通过java代码判断Redis是否存在缓存，然后决定从何处取数据，但是这种方法在我们有大量的需要用到缓存的地方的时候，会产生大量的冗余代码，而且有大量的判断语句，让我们的代码不能够专注于业务上面，这样子是不太好的。</p><p>所以在Spring的3.1版本之后就引入了对注解的支持，我们可以通过在类上、方法上标记注解来实现二级缓存的存取</p><p>其三个注解分别为：<code>Cacheable</code> ，<code>CacheEvict</code>，<code>CachePut</code></p><p>下面我会将三个注解分别展开进行简单解释</p></div><h2 id="2、Cacheable注解"><a href="#2、Cacheable注解" class="headerlink" title="2、Cacheable注解"></a>2、Cacheable注解</h2><div class="story post-story"><ul><li>@Cacheable可以标记在一个方法上，也可以标记在一个类上。</li><li>对于一个支持缓存的方法，Spring会在其被调用后将其返回值缓存起来，以保证下次利用同样的参数来执行该方法时可以直接从缓存中获取结果，而不需要再次执行该方法。</li><li>Spring在缓存方法的返回值时是以键值对进行缓存的，值就是方法的返回结果。</li><li>至于键的话，Spring又支持两种策略，默认策略和自定义策略，这个稍后会进行说明。</li><li>需要注意的是当一个支持缓存的方法在对象内部被调用时是不会触发缓存功能的。</li><li>@Cacheable可以指定三个属性，value、key和condition。</li></ul><h3 id="2-1、value属性"><a href="#2-1、value属性" class="headerlink" title="2.1、value属性"></a>2.1、value属性</h3><p>value属性是必须指定的，其表示当前方法的返回值是会被缓存在哪个Cache上的，对应Cache的名称。其可以是一个Cache也可以是多个Cache，当需要指定多个Cache时其是一个数组。<br>如下例子所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;selectForAll&quot;)</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;MYBATIS:com.chen.mysqlredisdemo.StudentMapper::AllStudent&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">selectStudentForAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Student&gt; studentList = studentService.selectStudentForAll();</span><br><span class="line">    <span class="keyword">return</span> studentList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2、key属性"><a href="#2-2、key属性" class="headerlink" title="2.2、key属性"></a>2.2、key属性</h3><ul><li>key属性是用来指定Spring缓存方法的返回结果时对应的key的。</li><li>该属性支持SpringEL表达式。当我们没有指定该属性时，Spring将使用默认策略生成key。</li><li>定义策略是指我们可以通过Spring的EL表达式来指定我们的key。这里的EL表达式可以使用方法参数及它们对应的属性。使用方法参数时我们可以直接使用“#参数名”或者“#p参数index”。<br>如下例子所示：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/selectForOne/&#123;sId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;MYBATIS:com.chen.mysqlredisdemo.StudentMapper&quot;, key = &quot;#sId&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">selectStudentForOne</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> sId)</span> </span>&#123;</span><br><span class="line">Student student = studentService.selectStudentForOne(sId);</span><br><span class="line"><span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>此时，如果我查询了一个sId为1800710318的学生<br>那么上面的方法中最后缓存的键为：<code>MYBATIS:com.chen.mysqlredisdemo.StudentMapper::1800710318</code></li></ul><h3 id="2-3、condition属性"><a href="#2-3、condition属性" class="headerlink" title="2.3、condition属性"></a>2.3、condition属性</h3><ul><li>condition属性可以用于指定缓存发生的条件。</li><li>有的时候我们可能并不希望缓存一个方法所有的返回结果，这时候通过condition属性可以实现这一功能。</li><li>condition属性默认为空，表示将缓存所有的调用情形。</li><li>其值是通过SpringEL表达式来指定的，当为true时表示进行缓存处理；当为false时表示不进行缓存处理，即每次调用该方法时该方法都会执行一次。<br>如下例子所示：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/selectForOne/&#123;sId&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;MYBATIS:com.chen.mysqlredisdemo.StudentMapper&quot;, key = &quot;#sId&quot;,condition = &quot;#sId&gt;1800710301&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">selectStudentForOne</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> sId)</span> </span>&#123;</span><br><span class="line">Student student = studentService.selectStudentForOne(sId);</span><br><span class="line"><span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>上面的例子就表示当查询的sId大于1800710318的时候才会执行缓存的操作</li></ul></div><h2 id="3、CachePut注解"><a href="#3、CachePut注解" class="headerlink" title="3、CachePut注解"></a>3、CachePut注解</h2><div class="story post-story"><ul><li>在支持Spring Cache的环境下，对于使用@Cacheable标注的方法，Spring在每次执行前都会检查Cache中是否存在相同key的缓存元素，如果存在就不再执行该方法，而是直接从缓存中获取结果进行返回，否则才会执行并将返回结果存入指定的缓存中。</li><li>@CachePut也可以声明一个方法支持缓存功能。</li><li>与@Cacheable不同的是使用@CachePut标注的方法在执行前不会去检查缓存中是否存在之前执行过的结果，而是每次都会执行该方法，并将执行结果以键值对的形式存入指定的缓存中。</li><li>@CachePut也可以标注在类上和方法上。使用@CachePut时我们可以指定的属性跟@Cacheable是一样的。</li></ul><p>简而言之就是CachePut只会往缓存中写数据，不会从缓存中拿数据</p></div><h2 id="4、CacheEvict注解"><a href="#4、CacheEvict注解" class="headerlink" title="4、CacheEvict注解"></a>4、CacheEvict注解</h2><div class="story post-story"><ul><li>@CacheEvict是用来标注在需要清除缓存元素的方法或类上的。当标记在一个类上时表示其中所有的方法的执行都会触发缓存的清除操作。</li><li>@CacheEvict可以指定的属性有value、key、condition、allEntries和beforeInvocation。</li><li>其中value、key和condition的语义与@Cacheable对应的属性类似。即value表示清除操作是发生在哪些Cache上的（对应Cache的名称）；key表示需要清除的是哪个key，如未指定则会使用默认策略生成的key；condition表示清除操作发生的条件。</li><li>与前面不同的不同的是有了两个多出来的属性：<code>allEntries</code>和<code>beforeInvocation</code></li></ul><h3 id="4-1、allEntries属性"><a href="#4-1、allEntries属性" class="headerlink" title="4.1、allEntries属性"></a>4.1、allEntries属性</h3><ul><li>allEntries是boolean类型，表示是否需要清除缓存中的所有元素。</li><li>默认为false，表示不需要。当指定了allEntries为true时，Spring Cache将忽略指定的key。</li><li>有的时候我们需要Cache一下清除所有的元素，这比一个一个清除元素更有效率。</li></ul><h3 id="4-2、beforeInvocation属性"><a href="#4-2、beforeInvocation属性" class="headerlink" title="4.2、beforeInvocation属性"></a>4.2、beforeInvocation属性</h3><ul><li>清除操作默认是在对应方法成功执行之后触发的，即方法如果因为抛出异常而未能成功返回时也不会触发清除操作。</li><li>使用beforeInvocation可以改变触发清除操作的时间，当我们指定该属性值为true时，Spring会在调用该方法之前清除缓存中的指定元素。</li></ul></div><h2 id="5、Caching注解"><a href="#5、Caching注解" class="headerlink" title="5、Caching注解"></a>5、Caching注解</h2><div class="story post-story"><p>@Caching注解可以让我们在一个方法或者类上同时指定多个Spring Cache相关的注解。<br>其拥有三个属性：cacheable、put和evict，分别用于指定@Cacheable、@CachePut和@CacheEvict。</p><p>其例子如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Caching(cacheable = @Cacheable(&quot;users&quot;), evict = &#123; @CacheEvict(&quot;cache2&quot;), @CacheEvict(value = &quot;cache3&quot;, allEntries = true) &#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">find</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">returnnull;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的例子通过一个Caching注解，实现了三种注解同事的配置，相当于一个大集合</p></div><h2 id="6、总结"><a href="#6、总结" class="headerlink" title="6、总结"></a>6、总结</h2><div class="story post-story"><p>SpringBoot中大量使用了注解、替代了原有的配置文件。<br>大大减少了冗余代码，方便地实现了注解中所设置好的功能。<br>使得我们的代码简洁易懂。<br>除了官方默认的注解，同时我们还可以自定义很多注解，极大方便了我们的使用。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="redis" scheme="http://example.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>Redis入门使用</title>
    <link href="http://example.com/2021/09/29/2021-09-29-Redis%E7%9A%84%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/"/>
    <id>http://example.com/2021/09/29/2021-09-29-Redis%E7%9A%84%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8/</id>
    <published>2021-09-28T17:01:06.000Z</published>
    <updated>2021-10-01T16:03:30.364Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Redis入门使用"><a href="#Redis入门使用" class="headerlink" title="Redis入门使用"></a>Redis入门使用</h1><h2 id="1、Redis简介"><a href="#1、Redis简介" class="headerlink" title="1、Redis简介"></a>1、Redis简介</h2><div class="story post-story"><ol><li><p>简介<br>Redis 是完全开源的，遵守 BSD 协议，是一个高性能的 key-value 数据库。<br>Redis 与其他 key - value 缓存产品有以下三个特点：</p><ul><li>Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。</li><li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li><li>Redis支持数据的备份，即master-slave模式的数据备份。</li></ul></li><li><p>优势</p></li></ol><ul><li>性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。</li><li>丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</li><li>原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。<br>丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</li></ul></div><h2 id="2、Redis安装"><a href="#2、Redis安装" class="headerlink" title="2、Redis安装"></a>2、Redis安装</h2><div class="story post-story"><h3 id="2-1、window安装"><a href="#2-1、window安装" class="headerlink" title="2.1、window安装"></a>2.1、window安装</h3><p>下载地址：<a href="https://github.com/tporadowski/redis/releases%E3%80%82">https://github.com/tporadowski/redis/releases。</a><br>** 根据自己电脑是32位或者64位的下载相对应得版本，就可以进行安装使用 **<br>解压文件夹之后进入文件夹得目录下打开cmd<br>输入以下命令，就可以运行redis<br><code>redis-server.exe redis.windows.conf</code><br>重新打开一个cmd，输入以下命令就可以进行数据库操作<br><code>redis-cli.exe -h 127.0.0.1 -p 6379</code></p><h3 id="2-2、Linux安装"><a href="#2-2、Linux安装" class="headerlink" title="2.2、Linux安装"></a>2.2、Linux安装</h3><p>下载地址：<a href="http://redis.io/download">http://redis.io/download</a> 下载最新稳定版本。<br>在linux中对压缩包进行解压之后<br>进入解压后的文件夹<br>进行make操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> wget http://download.redis.io/releases/redis-6.0.8.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> tar xzf redis-6.0.8.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> redis-6.0.8</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make</span></span><br></pre></td></tr></table></figure><p>make之后，src目录下面就会出现一个<code>redis-server</code>的文件，可以用来启动Redis，如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> src</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./redis-server</span></span><br></pre></td></tr></table></figure><p>除此之外，Redis还给我们提供了一个配置文件，可以修改Redis的配置文件，并运行，如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> src</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ./redis-server ../redis.conf</span></span><br></pre></td></tr></table></figure><h3 id="2-3、Ubuntu-apt-命令安装"><a href="#2-3、Ubuntu-apt-命令安装" class="headerlink" title="2.3、Ubuntu apt 命令安装"></a>2.3、Ubuntu apt 命令安装</h3><p>Ubuntu系统不像其他的linux系统，它可以通过命令来在线安装<br>在 Ubuntu 系统安装 Redis 可以使用以下命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sudo apt update</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sudo apt install redis-server</span></span><br></pre></td></tr></table></figure><p>然后可以启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> redis-server</span></span><br></pre></td></tr></table></figure></div><h2 id="3、Redis的数据类型"><a href="#3、Redis的数据类型" class="headerlink" title="3、Redis的数据类型"></a>3、Redis的数据类型</h2><div class="story post-story"><h3 id="3-1、String类型"><a href="#3-1、String类型" class="headerlink" title="3.1、String类型"></a>3.1、String类型</h3><p>字符串类型，是一种我们平常最常见到的一种数据类型之一<br>我们使用set和get存取数据时，一般就是String的类型，如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; SET name &quot;陈益财&quot;</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; GET name</span><br><span class="line">&quot;陈益财&quot;</span><br></pre></td></tr></table></figure><p>其中，name就是key，”陈益财”就是所对应的值</p><h3 id="3-2、Hash类型"><a href="#3-2、Hash类型" class="headerlink" title="3.2、Hash类型"></a>3.2、Hash类型</h3><p>Redis hash 是一个键值(key=&gt;value)对集合。<br>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象<br>例子如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; HMSET names name1 &quot;chenyicai&quot; name1 &quot;George&quot;</span><br><span class="line">&quot;OK&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; HGET names name1</span><br><span class="line">&quot;Hello&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt; HGET names name1</span><br><span class="line">&quot;World&quot;</span><br></pre></td></tr></table></figure><h3 id="3-3、List类型"><a href="#3-3、List类型" class="headerlink" title="3.3、List类型"></a>3.3、List类型</h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。<br>例子如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; lpush chen redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; lpush chen mongodb</span><br><span class="line">(integer) 2</span><br><span class="line">redis 127.0.0.1:6379&gt; lpush chen rabbitmq</span><br><span class="line">(integer) 3</span><br><span class="line">redis 127.0.0.1:6379&gt; lrange chen 0 10</span><br><span class="line">1) &quot;rabbitmq&quot;</span><br><span class="line">2) &quot;mongodb&quot;</span><br><span class="line">3) &quot;redis&quot;</span><br><span class="line">redis 127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p>其中lpush表示存数据，而lrange表示取数据</p><h3 id="3-4、set类型"><a href="#3-4、set类型" class="headerlink" title="3.4、set类型"></a>3.4、set类型</h3><p>Redis 的 Set 是 string 类型的无序集合。<br>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。<br>例子如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; sadd chen redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd chen mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd chen rabbitmq</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; sadd chen rabbitmq</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; smembers chen</span><br><span class="line"></span><br><span class="line">1) &quot;redis&quot;</span><br><span class="line">2) &quot;rabbitmq&quot;</span><br><span class="line">3) &quot;mongodb&quot;</span><br></pre></td></tr></table></figure><p>其中sadd表示添加数据，smembers表示取出数据<br><strong>注意：以上实例中 rabbitmq 添加了两次，但根据集合内元素的唯一性，第二次插入的元素将被忽略</strong></p><h3 id="3-5、zset类型"><a href="#3-5、zset类型" class="headerlink" title="3.5、zset类型"></a>3.5、zset类型</h3><p>Redis zset 和 set 一样也是string类型元素的集合,<strong>且不允许重复的成员</strong>。<br>不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。<br>zset的成员是唯一的,但分数(score)却可以重复。<br>例子·如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; zadd chen 0 redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd chen 0 mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd chen 0 rabbitmq</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; zadd chen 0 rabbitmq</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZRANGEBYSCORE chen 0 1000</span><br><span class="line">1) &quot;mongodb&quot;</span><br><span class="line">2) &quot;rabbitmq&quot;</span><br><span class="line">3) &quot;redis&quot;</span><br></pre></td></tr></table></figure><p>其中zadd表示存数据，ZRANGEBYSCORE表示取数据<br>且虽然存了两次相同的字符，但是也是只会保留一个</p></div><h2 id="4、在java中使用Redis"><a href="#4、在java中使用Redis" class="headerlink" title="4、在java中使用Redis"></a>4、在java中使用Redis</h2><div class="story post-story"><p>使用Redis更多的情况是在java环境下面使用，所以需要掌握如何在java中对Redis进行操作<br>Redis官方给我们提供了很方便的工具来进行Redis的操作：Jedis</p><p>首先你需要下载驱动包 <a href="https://mvnrepository.com/artifact/redis.clients/jedis">下载 jedis.jar</a>，确保下载最新驱动包。</p><h3 id="4-1、连接到Redis"><a href="#4-1、连接到Redis" class="headerlink" title="4.1、连接到Redis"></a>4.1、连接到Redis</h3><p>配置完成之后我们就可以连接到Redis了。<br>例子如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        <span class="comment">// 如果 Redis 服务设置了密码，需要下面这行，没有就不需要</span></span><br><span class="line">        <span class="comment">// jedis.auth(&quot;123456&quot;); </span></span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">        <span class="comment">//查看服务是否运行</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务正在运行: &quot;</span>+jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是可以连接成功的，就会返回一个PONG表示回应</p><h3 id="4-2、String类型的存储"><a href="#4-2、String类型的存储" class="headerlink" title="4.2、String类型的存储"></a>4.2、String类型的存储</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisStringJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">        <span class="comment">//设置 redis 字符串数据</span></span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;chenyicai&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;redis 存储的字符串为: &quot;</span>+ jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>成功之后控制台就会显示name所对应的值：chenyicai</p><h3 id="4-3、List类型的存储"><a href="#4-3、List类型的存储" class="headerlink" title="4.3、List类型的存储"></a>4.3、List类型的存储</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisListJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">        <span class="comment">//存储数据到列表中</span></span><br><span class="line">        jedis.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;Baidu&quot;</span>);</span><br><span class="line">        jedis.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;Google&quot;</span>);</span><br><span class="line">        jedis.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        List&lt;String&gt; list = jedis.lrange(<span class="string">&quot;site-list&quot;</span>, <span class="number">0</span> ,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;list.size(); i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;列表项为: &quot;</span>+list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>成功之后控制台就会返回信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">列表项为: Taobao</span><br><span class="line">列表项为: Google</span><br><span class="line">列表项为: Baidu</span><br></pre></td></tr></table></figure></div><h2 id="5、在SpringBoot中使用Redis"><a href="#5、在SpringBoot中使用Redis" class="headerlink" title="5、在SpringBoot中使用Redis"></a>5、在SpringBoot中使用Redis</h2><div class="story post-story"><p>一般在SpringBoot中使用Redis时我们会用来做Mysql数据库的二级缓存，这样子在我们获取数据的时候就不需要每次都到数据库进行查询，如果缓存中有数据就可以直接从缓存中拿，大大提高了查询的效率。</p><ol><li><p>首先我们需要在maven中引入我们所需要的依赖</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li><li><p>然后在yml配置文件中，配置Redis的相关配置文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  redis:</span><br><span class="line">    database: <span class="number">0</span></span><br><span class="line">    host: localhost</span><br><span class="line">    port: <span class="number">6379</span></span><br><span class="line">    password:</span><br><span class="line">    timeout: <span class="number">500</span></span><br><span class="line">    pool:</span><br><span class="line">      max-active: <span class="number">8</span></span><br><span class="line">      max-idle: <span class="number">8</span></span><br><span class="line">      min-idle: <span class="number">0</span></span><br><span class="line">      max-wait: -<span class="number">1</span></span><br></pre></td></tr></table></figure></li><li><p>我们还需要一个Config类来处理数据的序列化，否则双方可能会出现乱码的情况</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisConnectionFactory redisConnectionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisConfig</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisConnectionFactory = redisConnectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redisTemplate 序列化使用的jdkSerializeable, 存储二进制字节码, 所以自定义序列化类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Jackson2JsonRedisSerialize 替换默认序列化</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line"></span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置value的序列化规则和 key的序列化规则</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><p>创建一个cache的实现类用于将查出来的数据添加到缓存中，并设置一些缓存的配置,里面包括了一些有关增删改的配置方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisRedisCache</span> <span class="keyword">implements</span> <span class="title">Cache</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Object key;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReadWriteLock readWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;Object, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String COMMON_CACHE_KEY = <span class="string">&quot;MYBATIS:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 默认缓存对象的缓存时间为 1 分钟</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPRIRE_TIME_IN_MINUT = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MybatisRedisCache</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;缓存对象id是不能为空的&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RedisTemplate&lt;Object, Object&gt; <span class="title">getRedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (redisTemplate == <span class="keyword">null</span>) &#123;</span><br><span class="line">            redisTemplate = ApplicationContextHolder.getBean(<span class="string">&quot;redisTemplate&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putObject</span><span class="params">(Object key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RedisTemplate redisTemplate = getRedisTemplate();</span><br><span class="line">            <span class="comment">//使用redisTemplate得到值操作对象</span></span><br><span class="line">            ValueOperations operation = redisTemplate.opsForValue();</span><br><span class="line">            <span class="comment">//使用值操作对象operation设置缓存对象</span></span><br><span class="line">            operation.set(getKey(key), value, EXPRIRE_TIME_IN_MINUT, TimeUnit.MINUTES);</span><br><span class="line"><span class="comment">//            System.out.println(&quot;缓存对象保存成功&quot;);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;缓存对象保存失败&quot;</span> + t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            setKey(key);</span><br><span class="line">            RedisTemplate redisTemplate = getRedisTemplate();</span><br><span class="line">            ValueOperations operations = redisTemplate.opsForValue();</span><br><span class="line">            Object result = operations.get(getKey(key));</span><br><span class="line"><span class="comment">//            System.out.println(&quot;获取缓存对象成功&quot;);</span></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;缓存对象获取失败&quot;</span> + t);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">removeObject</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RedisTemplate redisTemplate = getRedisTemplate();</span><br><span class="line">            redisTemplate.delete(getKey(key));</span><br><span class="line"><span class="comment">//            System.out.println(&quot;删除缓存对象成功！&quot;+key);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;删除缓存对象失败！&quot;</span> + t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RedisTemplate redisTemplate = getRedisTemplate();</span><br><span class="line">            Set&lt;String&gt; keys = redisTemplate.keys(getKeys());</span><br><span class="line">            redisTemplate.delete(keys);</span><br><span class="line">            System.out.println(<span class="string">&quot;出现新增、修改、删除操作，清空对应Mapper缓存======&gt;&quot;</span> + keys.size());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 按照一定规则标识key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getKey</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        String k=COMMON_CACHE_KEY + <span class="keyword">this</span>.id + <span class="string">&quot;:&quot;</span> + DigestUtils.md5DigestAsHex(String.valueOf(key).getBytes());</span><br><span class="line">        <span class="keyword">return</span> k;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所有key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getKeys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> COMMON_CACHE_KEY + <span class="keyword">this</span>.id + <span class="string">&quot;:*&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Long size = getRedisTemplate().boundHashOps(getId()).size();</span><br><span class="line">        <span class="keyword">return</span> size == <span class="keyword">null</span> ? <span class="number">0</span> : size.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ReadWriteLock <span class="title">getReadWriteLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> readWriteLock;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>然后我们在数据库查询的<code>mapper.xml</code>上添加上以下的配置，表示开启了数据库的二级缓存</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.chen.mysqlredisdemo.cache.MybatisRedisCache&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>然后在Controller文件中注入刚才写好的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure></li><li><p>最后在方法中判断Redis中是否有缓存，如果有就从Redis中取数据，否则就到数据库进行查找</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/selectForOne/&#123;sId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">selectStudentForOne</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> sId)</span></span>&#123;</span><br><span class="line">        String key = <span class="string">&quot;MYBATIS:&quot;</span> + <span class="string">&quot;com.chen.mysqlredisdemo.StudentMapper:&quot;</span>+sId;</span><br><span class="line">        ValueOperations&lt;String, Student&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">        <span class="keyword">boolean</span> hasKey = redisTemplate.hasKey(key);</span><br><span class="line">        <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;缓存输出&quot;</span>);</span><br><span class="line">            Student student = operations.get(key);</span><br><span class="line">            <span class="keyword">return</span> student;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            Student student = studentService.selectStudentForOne(sId);</span><br><span class="line">            operations.set(key, student);<span class="comment">//把数据放入缓存</span></span><br><span class="line">            <span class="keyword">return</span> student;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="redis" scheme="http://example.com/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_设计有序流</title>
    <link href="http://example.com/2021/09/26/2021-09-26-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1%E6%9C%89%E5%BA%8F%E6%B5%81/"/>
    <id>http://example.com/2021/09/26/2021-09-26-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1%E6%9C%89%E5%BA%8F%E6%B5%81/</id>
    <published>2021-09-26T13:47:00.000Z</published>
    <updated>2021-10-01T16:03:13.089Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="设计有序流"><a href="#设计有序流" class="headerlink" title="设计有序流"></a>设计有序流</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/design-an-ordered-stream/">lettcode-1656题</a><br>难度：简单<img src="https://i.bmp.ovh/imgs/2021/09/3e508439a8f7dbe3.png" class="lazyload" data-srcset="https://i.bmp.ovh/imgs/2021/09/3e508439a8f7dbe3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>既然是一个有序流，那么我们就可以将其存储到一个数组中，然后通过数组下标对所在的值进行访问。所以我们首先创建一个长度为n+1的数组，将value的值存在其中。<br>将下标指针的值设置为1，然后在执行时进行循环加1</p><p>接下来就是循环读取的过程：<br>当我们在数组中插入一个数据的时候，就判断一个数组下标是否小于n，以及当前下标处的value值是否不为空，如果不为空我们就进入循环，将其存到一个新的集合中，并将其输出。<br>如果为空的时候就不执行方法，继续往数组中添加value<br>直到下标不小于n为止</p></div><h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrderedStream</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] arr;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> ptr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderedStream</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//因为数组的下标n从0开始，所以数组的长度为n+1</span></span><br><span class="line">        <span class="keyword">this</span>.arr=<span class="keyword">new</span> String[n+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">this</span>.n=n;</span><br><span class="line">        <span class="keyword">this</span>.ptr=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">insert</span><span class="params">(<span class="keyword">int</span> idKey, String value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将value存到数组中</span></span><br><span class="line">        arr[idKey]=value;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个新的数组</span></span><br><span class="line">        List&lt;String&gt; res=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//循环读取arr数组，将其中的值写到res数组中</span></span><br><span class="line">        <span class="comment">//当arr[]为null时，不进入循环</span></span><br><span class="line">        <span class="keyword">while</span> (ptr&lt;=n&amp;&amp;arr[ptr]!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            res.add(arr[ptr]);</span><br><span class="line">            ptr++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>算法学习_设计停车系统</title>
    <link href="http://example.com/2021/09/26/2021-09-26-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1%E5%81%9C%E8%BD%A6%E7%B3%BB%E7%BB%9F/"/>
    <id>http://example.com/2021/09/26/2021-09-26-%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0_%E8%AE%BE%E8%AE%A1%E5%81%9C%E8%BD%A6%E7%B3%BB%E7%BB%9F/</id>
    <published>2021-09-26T06:06:30.000Z</published>
    <updated>2021-10-01T16:03:08.988Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="设计停车系统"><a href="#设计停车系统" class="headerlink" title="设计停车系统"></a>设计停车系统</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><div class="story post-story"><p><a href="https://leetcode-cn.com/problems/design-parking-system/">lettcode-1603题</a><br>难度：简单<img src="https://s3.bmp.ovh/imgs/2021/09/a5c6d4d87d542ba7.png" class="lazyload" data-srcset="https://s3.bmp.ovh/imgs/2021/09/a5c6d4d87d542ba7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h2><div class="story post-story"><p>每种车都有每种车所对应的一个车位，而且不能停到其他车的车位上面去，所以说我们需要三个变量将每种车的车位数量存起来。<br>然后在有新车进来时，判断车辆的类型，然后查找相应的停车位，如果有车位就返回一个true，相当于停车成功，然后该类型的车位减去一个，如果车位为0，则不允许停车，返回false</p></div><h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><div class="story post-story"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParkingSystem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> big;</span><br><span class="line">    <span class="keyword">int</span> medium;</span><br><span class="line">    <span class="keyword">int</span> small;</span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParkingSystem</span><span class="params">(<span class="keyword">int</span> big, <span class="keyword">int</span> medium, <span class="keyword">int</span> small)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.big=big;</span><br><span class="line">        <span class="keyword">this</span>.medium=medium;</span><br><span class="line">        <span class="keyword">this</span>.small=small;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addCar</span><span class="params">(<span class="keyword">int</span> carType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (carType==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.big&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.big--;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (carType==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.medium&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.medium--;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (carType==<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.small&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.small--;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="算法" scheme="http://example.com/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>java栈</title>
    <link href="http://example.com/2021/09/25/2021-09-25-java%E6%A0%88/"/>
    <id>http://example.com/2021/09/25/2021-09-25-java%E6%A0%88/</id>
    <published>2021-09-25T05:40:27.000Z</published>
    <updated>2021-10-01T16:03:05.711Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="java栈"><a href="#java栈" class="headerlink" title="java栈"></a>java栈</h1><p>栈是一个先进后出的数据结构，想要自己实现一个栈，要求这个栈具有push()，pop()——返回栈顶并出栈，peek()——返回栈顶不出栈，isEmpty()等方法。</p><h2 id="1-1、手动实现一个栈的多种方式"><a href="#1-1、手动实现一个栈的多种方式" class="headerlink" title="1.1、手动实现一个栈的多种方式"></a>1.1、手动实现一个栈的多种方式</h2><div class="story post-story"><ol><li><p>采用数组来实现栈</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> testDemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> abc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/9/25 19:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack1</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实现栈的数组</span></span><br><span class="line">    <span class="keyword">private</span> Object[] stack;</span><br><span class="line">    <span class="comment">// 数组大小</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    Stack1()&#123;</span><br><span class="line">        stack=<span class="keyword">new</span> Object[<span class="number">10</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断数组是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (size==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回栈顶元素</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span></span>&#123;</span><br><span class="line">        T t=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            t= (T) stack[size-<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 返回栈顶并出栈</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        T t=peek();</span><br><span class="line">        <span class="keyword">if</span>(size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            stack[size-<span class="number">1</span>]=<span class="keyword">null</span>;</span><br><span class="line">            size--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 扩容</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">expandCapacity</span><span class="params">(<span class="keyword">int</span> size)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len=stack.length;</span><br><span class="line">        <span class="keyword">if</span> (size&gt;len)&#123;</span><br><span class="line">            size=size*<span class="number">3</span>/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">            stack= Arrays.copyOf(stack,size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">        expandCapacity(size+<span class="number">1</span>);</span><br><span class="line">        stack[size]=t;</span><br><span class="line">        size++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stack1&lt;String&gt; stringStack1=<span class="keyword">new</span> Stack1&lt;&gt;();</span><br><span class="line">        System.out.println(stringStack1.peek());</span><br><span class="line">        System.out.println(stringStack1.isEmpty());</span><br><span class="line">        stringStack1.push(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        stringStack1.push(<span class="string">&quot;chenyc2021@qq.com&quot;</span>);</span><br><span class="line">        stringStack1.push(<span class="string">&quot;gogogo&quot;</span>);</span><br><span class="line">        System.out.println(stringStack1.pop());</span><br><span class="line">        System.out.println(stringStack1.isEmpty());</span><br><span class="line">        System.out.println(stringStack1.peek());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>采用链表来实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> testDemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> abc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/9/26 0:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack2</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个链表</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> T t;</span><br><span class="line">        <span class="keyword">private</span> Node next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node&lt;T&gt; head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    Stack2() &#123;</span><br><span class="line">        head = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 入栈</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;参数不能为空&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            head = <span class="keyword">new</span> Node&lt;T&gt;();</span><br><span class="line">            head.t = t;</span><br><span class="line">            head.next = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;T&gt; temp = head;</span><br><span class="line">            head = <span class="keyword">new</span> Node&lt;T&gt;();</span><br><span class="line">            head.t = t;</span><br><span class="line">            head.next = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 出栈</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T t = head.t;</span><br><span class="line">        head = head.next;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 栈顶元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        T t = head.t;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断栈是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkStack</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stack2 stack = <span class="keyword">new</span> Stack2();</span><br><span class="line">        System.out.println(stack.isEmpty());</span><br><span class="line">        stack.push(<span class="string">&quot;Java&quot;</span>);</span><br><span class="line">        stack.push(<span class="string">&quot;is&quot;</span>);</span><br><span class="line">        stack.push(<span class="string">&quot;beautiful&quot;</span>);</span><br><span class="line">        System.out.println(stack.peek());</span><br><span class="line">        System.out.println(stack.peek());</span><br><span class="line">        System.out.println(stack.pop());</span><br><span class="line">        System.out.println(stack.pop());</span><br><span class="line">        System.out.println(stack.isEmpty());</span><br><span class="line">        System.out.println(stack.pop());</span><br><span class="line">        System.out.println(stack.isEmpty());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>采用LinkedList实现栈</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> George</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> testDemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> abc</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/9/26 9:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack3</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 构建一个linkedLIst集合</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;T&gt; ll=<span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断栈是否为空</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ll.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 入栈</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">        ll.addFirst(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//出栈</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ll.removeFirst();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 栈顶元素</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">peek</span><span class="params">()</span></span>&#123;</span><br><span class="line">        T t=<span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (!ll.isEmpty())&#123;</span><br><span class="line">            t=ll.getFirst();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedStack</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Stack3&lt;String&gt; stringStack3=<span class="keyword">new</span> Stack3&lt;&gt;();</span><br><span class="line">        System.out.println(stringStack3.isEmpty());</span><br><span class="line">        System.out.println(stringStack3.peek());</span><br><span class="line">        stringStack3.push(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        stringStack3.push(<span class="string">&quot;is&quot;</span>);</span><br><span class="line">        stringStack3.push(<span class="string">&quot;beautiful&quot;</span>);</span><br><span class="line">        System.out.println(stringStack3.peek());</span><br><span class="line">        System.out.println(stringStack3.pop());</span><br><span class="line">        System.out.println(stringStack3.isEmpty());</span><br><span class="line">        System.out.println(stringStack3.peek());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></div><h2 id="1-2、栈的应用"><a href="#1-2、栈的应用" class="headerlink" title="1.2、栈的应用"></a>1.2、栈的应用</h2><div class="story post-story"><p>在java中，栈是一种很重要的数据结构，如以下的很多场景都应用到了栈</p><ul><li>符号匹配</li><li>中缀表达式变为后缀表达式</li><li>计算后缀表达式</li><li>实现函数的嵌套调用</li><li>HTML和XML中的标签匹配</li><li>网页浏览器中以访问界面的历史记录</li></ul><p>例如：</p><ol><li>符号匹配<br>在编写程序的过程中，我们经常会遇到诸如圆括号“()”与花括号“{}”，这些符号都必须是左右匹配的，这就是我们所说的符合匹配类型，当然符合不仅需要个数相等，而且需要先左后右的依次出现，否则就不符合匹配规则，如“)(”，明显是错误的匹配，而“()”才是正确的匹配。有时候符合如括号还会嵌套出现，如“9-(5+(5+1))”,而嵌套的匹配原则是一个右括号与其前面最近的一个括号匹配，事实上编译器帮我检查语法错误是也是执行一样的匹配原理，而这一系列操作都需要借助栈来完成，接下来我们使用栈来实现括号”()”是否匹配的检测。<br>判断原则如下（str=”((5-3)*8-2)”）：</li></ol><p>a.设置str是一个表达式字符串，从左到右依次对字符串str中的每个字符char进行语法检测，如果char是，左括号则入栈，如果char是右括号则出栈(有一对匹配就可以去匹配一个左括号，因此可以出栈)，若此时出栈的字符char为左括号，则说明这一对括号匹配正常，如果此时栈为空或者出栈字符不为左括号，则表示缺少与char匹配的左括号，即目前不完整。</p><p>b.重复执行a操作，直到str检测结束，如果此时栈为空，则全部括号匹配，如果栈中还有左括号，是说明缺少右括号。</p><p>实现代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckExpression</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">isValid</span><span class="params">(String expstr)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="comment">//创建栈</span></span><br><span class="line">      LinkedStack&lt;String&gt; stack = <span class="keyword">new</span> LinkedStack&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span>(i&lt;expstr.length())</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">char</span> ch=expstr.charAt(i);</span><br><span class="line">          i++;</span><br><span class="line">          <span class="keyword">switch</span>(ch)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>: stack.push(ch+<span class="string">&quot;&quot;</span>);<span class="comment">//左括号直接入栈</span></span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>: <span class="keyword">if</span> (stack.isEmpty() || !stack.pop().equals(<span class="string">&quot;(&quot;</span>)) <span class="comment">//遇见右括号左括号直接出栈</span></span><br><span class="line">                  <span class="keyword">return</span> <span class="string">&quot;(&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//最后检测是否为空,为空则检测通过</span></span><br><span class="line">      <span class="keyword">if</span>(stack.isEmpty())</span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;check pass!&quot;</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">return</span> <span class="string">&quot;check exception!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      String expstr=<span class="string">&quot;((5-3)*8-2)&quot;</span>;</span><br><span class="line">      System.out.println(expstr+<span class="string">&quot;  &quot;</span>+isValid(expstr));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="数据结构" scheme="http://example.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>准备阅读小米十年纪念《一往无前》</title>
    <link href="http://example.com/2021/08/27/2021-08-27-%E5%87%86%E5%A4%87%E9%98%85%E8%AF%BB%E5%B0%8F%E7%B1%B3%E5%8D%81%E5%B9%B4%E7%BA%AA%E5%BF%B5%E3%80%8A%E4%B8%80%E5%BE%80%E6%97%A0%E5%89%8D%E3%80%8B%20-%20%E5%89%AF%E6%9C%AC%20-%20%E5%89%AF%E6%9C%AC/"/>
    <id>http://example.com/2021/08/27/2021-08-27-%E5%87%86%E5%A4%87%E9%98%85%E8%AF%BB%E5%B0%8F%E7%B1%B3%E5%8D%81%E5%B9%B4%E7%BA%AA%E5%BF%B5%E3%80%8A%E4%B8%80%E5%BE%80%E6%97%A0%E5%89%8D%E3%80%8B%20-%20%E5%89%AF%E6%9C%AC%20-%20%E5%89%AF%E6%9C%AC/</id>
    <published>2021-08-26T16:46:22.000Z</published>
    <updated>2021-10-01T16:03:00.504Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="准备阅读小米十年纪念《一往无前》"><a href="#准备阅读小米十年纪念《一往无前》" class="headerlink" title="准备阅读小米十年纪念《一往无前》"></a>准备阅读小米十年纪念《一往无前》</h1><p>作为一个不太资深的老米粉，自从小米发布新书《一往无前》以来一直想阅读一下，感受一下大厂发展的心路历程，但是一直都没有提上日程，而今天决定正式开始阅读此书，但是可能耗时会较长，现在这里做一个标记，阅读完毕务必完成一篇读后感。</p><hr><p>2021.09.21 因为一直都在面试，所以阅读计划得往后推迟一点了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="随笔" scheme="http://example.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>对SpringIOC的理解</title>
    <link href="http://example.com/2021/08/26/2021-08-26-%E5%AF%B9SpringIOC%E7%9A%84%E7%90%86%E8%A7%A3/"/>
    <id>http://example.com/2021/08/26/2021-08-26-%E5%AF%B9SpringIOC%E7%9A%84%E7%90%86%E8%A7%A3/</id>
    <published>2021-08-26T01:45:01.000Z</published>
    <updated>2021-10-01T16:02:45.849Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="对SpringIOC的理解"><a href="#对SpringIOC的理解" class="headerlink" title="对SpringIOC的理解"></a>对SpringIOC的理解</h1><h2 id="1、何为IOC"><a href="#1、何为IOC" class="headerlink" title="1、何为IOC"></a>1、何为IOC</h2><div class="story post-story"><p>​    IOC—Inversion of Control，即“控制反转”，不是什么技术，而是一种设计思想。在Java开发中，IOC意味着将你设计好的对象交给容器控制，而不是传统的在你的对象内部直接控制。如何理解好IOC呢？理解好Ioc的关键是要明确“谁控制谁，控制什么，为何是反转（有反转就应该有正转了），哪些方面反转了”，那我们来分析一下</p><h3 id="1-1-谁控制谁，控制什么"><a href="#1-1-谁控制谁，控制什么" class="headerlink" title="1.1 谁控制谁，控制什么"></a>1.1 谁控制谁，控制什么</h3><p>​    传统Java程序设计，我们直接在对象内部通过new进行创建对象，是程序主动去创建依赖对象；而IOC是有专门一个容器来创建这些对象，即由IOC容器来控制对象的创建；谁控制谁？当然是IOC 容器控制了对象；控制什么？那就是主要控制了外部资源获取（不只是对象包括比如文件等）</p><h3 id="1-2-为何是反转，哪些方面反转了"><a href="#1-2-为何是反转，哪些方面反转了" class="headerlink" title="1.2 为何是反转，哪些方面反转了"></a>1.2 为何是反转，哪些方面反转了</h3><p>​    有反转就有正转，传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，也就是正转；而反转则是由容器来帮忙创建及注入依赖对象；为何是反转？因为由容器帮我们查找及注入依赖对象，对象只是被动的接受依赖对象，所以是反转；哪些方面反转了？依赖对象的获取被反转了。</p><h3 id="1-3-图例说明"><a href="#1-3-图例说明" class="headerlink" title="1.3 图例说明"></a>1.3 图例说明</h3><p>传统程序设计下图，都是主动去创建相关对象然后再组合起来：    </p><p><img src="https://s3.bmp.ovh/imgs/2021/08/38929d2b7cf05cd7.jpg" class="lazyload" data-srcset="https://s3.bmp.ovh/imgs/2021/08/38929d2b7cf05cd7.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p><p>当有了IoC/DI的容器后，在客户端类中不再主动去创建这些对象了，如下图所示：</p><p><img src="https://s3.bmp.ovh/imgs/2021/08/c7705f5db3bbd643.png" class="lazyload" data-srcset="https://s3.bmp.ovh/imgs/2021/08/c7705f5db3bbd643.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></p></div><h2 id="2、IOC能做什么"><a href="#2、IOC能做什么" class="headerlink" title="2、IOC能做什么"></a>2、IOC能做什么</h2><div class="story post-story"><p>​    IOC 不是一种技术，只是一种思想，一个重要的面向对象编程的法则，它能指导我们如何设计出松耦合、更优良的程序。传统应用程序都是由我们在类内部主动创建依赖对象，从而导致类与类之间高耦合，难于测试；有了IOC容器后，把创建和查找依赖对象的控制权交给了容器，由容器进行注入组合对象，所以对象与对象之间是松散耦合，这样也方便测试，利于功能复用，更重要的是使得程序的整个体系结构变得非常灵活。<br>　　其实IOC对编程带来的最大改变不是从代码上，而是从思想上，发生了“主从换位”的变化。应用程序原本是老大，要获取什么资源都是主动出击，但是在IOC/DI思想中，应用程序就变成被动的了，被动的等待IOC容器来创建并注入它所需要的资源了。<br>　　IOC很好的体现了面向对象设计法则之一—— 好莱坞法则：“别找我们，我们找你”；即由IOC容器帮对象找相应的依赖对象并注入，而不是由对象主动去找。</p></div><h2 id="3、IOC和DI"><a href="#3、IOC和DI" class="headerlink" title="3、IOC和DI"></a>3、IOC和DI</h2><div class="story post-story"><p>​    DI—Dependency Injection，即“依赖注入”：组件之间依赖关系由容器在运行期决定，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是为了提升组件重用的频率，并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。</p><p>理解DI的关键是：“谁依赖谁，为什么需要依赖，谁注入谁，注入了什么”，那我们来分析一下：</p><ul><li><p>谁依赖于谁：当然是应用程序依赖于IOC容器；</p></li><li><p>为什么需要依赖：应用程序需要IOC容器来提供对象需要的外部资源；</p></li><li><p>谁注入谁：很明显是IOC容器注入应用程序某个对象，应用程序依赖的对象；</p></li><li><p>注入了什么：就是注入某个对象所需要的外部资源（包括对象、资源、常量数据）。</p><p>  IOC和DI由什么关系呢？其实它们是同一个概念的不同角度描述，由于控制反转概念比较含糊（可能只是理解为容器控制对象这一个层面，很难让人想到谁来维护对象关系），所以2004年大师级人物Martin Fowler又给出了一个新的名字：“依赖注入”，相对IOC而言，“依赖注入”明确描述了“被注入对象依赖IoC容器配置依赖对象”。</p></li></ul></div><h2 id="4、对IOC和DI的理解"><a href="#4、对IOC和DI的理解" class="headerlink" title="4、对IOC和DI的理解"></a>4、对IOC和DI的理解</h2><div class="story post-story"><h3 id="4-1、IoC-控制反转"><a href="#4-1、IoC-控制反转" class="headerlink" title="4.1、IoC(控制反转)"></a>4.1、IoC(控制反转)</h3><p>　　首先想说说IoC（Inversion of Control，控制反转）。这是spring的核心，贯穿始终。所谓IoC，对于spring框架来说，就是由spring来负责控制对象的生命周期和对象间的关系。这是什么意思呢，举个简单的例子，我们是如何找女朋友的？常见的情况是，我们到处去看哪里有长得漂亮身材又好的mm，然后打听她们的兴趣爱好、qq号、电话号、ip号、iq号………，想办法认识她们，投其所好送其所要，然后嘿嘿……这个过程是复杂深奥的，我们必须自己设计和面对每个环节。传统的程序开发也是如此，在一个对象中，如果要使用另外的对象，就必须得到它（自己new一个，或者从JNDI中查询一个），使用完之后还要将对象销毁（比如Connection等），对象始终会和其他的接口或类藕合起来。<br>　　那么IoC是如何做的呢？有点像通过婚介找女朋友，在我和女朋友之间引入了一个第三者：婚姻介绍所。婚介管理了很多男男女女的资料，我可以向婚介提出一个列表，告诉它我想找个什么样的女朋友，比如长得像李嘉欣，身材像林熙雷，唱歌像周杰伦，速度像卡洛斯，技术像齐达内之类的，然后婚介就会按照我们的要求，提供一个mm，我们只需要去和她谈恋爱、结婚就行了。简单明了，如果婚介给我们的人选不符合要求，我们就会抛出异常。整个过程不再由我自己控制，而是有婚介这样一个类似容器的机构来控制。Spring所倡导的开发方式就是如此，所有的类都会在spring容器中登记，告诉spring你是个什么东西，你需要什么东西，然后spring会在系统运行到适当的时候，把你要的东西主动给你，同时也把你交给其他需要你的东西。所有的类的创建、销毁都由 spring来控制，也就是说控制对象生存周期的不再是引用它的对象，而是spring。对于某个具体的对象而言，以前是它控制其他对象，现在是所有对象都被spring控制，所以这叫控制反转。</p><h3 id="4-2、DI-依赖注入"><a href="#4-2、DI-依赖注入" class="headerlink" title="4.2、DI(依赖注入)"></a>4.2、DI(依赖注入)</h3><p>　　IoC的一个重点是在系统运行中，动态的向某个对象提供它所需要的其他对象。这一点是通过DI（Dependency Injection，依赖注入）来实现的。比如对象A需要操作数据库，以前我们总是要在A中自己编写代码来获得一个Connection对象，有了 spring我们就只需要告诉spring，A中需要一个Connection，至于这个Connection怎么构造，何时构造，A不需要知道。在系统运行时，spring会在适当的时候制造一个Connection，然后像打针一样，注射到A当中，这样就完成了对各个对象之间关系的控制。A需要依赖 Connection才能正常运行，而这个Connection是由spring注入到A中的，依赖注入的名字就这么来的。那么DI是如何实现的呢？ Java 1.3之后一个重要特征是反射（reflection），它允许程序在运行的时候动态的生成对象、执行对象的方法、改变对象的属性，spring就是通过反射来实现注入的。<br>　　理解了IoC和DI的概念后，一切都将变得简单明了，剩下的工作只是在spring的框架中堆积木而已。　　　　</p></div><h2 id="5、原文地址"><a href="#5、原文地址" class="headerlink" title="5、原文地址"></a>5、原文地址</h2><div class="story post-story"><p><a href="https://www.iteye.com/blog/jinnianshilongnian-1413846">https://www.iteye.com/blog/jinnianshilongnian-1413846</a></p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>最近一段时间的学习总结</title>
    <link href="http://example.com/2021/08/20/2021-08-20-%E6%9C%80%E8%BF%91%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    <id>http://example.com/2021/08/20/2021-08-20-%E6%9C%80%E8%BF%91%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E7%9A%84%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</id>
    <published>2021-08-19T17:16:32.000Z</published>
    <updated>2021-10-01T16:02:28.182Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="最近一段时间的学习总结"><a href="#最近一段时间的学习总结" class="headerlink" title="最近一段时间的学习总结"></a>最近一段时间的学习总结</h1><h2 id="项目部分"><a href="#项目部分" class="headerlink" title="项目部分"></a>项目部分</h2><div class="story post-story"><ol><li>完成了学生宿舍系统的答辩</li><li>成功将学生宿舍为系统部署到了服务器上</li><li>准备进行学生宿舍系统的小程序的设计，但是实在是没有时间</li><li>完成了国医堂小程序的开发(React+Taro+Taro UI)</li><li>完成了小程序API的开发(Vue+SpringBoot+MyBatis-Plus)</li><li>国医堂小程序后台开发完毕(VUE+SpringBoot+MyBatis-Plus+Element-UI)</li><li>准备进行中医药门户或者桂林医学院报修系统开发环境的搭建</li></ol></div><h2 id="框架部分"><a href="#框架部分" class="headerlink" title="框架部分"></a>框架部分</h2><div class="story post-story"><ol><li>学习了SpringSecurity，并完成了Session以及Token两种情况下的应用Demo</li><li>MyBatis-Plus逆向工程(代码生成器)</li><li>Shiro的基本使用</li><li>入门Activiti(工作流)</li><li>准备学些RabbitMQ、</li><li>MyBatis-Plus逆向工程3.5.0版本之之前是setting模式，之后是building模式</li><li>入门了React以及Vue两个有名的前端框架的使用</li><li>ElementUI，LayUI，Bootstrap等UI的使用</li></ol></div><h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><div class="story post-story"><ol><li>复习了下AOP思想，并准备使用到日志中</li><li>HashMap和HashTable的区别</li></ol></div><h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><div class="story post-story"><ol><li>手动将web项目部署到阿里云服务器上</li><li>复习了Linux的指令</li></ol></div><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><div class="story post-story"><p>看到同学面试京东所回答的问题，以及其他同学所总结的知识点，感觉自己和别人相比有很大的进步空间</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="学习总结" scheme="http://example.com/tags/%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
    
  </entry>
  
  <entry>
    <title>shiro安全框架</title>
    <link href="http://example.com/2021/08/01/2021-08-01-shiro%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6/"/>
    <id>http://example.com/2021/08/01/2021-08-01-shiro%E5%AE%89%E5%85%A8%E6%A1%86%E6%9E%B6/</id>
    <published>2021-08-01T12:19:41.000Z</published>
    <updated>2021-10-01T16:02:30.173Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="shiro安全框架"><a href="#shiro安全框架" class="headerlink" title="shiro安全框架"></a>shiro安全框架</h1><h2 id="1、简述"><a href="#1、简述" class="headerlink" title="1、简述"></a>1、简述</h2><div class="story post-story"><p>shiro是apache公司所出品的开源安全框架<br>其可以用于：</p><ol><li>处理身份认证</li><li>授权</li><li>企业会话管理和加密</li></ol><p>相对于Spring security来说更加简单，使用也更加灵活</p><p>在使用shiro的时候可以不依赖于任何容器，既可以在javaSE下使用，同样可以在JavaEE下使用</p></div><h2 id="2、架构"><a href="#2、架构" class="headerlink" title="2、架构"></a>2、架构</h2><div class="story post-story"><ol><li>使用用户的登录信息构建令牌<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line"></span><br></pre></td></tr></table></figure>token可以理解为一个用户令牌，等于的过程可以理解为shiro检验用户令牌是否具有合法的身份以及相关的权限</li><li>执行登录</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SecurityUtils.setSecurityManager(securityManager); <span class="comment">// 注入SecurityManager</span></span><br><span class="line">Subject subject = SecurityUtils.getSubject(); <span class="comment">// 获取Subject单例对象</span></span><br><span class="line">subject.login(token); <span class="comment">// 执行登录</span></span><br></pre></td></tr></table></figure><p>shiro中最核心的部分就是securityManger，它主要负责安全认证和授权。当我们在使用这个框架的时候，shiro已经将一切的操作封装成一个盒子了，我们在使用的时候可以把它当成一个黑盒来进行使用。SecurityUtils对象，本质上就是一个工厂类似Spring中的ApplicationContext。Subject，翻译过来就是项目的意思，他是一个需要通过shiro保护的一个抽象概念。<br>通过1令牌和项目的登录关系，保证了我们的安全。</p><ol start="3"><li>判断用户</li></ol><p>这一步中的内容shiro无法帮我们进行实现，我们只有通过最原始的手段来实现登录用户的判断，就是查询数据库。</p><p>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!token.getUsername().equals(name)) &#123;</span><br><span class="line">  <span class="comment">//shiro底层会抛出一个异常</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//判断密码</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(<span class="string">&quot;&quot;</span>, password, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><p>第一个if语句中首先会判断数据库中查到的name于输入的用户名2是否一致，如果不一致，则会抛出一个异常<br>然后SimpleAuthenticationInfo中可以用于判断密码的正确性，同样是从数据库查出来的数据做对比。</p></div><h2 id="3、实现Realm"><a href="#3、实现Realm" class="headerlink" title="3、实现Realm"></a>3、实现Realm</h2><div class="story post-story"><ol><li>创建一个Realm</li></ol><p>Realm即领域，相当于datasource数据源，securityManager进行安全认证需要通过Realm获取用户权限数据，比如：如果用户身份数据在数据库那么realm就需要从数据库获取用户身份信息，但是Realm并不止局限于数据的存取，其中还有很多认证授权校验相关的代码<br>我们可以自定义一个MyRealm，用于我们的项目之中，但是前提是这个类必须继承于AuthorizingRealm父类，然后实现两个方法<br>AuthorizationInfo doGetAuthorizationInfo以及AuthenticationInfo doGetAuthenticationInfo<br>AuthenticationInfo代表了用户的角色信息集合，AuthorizationInfo代表了角色的权限信息集合。如此一来，当设计人员对项目中的某一个url路径设置了只允许某个角色或具有某种权限才可以访问的控制约束的时候，Shiro就可以通过以上两个对象来判断。</p><p>我们也可以简单看作：<br><strong>doGetAuthenticationInfo()</strong> 方法：用来验证当前登录的用户，获取认证信息。<br><strong>doGetAuthorizationInfo()</strong> 方法：为当前登录成功的用户授予权限和分配角色。</p><ol start="2"><li>从数据库查询数据</li></ol><p>在数据库中查询登陆人信息的时候，仅仅需要查询用户的id，这时还未涉及到密码，也就是说即使用户输入的密码不正确，照样可以查询出该用户。<br>然后，将该用户的相关信息封装到authcInfo中并返回给Shiro接下来就该Shiro上场了，将封装的用户信息与用户的输入信息（用户名、密码）进行对比、校验（注意，这里对密码也要进行校验）。校验通过则允许用户登录，否则跳转到指定页面。</p></div><h2 id="4、Shiro配置"><a href="#4、Shiro配置" class="headerlink" title="4、Shiro配置"></a>4、Shiro配置</h2><div class="story post-story"><ol><li>在ShiroConfig中配置Realm</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name=&quot;MyRealm&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MyRealm <span class="title">myRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyRealm();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>配置安全管理器SecurityManager</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name=&quot;securityManager&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">getDefaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;MyRealm&quot;)</span> MyRealm myRealm)</span> </span>&#123;</span><br><span class="line">    DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">    <span class="comment">//关联Realm</span></span><br><span class="line">    securityManager.setRealm(myRealm);</span><br><span class="line">    <span class="keyword">return</span> securityManager;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>当我们配置安全管理器的时候，需要将前面的Realm添加进来，这样子才可以访问到Realm</p><ol start="3"><li>配置Shiro过滤器</li></ol><p>shiro中自带好了配置的过滤器，我们在使用之前需要将其进行导入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line"><span class="comment">//设置安全管理器</span></span><br><span class="line">shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line"><span class="comment">//添加Shiro内置过滤器</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Shiro内置过滤器，可以实现权限相关的拦截器</span></span><br><span class="line"><span class="comment">常用的有：</span></span><br><span class="line"><span class="comment">anon：无需认证就能访问</span></span><br><span class="line"><span class="comment">authc：必须认证才能访问</span></span><br><span class="line"><span class="comment">user：必须拥有 “记住我” 功能才能使用</span></span><br><span class="line"><span class="comment">perms：拥有对某个资源的权限才能访问</span></span><br><span class="line"><span class="comment">role： 拥有对某个角色权限才能访问</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">LinkedHashMap&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;String,String&gt;();</span><br><span class="line"><span class="comment">//这里我们要将不进行拦截的放在前面</span></span><br><span class="line">filterMap.put(<span class="string">&quot;/login&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/*&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//最后设置验证失败的时候所跳转的界面</span></span><br><span class="line">shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br></pre></td></tr></table></figure><p>此时当我们未登陆的时候，点击被拦截的模块，就会跳到我们所指定的网页，而没有拦截的网页则可以正常显示。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="shiro" scheme="http://example.com/tags/shiro/"/>
    
  </entry>
  
  <entry>
    <title>springboot+mybatis整合支付宝支付</title>
    <link href="http://example.com/2021/07/22/2021-07-22-springboot+mybatis%E6%95%B4%E5%90%88%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98/"/>
    <id>http://example.com/2021/07/22/2021-07-22-springboot+mybatis%E6%95%B4%E5%90%88%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%AF%E4%BB%98/</id>
    <published>2021-07-22T04:13:22.000Z</published>
    <updated>2021-11-18T15:31:43.830Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="springboot-mybatis整合支付宝支付"><a href="#springboot-mybatis整合支付宝支付" class="headerlink" title="springboot+mybatis整合支付宝支付"></a>springboot+mybatis整合支付宝支付</h1><h2 id="准备支付宝沙箱环境"><a href="#准备支付宝沙箱环境" class="headerlink" title="准备支付宝沙箱环境"></a>准备支付宝沙箱环境</h2><div class="story post-story"><hr><p>需要三个网站来准备支付宝的沙箱环境：</p><ol><li><a href="https://opendocs.alipay.com/open/54/104506">支付宝开放平台</a></li><li><a href="https://openhome.alipay.com/platform/appDaily.htm?tab=info">开放平台-沙箱环境</a></li><li><a href="https://openhome.alipay.com/platform/appDaily.htm?tab=info">miniU研发工作室</a></li></ol></div><h2 id="具体配置过程百度即可"><a href="#具体配置过程百度即可" class="headerlink" title="具体配置过程百度即可"></a>具体配置过程百度即可</h2><div class="story post-story"><h2 id="bean类"><a href="#bean类" class="headerlink" title="bean类"></a>bean类</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">package cn.edu.guet.bean;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author George</span><br><span class="line"> * @project DormitorySystem</span><br><span class="line"> * @package cn.edu.guet.bean</span><br><span class="line"> * @date 2021/7/22 11:35</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line">public class AlipayBean &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 商户订单号，必填</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    private String out_trade_no;</span><br><span class="line">    /**</span><br><span class="line">     * 订单名称，必填</span><br><span class="line">     */</span><br><span class="line">    private String subject;</span><br><span class="line">    /**</span><br><span class="line">     * 付款金额，必填</span><br><span class="line">     * 根据支付宝接口协议，必须使用下划线</span><br><span class="line">     */</span><br><span class="line">    private String total_amount;</span><br><span class="line">    /**</span><br><span class="line">     * 商品描述，可空</span><br><span class="line">     */</span><br><span class="line">    private String body;</span><br><span class="line">    /**</span><br><span class="line">     * 超时时间参数</span><br><span class="line">     */</span><br><span class="line">    private String timeout_express= &quot;10m&quot;;</span><br><span class="line">    /**</span><br><span class="line">     * 产品编号</span><br><span class="line">     */</span><br><span class="line">    private String product_code= &quot;FAST_INSTANT_TRADE_PAY&quot;;</span><br><span class="line"></span><br><span class="line">    public String getOut_trade_no() &#123;</span><br><span class="line">        return out_trade_no;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOut_trade_no(String out_trade_no) &#123;</span><br><span class="line">        this.out_trade_no = out_trade_no;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getSubject() &#123;</span><br><span class="line">        return subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSubject(String subject) &#123;</span><br><span class="line">        this.subject = subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTotal_amount() &#123;</span><br><span class="line">        return total_amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTotal_amount(String total_amount) &#123;</span><br><span class="line">        this.total_amount = total_amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getBody() &#123;</span><br><span class="line">        return body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBody(String body) &#123;</span><br><span class="line">        this.body = body;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getTimeout_express() &#123;</span><br><span class="line">        return timeout_express;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTimeout_express(String timeout_express) &#123;</span><br><span class="line">        this.timeout_express = timeout_express;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getProduct_code() &#123;</span><br><span class="line">        return product_code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProduct_code(String product_code) &#123;</span><br><span class="line">        this.product_code = product_code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h2 id="alipayConfig类"><a href="#alipayConfig类" class="headerlink" title="alipayConfig类"></a>alipayConfig类</h2><div class="story post-story"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">package cn.edu.guet.config;</span><br><span class="line"></span><br><span class="line">import java.io.FileWriter;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">/**</span><br><span class="line"> * @author George</span><br><span class="line"> * @project DormitorySystem</span><br><span class="line"> * @package cn.edu.guet.config</span><br><span class="line"> * @date 2021/7/22 13:16</span><br><span class="line"> * @since 1.0</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class AlipayConfig &#123;</span><br><span class="line"></span><br><span class="line">//↓↓↓↓↓↓↓↓↓↓请在这里配置您的基本信息↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span><br><span class="line"></span><br><span class="line">    // 应用ID,您的APPID，收款账号既是您的APPID对应支付宝账号</span><br><span class="line">    public static String app_id = &quot;2021000117643373&quot;;</span><br><span class="line">    // 商户私钥，您的PKCS8格式RSA2私钥</span><br><span class="line">    public static String merchant_private_key = &quot;&quot;;</span><br><span class="line">    // 支付宝公钥,查看地址：https://openhome.alipay.com/platform/keyManage.htm 对应APPID下的支付宝公钥。</span><br><span class="line">    public static String alipay_public_key = &quot;&quot;;</span><br><span class="line">    // 服务器异步通知页面路径  需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span><br><span class="line">    public static String notify_url = &quot;http://localhost:8082&quot;;</span><br><span class="line">    // 页面跳转同步通知页面路径 需http://格式的完整路径，不能加?id=123这类自定义参数，必须外网可以正常访问</span><br><span class="line">    public static String return_url = &quot;http://localhost:8082&quot;;</span><br><span class="line">    // 签名方式</span><br><span class="line">    public static String sign_type = &quot;RSA2&quot;;</span><br><span class="line">    // 字符编码格式</span><br><span class="line">    public static String charset = &quot;utf-8&quot;;</span><br><span class="line">    // 支付宝网关</span><br><span class="line">    public static String gatewayUrl = &quot;https://openapi.alipaydev.com/gateway.do&quot;;</span><br><span class="line">    // 支付宝网关</span><br><span class="line">    public static String log_path = &quot;C:\\&quot;;</span><br><span class="line"></span><br><span class="line">//↑↑↑↑↑↑↑↑↑↑请在这里配置您的基本信息↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 写日志，方便测试（看网站需求，也可以改成把记录存入数据库）</span><br><span class="line">     * @param sWord 要写入日志里的文本内容</span><br><span class="line">     */</span><br><span class="line">    public static void logResult(String sWord) &#123;</span><br><span class="line">        FileWriter writer = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            writer = new FileWriter(log_path + &quot;alipay_log_&quot; + System.currentTimeMillis()+&quot;.txt&quot;);</span><br><span class="line">            writer.write(sWord);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (writer != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    writer.close();</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><h2 id="controller控制器"><a href="#controller控制器" class="headerlink" title="controller控制器"></a>controller控制器</h2><div class="story post-story"><p><strong>支付</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">@Controller</span><br><span class="line">public class AlipayController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/pay&quot;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    public void payController(HttpServletRequest request, HttpServletResponse response) throws IOException, AlipayApiException &#123;</span><br><span class="line">        // 获取初始化的AliPayClient</span><br><span class="line">        AlipayClient alipayClient = new DefaultAlipayClient(</span><br><span class="line">                AlipayConfig.gatewayUrl,</span><br><span class="line">                AlipayConfig.app_id,</span><br><span class="line">                AlipayConfig.merchant_private_key,</span><br><span class="line">                &quot;json&quot;,</span><br><span class="line">                AlipayConfig.charset,</span><br><span class="line">                AlipayConfig.alipay_public_key,</span><br><span class="line">                AlipayConfig.sign_type);</span><br><span class="line">        // 设置请求参数</span><br><span class="line">        AlipayTradePagePayRequest alipayRequest = new AlipayTradePagePayRequest();</span><br><span class="line">        alipayRequest.setReturnUrl(AlipayConfig.return_url);</span><br><span class="line">        alipayRequest.setNotifyUrl(AlipayConfig.notify_url);</span><br><span class="line">        //商户订单号，商户网站订单系统中唯一订单号，必填</span><br><span class="line">        String out_trade_no = new String(request.getParameter(&quot;WIDout_trade_no&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;);</span><br><span class="line">        //付款金额，必填</span><br><span class="line">        String total_amount = new String(request.getParameter(&quot;WIDtotal_amount&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;);</span><br><span class="line">        //订单名称，必填</span><br><span class="line">        String subject = new String(request.getParameter(&quot;WIDsubject&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;);</span><br><span class="line">        //商品描述，可空</span><br><span class="line">        String body = new String(request.getParameter(&quot;WIDbody&quot;).getBytes(&quot;ISO-8859-1&quot;),&quot;UTF-8&quot;);</span><br><span class="line">        alipayRequest.setBizContent(&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;+ out_trade_no +&quot;\&quot;,&quot;</span><br><span class="line">                + &quot;\&quot;total_amount\&quot;:\&quot;&quot;+ total_amount +&quot;\&quot;,&quot;</span><br><span class="line">                + &quot;\&quot;subject\&quot;:\&quot;&quot;+ subject +&quot;\&quot;,&quot;</span><br><span class="line">                + &quot;\&quot;body\&quot;:\&quot;&quot;+ body +&quot;\&quot;,&quot;</span><br><span class="line">                + &quot;\&quot;product_code\&quot;:\&quot;FAST_INSTANT_TRADE_PAY\&quot;&#125;&quot;);</span><br><span class="line">        //若想给BizContent增加其他可选请求参数，以增加自定义超时时间参数timeout_express来举例说明</span><br><span class="line">        //alipayRequest.setBizContent(&quot;&#123;\&quot;out_trade_no\&quot;:\&quot;&quot;+ out_trade_no +&quot;\&quot;,&quot;</span><br><span class="line">        //+ &quot;\&quot;total_amount\&quot;:\&quot;&quot;+ total_amount +&quot;\&quot;,&quot;</span><br><span class="line">        //+ &quot;\&quot;subject\&quot;:\&quot;&quot;+ subject +&quot;\&quot;,&quot;</span><br><span class="line">        //+ &quot;\&quot;body\&quot;:\&quot;&quot;+ body +&quot;\&quot;,&quot;</span><br><span class="line">        //+ &quot;\&quot;timeout_express\&quot;:\&quot;10m\&quot;,&quot;</span><br><span class="line">        //+ &quot;\&quot;product_code\&quot;:\&quot;FAST_INSTANT_TRADE_PAY\&quot;&#125;&quot;);</span><br><span class="line">        //请求参数可查阅【电脑网站支付的API文档-alipay.trade.page.pay-请求参数】章节</span><br><span class="line"></span><br><span class="line">        //请求</span><br><span class="line">        String result = alipayClient.pageExecute(alipayRequest).getBody();</span><br><span class="line"></span><br><span class="line">        //输出</span><br><span class="line">        response.setContentType(&quot;text/html;charset=&quot;+AlipayConfig.charset);</span><br><span class="line">        response.getWriter().write(result);</span><br><span class="line">        response.getWriter().flush();</span><br><span class="line">        response.getWriter().close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="java" scheme="http://example.com/tags/java/"/>
    
    <category term="SpringBoot" scheme="http://example.com/tags/SpringBoot/"/>
    
    <category term="MyBatis" scheme="http://example.com/tags/MyBatis/"/>
    
  </entry>
  
</feed>
